import{r as t,a as B,j as e,s as g}from"./index-7uJ0qKqD.js";import{H as J,a as Q}from"./HeroSliderSkeleton-D1XTqloE.js";import{S as W,G as X,T as Z,Y as ee}from"./TagFilter-ticWPhTP.js";import{M as se}from"./MovieGrid-DoFVm-rM.js";import{M as _}from"./MovieGridSkeleton-DW-WaVP_.js";import{P as re}from"./Pagination-BK7uePpH.js";import"./MovieCardSkeleton--xuy0sGE.js";import"./useWatchLater-B27ka-37.js";const h=30,me=()=>{const[b,k]=t.useState([]),[j,R]=t.useState([]),[v,Y]=t.useState(0),[A,q]=t.useState([]),[F,H]=t.useState([]),[L,$]=t.useState([]),[x,w]=t.useState(!0),[D,y]=t.useState(!0),[E,P]=t.useState(null),[c,I]=t.useState("all"),[d,M]=t.useState([]),[m,N]=t.useState([]),[u,K]=t.useState("createdAt_desc"),[f,T]=B(),p=parseInt(f.get("page")||"1",10),l=t.useCallback(r=>{const s=new URLSearchParams(f);r<=1?s.delete("page"):s.set("page",r.toString()),T(s,{replace:!0}),window.scrollTo(0,0)},[f,T]);t.useEffect(()=>{(async()=>{try{w(!0);const[s,o,a,i]=await Promise.all([g.from("categories").select("name").order("name"),g.from("movies").select("tags").eq("is_kurdish",!0),g.from("movies").select("year").eq("is_kurdish",!0),g.from("movies").select("*").eq("is_kurdish",!0).order("created_at",{ascending:!1}).limit(5)]);if(s.error)throw new Error(`Categories Error: ${s.error.message}`);if(q(s.data.map(n=>n.name)),o.error)throw new Error(`Tags Error: ${o.error.message}`);if(H([...new Set(o.data.flatMap(n=>n.tags||[]))].sort()),a.error)throw new Error(`Years Error: ${a.error.message}`);if($([...new Set(a.data.map(n=>n.year))].sort((n,S)=>Number(S)-Number(n))),i.error)throw new Error(`Hero Movies Error: ${i.error.message}`);k(i.data)}catch(s){console.error("Error fetching initial Kurdish data: ",s.message),P("فشل تحميل البيانات الأولية.")}finally{w(!1)}})()},[]),t.useEffect(()=>{x||(async()=>{y(!0);const s=(p-1)*h,o=s+h-1;let a=g.from("movies").select("*",{count:"exact"}).eq("is_kurdish",!0);c!=="all"&&(a=a.eq("year",c)),d.length>0&&(a=a.contains("genres",d)),m.length>0&&(a=a.contains("tags",m));const[i,n]=u.split("_");a=a.order(i==="createdAt"?"created_at":i,{ascending:n==="asc"}),a=a.range(s,o);const{data:S,error:G,count:V}=await a;G?(console.error("Error fetching paginated Kurdish movies: ",G.message),P("فشل تحميل الأفلام.")):(R(S),Y(V||0)),y(!1)})()},[p,c,d,m,u,x]);const O=r=>{l(1),M(s=>s.includes(r)?s.filter(o=>o!==r):[...s,r])},z=r=>{l(1),N(s=>s.includes(r)?s.filter(o=>o!==r):[...s,r])},U=c!=="all"||d.length>0||m.length>0||u!=="createdAt_desc",C=Math.ceil(v/h);return x?e.jsxs("div",{children:[e.jsx(J,{}),e.jsx("div",{className:"my-8 h-20 bg-gray-800/50 rounded-lg animate-pulse"}),e.jsxs("section",{className:"mb-12",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"الأفلام المدبلجة للكردية"}),e.jsx(_,{count:18})]})]}):E&&b.length===0?e.jsxs("div",{className:"text-center p-8 bg-red-900/20 border border-red-500/50 rounded-lg mt-8 animate-fade-in",children:[e.jsx("h2",{className:"text-2xl text-red-400 mb-4",children:"حدث خطأ في الاتصال بقاعدة البيانات"}),e.jsx("p",{className:"text-slate-300 whitespace-pre-line",children:E}),e.jsx("p",{className:"text-slate-400 mt-4",children:"Please check your Supabase dashboard to ensure the 'movies' and 'categories' tables are readable by anonymous users via RLS policies."})]}):e.jsxs("div",{className:"animate-fade-in",children:[e.jsx(Q,{movies:b}),e.jsx("div",{className:"relative z-30 my-8 flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl",children:e.jsxs("div",{className:"w-full md:w-auto flex flex-col md:flex-row md:flex-wrap justify-center items-center gap-4",children:[e.jsx(W,{sortOrder:u,onSortChange:r=>{l(1),K(r)}}),e.jsx(X,{genres:A,selectedGenres:d,onToggleGenre:O,onClearGenres:()=>{l(1),M([])}}),e.jsx(Z,{tags:F,selectedTags:m,onToggleTag:z,onClearTags:()=>{l(1),N([])}}),e.jsx(ee,{years:L,selectedYear:c,onYearChange:r=>{l(1),I(r)}})]})}),e.jsxs("section",{className:"mb-12",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:U?`نتائج (${v})`:"الأفلام المدبلجة للكردية"}),D?e.jsx(_,{count:h}):j.length>0?e.jsxs(e.Fragment,{children:[e.jsx(se,{movies:j}),C>1&&e.jsx(re,{currentPage:p,totalPages:C,onPageChange:l})]}):e.jsx("div",{className:"text-center p-8 bg-gray-800 rounded-lg mt-8",children:e.jsx("p",{className:"text-xl text-gray-400",children:"لا توجد أفلام مدبلجة للكردية تطابق معايير البحث."})})]})]})};export{me as default};
