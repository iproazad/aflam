import{u as N,r as i,d as w,F as S,T as y,R as L,j as e,L as k}from"./index-CYpngbW4.js";import{F as C,S as R}from"./SpinnerIcon-DH8b2oYa.js";const W=()=>{const{currentUser:s}=N(),[n,r]=i.useState([]);i.useEffect(()=>{if(!s){r([]);return}const x=w.collection("user_lists").doc(s.uid).onSnapshot(m=>{if(m.exists){const l=m.data();r((l==null?void 0:l.favoriteSeries)||[])}else r([])},m=>{console.error("Error listening to favorite series:",m)});return()=>x()},[s]);const g=i.useCallback(async o=>{if(!s){console.warn("User must be logged in to manage favorite series.");return}const x=w.collection("user_lists").doc(s.uid),m=n.includes(o);try{m?await x.update({favoriteSeries:S.arrayRemove(o)}):await x.set({favoriteSeries:S.arrayUnion(o)},{merge:!0})}catch(l){console.error("Error toggling favorite series in Firestore:",l)}},[s,n]),u=i.useCallback(o=>n.includes(o),[n]);return{favoriteSeries:n,toggleFavoriteSeries:g,isFavoriteSeries:u}},I=()=>{const{currentUser:s}=N(),[n,r]=i.useState([]),[g,u]=i.useState(!1);i.useEffect(()=>{if(!s){r([]);return}const c=w.collection("user_lists").doc(s.uid).onSnapshot(d=>{if(d.exists){const a=d.data(),b=(a==null?void 0:a.watchLaterSeries)||[];b.sort((p,t)=>{var v,f;return(((v=t.addedAt)==null?void 0:v.toMillis())||0)-(((f=p.addedAt)==null?void 0:f.toMillis())||0)}),r(b)}else r([])},d=>{console.error("Error listening to watch later series list:",d)});return()=>c()},[s]);const o=i.useCallback(async(h,c,d)=>{var p;if(!s){console.warn("User must be logged in to manage watch later list.");return}u(!0);const a=w.collection("user_lists").doc(s.uid),b={seriesId:h,season:c,episode:d,addedAt:y.now()};try{const t=await a.get();if(t.exists){const f=[...(((p=t.data())==null?void 0:p.watchLaterSeries)||[]).filter(j=>j.seriesId!==h),b];await a.update({watchLaterSeries:f})}else await a.set({watchLaterSeries:[b]})}catch(t){console.error("Error adding to watch later series in Firestore:",t)}finally{u(!1)}},[s]),x=i.useCallback(async h=>{var d;if(!s)return;u(!0);const c=w.collection("user_lists").doc(s.uid);try{const a=await c.get();if(a.exists){const p=(((d=a.data())==null?void 0:d.watchLaterSeries)||[]).filter(t=>t.seriesId!==h);await c.update({watchLaterSeries:p})}}catch(a){console.error("Error removing from watch later series in Firestore:",a)}finally{u(!1)}},[s]),m=i.useCallback(h=>n.some(c=>c.seriesId===h),[n]),l=i.useCallback(h=>n.find(c=>c.seriesId===h),[n]);return{watchLaterSeries:n,addWatchLaterSeries:o,removeWatchLaterSeries:x,isWatchLaterSeries:m,getWatchLaterInfo:l,loading:g}},F=({isFavorite:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 sm:h-6 sm:w-6 transition-all duration-300 ${s?"text-red-500":"text-white"}`,fill:s?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 016.364 6.364L12 20.364l-7.682-7.682a4.5 4.5 0 010-6.364z"})}),E=({isWatchLater:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 sm:h-6 sm:w-6 transition-all duration-300 ${s?"text-cyan-400":"text-white"}`,fill:s?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),$=({series:s,isFavorite:n,isWatchLater:r,onToggleFavorite:g,onToggleWatchLater:u,watchLaterInfo:o=null})=>{const{currentUser:x}=N(),[m,l]=i.useState(!1),h=a=>{a.preventDefault(),a.stopPropagation(),g(s.id)},c=a=>{a.preventDefault(),a.stopPropagation(),u(s)},d=o?`/series/${s.id}?season=${o.season}&episode=${o.episode}`:`/series/${s.id}`;return e.jsx("div",{className:"relative group",children:e.jsxs(k,{to:d,className:"relative block z-10 rounded-lg overflow-hidden shadow-lg hover:shadow-xl hover:shadow-cyan-500/20 transform transition-all duration-300 ease-in-out group-hover:scale-105 bg-slate-800",children:[x&&e.jsxs("div",{className:"absolute top-1.5 right-1.5 z-20 flex flex-col gap-1.5 opacity-0 group-hover:opacity-100 translate-y-2 group-hover:translate-y-0 transition-all duration-300",children:[e.jsx("button",{onClick:h,className:"p-1.5 bg-slate-900/60 rounded-full hover:bg-slate-900/80 transition-all duration-200 hover:scale-110","aria-label":n?"إزالة من المفضلة":"إضافة إلى المفضلة",children:e.jsx(F,{isFavorite:n})}),e.jsx("button",{onClick:c,className:"p-1.5 bg-slate-900/60 rounded-full hover:bg-slate-900/80 transition-all duration-200 hover:scale-110","aria-label":r?"إزالة من قائمة المشاهدة لاحقاً":"إضافة إلى قائمة المشاهدة لاحقاً",children:e.jsx(E,{isWatchLater:r})})]}),e.jsx("div",{className:"relative w-full aspect-[2/3] bg-slate-800 overflow-hidden",children:e.jsx("img",{src:s.posterUrl,loading:"lazy",onLoad:()=>l(!0),alt:s.title,className:`
              w-full h-full object-cover
              transition-all duration-700 ease-in-out group-hover:opacity-75
              ${m?"scale-100 blur-0":"scale-110 blur-md"}
            `})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/70 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 sm:p-3 md:p-4 transition-all duration-300 group-hover:-translate-y-1",children:[e.jsx("h3",{className:"text-white text-sm sm:text-base font-bold truncate",children:s.title}),e.jsxs("div",{className:"mt-1 flex justify-between items-center",children:[e.jsx("p",{className:"text-slate-300 text-xs sm:text-sm",children:s.year}),s.imdbRating&&s.imdbRating>0?e.jsxs("div",{className:"flex items-center gap-1.5",title:`IMDb Rating: ${s.imdbRating}/10`,children:[e.jsx("span",{className:"bg-yellow-500 text-black text-xs sm:text-sm font-bold px-2 py-0.5 rounded-sm",children:"IMDb"}),e.jsx("span",{className:"font-bold text-white text-sm",children:s.imdbRating.toFixed(1)})]}):e.jsx("div",{className:"h-5"})]}),o&&e.jsxs("div",{className:"mt-1.5 text-center text-xs font-bold text-cyan-200 bg-cyan-500/20 px-2 py-1 rounded-sm",children:["استئناف م",o.season," ح",o.episode]})]})]})})},z=L.memo($),D=({isOpen:s,onClose:n,series:r,onSave:g,isSaving:u})=>{var p;const[o,x]=i.useState(1),[m,l]=i.useState(1);if(i.useEffect(()=>{if(r&&r.seasons.length>0){const t=r.seasons[0];x(t.seasonNumber),t.episodes.length>0&&l(t.episodes[0].episodeNumber)}},[r]),!r)return null;const h=()=>{g(o,m)},c=t=>{const v=Number(t.target.value);x(v);const f=r.seasons.find(j=>j.seasonNumber===v);f&&f.episodes.length>0?l(f.episodes[0].episodeNumber):l(1)},d=r.seasons||[],a=((p=d.find(t=>t.seasonNumber===o))==null?void 0:p.episodes)||[],b="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition cursor-pointer";return e.jsx(C,{isOpen:s,onClose:n,title:`أضف "${r.title}" للمشاهدة لاحقاً`,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("p",{className:"text-slate-300",children:"اختر الحلقة التي توقفت عندها للعودة إليها بسهولة لاحقًا."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"season",className:"block text-sm font-medium text-slate-300 mb-2",children:"الموسم"}),e.jsx("select",{id:"season",value:o,onChange:c,className:b,children:d.map(t=>e.jsxs("option",{value:t.seasonNumber,children:["الموسم ",t.seasonNumber]},t.seasonNumber))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"episode",className:"block text-sm font-medium text-slate-300 mb-2",children:"الحلقة"}),e.jsx("select",{id:"episode",value:m,onChange:t=>l(Number(t.target.value)),className:b,children:a.map(t=>e.jsxs("option",{value:t.episodeNumber,children:["الحلقة ",t.episodeNumber,": ",t.title]},t.episodeNumber))})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t border-slate-700",children:[e.jsx("button",{onClick:n,disabled:u,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{onClick:h,disabled:u,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",children:[u&&e.jsx(R,{}),u?"جاري الحفظ...":"حفظ واستئناف"]})]})]})})};export{D as R,z as S,I as a,W as u};
