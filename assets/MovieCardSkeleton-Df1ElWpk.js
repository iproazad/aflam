import{r as l,j as c}from"./index-BoJC5ASQ.js";const x="ImageCacheDB",I=1,i="images",v=1440*60*1e3;let u=null;function h(){return u||(u=new Promise((e,t)=>{if(!("indexedDB"in window)){t("IndexedDB not supported");return}const r=indexedDB.open(x,I);r.onerror=()=>{console.error("IndexedDB error:",r.error),t("Error opening IndexedDB."),u=null},r.onsuccess=()=>{e(r.result)},r.onupgradeneeded=s=>{const n=s.target.result;n.objectStoreNames.contains(i)||n.createObjectStore(i,{keyPath:"url"})}}),u)}async function j(e){try{const t=await h();return new Promise((r,s)=>{const g=t.transaction(i,"readonly").objectStore(i).get(e);g.onerror=()=>{s("Error getting image from cache.")},g.onsuccess=()=>{const o=g.result;if(o&&Date.now()-o.timestamp<v)r(o.blob);else{if(o)try{t.transaction(i,"readwrite").objectStore(i).delete(e)}catch{}r(null)}}})}catch(t){return console.error("Failed to access IndexedDB:",t),null}}async function y(e,t){try{const n=(await h()).transaction(i,"readwrite").objectStore(i),a={url:e,blob:t,timestamp:Date.now()};n.put(a)}catch(r){console.error("Failed to add image to IndexedDB cache:",r)}}const m=new Map;async function w(e){if(!e)return"";if(m.has(e))return m.get(e);try{const t=await j(e);if(t){const a=URL.createObjectURL(t);return m.set(e,a),a}const r=await fetch(e);if(!r.ok)throw new Error(`Fetch failed with status ${r.status}`);const s=await r.blob();y(e,s.slice());const n=URL.createObjectURL(s);return m.set(e,n),n}catch(t){return console.error(`Failed to get or cache image ${e}:`,t),e}}const D=e=>{const[t,r]=l.useState(e);return l.useEffect(()=>{let s=!0;return e&&w(e).then(n=>{s&&r(n)}),()=>{s=!1}},[e]),t},B=e=>{const[t,r]=l.useState(void 0),[s,n]=l.useState(!1),a=l.useRef(null);return l.useEffect(()=>{let o;const d=a.current;let b=!0;return d&&!t&&(o=new IntersectionObserver(([f])=>{f.isIntersecting&&b&&(w(e).then(p=>{b&&r(p)}),o.unobserve(f.target))},{rootMargin:"0px 0px 200px 0px"}),o.observe(d)),()=>{b=!1,o&&d&&o.unobserve(d)}},[e,t]),{imageRef:a,imageSrc:t,isLoaded:s,handleImageLoad:()=>{n(!0)}}},N=()=>c.jsxs("div",{className:"block group relative rounded-lg overflow-hidden shadow-lg bg-gray-800 animate-pulse",children:[c.jsx("div",{className:"relative w-full aspect-[2/3] bg-gray-700"}),c.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"}),c.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 sm:p-3 md:p-4",children:[c.jsx("div",{className:"h-5 bg-gray-600 rounded w-3/4 mb-2"}),c.jsxs("div",{className:"flex justify-between items-center mt-1",children:[c.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"}),c.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})]})]})]});export{N as M,B as a,D as u};
