import{r as o,j as e,s as S,f as Be,R as Ze}from"./index-DVThGNSq.js";import{P as Se}from"./Pagination-DR4rU08a.js";import{F as ue,S as de}from"./SpinnerIcon-Ds8InN32.js";const Pe=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),es=({onSubmit:d,initialData:r,onCancel:m,isKurdishByDefault:u=!1,isLoading:w=!1,allGenres:i=[]})=>{var Y,Q,V;const[l,x]=o.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"1080p"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:!1,imdb_rating:void 0,quality:"",duration:"",language:"",country:"",directors:[],writers:[],cast:[]}),[k,P]=o.useState(""),[I,D]=o.useState(""),[U,b]=o.useState(!1),[$,M]=o.useState(""),[R,A]=o.useState(!1),[B,O]=o.useState(""),[E,J]=o.useState(""),[F,f]=o.useState(!1),p=o.useRef(null);o.useEffect(()=>{r?(x({title:r.title||"",description:r.description||"",poster_url:r.poster_url||"",backdrop_url:r.backdrop_url||"",year:r.year||new Date().getFullYear(),genres:r.genres||[],tags:r.tags||[],servers:r.servers&&r.servers.length>0?r.servers:[{name:"Server 1",url:"",quality:"1080p"}],backup_servers:r.backup_servers||[],download_url:r.download_url||"",trailer_url:r.trailer_url||"",is_kurdish:r.is_kurdish||!1,imdb_rating:r.imdb_rating,quality:r.quality||"",duration:r.duration||"",language:r.language||"",country:r.country||"",directors:r.directors||[],writers:r.writers||[],cast:r.cast||[]}),P((r.tags||[]).join(", "))):(x({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"1080p"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:u,imdb_rating:void 0,quality:"",duration:"",language:"",country:"",directors:[],writers:[],cast:[]}),P(""))},[r,u]),o.useEffect(()=>{const n=s=>{p.current&&!p.current.contains(s.target)&&A(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[]),o.useEffect(()=>{const n=l.download_url;if(n&&n.includes("vidtube.pro/d/")){const s=n.replace("/d/","/embed-");l.servers.length>0&&l.servers[0].url!==s&&x(a=>{const h=[...a.servers];return h[0]={...h[0],url:s},{...a,servers:h}})}},[l.download_url,l.servers]),o.useEffect(()=>{if(!r){const n=l.title.match(/\b(19[89]\d|20\d{2})\b/);if(n&&n[0]){const s=parseInt(n[0],10),a=l.title.replace(n[0],"").replace(/\s\s+/g," ").trim();x(h=>h.year!==s||h.title!==a?{...h,year:s,title:a}:h)}}},[l.title,r]),o.useEffect(()=>{!r&&!l.backdrop_url.trim()&&x(n=>({...n,backdrop_url:n.poster_url}))},[l.poster_url,r,l.backdrop_url]);const c=n=>{const{name:s,value:a,type:h}=n.target;if(h==="checkbox"){const{checked:C}=n.target;x(t=>({...t,[s]:C}))}else if(s==="year"){const C=parseInt(a,10);x(t=>({...t,[s]:isNaN(C)?0:C}))}else if(s==="imdb_rating"){const C=parseFloat(a);x(t=>({...t,imdb_rating:isNaN(C)?void 0:C}))}else x(C=>({...C,[s]:a}))},g=n=>{P(n.target.value)},y=n=>{x(s=>{const a=s.genres||[],h=a.includes(n)?a.filter(C=>C!==n):[...a,n];return{...s,genres:h}})},q=async()=>{const n=E.trim();if(n){if(i.some(s=>s.toLowerCase()===n.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}f(!0);try{const{error:s}=await S.from("categories").insert({name:n});if(s)throw s;x(a=>({...a,genres:[...a.genres||[],n]})),J("")}catch(s){console.error("Error adding new genre:",s),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{f(!1)}}},_=(n,s,a)=>{const h=[...l.servers];h[n]={...h[n],[s]:a},x(C=>({...C,servers:h}))},H=()=>{x(n=>{const s={name:`Server ${n.servers.length+1}`,url:"",quality:"1080p"};return{...n,servers:[...n.servers,s]}})},Z=n=>{x(s=>({...s,servers:s.servers.filter((a,h)=>h!==n)}))},ee=(n,s,a)=>{const h=[...l.backup_servers||[]];h[n]={...h[n],[s]:a},x(C=>({...C,backup_servers:h}))},le=()=>{x(n=>{var s;return{...n,backup_servers:[...n.backup_servers||[],{name:`Server ${(((s=n.backup_servers)==null?void 0:s.length)||0)+1}`,url:"",quality:"1080p",no_sub_url:""}]}})},se=n=>{x(s=>({...s,backup_servers:(s.backup_servers||[]).filter((a,h)=>h!==n)}))},v=async()=>{var n,s,a,h,C,t,j,N;if(!I){M("Please enter a URL.");return}b(!0),M("");try{M("Fetching movie page...");const L=`https://corsproxy.io/?${encodeURIComponent(I)}`,X=await fetch(L);if(!X.ok)throw new Error(`Failed to fetch URL: ${X.statusText}`);const re=await X.text(),ne=new DOMParser,te=ne.parseFromString(re,"text/html"),K=ie=>{var qe,Ae,Fe;const me=Array.from(te.querySelectorAll(".RightTaxContent > li")).find(Ne=>{var xe,Te;return(Te=(xe=Ne.querySelector("span"))==null?void 0:xe.textContent)==null?void 0:Te.trim().startsWith(ie)});if(!me)return[];const je=Array.from(me.querySelectorAll("a, strong"));if(je.length>0)return je.map(Ne=>{var xe;return((xe=Ne.textContent)==null?void 0:xe.trim())||""}).filter(Boolean);const we=me.cloneNode(!0);(qe=we.querySelector("i"))==null||qe.remove(),(Ae=we.querySelector("span"))==null||Ae.remove();const Oe=(Fe=we.textContent)==null?void 0:Fe.trim().replace(/^:/,"").trim();return Oe?Oe.split(/\s*,\s*/):[]},ce=((s=(n=te.querySelector("h1.post-title"))==null?void 0:n.textContent)==null?void 0:s.trim())||"",he=ce.match(/\b(19\d{2}|20\d{2})\b/),Ue=he?parseInt(he[0],10):new Date().getFullYear();let oe=ce;oe=oe.replace(/فيلم|مترجم|اون لاين|اونلاين|WEB-DL|BluRay|HD/gi,"").replace(/[\u0600-\u06FF]+/g,""),he&&(oe=oe.replace(he[0],"")),oe=oe.trim().replace(/^[^a-zA-Z0-9\s]+|[^a-zA-Z0-9\s]+$/g,"").trim();const ze=((h=(a=te.querySelector(".story p"))==null?void 0:a.textContent)==null?void 0:h.trim())||"",Ee=((C=te.querySelector(".MainSingle .left .image img"))==null?void 0:C.getAttribute("src"))||"",Ie=((j=(t=te.querySelector(".imdbR span"))==null?void 0:t.textContent)==null?void 0:j.trim())||"0",De=parseFloat(Ie)||void 0,Je=K("نوع الفيلم"),We=K("جودة الفيلم").join(", "),Ye=K("توقيت الفيلم").join(", "),Ve=K("لغة الفيلم").join(", "),He=K("دولة الفيلم").join(", "),Ke=K("المخرجين"),Qe=K("المؤلفين"),Xe=K("بطولة");let $e="";const be=te.querySelector("a.download"),Me=be==null?void 0:be.getAttribute("href");if(Me){M("Fetching download link...");const ie=`https://corsproxy.io/?${encodeURIComponent(Me)}`,ye=await fetch(ie);if(ye.ok){const me=await ye.text();$e=((N=ne.parseFromString(me,"text/html").querySelector('a.downloadsLink, a[href*="vidtube.pro/d/"]'))==null?void 0:N.getAttribute("href"))||""}}x(ie=>({...ie,title:oe,year:Ue||ie.year,description:ze,poster_url:Ee,backdrop_url:Ee,imdb_rating:De,genres:[...new Set([...ie.genres,...Je])],quality:We,duration:Ye,language:Ve,country:He,directors:Ke,writers:Qe,cast:Xe,download_url:$e})),M("تم جلب البيانات بنجاح!")}catch(L){console.error("Scraping failed:",L),M(`فشل جلب البيانات: ${L.message}.`)}finally{b(!1)}},T=n=>{if(n.preventDefault(),l.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const s=k.split(",").map(a=>a.trim()).filter(Boolean);d({...l,tags:s})},W=i.filter(n=>n.toLowerCase().includes(B.toLowerCase())),z="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",G="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3 p-4 bg-slate-900/50 rounded-lg border border-slate-700",children:[e.jsx("label",{htmlFor:"scrape_url",className:"block text-lg font-semibold text-white",children:"جلب البيانات من رابط"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"scrape_url",type:"url",value:I,onChange:n=>D(n.target.value),placeholder:"https://web6.topcinema.cam/...",className:`${z} flex-grow`}),e.jsxs("button",{type:"button",onClick:v,disabled:U,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700 flex-shrink-0 flex items-center disabled:bg-slate-500",children:[U&&e.jsx(Pe,{}),U?"جاري الجلب...":"جلب البيانات"]})]}),$&&e.jsx("p",{className:`text-sm mt-1 ${$.startsWith("فشل")?"text-red-400":"text-green-400"}`,children:$})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx("input",{type:"text",name:"title",value:l.title,onChange:c,placeholder:"عنوان الفيلم (بالانجليزية)",required:!0,className:z})}),e.jsx("input",{type:"number",name:"year",value:l.year||"",onChange:c,placeholder:"سنة الإنتاج",required:!0,className:z})]}),e.jsx("textarea",{name:"description",value:l.description,onChange:c,placeholder:"وصف الفيلم",required:!0,className:`${z} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"poster_url",value:l.poster_url,onChange:c,placeholder:"رابط صورة البوستر",required:!0,className:z}),e.jsx("input",{type:"url",name:"backdrop_url",value:l.backdrop_url,onChange:c,placeholder:"رابط صورة الخلفية",required:!0,className:z})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:l.imdb_rating??"",onChange:c,placeholder:"تقيم الفيلم",step:"0.1",min:"0",max:"10",className:z}),e.jsx("input",{type:"url",name:"trailer_url",value:l.trailer_url??"",onChange:c,placeholder:"رابط المقطع الدعائي (اختياري)",className:z})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:k,onChange:g,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:z})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"is_kurdish",type:"checkbox",name:"is_kurdish",checked:!!l.is_kurdish,onChange:c,className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("label",{htmlFor:"is_kurdish",className:"text-white cursor-pointer",children:"هذا الفيلم مدبلج للكردية"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:p,children:[e.jsxs("button",{type:"button",onClick:()=>A(n=>!n),className:`${z} text-right flex justify-between items-center`,children:[e.jsx("span",{children:l.genres.length>0?l.genres.join(", "):"اختر الفئات..."}),e.jsx("svg",{className:`h-5 w-5 transition-transform duration-200 ${R?"rotate-180":""}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),R&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[e.jsx("div",{className:"p-2 border-b border-slate-700",children:e.jsx("input",{type:"text",placeholder:"ابحث أو أضف فئة...",value:B,onChange:n=>O(n.target.value),className:"w-full bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"})}),e.jsx("ul",{className:"p-1",children:W.map(n=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.genres.includes(n),onChange:()=>y(n),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:n})]},n))}),e.jsx("div",{className:"p-2 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"إضافة فئة جديدة...",value:E,onChange:n=>J(n.target.value),className:"flex-grow bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:q,disabled:F||!E.trim(),className:"bg-cyan-600 text-white px-3 py-1 rounded-md text-sm hover:bg-cyan-700 disabled:bg-slate-500",children:F?"...":"إضافة"})]})})]})]})]}),e.jsxs("details",{className:"bg-slate-900/30 p-4 rounded-lg border border-slate-700",open:!0,children:[e.jsx("summary",{className:"text-lg font-semibold text-white cursor-pointer",children:"تفاصيل إضافية للفيلم"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",name:"quality",value:l.quality,onChange:c,placeholder:"الجودة (e.g. 1080p WEB-DL)",className:G}),e.jsx("input",{type:"text",name:"duration",value:l.duration,onChange:c,placeholder:"مدة العرض",className:G}),e.jsx("input",{type:"text",name:"language",value:l.language,onChange:c,placeholder:"اللغة",className:G}),e.jsx("input",{type:"text",name:"country",value:l.country,onChange:c,placeholder:"الدولة",className:G})]}),e.jsx("textarea",{value:(Y=l.directors)==null?void 0:Y.join(", "),onChange:n=>x(s=>({...s,directors:n.target.value.split(",").map(a=>a.trim())})),placeholder:"المخرجين (مفصولة بفاصلة)",className:`${G} w-full`,rows:2}),e.jsx("textarea",{value:(Q=l.writers)==null?void 0:Q.join(", "),onChange:n=>x(s=>({...s,writers:n.target.value.split(",").map(a=>a.trim())})),placeholder:"المؤلفين (مفصولة بفاصلة)",className:`${G} w-full`,rows:2}),e.jsx("textarea",{value:(V=l.cast)==null?void 0:V.join(", "),onChange:n=>x(s=>({...s,cast:n.target.value.split(",").map(a=>a.trim())})),placeholder:"البطولة (مفصولة بفاصلة)",className:`${G} w-full`,rows:3})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات المشاهدة"}),l.servers.map((n,s)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:n.name,onChange:a=>_(s,"name",a.target.value),placeholder:"اسم السيرفر",className:`${G} flex-1`}),e.jsxs("select",{value:n.quality,onChange:a=>_(s,"quality",a.target.value),className:`${G} w-28`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),l.servers.length>1&&e.jsx("button",{type:"button",onClick:()=>Z(s),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),s===0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{type:"url",value:n.url,onChange:a=>_(s,"url",a.target.value),placeholder:"رابط السيرفر 1",required:!0,className:`${G} w-full`}),e.jsx("input",{type:"url",name:"download_url",value:l.download_url||"",onChange:c,placeholder:"رابط تحميل الفيلم (اختياري)",className:`${G} w-full`})]}):e.jsx("input",{type:"url",value:n.url,onChange:a=>_(s,"url",a.target.value),placeholder:"رابط السيرفر",required:!0,className:`${G} w-full`})]},s)),e.jsx("button",{type:"button",onClick:H,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات احتياطية (مشغل خارجي)"}),(l.backup_servers||[]).map((n,s)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:n.name,onChange:a=>ee(s,"name",a.target.value),placeholder:"اسم السيرفر",className:`${G} flex-1`}),e.jsxs("select",{value:n.quality,onChange:a=>ee(s,"quality",a.target.value),className:`${G} w-28`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>se(s),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{type:"url",value:n.url,onChange:a=>ee(s,"url",a.target.value),placeholder:"رابط السيرفر (مع ترجمة)",className:`${G} w-full`}),e.jsx("input",{type:"url",value:n.no_sub_url||"",onChange:a=>ee(s,"no_sub_url",a.target.value),placeholder:"رابط السيرفر (بدون ترجمة)",className:`${G} w-full`})]})]},s)),e.jsx("button",{type:"button",onClick:le,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:m,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",disabled:w,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:w,children:[w&&e.jsx(Pe,{}),w?r?"جاري التحديث...":"جاري الإضافة...":r?"تحديث الفيلم":"إضافة الفيلم"]})]})]})},ss=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ae=({isOpen:d,onClose:r,onConfirm:m,title:u,message:w,isLoading:i=!1})=>{const[l,x]=o.useState(d);return o.useEffect(()=>{if(d)x(!0);else{const k=setTimeout(()=>x(!1),300);return()=>clearTimeout(k)}},[d]),l?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${d?"animate-fade-in":"animate-fade-out"}`,onClick:r,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:`relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md border border-slate-700 ${d?"animate-zoom-in":"animate-zoom-out"}`,onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:u}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:w})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:m,disabled:i,children:[i&&e.jsx(ss,{}),i?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:r,disabled:i,children:"إلغاء"})]})]})}):null},ts=10,Re=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((d,r)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},r))})}),e.jsx("tbody",{children:[...Array(ts)].map((d,r)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((m,u)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},u))]},r))})]})})]}),_e=({message:d,type:r,onClose:m})=>(o.useEffect(()=>{const i=setTimeout(m,5e3);return()=>clearTimeout(i)},[m]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${r==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:d}),e.jsx("button",{onClick:m,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Ge=({genres:d,onSubmit:r,onClose:m,isLoading:u})=>{const[w,i]=o.useState(d[0]||""),[l,x]=o.useState("add"),k=P=>{P.preventDefault(),w&&r(w,l)};return e.jsx(ue,{title:"تغيير الفئة بشكل جماعي",onClose:m,isOpen:!0,children:e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:w,onChange:P=>i(P.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:d.map(P=>e.jsx("option",{value:P,children:P},P))}),e.jsxs("select",{value:l,onChange:P=>x(P.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:m,disabled:u,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:u||!w,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[u&&e.jsx(de,{}),u?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},rs=({onSubmit:d,onClose:r,isLoading:m})=>{const[u,w]=o.useState(new Date().getFullYear()),i=l=>{l.preventDefault(),d(u)};return e.jsx(ue,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:r,isOpen:!0,children:e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:u,onChange:l=>w(parseInt(l.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:r,disabled:m,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:m,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[m&&e.jsx(de,{}),m?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Le=({onSubmit:d,onClose:r,isLoading:m})=>{const[u,w]=o.useState(""),[i,l]=o.useState("add"),x=k=>{k.preventDefault(),u.trim()&&d(u.trim(),i)};return e.jsx(ue,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:r,isOpen:!0,children:e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:u,onChange:k=>w(k.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:i,onChange:k=>l(k.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:r,disabled:m,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:m||!u.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[m&&e.jsx(de,{}),m?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},pe=10,as=()=>{const[d,r]=o.useState([]),[m,u]=o.useState(null),[w,i]=o.useState(!1),[l,x]=o.useState(1),[k,P]=o.useState("all"),[I,D]=o.useState(""),[U,b]=o.useState(!1),[$,M]=o.useState(null),[R,A]=o.useState(!0),[B,O]=o.useState(!1),[E,J]=o.useState(null),[F,f]=o.useState([]),[p,c]=o.useState(null),[g,y]=o.useState([]),q=async()=>{const{data:t,error:j}=await S.from("movies").select("*").order("created_at",{ascending:!1});j?(console.error("Error fetching movies: ",j),_("فشل في تحميل الأفلام.","error")):r(t);const{data:N,error:L}=await S.from("categories").select("name").order("name");L?console.error("Error fetching categories from ManageMovies: ",L):y(N.map(X=>X.name)),A(!1)};o.useEffect(()=>{A(!0),q();const t=S.channel("public:movies").on("postgres_changes",{event:"*",schema:"public",table:"movies"},()=>q()).subscribe();return()=>{S.removeChannel(t)}},[]),o.useEffect(()=>{x(1),f([])},[k,I]);const _=(t,j)=>{J({message:t,type:j})},H=async t=>{O(!0);try{const{error:j}=await S.from("movies").insert([{...t,created_at:new Date().toISOString()}]);if(j)throw j;await q(),i(!1),x(1),_("تمت إضافة الفيلم بنجاح.","success")}catch(j){console.error("Error adding movie: ",j);const N=j.message||JSON.stringify(j);_(`حدث خطأ أثناء إضافة الفيلم: ${N}`,"error")}finally{O(!1)}},Z=async(t,j)=>{O(!0);try{const{error:N}=await S.from("movies").update(j).eq("id",t);if(N)throw N;await q(),u(null),i(!1),_("تم تحديث الفيلم بنجاح.","success")}catch(N){console.error("Error updating movie: ",N);const L=N.message||JSON.stringify(N);_(`حدث خطأ أثناء تحديث الفيلم: ${L}`,"error")}finally{O(!1)}},ee=t=>{M(t),b(!0)},le=async()=>{if($){O(!0);try{const{error:t}=await S.from("movies").delete().eq("id",$.id);if(t)throw t;_("تم حذف الفيلم بنجاح.","success")}catch(t){console.error("Error deleting movie: ",t);const j=t.message||JSON.stringify(t);_(`حدث خطأ أثناء حذف الفيلم: ${j}`,"error")}finally{b(!1),M(null),O(!1)}}},se=t=>{u(t),i(!0)},v=()=>{u(null),i(!0)},T=()=>{u(null),i(!1),c(null)},W=t=>{f(j=>j.includes(t)?j.filter(N=>N!==t):[...j,t])},z=t=>{t.target.checked?f(a.map(j=>j.id)):f(F.filter(j=>!a.some(N=>N.id===j)))},G=async(t,j)=>{O(!0);try{const{error:N}=await S.from("movies").update(t).in("id",F);if(N)throw N;_(j,"success"),f([])}catch(N){console.error("Bulk update failed:",N),_("فشل التحديث الجماعي.","error")}finally{O(!1),c(null)}},Y=async()=>{O(!0);try{const{error:t}=await S.from("movies").delete().in("id",F);if(t)throw t;_(`تم حذف ${F.length} فيلم بنجاح.`,"success"),f([])}catch(t){console.error("Bulk delete failed:",t),_("فشل الحذف الجماعي.","error")}finally{O(!1),c(null)}},Q=async(t,j)=>{O(!0);try{const{data:N,error:L}=await S.from("movies").select("id, genres").in("id",F);if(L)throw L;const X=N.map(ne=>{const te=ne.genres||[];let K;return j==="add"?K=[...new Set([...te,t])]:K=te.filter(ce=>ce!==t),{id:ne.id,genres:K}}),{error:re}=await S.from("movies").upsert(X);if(re)throw re;_(`تم ${j==="add"?"إضافة":"إزالة"} فئة "${t}" بنجاح.`,"success"),f([])}catch(N){console.error("Bulk genre change failed:",N),_("فشل تغيير الفئة الجماعي.","error")}finally{O(!1),c(null)}},V=async(t,j)=>{O(!0);try{const{data:N,error:L}=await S.from("movies").select("id, tags").in("id",F);if(L)throw L;const X=N.map(ne=>{const te=ne.tags||[];let K;return j==="add"?K=[...new Set([...te,t])]:K=te.filter(ce=>ce!==t),{id:ne.id,tags:K}}),{error:re}=await S.from("movies").upsert(X);if(re)throw re;_(`تم ${j==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${t}" بنجاح.`,"success"),f([])}catch(N){console.error("Bulk tags change failed:",N),_("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{O(!1),c(null)}},n=d.filter(t=>k==="kurdish"?t.is_kurdish===!0:k==="non-kurdish"?!t.is_kurdish:!0).filter(t=>Be(I,t.title)),s=Math.ceil(n.length/pe),a=n.slice((l-1)*pe,l*pe),h=t=>`px-4 py-2 text-sm font-bold rounded-lg transition-colors duration-200 ${k===t?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-md":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,C=a.length>0&&a.every(t=>F.includes(t.id));return R?e.jsx(Re,{}):e.jsxs("div",{className:"relative",children:[E&&e.jsx(_e,{...E,onClose:()=>J(null)}),e.jsx(ae,{isOpen:U,onClose:()=>b(!1),onConfirm:le,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',$==null?void 0:$.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:B}),p==="delete"&&e.jsx(ae,{isOpen:!0,onClose:()=>c(null),onConfirm:Y,title:`تأكيد حذف ${F.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:B}),p==="genre"&&e.jsx(Ge,{genres:g,onClose:T,onSubmit:Q,isLoading:B}),p==="tags"&&e.jsx(Le,{onClose:T,onSubmit:V,isLoading:B}),p==="year"&&e.jsx(rs,{onClose:T,onSubmit:t=>G({year:t},"تم تحديث السنة بنجاح."),isLoading:B}),p==="markKurdish"&&e.jsx(ae,{isOpen:!0,onClose:T,onConfirm:()=>G({is_kurdish:!0},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد تحديد كل هذه الأفلام على أنها كردية؟",isLoading:B}),p==="unmarkKurdish"&&e.jsx(ae,{isOpen:!0,onClose:T,onConfirm:()=>G({is_kurdish:!1},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد إزالة العلامة الكردية من كل هذه الأفلام؟",isLoading:B}),w&&e.jsx(ue,{title:m?"تعديل الفيلم":"إضافة فيلم جديد",onClose:T,isOpen:w,children:e.jsx(es,{onSubmit:m?t=>Z(m.id,t):H,initialData:m,onCancel:T,isKurdishByDefault:k==="kurdish"&&!m,isLoading:B,allGenres:g})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:v,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:I,onChange:t=>D(t.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("div",{className:"flex flex-wrap justify-center items-center gap-2 p-1 bg-slate-900/50 rounded-lg flex-shrink-0",children:[e.jsx("button",{onClick:()=>P("all"),className:h("all"),children:"الكل"}),e.jsx("button",{onClick:()=>P("kurdish"),className:h("kurdish"),children:"كردي فقط"}),e.jsx("button",{onClick:()=>P("non-kurdish"),className:h("non-kurdish"),children:"غير كردي"})]})]}),F.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[F.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>f([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>c("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>c("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>c("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>c("markKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تحديد ككردي"}),e.jsx("button",{onClick:()=>c("unmarkKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"إلغاء تحديد ككردي"}),e.jsx("button",{onClick:()=>c("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto hidden lg:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:z,checked:C,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"مدبلج كردي"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:a.map(t=>{var j,N;return e.jsxs("tr",{className:`${F.includes(t.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:F.includes(t.id),onChange:()=>W(t.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:t.poster_url,alt:t.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:t.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:t.imdb_rating?t.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(j=t.genres)==null?void 0:j.slice(0,3).map(L=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:L},L)),((N=t.genres)==null?void 0:N.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.is_kurdish?"نعم":"لا"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>se(t),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>ee(t),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},t.id)})})]})}),e.jsxs("div",{className:"block lg:hidden space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx("input",{type:"checkbox",onChange:z,checked:C,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("label",{className:"text-sm text-slate-300",children:"تحديد الكل في هذه الصفحة"})]}),a.map(t=>{var j,N;return e.jsxs("div",{className:`p-3 rounded-lg transition-all duration-200 ${F.includes(t.id)?"bg-cyan-500/20 ring-2 ring-cyan-500":"bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24",children:e.jsx("img",{src:t.poster_url,alt:t.title,className:"w-full rounded object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-bold text-white truncate flex-grow pr-2",children:t.title}),e.jsx("input",{type:"checkbox",checked:F.includes(t.id),onChange:()=>W(t.id),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 flex-shrink-0"})]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1 flex items-center gap-x-2 flex-wrap",children:[e.jsx("span",{children:t.year}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{className:"text-yellow-400 font-bold",children:t.imdb_rating?t.imdb_rating.toFixed(1):"N/A"}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{children:t.is_kurdish?"كردي":"غير كردي"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[(j=t.genres)==null?void 0:j.slice(0,2).map(L=>e.jsx("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:L},L)),((N=t.genres)==null?void 0:N.length)>2&&e.jsxs("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:["+",t.genres.length-2]})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 flex justify-end items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-xs text-slate-500 mr-auto",children:["أضيف في: ",t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"N/A"]}),e.jsx("button",{onClick:()=>se(t),className:"font-medium text-cyan-400 hover:text-cyan-300",children:"تعديل"}),e.jsx("button",{onClick:()=>ee(t),className:"font-medium text-red-500 hover:text-red-400",children:"حذف"})]})]},t.id)})]})]}),n.length>pe&&e.jsx("div",{className:"p-4 mt-4 border-t border-slate-700",children:e.jsx(Se,{currentPage:l,totalPages:s,onPageChange:x})})]})},ns=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ls=({onSubmit:d,initialData:r,onCancel:m,isLoading:u=!1,allGenres:w=[]})=>{const[i,l]=o.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:"",year:new Date().getFullYear(),episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"}],imdb_rating:0}],trailer_url:"",imdb_rating:0}),[x,k]=o.useState(""),[P,I]=o.useState(!1),D=o.useRef(null);o.useEffect(()=>{r&&(l({...r,genres:r.genres||[],tags:r.tags||[],seasons:r.seasons&&r.seasons.length>0?r.seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:r.poster_url,year:r.year,episodes:[],imdb_rating:0}],trailer_url:r.trailer_url||"",imdb_rating:r.imdb_rating||0}),k((r.tags||[]).join(", ")))},[r]),o.useEffect(()=>{const p=c=>{D.current&&!D.current.contains(c.target)&&I(!1)};return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[]);const U=p=>{const{name:c,value:g}=p.target;if(c==="year"||c==="imdb_rating"){const y=parseFloat(g);l(q=>({...q,[c]:isNaN(y)?0:y}))}else l(y=>({...y,[c]:g}))},b=p=>{k(p.target.value)},$=p=>{l(c=>({...c,genres:c.genres.includes(p)?c.genres.filter(g=>g!==p):[...c.genres,p]}))},M=(p,c,g)=>{const y=[...i.seasons],q={...y[p]};if(c==="season_number"||c==="year"||c==="imdb_rating"){const _=typeof g=="string"?parseFloat(g):g;q[c]=isNaN(_)?0:_}else q[c]=g;y[p]=q,l(_=>({..._,seasons:y}))},R=()=>{const p=i.seasons.length>0?Math.max(...i.seasons.map(g=>g.season_number))+1:1,c=i.seasons.length>0?i.seasons[i.seasons.length-1].year:i.year;l(g=>({...g,seasons:[...g.seasons,{season_number:p,title:`الموسم ${p}`,description:"",poster_url:g.poster_url,year:c+1,episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"}],imdb_rating:0}]}))},A=p=>{l(c=>({...c,seasons:c.seasons.filter((g,y)=>y!==p)}))},B=(p,c,g,y)=>{const q=[...i.seasons],_=[...q[p].episodes],H={..._[c]};if(g==="episode_number"){const Z=typeof y=="string"?parseFloat(y):y;H[g]=isNaN(Z)?0:Z}else H[g]=y;_[c]=H,q[p]={...q[p],episodes:_},l(Z=>({...Z,seasons:q}))},O=p=>{const c=i.seasons[p],g=c.episodes.length>0?Math.max(...c.episodes.map(_=>_.episode_number))+1:1,y={episode_number:g,title:`الحلقة ${g}`,url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"},q=i.seasons.map((_,H)=>H===p?{..._,episodes:[..._.episodes,y]}:_);l(_=>({..._,seasons:q}))},E=(p,c)=>{const g=i.seasons.map((y,q)=>q===p?{...y,episodes:y.episodes.filter((_,H)=>H!==c)}:y);l(y=>({...y,seasons:g}))},J=p=>{p.preventDefault();const c=x.split(",").map(g=>g.trim()).filter(Boolean);d({...i,tags:c})},F="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",f="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:J,className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white border-b border-slate-700 pb-2",children:"معلومات المسلسل الرئيسية"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:i.title,onChange:U,placeholder:"عنوان المسلسل",required:!0,className:F}),e.jsx("input",{type:"number",name:"year",value:i.year||"",onChange:U,placeholder:"سنة بداية العرض",required:!0,className:F})]}),e.jsx("textarea",{name:"description",value:i.description,onChange:U,placeholder:"وصف المسلسل العام",required:!0,className:`${F} h-24`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"poster_url",value:i.poster_url,onChange:U,placeholder:"رابط البوستر الرئيسي",required:!0,className:F}),e.jsx("input",{type:"url",name:"backdrop_url",value:i.backdrop_url,onChange:U,placeholder:"رابط صورة الخلفية",required:!0,className:F})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:i.imdb_rating??"",onChange:U,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:F}),e.jsx("input",{type:"url",name:"trailer_url",value:i.trailer_url??"",onChange:U,placeholder:"رابط المقطع الدعائي (اختياري)",className:F})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات"}),e.jsxs("div",{className:"relative",ref:D,children:[e.jsx("button",{type:"button",onClick:()=>I(p=>!p),className:`${F} text-right`,children:i.genres.length>0?i.genres.join(", "):"اختر الفئات..."}),P&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:w.map(p=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.genres.includes(p),onChange:()=>$(p),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:p})]},p))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (مفصولة بفاصلة)"}),e.jsx("input",{type:"text",value:x,onChange:b,placeholder:"أكشن, إثارة...",className:F})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),i.seasons.map((p,c)=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-white font-semibold",children:"الموسم رقم:"}),e.jsx("input",{type:"number",value:p.season_number||"",onChange:g=>M(c,"season_number",g.target.value),className:`${f} w-20`})]}),e.jsx("button",{type:"button",onClick:()=>A(c),className:"bg-red-600 text-white px-3 py-1 rounded-md text-sm",children:"إزالة الموسم"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",value:p.title,onChange:g=>M(c,"title",g.target.value),placeholder:"عنوان الموسم",required:!0,className:f}),e.jsx("input",{type:"number",value:p.year||"",onChange:g=>M(c,"year",g.target.value),placeholder:"سنة الموسم",required:!0,className:f}),e.jsx("input",{type:"number",value:p.imdb_rating??"",onChange:g=>M(c,"imdb_rating",g.target.value),placeholder:"تقييم IMDb",step:"0.1",min:"0",max:"10",className:f}),e.jsx("input",{type:"url",value:p.poster_url,onChange:g=>M(c,"poster_url",g.target.value),placeholder:"رابط بوستر الموسم",required:!0,className:`${f} col-span-1 sm:col-span-3`}),e.jsx("textarea",{value:p.description,onChange:g=>M(c,"description",g.target.value),placeholder:"وصف الموسم",required:!0,className:`${f} h-20 col-span-1 sm:col-span-3`})]}),e.jsxs("div",{className:"space-y-2 pt-3 mt-3 border-t border-slate-600",children:[e.jsxs("h4",{className:"font-semibold text-slate-300",children:["حلقات الموسم ",p.season_number,":"]}),p.episodes.map((g,y)=>e.jsxs("div",{className:"bg-slate-800/60 p-2 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:g.episode_number||"",onChange:q=>B(c,y,"episode_number",q.target.value),placeholder:"رقم",className:`${f} w-16`}),e.jsx("input",{type:"text",value:g.title,onChange:q=>B(c,y,"title",q.target.value),placeholder:"عنوان الحلقة",className:`${f} flex-1`}),e.jsx("button",{type:"button",onClick:()=>E(c,y),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600 text-xs",children:"X"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:g.url,onChange:q=>B(c,y,"url",q.target.value),placeholder:"رابط المشاهدة",required:!0,className:`${f} flex-1`}),e.jsxs("select",{value:g.quality||"1080p",onChange:q=>B(c,y,"quality",q.target.value),className:`${f} w-28 flex-shrink-0`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]})]}),e.jsx("input",{type:"url",value:g.download_url||"",onChange:q=>B(c,y,"download_url",q.target.value),placeholder:"رابط التحميل (اختياري)",className:`${f} w-full`})]})]},y)),e.jsx("button",{type:"button",onClick:()=>O(c),className:"text-sm bg-slate-600 text-white py-1 px-3 rounded-md hover:bg-slate-500",children:"إضافة حلقة"})]})]},c)),e.jsx("button",{type:"button",onClick:R,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700",children:"إضافة موسم"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:m,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg",disabled:u,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg",disabled:u,children:[u&&e.jsx(ns,{}),r?"تحديث المسلسل":"إضافة المسلسل"]})]})]})},ge=10,os=()=>{const[d,r]=o.useState([]),[m,u]=o.useState(null),[w,i]=o.useState(!1),[l,x]=o.useState(1),[k,P]=o.useState(""),[I,D]=o.useState(!1),[U,b]=o.useState(null),[$,M]=o.useState(!0),[R,A]=o.useState(!1),[B,O]=o.useState(null),[E,J]=o.useState([]),[F,f]=o.useState(null),[p,c]=o.useState([]),g=async()=>{const{data:s,error:a}=await S.from("series").select("*").order("created_at",{ascending:!1});a?(console.error("Error fetching series: ",a),y("فشل في تحميل المسلسلات.","error")):r(s);const{data:h,error:C}=await S.from("categories").select("name").order("name");C?console.error("Error fetching categories: ",C):c(h.map(t=>t.name)),M(!1)};o.useEffect(()=>{M(!0),g();const s=S.channel("public:series").on("postgres_changes",{event:"*",schema:"public",table:"series"},g).subscribe();return()=>{S.removeChannel(s)}},[]),o.useEffect(()=>{x(1),J([])},[k]);const y=(s,a)=>{O({message:s,type:a})},q=async s=>{A(!0);try{const{error:a}=await S.from("series").insert([{...s,created_at:new Date().toISOString()}]);if(a)throw a;await g(),i(!1),x(1),y("تمت إضافة المسلسل بنجاح.","success")}catch(a){console.error("Error adding series: ",a);const h=a.message||JSON.stringify(a);y(`حدث خطأ أثناء إضافة المسلسل: ${h}`,"error")}finally{A(!1)}},_=async(s,a)=>{A(!0);try{const{error:h}=await S.from("series").update(a).eq("id",s);if(h)throw h;await g(),u(null),i(!1),y("تم تحديث المسلسل بنجاح.","success")}catch(h){console.error("Error updating series:",h);const C=h.message||JSON.stringify(h);y(`حدث خطأ أثناء تحديث المسلسل: ${C}`,"error")}finally{A(!1)}},H=s=>{b(s),D(!0)},Z=async()=>{if(U){A(!0);try{const{error:s}=await S.from("series").delete().eq("id",U.id);if(s)throw s;y("تم حذف المسلسل بنجاح.","success")}catch(s){console.error("Error deleting series:",s);const a=s.message||JSON.stringify(s);y(`حدث خطأ أثناء حذف المسلسل: ${a}`,"error")}finally{D(!1),b(null),A(!1)}}},ee=s=>{u(s),i(!0)},le=()=>{u(null),i(!0)},se=()=>{u(null),i(!1),f(null)},v=s=>{J(a=>a.includes(s)?a.filter(h=>h!==s):[...a,s])},T=s=>{s.target.checked?J(V.map(a=>a.id)):J(E.filter(a=>!V.some(h=>h.id===a)))},W=async()=>{A(!0);try{const{error:s}=await S.from("series").delete().in("id",E);if(s)throw s;y(`تم حذف ${E.length} مسلسل بنجاح.`,"success"),J([])}catch(s){console.error("Bulk delete failed:",s),y("فشل الحذف الجماعي.","error")}finally{A(!1),f(null)}},z=async(s,a)=>{A(!0);try{const{data:h,error:C}=await S.from("series").select("id, genres").in("id",E);if(C)throw C;const t=h.map(N=>{const L=N.genres||[],X=a==="add"?[...new Set([...L,s])]:L.filter(re=>re!==s);return{id:N.id,genres:X}}),{error:j}=await S.from("series").upsert(t);if(j)throw j;y(`تم ${a==="add"?"إضافة":"إزالة"} فئة "${s}" بنجاح.`,"success"),J([])}catch(h){console.error("Bulk genre change failed:",h),y("فشل تغيير الفئة الجماعي.","error")}finally{A(!1),f(null)}},G=async(s,a)=>{A(!0);try{const{data:h,error:C}=await S.from("series").select("id, tags").in("id",E);if(C)throw C;const t=h.map(N=>{const L=N.tags||[],X=a==="add"?[...new Set([...L,s])]:L.filter(re=>re!==s);return{id:N.id,tags:X}}),{error:j}=await S.from("series").upsert(t);if(j)throw j;y(`تم ${a==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${s}" بنجاح.`,"success"),J([])}catch(h){console.error("Bulk tags change failed:",h),y("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{A(!1),f(null)}},Y=d.filter(s=>Be(k,s.title)),Q=Math.ceil(Y.length/ge),V=Y.slice((l-1)*ge,l*ge),n=V.length>0&&V.every(s=>E.includes(s.id));return $?e.jsx(Re,{}):e.jsxs("div",{className:"relative",children:[B&&e.jsx(_e,{...B,onClose:()=>O(null)}),e.jsx(ae,{isOpen:I,onClose:()=>D(!1),onConfirm:Z,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',U==null?void 0:U.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:R}),F==="delete"&&e.jsx(ae,{isOpen:!0,onClose:()=>f(null),onConfirm:W,title:`تأكيد حذف ${E.length} مسلسل`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:R}),F==="genre"&&e.jsx(Ge,{genres:p,onClose:se,onSubmit:z,isLoading:R}),F==="tags"&&e.jsx(Le,{onClose:se,onSubmit:G,isLoading:R}),w&&e.jsx(ue,{title:m?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:se,isOpen:w,children:e.jsx(ls,{onSubmit:m?s=>_(m.id,s):q,initialData:m,onCancel:se,isLoading:R,allGenres:p})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:le,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:k,onChange:s=>P(s.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a series to edit"})]})]}),E.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[E.length," مسلسل محدد"]}),e.jsx("button",{onClick:()=>J([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>f("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>f("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>f("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto hidden lg:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:T,checked:n,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:V.map(s=>{var a,h,C;return e.jsxs("tr",{className:`${E.includes(s.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:E.includes(s.id),onChange:()=>v(s.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:s.poster_url,alt:s.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:s.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:s.imdb_rating?s.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:s.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(a=s.genres)==null?void 0:a.slice(0,3).map(t=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:t},t)),((h=s.genres)==null?void 0:h.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:((C=s.seasons)==null?void 0:C.length)||0}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:s.created_at?new Date(s.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>ee(s),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>H(s),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},s.id)})})]})}),e.jsxs("div",{className:"block lg:hidden space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx("input",{type:"checkbox",onChange:T,checked:n,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("label",{className:"text-sm text-slate-300",children:"تحديد الكل في هذه الصفحة"})]}),V.map(s=>{var a,h,C;return e.jsxs("div",{className:`p-3 rounded-lg transition-all duration-200 ${E.includes(s.id)?"bg-cyan-500/20 ring-2 ring-cyan-500":"bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24",children:e.jsx("img",{src:s.poster_url,alt:s.title,className:"w-full rounded object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-bold text-white truncate flex-grow pr-2",children:s.title}),e.jsx("input",{type:"checkbox",checked:E.includes(s.id),onChange:()=>v(s.id),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 flex-shrink-0"})]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1 flex items-center gap-x-2 flex-wrap",children:[e.jsx("span",{children:s.year}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{className:"text-yellow-400 font-bold",children:s.imdb_rating?s.imdb_rating.toFixed(1):"N/A"}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsxs("span",{children:[((a=s.seasons)==null?void 0:a.length)||0," مواسم"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[(h=s.genres)==null?void 0:h.slice(0,2).map(t=>e.jsx("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:t},t)),((C=s.genres)==null?void 0:C.length)>2&&e.jsxs("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:["+",s.genres.length-2]})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 flex justify-end items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-xs text-slate-500 mr-auto",children:["أضيف في: ",s.created_at?new Date(s.created_at).toLocaleDateString("ar-EG"):"N/A"]}),e.jsx("button",{onClick:()=>ee(s),className:"font-medium text-cyan-400 hover:text-cyan-300",children:"تعديل"}),e.jsx("button",{onClick:()=>H(s),className:"font-medium text-red-500 hover:text-red-400",children:"حذف"})]})]},s.id)})]})]}),Y.length>ge&&e.jsx("div",{className:"p-4 mt-4 border-t border-slate-700",children:e.jsx(Se,{currentPage:l,totalPages:Q,onPageChange:x})})]})},is=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),cs=({onSubmit:d,initialData:r,onCancel:m,isLoading:u=!1})=>{const[w,i]=o.useState("");o.useEffect(()=>{i(r?r.name:"")},[r]);const l=x=>{x.preventDefault(),w.trim()&&d({name:w})};return e.jsxs("form",{onSubmit:l,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:w,onChange:x=>i(x.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:m,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:u,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:u,children:[u&&e.jsx(is,{}),u?r?"جاري التحديث...":"جاري الإضافة...":r?"تحديث":"إضافة"]})]})]})},ds=10,us=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(ds)].map((d,r)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},r))})]})})}),ms=({isOpen:d,onClose:r,onSubmit:m,isLoading:u,categories:w})=>{const[i,l]=o.useState(""),[x,k]=o.useState(""),[P,I]=o.useState(""),D=Ze.useMemo(()=>w.filter(b=>b.name!==i),[w,i]);o.useEffect(()=>{if(d&&w.length>0){const b=w[0].name;l(b);const $=w.filter(M=>M.name!==b);k($.length>0?$[0].name:"")}},[d,w]),o.useEffect(()=>{I(i&&x&&i===x?"لا يمكن دمج فئة مع نفسها. الرجاء اختيار فئتين مختلفتين.":"")},[i,x]),o.useEffect(()=>{D.some(b=>b.name===x)||k(D.length>0?D[0].name:"")},[i,D,x]);const U=b=>{b.preventDefault(),!(P||!i||!x)&&m(i,x)};return e.jsx(ue,{title:"توحيد (دمج) الفئات",onClose:r,isOpen:d,children:e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[e.jsx("p",{className:"text-slate-300",children:"سيتم نقل كل المحتوى من الفئة المصدر إلى الفئة الهدف، ثم سيتم حذف الفئة المصدر نهائياً."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source_category",className:"block text-sm font-medium text-slate-300 mb-2",children:"دمج من هذه الفئة (سيتم حذفها):"}),e.jsx("select",{id:"source_category",value:i,onChange:b=>l(b.target.value),required:!0,className:"w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",children:w.map(b=>e.jsx("option",{value:b.name,children:b.name},b.id))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"destination_category",className:"block text-sm font-medium text-slate-300 mb-2",children:"الدمج في هذه الفئة (ستبقى):"}),e.jsx("select",{id:"destination_category",value:x,onChange:b=>k(b.target.value),required:!0,className:"w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",disabled:D.length===0,children:D.map(b=>e.jsx("option",{value:b.name,children:b.name},b.id))})]}),P&&e.jsx("p",{className:"text-red-400 text-center text-sm bg-red-500/10 p-2 rounded-md",children:P}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:r,disabled:u,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:u||!!P||!i||!x,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",children:[u&&e.jsx(de,{}),u?"جاري الدمج...":"تنفيذ الدمج"]})]})]})})},fe=10,xs=({message:d,type:r,onClose:m})=>(o.useEffect(()=>{const i=setTimeout(m,5e3);return()=>clearTimeout(i)},[m]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${r==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:d}),e.jsx("button",{onClick:m,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),hs=({children:d,onClose:r,title:m,isOpen:u})=>{const[w,i]=o.useState(u);return o.useEffect(()=>{if(u){i(!0),document.body.style.overflow="hidden";const l=x=>{x.key==="Escape"&&r()};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}}else{const l=setTimeout(()=>{i(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(l)}},[u,r]),w?e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 ${u?"animate-fade-in":"animate-fade-out"}`,onClick:r,children:e.jsxs("div",{className:`bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700 ${u?"animate-zoom-in":"animate-zoom-out"}`,onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:m}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),d]})}):null},ps=()=>{const[d,r]=o.useState([]),[m,u]=o.useState(null),[w,i]=o.useState(!1),[l,x]=o.useState(1),[k,P]=o.useState(!1),[I,D]=o.useState(null),[U,b]=o.useState(!0),[$,M]=o.useState(!1),[R,A]=o.useState(null),[B,O]=o.useState(!1),[E,J]=o.useState(null),F=async()=>{const{data:v,error:T}=await S.from("categories").select("*").order("name");T?(console.error("Error fetching categories: ",T),f("فشل في تحميل الفئات.","error")):r(v),b(!1)};o.useEffect(()=>{b(!0),F();const v=S.channel("public:categories").on("postgres_changes",{event:"*",schema:"public",table:"categories"},F).subscribe();return()=>{S.removeChannel(v)}},[]);const f=(v,T)=>{A({message:v,type:T})},p=async v=>{M(!0);try{const{error:T}=await S.from("categories").insert([v]);if(T)throw T;f("تمت إضافة الفئة بنجاح!","success"),i(!1),x(1)}catch(T){console.error("Error adding category: ",T);const W=T.message||JSON.stringify(T);f(`حدث خطأ أثناء إضافة الفئة: ${W}`,"error")}finally{M(!1)}},c=async(v,T)=>{M(!0);const W=m==null?void 0:m.name,z=T.name,G=W&&z&&W!==z;try{const{error:Y}=await S.from("categories").update(T).eq("id",v);if(Y)throw Y;if(G){f("تم تحديث الفئة. جاري تحديث المحتوى المرتبط...","success");const{data:Q,error:V}=await S.from("movies").select("id, genres").contains("genres",[W]);if(V)console.error("Error fetching movies to update:",V),f("تم تحديث الفئة، لكن حدث خطأ أثناء جلب الأفلام للتحديث.","error");else if(Q&&Q.length>0){const a=Q.map(t=>{const j=t.genres.map(N=>N===W?z:N);return S.from("movies").update({genres:j}).eq("id",t.id)}),C=(await Promise.all(a)).find(t=>t.error);C&&(console.error("Error updating movies with new category:",C.error),f("تم تحديث الفئة، لكن حدث خطأ أثناء تحديث بعض الأفلام.","error"))}const{data:n,error:s}=await S.from("series").select("id, genres").contains("genres",[W]);if(s)console.error("Error fetching series to update:",s),f("تم تحديث الفئة، لكن حدث خطأ أثناء جلب المسلسلات للتحديث.","error");else if(n&&n.length>0){const a=n.map(t=>{const j=t.genres.map(N=>N===W?z:N);return S.from("series").update({genres:j}).eq("id",t.id)}),C=(await Promise.all(a)).find(t=>t.error);C&&(console.error("Error updating series with new category:",C.error),f("تم تحديث الفئة، لكن حدث خطأ أثناء تحديث بعض المسلسلات.","error"))}f("تم تحديث الفئة والمحتوى المرتبط بنجاح!","success")}else f("تم تحديث الفئة بنجاح!","success");u(null),i(!1)}catch(Y){if(console.error("Error updating category transaction: ",Y),Y.code==="23505")f(`فشل التحديث: اسم الفئة "${z}" موجود بالفعل.`,"error");else{const Q=Y.message||JSON.stringify(Y);f(`حدث خطأ أثناء تحديث الفئة: ${Q}`,"error")}}finally{M(!1)}},g=v=>{D(v),P(!0)},y=async()=>{if(I){M(!0);try{const{error:v}=await S.from("categories").delete().eq("id",I.id);if(v)throw v;f("تم حذف الفئة بنجاح!","success")}catch(v){console.error("Error deleting category: ",v);const T=v.message||JSON.stringify(v);f(`حدث خطأ أثناء حذف الفئة: ${T}`,"error")}finally{P(!1),D(null),M(!1)}}},q=v=>{u(v),i(!0)},_=()=>{u(null),i(!0)},H=()=>{u(null),i(!1)},Z=(v,T)=>{O(!1),J({source:v,dest:T})},ee=async()=>{if(!E)return;const{source:v,dest:T}=E;M(!0);try{f("جاري تحديث الأفلام...","success");const{data:W,error:z}=await S.from("movies").select("id, genres").contains("genres",[v]);if(z)throw new Error(`Failed to fetch movies: ${z.message}`);if(W&&W.length>0){const V=W.map(n=>{const s=[...new Set(n.genres.filter(a=>a!==v).concat([T]))];return S.from("movies").update({genres:s}).eq("id",n.id)});await Promise.all(V)}f("جاري تحديث المسلسلات...","success");const{data:G,error:Y}=await S.from("series").select("id, genres").contains("genres",[v]);if(Y)throw new Error(`Failed to fetch series: ${Y.message}`);if(G&&G.length>0){const V=G.map(n=>{const s=[...new Set(n.genres.filter(a=>a!==v).concat([T]))];return S.from("series").update({genres:s}).eq("id",n.id)});await Promise.all(V)}f("جاري حذف الفئة المدمجة...","success");const{error:Q}=await S.from("categories").delete().eq("name",v);if(Q)throw new Error(`Failed to delete category: ${Q.message}`);f("تم دمج الفئات بنجاح!","success")}catch(W){console.error("Error merging categories: ",W),f(`فشل دمج الفئات: ${W.message}`,"error")}finally{J(null),M(!1)}},le=Math.ceil(d.length/fe),se=d.slice((l-1)*fe,l*fe);return U?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(us,{})]}):e.jsxs("div",{children:[R&&e.jsx(xs,{...R,onClose:()=>A(null)}),e.jsx(ae,{isOpen:k,onClose:()=>P(!1),onConfirm:y,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',I==null?void 0:I.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:$}),e.jsx(ae,{isOpen:!!E,onClose:()=>J(null),onConfirm:ee,title:"تأكيد عملية الدمج",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد دمج الفئة ",e.jsxs("strong",{className:"text-white",children:['"',E==null?void 0:E.source,'"']})," في الفئة ",e.jsxs("strong",{className:"text-white",children:['"',E==null?void 0:E.dest,'"']}),"؟",e.jsx("br",{}),e.jsxs("span",{className:"text-yellow-400",children:['سيتم حذف الفئة "',E==null?void 0:E.source,'" نهائياً. لا يمكن التراجع عن هذا الإجراء.']})]}),isLoading:$}),e.jsx(ms,{isOpen:B,onClose:()=>O(!1),onSubmit:Z,isLoading:$,categories:d}),e.jsx(hs,{isOpen:w,title:m?"تعديل الفئة":"إضافة فئة جديدة",onClose:H,children:e.jsx(cs,{onSubmit:m?v=>c(m.id,v):p,initialData:m,onCancel:H,isLoading:$})}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsx("button",{onClick:_,className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsx("button",{onClick:()=>O(!0),className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500 transition-colors",children:"توحيد الفئات"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden hidden sm:block",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:d.length>0?se.map(v=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:v.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>q(v),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>g(v),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},v.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})})}),e.jsx("div",{className:"block sm:hidden space-y-3",children:d.length>0?se.map(v=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-white",children:v.name}),e.jsxs("div",{className:"flex gap-4 flex-shrink-0",children:[e.jsx("button",{onClick:()=>q(v),className:"text-cyan-400 hover:text-cyan-300 text-sm font-medium",children:"تعديل"}),e.jsx("button",{onClick:()=>g(v),className:"text-red-500 hover:text-red-400 text-sm font-medium",children:"حذف"})]})]},v.id)):e.jsx("div",{className:"text-center py-8 text-gray-400 bg-slate-900/50 rounded-lg",children:"لا توجد فئات حالياً."})})]}),d.length>fe&&e.jsx("div",{className:"mt-4",children:e.jsx(Se,{currentPage:l,totalPages:le,onPageChange:x})})]})},ve=["movies","series","categories"],gs=d=>d.replace(/[A-Z]/g,r=>`_${r.toLowerCase()}`),Ce=d=>Array.isArray(d)?d.map(r=>Ce(r)):d!==null&&typeof d=="object"&&d.constructor===Object?d.hasOwnProperty("seconds")&&d.hasOwnProperty("nanoseconds")&&Object.keys(d).length===2&&typeof d.seconds=="number"&&typeof d.nanoseconds=="number"?new Date(d.seconds*1e3).toISOString():d.hasOwnProperty("_seconds")&&d.hasOwnProperty("_nanoseconds")&&Object.keys(d).length===2&&typeof d._seconds=="number"&&typeof d._nanoseconds=="number"?new Date(d._seconds*1e3).toISOString():Object.keys(d).reduce((r,m)=>{const u=gs(m);return r[u]=Ce(d[m]),r},{}):d,fs=()=>{const[d,r]=o.useState(!1),[m,u]=o.useState(null),[w,i]=o.useState(!1),[l,x]=o.useState(null),k=(b,$)=>{u({message:b,type:$})},P=async()=>{r(!0),k("بدء عملية النسخ الاحتياطي... قد تستغرق هذه العملية بعض الوقت.","success");try{const b={};for(const O of ve){const{data:E,error:J}=await S.from(O).select("*");if(J)throw J;b[O]=E||[]}const $=JSON.stringify(b,null,2),M=new Blob([$],{type:"application/json"}),R=URL.createObjectURL(M),A=document.createElement("a");A.href=R;const B=new Date().toISOString().slice(0,10);A.download=`supabase-backup-${B}.json`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(R),k("تم إكمال النسخ الاحتياطي بنجاح!","success")}catch(b){console.error("Backup failed:",b);let $="فشل النسخ الاحتياطي. تحقق من وحدة التحكم لمزيد من التفاصيل.";b.code==="42501"&&($="فشل النسخ الاحتياطي: أذونات غير كافية. تأكد من أن قواعد RLS تسمح للمشرفين بقراءة المجموعات."),k($,"error")}finally{r(!1)}},I=b=>{var M;const $=(M=b.target.files)==null?void 0:M[0];if($){const R=new FileReader;R.onload=A=>{var B;try{const O=(B=A.target)==null?void 0:B.result,E=JSON.parse(O);x(E)}catch(O){k("ملف JSON غير صالح.","error"),console.error("JSON parsing error:",O),x(null)}},R.readAsText($)}},D=()=>{l?i(!0):k("الرجاء تحديد ملف نسخ احتياطي أولاً.","error")},U=async()=>{if(i(!1),!!l){r(!0),k("بدء عملية الاستعادة... هذه العملية ستستغرق وقتاً.","success");try{let b=0,$=[];for(const R of Object.keys(l)){if(!ve.includes(R)){$.push(R),console.warn(`Skipping restore for unsupported collection: "${R}"`);continue}const A=l[R];if(Array.isArray(A)&&A.length>0){const B=A.map(E=>Ce(E)),{error:O}=await S.from(R).upsert(B);if(O)throw console.error(`Error during upsert to "${R}":`,JSON.stringify(O,null,2)),console.error("First failed object (transformed):",JSON.stringify(B[0],null,2)),O;b++}}let M="تمت استعادة البيانات بنجاح!";$.length>0&&(M+=` تم تخطي المجموعات التالية: ${$.join(", ")}.`),b===0&&$.length>0?k(`لم يتم العثور على مجموعات بيانات صالحة للاستعادة في الملف. تم تخطي: ${$.join(", ")}.`,"error"):b>0?k(M,"success"):k("لم يتم العثور على بيانات صالحة للاستعادة في الملف.","error")}catch(b){console.error("Restore failed:",JSON.stringify(b,null,2));const $=`فشلت عملية الاستعادة: ${b.message||"خطأ غير معروف"}. يرجى مراجعة وحدة التحكم للحصول على التفاصيل الفنية.`;k($,"error")}finally{r(!1),x(null)}}};return e.jsxs("div",{className:"space-y-12",children:[m&&e.jsx(_e,{...m,onClose:()=>u(null)}),e.jsx(ae,{isOpen:w,onClose:()=>i(!1),onConfirm:U,title:"تأكيد استعادة البيانات",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد استعادة البيانات من هذا الملف؟",e.jsx("br",{}),e.jsx("strong",{className:"text-yellow-400",children:"تحذير:"})," سيتم الكتابة فوق أي بيانات موجودة في المجموعات التي لها نفس الأسماء. لا يمكن التراجع عن هذا الإجراء."]}),isLoading:d}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"النسخ الاحتياطي للبيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:["انقر على الزر أدناه لتصدير بيانات المحتوى العام (",ve.join(", "),"). لا يتم تضمين بيانات المستخدمين والمشرفين الخاصة في هذا النسخ الاحتياطي من جانب العميل لأسباب تتعلق بالأمان والأذونات."]}),e.jsxs("button",{onClick:P,disabled:d,className:"w-full flex items-center justify-center bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-800 disabled:cursor-wait",children:[d&&e.jsx(de,{}),d?"جاري التصدير...":"تصدير بيانات المحتوى الآن"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"استعادة البيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("div",{className:"p-4 border-l-4 border-yellow-500 bg-yellow-500/10 text-yellow-300 rounded-md",children:[e.jsx("strong",{className:"font-bold",children:"تحذير خطير:"})," استعادة البيانات من ملف ستقوم بالكتابة فوق البيانات الحالية في قاعدة البيانات. استخدم هذه الميزة بحذر شديد وتأكد من أنك تستخدم ملف النسخ الاحتياطي الصحيح."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"1. حدد ملف النسخ الاحتياطي (.json)"}),e.jsx("input",{type:"file",accept:".json",onChange:I,className:"w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-500/20 file:text-cyan-300 hover:file:bg-cyan-500/30"})]}),e.jsxs("button",{onClick:D,disabled:d||!l,className:"w-full flex items-center justify-center bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors disabled:bg-red-800 disabled:cursor-not-allowed disabled:cursor-wait",children:[d&&e.jsx(de,{}),d?"جاري الاستعادة...":"2. استعادة البيانات"]})]})]})]})},ke=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(as,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx(os,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(ps,{})},{key:"backup",label:"النسخ الاحتياطي والاستعادة",component:e.jsx(fs,{})}],bs=({label:d,tabKey:r,activeTab:m,onClick:u})=>e.jsx("button",{onClick:()=>u(r),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex-shrink-0 ${m===r?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":m===r,children:d}),Ns=()=>{var u;const[d,r]=o.useState(ke[0].key),m=(u=ke.find(w=>w.key===d))==null?void 0:u.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6 overflow-x-auto whitespace-nowrap scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",role:"tablist",children:ke.map(w=>e.jsx(bs,{label:w.label,tabKey:w.key,activeTab:d,onClick:r},w.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-3 sm:p-6 rounded-lg border border-slate-700",children:m})]})};export{Ns as default};
