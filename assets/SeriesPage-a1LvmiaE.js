import{R as K,u as Q,r as x,j as e,L as X,a as $,b as Z,d as P}from"./index-SB9iHKDM.js";import{H as ee,a as te,S as se,G as ae,T as re,Y as le}from"./TagFilter-DSK1hLIj.js";import{b as ne,u as oe,a as ie}from"./MovieCardSkeleton-0pZWhUh-.js";import{M as ce}from"./MovieGridSkeleton-4Q3-vxbl.js";import{I as de}from"./InfiniteScrollTrigger-BVp-5I8K.js";const xe=({isFavorite:a})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 sm:h-6 sm:w-6 transition-all duration-300 ${a?"text-red-500":"text-white"}`,fill:a?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 016.364 6.364L12 20.364l-7.682-7.682a4.5 4.5 0 010-6.364z"})}),me=({isWatchLater:a})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 sm:h-6 sm:w-6 transition-all duration-300 ${a?"text-cyan-400":"text-white"}`,fill:a?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),ge=()=>e.jsx("svg",{className:"h-4 w-4 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}),he=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 2a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 2zM5.404 4.343a.75.75 0 010 1.06l-1.06 1.06a.75.75 0 01-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm9.192 0a.75.75 0 011.06 0l1.06 1.06a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zM2.75 10a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5h-1.5A.75.75 0 012.75 10zm12.5 0a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5h-1.5a.75.75 0 01-.75-.75zM5.404 15.657a.75.75 0 011.06 0l-1.06 1.06a.75.75 0 01-1.06-1.06l1.06-1.06zm9.192 0a.75.75 0 010 1.06l1.06 1.06a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 011.06 0zM10 14.25a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5a.75.75 0 01.75-.75z",clipRule:"evenodd"})}),ue=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12.395 2.553a1 1 0 00-1.45-.385c-.345.675-.865 1.228-1.462 1.756C9.07 5.25 8.247 5.5 7.5 5.5c-1.25 0-2.312-.746-2.813-1.846a1 1 0 00-1.748.817c.22.48.51.92.85 1.307.34.386.72.724 1.14 1.003C6.152 7.64 7.042 8 8 8c.675 0 1.32-.206 1.84-.572A4.413 4.413 0 0011.03 6.16c.41-.37.77-.79.99-1.272a1 1 0 00-.01-1.107l-.02-.02zM15 12a1 1 0 100 2h.01a1 1 0 100-2H15zM3 12a1 1 0 100 2h.01a1 1 0 100-2H3zM9 12a1 1 0 100 2h.01a1 1 0 100-2H9z",clipRule:"evenodd"})}),fe=({series:a,isFavorite:f,isWatchLater:p,averageRating:u,ratingCount:m,onToggleFavorite:b,onToggleWatchLater:c})=>{var j;const{currentUser:v}=Q(),[g,h]=x.useState(!1),{imageRef:y,imageSrc:N,isLoaded:w,handleImageLoad:S}=ne(a.posterUrl),A=u>=4&&m>=10,d=(j=a.createdAt)!=null&&j.toDate?new Date().getTime()-a.createdAt.toDate().getTime()<10080*60*1e3:!1,o=n=>{n.preventDefault(),n.stopPropagation(),b(a.id)},i=n=>{n.preventDefault(),n.stopPropagation(),c(a.id)};return e.jsx("div",{className:"relative group",children:e.jsxs(X,{to:`/series/${a.id}`,className:"relative block z-10 rounded-lg overflow-hidden shadow-lg hover:shadow-xl hover:shadow-cyan-500/20 transform transition-all duration-300 ease-in-out group-hover:scale-105 bg-slate-800",children:[v&&e.jsxs("div",{className:"absolute top-1.5 right-1.5 z-20 flex flex-col gap-1.5 opacity-0 group-hover:opacity-100 translate-y-2 group-hover:translate-y-0 transition-all duration-300",children:[e.jsx("button",{onClick:o,className:"p-1.5 bg-slate-900/60 rounded-full hover:bg-slate-900/80 transition-all duration-200 hover:scale-110","aria-label":f?"إزالة من المفضلة":"إضافة إلى المفضلة",children:e.jsx(xe,{isFavorite:f})}),e.jsx("button",{onClick:i,className:"p-1.5 bg-slate-900/60 rounded-full hover:bg-slate-900/80 transition-all duration-200 hover:scale-110","aria-label":p?"إزالة من قائمة المشاهدة لاحقاً":"إضافة إلى قائمة المشاهدة لاحقاً",children:e.jsx(me,{isWatchLater:p})})]}),e.jsx("div",{className:"relative w-full aspect-[2/3] bg-slate-800 overflow-hidden",children:e.jsx("img",{ref:y,src:N,onLoad:S,alt:a.title,className:`
              w-full h-full object-cover
              transition-all duration-700 ease-in-out group-hover:opacity-75
              ${w?"scale-100 blur-0":"scale-110 blur-md"}
            `})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/90 via-black/70 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 sm:p-3 md:p-4 transition-all duration-300 group-hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-white text-sm sm:text-base font-bold truncate flex-shrink min-w-0",children:a.title}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[d&&e.jsx("div",{title:"إضافة جديدة",className:"flex items-center justify-center h-5 w-5 bg-yellow-400/10 text-yellow-300 rounded-full",children:e.jsx(he,{})}),A&&e.jsx("div",{title:"شائع حالياً",className:"flex items-center justify-center h-5 w-5 bg-orange-400/10 text-orange-400 rounded-full",children:e.jsx(ue,{})})]})]}),e.jsxs("div",{className:"mt-1 space-y-0.5",children:[a.genres&&a.genres.length>0&&e.jsxs("div",{className:"relative",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:[e.jsx("p",{className:"text-slate-400 text-xs truncate",children:a.genres.join(" / ")}),g&&e.jsx("div",{className:"absolute bottom-full left-0 mb-1 w-max max-w-xs bg-slate-900 text-white text-xs rounded py-1.5 px-3 z-10 shadow-lg border border-slate-700 pointer-events-none animate-fade-in-up-fast",children:a.genres.join(", ")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-slate-300 text-xs sm:text-sm",children:a.year}),m>0?e.jsxs("div",{className:"flex items-center gap-1 text-xs sm:text-sm text-yellow-400",title:`Average rating: ${u.toFixed(1)} from ${m} user${m>1?"s":""}`,children:[e.jsx(ge,{}),e.jsx("span",{className:"font-bold text-white",children:u.toFixed(1)}),e.jsxs("span",{className:"text-slate-400 text-xs ml-1 font-normal",children:["(",m,")"]})]}):e.jsx("div",{className:"h-5"})]})]})]})]})})},pe=K.memo(fe),ve=({series:a})=>{const{isFavorite:f,toggleFavorite:p}=oe(),{isWatchLater:u,toggleWatchLater:m}=ie(),{getAverageRating:b}=$();return e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 md:gap-6",children:a.map(c=>{const{average:v,count:g}=b(c.id);return e.jsx(pe,{series:c,isFavorite:f(c.id),isWatchLater:u(c.id),averageRating:v,ratingCount:g,onToggleFavorite:p,onToggleWatchLater:m},c.id)})})},G=28,Se=()=>{const[a,f]=x.useState([]),[p,u]=x.useState([]),[m,b]=x.useState(!0),[c,v]=x.useState(null),{getAverageRating:g}=$(),[h,y]=Z(),[N,w]=x.useState(1),[S,A]=x.useState(!1),d=h.get("year")||"all",o=h.getAll("genre"),i=h.getAll("tag"),j=h.get("sort")||"createdAt_desc";x.useEffect(()=>{(async()=>{try{const r=(await P.collection("series").orderBy("createdAt","desc").get()).docs.map(l=>({id:l.id,...l.data()}));f(r)}catch(s){console.error("Error fetching series: ",s),s.code==="permission-denied"?v("خطأ في الأذونات: لا يمكن الوصول إلى بيانات المسلسلات. يرجى مراجعة قواعد أمان Firestore."):v("حدث خطأ غير متوقع أثناء تحميل المسلسلات.")}finally{b(!1)}})()},[]),x.useEffect(()=>{const t=P.collection("categories").orderBy("name").onSnapshot(s=>{const r=s.docs.map(l=>l.data().name);u(r)},s=>{console.error("Error fetching categories: ",s)});return()=>t()},[]);const n=t=>{const s=new URLSearchParams(h);Object.entries(t).forEach(([r,l])=>{s.delete(r),Array.isArray(l)?l.forEach(M=>s.append(r,M)):l&&l!=="all"&&s.set(r,l)}),w(1),y(s,{replace:!0})},T=t=>{const s=o.includes(t)?o.filter(r=>r!==t):[...o,t];n({genre:s})},B=()=>n({genre:[]}),z=t=>{const s=i.includes(t)?i.filter(r=>r!==t):[...i,t];n({tag:s})},_=()=>n({tag:[]}),R=t=>n({year:t}),H=t=>n({sort:t}),D=()=>{w(1),y(new URLSearchParams,{replace:!0})},W=[...new Set(a.map(t=>t.year))].sort((t,s)=>s-t),Y=p,U=[...new Set(a.flatMap(t=>t.tags||[]))].sort(),C=x.useMemo(()=>a.filter(t=>d==="all"||t.year.toString()===d).filter(t=>o.length===0?!0:o.some(s=>{var r;return(r=t.genres)==null?void 0:r.includes(s)})).filter(t=>i.length===0?!0:i.some(s=>{var r;return(r=t.tags)==null?void 0:r.includes(s)})).sort((t,s)=>{var r,l,M,I;switch(j){case"rating_desc":return g(s.id).average-g(t.id).average;case"rating_asc":return g(t.id).average-g(s.id).average;case"year_desc":return Number(s.year)-Number(t.year);case"year_asc":return Number(t.year)-Number(s.year);case"createdAt_asc":{const k=(r=t.createdAt)!=null&&r.toMillis?t.createdAt.toMillis():0,L=(l=s.createdAt)!=null&&l.toMillis?s.createdAt.toMillis():0;return k-L}case"createdAt_desc":default:{const k=(M=s.createdAt)!=null&&M.toMillis?s.createdAt.toMillis():0,L=(I=t.createdAt)!=null&&I.toMillis?t.createdAt.toMillis():0;return k-L}}}),[a,d,o,i,j,g]),V=Math.ceil(C.length/G),F=N<V,O=()=>{F&&!S&&(A(!0),setTimeout(()=>{w(t=>t+1),A(!1)},500))},q=C.slice(0,N*G),E=d!=="all"||o.length>0||i.length>0;if(m)return e.jsxs("div",{children:[e.jsx(ee,{}),e.jsx("div",{className:"my-8 h-20 bg-gray-800/50 rounded-lg animate-pulse"}),e.jsxs("section",{className:"mb-12",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"تصفح كل المسلسلات"}),e.jsx(ce,{count:18})]})]});if(c)return e.jsx("div",{className:"text-center p-8 bg-red-900/20 border border-red-500 rounded-lg mt-8",children:e.jsx("p",{className:"text-2xl text-red-400",children:c})});const J=a.slice(0,5).map(t=>({...t,servers:[]}));return e.jsxs("div",{children:[e.jsx(te,{movies:J}),e.jsx("div",{className:"relative z-30 my-8 flex justify-center items-center p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl",children:e.jsxs("div",{className:"w-full grid grid-cols-1 sm:grid-cols-2 md:flex md:flex-row md:flex-wrap justify-center items-center gap-4",children:[e.jsx(se,{sortOrder:j,onSortChange:H}),e.jsx(ae,{genres:Y,selectedGenres:o,onToggleGenre:T,onClearGenres:B}),e.jsx(re,{tags:U,selectedTags:i,onToggleTag:z,onClearTags:_}),e.jsx(le,{years:W,selectedYear:d,onYearChange:R})]})}),E&&e.jsxs("div",{className:"mb-8 flex flex-wrap items-center gap-3 rounded-lg bg-gray-800/50 p-3 animate-fade-in-down",children:[e.jsx("span",{className:"font-bold text-gray-300 mr-2 flex-shrink-0",children:"الفلاتر النشطة:"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 flex-grow",children:[d!=="all"&&e.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["سنة: ",d,e.jsx("button",{onClick:()=>R("all"),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove year filter ${d}`,children:"×"})]}),o.map(t=>e.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:[t,e.jsx("button",{onClick:()=>T(t),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove genre filter ${t}`,children:"×"})]},t)),i.map(t=>e.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["#",t,e.jsx("button",{onClick:()=>z(t),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove tag filter ${t}`,children:"×"})]},t))]}),e.jsx("button",{onClick:D,className:"ml-auto text-sm font-bold text-red-500 hover:text-red-400 hover:underline flex-shrink-0 px-2",children:"مسح الكل"})]}),e.jsxs("section",{className:"mb-12",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:E?"نتائج البحث":"تصفح كل المسلسلات"}),C.length>0?e.jsxs(e.Fragment,{children:[e.jsx(ve,{series:q}),e.jsx(de,{onIntersect:O,hasMore:F,isLoading:S})]}):e.jsx("div",{className:"text-center p-8 bg-gray-800 rounded-lg mt-8",children:e.jsx("p",{className:"text-xl text-gray-400",children:"لا توجد مسلسلات تطابق معايير البحث."})})]})]})};export{Se as default};
