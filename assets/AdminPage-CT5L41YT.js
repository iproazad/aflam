import{r,d as E,j as e,F as J,T as de,u as ue}from"./index-meYP44dG.js";import{P as le}from"./Pagination-DBAWEYoW.js";const xe=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),me=({onSubmit:c,initialData:t,onCancel:l,isKurdishByDefault:n=!1,isLoading:d=!1,allGenres:u=[]})=>{const[i,m]=r.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:!1}),[j,b]=r.useState(""),[M,U]=r.useState(!1),[$,q]=r.useState(""),[D,F]=r.useState(""),[w,k]=r.useState(!1),C=r.useRef(null),[B,S]=r.useState(!1),[T,I]=r.useState(""),f=r.useRef(null);r.useEffect(()=>{t?(m({...t,genres:t.genres||[],tags:t.tags||[],servers:t.servers&&t.servers.length>0?t.servers:[{name:"Server 1",url:"",quality:"720p"}],backupServers:t.backupServers||[],trailerUrl:t.trailerUrl||"",isKurdish:t.isKurdish||!1}),b((t.tags||[]).join(", "))):(m({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:n}),b(""))},[t,n]),r.useEffect(()=>{const s=o=>{C.current&&!C.current.contains(o.target)&&U(!1)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]),r.useEffect(()=>{f.current&&clearTimeout(f.current);const s=i.title.trim();if(!s||t&&s===t.title.trim()){I(""),S(!1);return}return S(!0),I(""),f.current=window.setTimeout(async()=>{try{const o=await E.collection("movies").where("title","==",s).get();let x=!1;o.empty||(t?o.forEach(N=>{N.id!==t.id&&(x=!0)}):x=!0),I(x?"تحذير: فيلم بنفس هذا العنوان موجود بالفعل.":"")}catch(o){console.error("Error checking for duplicate title:",o)}finally{S(!1)}},500),()=>{f.current&&clearTimeout(f.current)}},[i.title,t]);const v=s=>{const{name:o,value:x,type:N}=s.target;if(N==="checkbox"){const{checked:O}=s.target;m(re=>({...re,[o]:O}))}else m(O=>({...O,[o]:o==="year"?parseInt(x):x}))},_=s=>{b(s.target.value)},A=s=>{m(o=>{const x=o.genres||[],N=x.includes(s)?x.filter(O=>O!==s):[...x,s];return{...o,genres:N}})},K=async()=>{const s=D.trim();if(s){if(u.some(o=>o.toLowerCase()===s.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}k(!0);try{await E.collection("categories").add({name:s}),m(o=>({...o,genres:[...o.genres||[],s]})),F("")}catch(o){console.error("Error adding new genre:",o),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{k(!1)}}},g=(s,o,x)=>{const N=[...i.servers];N[s]={...N[s],[o]:x},m(O=>({...O,servers:N}))},z=()=>{m(s=>({...s,servers:[...s.servers,{name:`Server ${s.servers.length+1}`,url:"",quality:"720p"}]}))},p=s=>{m(o=>({...o,servers:o.servers.filter((x,N)=>N!==s)}))},P=(s,o,x)=>{const N=[...i.backupServers||[]];N[s]={...N[s],[o]:x},m(O=>({...O,backupServers:N}))},V=()=>{m(s=>{var o;return{...s,backupServers:[...s.backupServers||[],{name:`Backup Server ${(((o=s.backupServers)==null?void 0:o.length)||0)+1}`,url:"",quality:"720p"}]}})},G=s=>{m(o=>({...o,backupServers:(o.backupServers||[]).filter((x,N)=>N!==s)}))},se=s=>{if(s.preventDefault(),i.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const o=j.split(",").map(x=>x.trim()).filter(x=>x!=="");c({...i,tags:o})},Y=u.filter(s=>s.toLowerCase().includes($.toLowerCase()));return e.jsxs("form",{onSubmit:se,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",name:"title",value:i.title,onChange:v,placeholder:"عنوان الفيلم",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),B&&e.jsx("p",{className:"text-xs text-gray-400 mt-1 animate-pulse",children:"جاري التحقق من العنوان..."}),T&&e.jsxs("p",{className:"text-sm text-yellow-400 mt-2 font-semibold flex items-center gap-2 animate-fade-in",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.636-1.21 2.37-1.21 3.006 0l5.485 10.47c.616 1.176-.24 2.62-1.503 2.62H4.275c-1.263 0-2.118-1.444-1.503-2.62l5.485-10.47zM9 9a1 1 0 011-1h0a1 1 0 011 1v3a1 1 0 01-2 0V9zm1 6a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),T]})]}),e.jsx("input",{type:"number",name:"year",value:i.year,onChange:v,placeholder:"سنة الإنتاج",required:!0,className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"})]}),e.jsx("textarea",{name:"description",value:i.description,onChange:v,placeholder:"وصف الفيلم",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none h-32"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:i.posterUrl,onChange:v,placeholder:"رابط صورة البوستر",required:!0,className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsx("input",{type:"url",name:"backdropUrl",value:i.backdropUrl,onChange:v,placeholder:"رابط صورة الخلفية",required:!0,className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:j,onChange:_,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"isKurdish",type:"checkbox",name:"isKurdish",checked:!!i.isKurdish,onChange:v,className:"h-5 w-5 text-cyan-500 bg-gray-700 border-gray-600 rounded focus:ring-cyan-600 focus:ring-offset-gray-800 cursor-pointer"}),e.jsx("label",{htmlFor:"isKurdish",className:"text-white cursor-pointer",children:"هذا الفيلم مدبلج للكردية"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:C,children:[e.jsxs("button",{type:"button",onClick:()=>U(s=>!s),className:"w-full bg-gray-700 p-2 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none text-right flex justify-between items-center min-h-[52px]","aria-haspopup":"true","aria-expanded":M,children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:i.genres.length>0?i.genres.map(s=>e.jsxs("span",{className:"bg-cyan-600 text-white text-xs font-semibold px-2 py-1 rounded-full flex items-center gap-1",children:[s,e.jsx("button",{type:"button",onClick:o=>{o.stopPropagation(),A(s)},className:"text-cyan-200 hover:text-white leading-none text-lg","aria-label":`إزالة ${s}`,children:"×"})]},s)):e.jsx("span",{className:"text-gray-400 px-1",children:"اختر الفئات..."})}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 text-gray-400 transition-transform ${M?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),M&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-gray-800 border border-gray-600 rounded-md shadow-lg animate-fade-in-up-fast",children:[e.jsx("div",{className:"p-2",children:e.jsx("input",{type:"text",placeholder:"ابحث عن فئة...",value:$,onChange:s=>q(s.target.value),className:"w-full bg-gray-900 text-white p-2 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",autoFocus:!0})}),e.jsx("ul",{className:"max-h-60 overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-800",children:Y.length>0?Y.map(s=>e.jsx("li",{children:e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-cyan-500/10 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:i.genres.includes(s),onChange:()=>A(s),className:"h-5 w-5 text-cyan-500 bg-gray-900 border-gray-600 rounded focus:ring-cyan-600 focus:ring-offset-gray-800 cursor-pointer"}),e.jsx("span",{className:"text-white select-none",children:s})]})},s)):e.jsx("li",{className:"text-gray-400 text-center p-4",children:"لا توجد نتائج"})}),e.jsx("div",{className:"border-t border-gray-600 p-2 mt-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"أو أضف فئة جديدة...",value:D,onChange:s=>F(s.target.value),onKeyDown:s=>{s.key==="Enter"&&(s.preventDefault(),K())},className:"flex-grow bg-gray-900 text-white p-2 text-sm rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsx("button",{type:"button",onClick:K,disabled:w||!D.trim(),className:"flex-shrink-0 bg-cyan-600 text-white px-3 py-1.5 text-sm font-bold rounded-md hover:bg-cyan-700 transition-colors disabled:bg-gray-500 disabled:cursor-not-allowed",children:w?"...":"إضافة"})]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"downloadUrl",value:i.downloadUrl??"",onChange:v,placeholder:"رابط التحميل (اختياري)",className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsx("input",{type:"url",name:"trailerUrl",value:i.trailerUrl??"",onChange:v,placeholder:"رابط المقطع الدعائي (اختياري)",className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات المشاهدة"}),i.servers.map((s,o)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-gray-700 rounded-md",children:[e.jsx("input",{type:"text",value:s.name,onChange:x=>g(o,"name",x.target.value),placeholder:"اسم السيرفر",className:"bg-gray-600 text-white p-2 rounded-md flex-1 border-none outline-none focus:ring-2 focus:ring-cyan-500"}),e.jsx("input",{type:"url",value:s.url,onChange:x=>g(o,"url",x.target.value),placeholder:"رابط السيرفر",required:!0,className:"bg-gray-600 text-white p-2 rounded-md flex-grow-[2] border-none outline-none focus:ring-2 focus:ring-cyan-500"}),e.jsxs("select",{value:s.quality,onChange:x=>g(o,"quality",x.target.value),className:"bg-gray-600 text-white p-2 rounded-md flex-1 border-none outline-none focus:ring-2 focus:ring-cyan-500 cursor-pointer",children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>p(o),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},o)),e.jsx("button",{type:"button",onClick:z,className:"mt-2 bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات احتياطية (اختياري)"}),(i.backupServers||[]).map((s,o)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-gray-700 rounded-md",children:[e.jsx("input",{type:"text",value:s.name,onChange:x=>P(o,"name",x.target.value),placeholder:"اسم السيرفر الاحتياطي",className:"bg-gray-600 text-white p-2 rounded-md flex-1 border-none outline-none focus:ring-2 focus:ring-cyan-500"}),e.jsx("input",{type:"url",value:s.url,onChange:x=>P(o,"url",x.target.value),placeholder:"رابط السيرفر الاحتياطي",className:"bg-gray-600 text-white p-2 rounded-md flex-grow-[2] border-none outline-none focus:ring-2 focus:ring-cyan-500"}),e.jsxs("select",{value:s.quality,onChange:x=>P(o,"quality",x.target.value),className:"bg-gray-600 text-white p-2 rounded-md flex-1 border-none outline-none focus:ring-2 focus:ring-cyan-500 cursor-pointer",children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>G(o),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},o)),e.jsx("button",{type:"button",onClick:V,className:"mt-2 bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:l,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:d,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:d||!!T,children:[d&&e.jsx(xe,{}),d?t?"جاري التحديث...":"جاري الإضافة...":t?"تحديث":"إضافة"]})]})]})},ge=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),W=({isOpen:c,onClose:t,onConfirm:l,title:n,message:d,isLoading:u=!1})=>c?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 animate-fade-in",onClick:t,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"relative bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-md animate-zoom-in",onClick:i=>i.stopPropagation(),children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-red-600 to-yellow-500 rounded-lg blur opacity-75"}),e.jsxs("div",{className:"relative bg-gray-800 p-8 rounded-lg",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-900/50 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:n}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-gray-300",children:d})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-gray-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:l,disabled:u,children:[u&&e.jsx(ge,{}),u?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-600 shadow-sm px-4 py-2 bg-gray-700 text-base font-medium text-white hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-gray-800 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50",onClick:t,disabled:u,children:"إلغاء"})]})]})]})}):null,he=10,pe=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((c,t)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},t))})}),e.jsx("tbody",{children:[...Array(he)].map((c,t)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((l,n)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},n))]},t))})]})})]}),ye=({message:c,type:t,onClose:l})=>(r.useEffect(()=>{const u=setTimeout(l,5e3);return()=>clearTimeout(u)},[l]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${t==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:c}),e.jsx("button",{onClick:l,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),te=({children:c,onClose:t,title:l})=>(r.useEffect(()=>{const n=d=>{d.key==="Escape"&&t()};return window.addEventListener("keydown",n),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",n),document.body.style.overflow="auto"}},[t]),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 animate-fade-in p-4",onClick:t,children:e.jsxs("div",{className:"relative bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] animate-zoom-in",onClick:n=>n.stopPropagation(),children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-lg blur opacity-75"}),e.jsxs("div",{className:"relative bg-gray-800 p-6 md:p-8 rounded-lg overflow-y-auto max-h-[90vh] scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:l}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),c]})]})})),oe=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),be=({genres:c,onSubmit:t,onClose:l,isLoading:n})=>{const[d,u]=r.useState(c[0]||""),[i,m]=r.useState("add"),j=b=>{b.preventDefault(),d&&t(d,i)};return e.jsx(te,{title:"تغيير الفئة بشكل جماعي",onClose:l,children:e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:d,onChange:b=>u(b.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:c.map(b=>e.jsx("option",{value:b,children:b},b))}),e.jsxs("select",{value:i,onChange:b=>m(b.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:l,disabled:n,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:n||!d,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[n&&e.jsx(oe,{}),n?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},fe=({onSubmit:c,onClose:t,isLoading:l})=>{const[n,d]=r.useState(new Date().getFullYear()),u=i=>{i.preventDefault(),c(n)};return e.jsx(te,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:t,children:e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:n,onChange:i=>d(parseInt(i.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:t,disabled:l,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:l,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[l&&e.jsx(oe,{}),l?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},je=({onSubmit:c,onClose:t,isLoading:l})=>{const[n,d]=r.useState(""),[u,i]=r.useState("add"),m=j=>{j.preventDefault(),n.trim()&&c(n.trim(),u)};return e.jsx(te,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:t,children:e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:n,onChange:j=>d(j.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:u,onChange:j=>i(j.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:t,disabled:l,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:l||!n.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[l&&e.jsx(oe,{}),l?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Q=10,we=()=>{const[c,t]=r.useState([]),[l,n]=r.useState(null),[d,u]=r.useState(!1),[i,m]=r.useState(1),[j,b]=r.useState("all"),[M,U]=r.useState(!1),[$,q]=r.useState(null),[D,F]=r.useState(!0),[w,k]=r.useState(!1),[C,B]=r.useState(null),[S,T]=r.useState([]),[I,f]=r.useState(null),[v,_]=r.useState([]);r.useEffect(()=>{F(!0);const a=E.collection("movies").orderBy("createdAt","desc").onSnapshot(y=>{const R=y.docs.map(L=>({id:L.id,...L.data()}));t(R),F(!1)},y=>{console.error("Error fetching movies: ",y),B({message:"فشل في تحميل الأفلام.",type:"error"}),F(!1)}),h=E.collection("categories").orderBy("name").onSnapshot(y=>{const R=y.docs.map(L=>L.data().name);_(R)},y=>{console.error("Error fetching categories from ManageMovies: ",y)});return()=>{a(),h()}},[]),r.useEffect(()=>{m(1),T([])},[j]);const A=(a,h)=>{B({message:a,type:h})},K=async a=>{k(!0);try{await E.collection("movies").add({...a,createdAt:de.now()}),u(!1),m(1),A("تمت إضافة الفيلم بنجاح.","success")}catch(h){console.error("Error adding movie: ",h),A("حدث خطأ أثناء إضافة الفيلم.","error")}finally{k(!1)}},g=async(a,h)=>{k(!0);try{await E.collection("movies").doc(a).update(h),n(null),u(!1),A("تم تحديث الفيلم بنجاح.","success")}catch(y){console.error("Error updating movie: ",y),A("حدث خطأ أثناء تحديث الفيلم.","error")}finally{k(!1)}},z=a=>{q(a),U(!0)},p=async()=>{if($){k(!0);try{await E.collection("movies").doc($.id).delete(),A("تم حذف الفيلم بنجاح.","success")}catch(a){console.error("Error deleting movie: ",a),A("حدث خطأ أثناء حذف الفيلم.","error")}finally{U(!1),q(null),k(!1)}}},P=a=>{n(a),u(!0)},V=()=>{n(null),u(!0)},G=()=>{n(null),u(!1),f(null)},se=a=>{T(h=>h.includes(a)?h.filter(y=>y!==a):[...h,a])},Y=a=>{a.target.checked?T(X.map(h=>h.id)):T([])},s=async(a,h)=>{k(!0);try{const y=E.batch();S.forEach(R=>{const L=E.collection("movies").doc(R);y.update(L,a)}),await y.commit(),A(h,"success"),T([])}catch(y){console.error("Bulk update failed:",y),A("فشل التحديث الجماعي.","error")}finally{k(!1),f(null)}},o=async()=>{k(!0);try{const a=E.batch();S.forEach(h=>{const y=E.collection("movies").doc(h);a.delete(y)}),await a.commit(),A(`تم حذف ${S.length} فيلم بنجاح.`,"success"),T([])}catch(a){console.error("Bulk delete failed:",a),A("فشل الحذف الجماعي.","error")}finally{k(!1),f(null)}},x=async(a,h)=>{const y={genres:h==="add"?J.arrayUnion(a):J.arrayRemove(a)};await s(y,`تم ${h==="add"?"إضافة":"إزالة"} فئة "${a}" بنجاح.`)},N=async(a,h)=>{const y={tags:h==="add"?J.arrayUnion(a):J.arrayRemove(a)};await s(y,`تم ${h==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${a}" بنجاح.`)},O=c.filter(a=>j==="kurdish"?a.isKurdish===!0:j==="non-kurdish"?!a.isKurdish:!0),re=Math.ceil(O.length/Q),X=O.slice((i-1)*Q,i*Q),ne=a=>`px-4 py-2 text-sm font-bold rounded-lg transition-colors duration-200 ${j===a?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-md":"bg-white/5 text-gray-200 hover:bg-white/10"}`,ie=X.length>0&&S.length===X.length;return D?e.jsx(pe,{}):e.jsxs("div",{className:"relative",children:[C&&e.jsx(ye,{...C,onClose:()=>B(null)}),e.jsx(W,{isOpen:M,onClose:()=>U(!1),onConfirm:p,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',$==null?void 0:$.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:w}),I==="delete"&&e.jsx(W,{isOpen:!0,onClose:()=>f(null),onConfirm:o,title:`تأكيد حذف ${S.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:w}),I==="genre"&&e.jsx(be,{genres:v,onClose:G,onSubmit:x,isLoading:w}),I==="tags"&&e.jsx(je,{onClose:G,onSubmit:N,isLoading:w}),I==="year"&&e.jsx(fe,{onClose:G,onSubmit:a=>s({year:a},"تم تحديث السنة بنجاح."),isLoading:w}),I==="markKurdish"&&e.jsx(W,{isOpen:!0,onClose:G,onConfirm:()=>s({isKurdish:!0},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد تحديد كل هذه الأفلام على أنها كردية؟",isLoading:w}),I==="unmarkKurdish"&&e.jsx(W,{isOpen:!0,onClose:G,onConfirm:()=>s({isKurdish:!1},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد إزالة العلامة الكردية من كل هذه الأفلام؟",isLoading:w}),d&&e.jsx(te,{title:l?"تعديل الفيلم":"إضافة فيلم جديد",onClose:G,children:e.jsx(me,{onSubmit:l?a=>g(l.id,a):K,initialData:l,onCancel:G,isKurdishByDefault:j==="kurdish"&&!l,isLoading:w,allGenres:v})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-6 gap-4",children:[e.jsx("button",{onClick:V,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-black/20 rounded-lg",children:[e.jsx("button",{onClick:()=>b("all"),className:ne("all"),children:"الكل"}),e.jsx("button",{onClick:()=>b("kurdish"),className:ne("kurdish"),children:"كردي فقط"}),e.jsx("button",{onClick:()=>b("non-kurdish"),className:ne("non-kurdish"),children:"غير كردي"})]})]}),S.length>0&&e.jsxs("div",{className:"sticky top-[70px] z-20 bg-gray-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[S.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>T([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>f("genre"),className:"bg-gray-700 text-sm py-1 px-3 rounded-md hover:bg-gray-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>f("tags"),className:"bg-gray-700 text-sm py-1 px-3 rounded-md hover:bg-gray-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>f("year"),className:"bg-gray-700 text-sm py-1 px-3 rounded-md hover:bg-gray-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>f("markKurdish"),className:"bg-gray-700 text-sm py-1 px-3 rounded-md hover:bg-gray-600",children:"تحديد ككردي"}),e.jsx("button",{onClick:()=>f("unmarkKurdish"),className:"bg-gray-700 text-sm py-1 px-3 rounded-md hover:bg-gray-600",children:"إلغاء تحديد ككردي"}),e.jsx("button",{onClick:()=>f("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"bg-gray-800/50 rounded-lg shadow-lg overflow-hidden border border-gray-700",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-black/20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:Y,checked:ie,className:"h-4 w-4 text-cyan-500 bg-gray-900 border-gray-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"الكلمات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"مدبلج كردي"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:X.map(a=>{var h,y,R,L,ce;return e.jsxs("tr",{className:`${S.includes(a.id)?"bg-cyan-500/10":"hover:bg-gray-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:S.includes(a.id),onChange:()=>se(a.id),className:"h-4 w-4 text-cyan-500 bg-gray-900 border-gray-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:a.posterUrl,alt:a.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:a.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-300 align-middle",children:a.year}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(h=a.genres)==null?void 0:h.slice(0,3).map(H=>e.jsx("span",{className:"bg-gray-600 text-gray-200 px-2 py-1 text-xs rounded-full",children:H},H)),((y=a.genres)==null?void 0:y.length)>3&&e.jsx("span",{className:"bg-gray-600 text-gray-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(R=a.tags)==null?void 0:R.slice(0,3).map(H=>e.jsx("span",{className:"bg-gray-600 text-cyan-200 px-2 py-1 text-xs rounded-full",children:H},H)),((L=a.tags)==null?void 0:L.length)>3&&e.jsx("span",{className:"bg-gray-600 text-cyan-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-300 align-middle",children:a.isKurdish?"نعم":"لا"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-gray-300 align-middle",children:(ce=a.createdAt)!=null&&ce.toDate?a.createdAt.toDate().toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>P(a),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>z(a),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},a.id)})})]})}),O.length>Q&&e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx(le,{currentPage:i,totalPages:re,onPageChange:m})})]})]})},ve=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsx("div",{className:"p-4 bg-gray-900",children:e.jsx("div",{className:"h-6 bg-gray-600 rounded w-1/3"})}),e.jsx("div",{className:"divide-y divide-gray-700",children:[...Array(5)].map((c,t)=>e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-600 rounded w-20"})]},t))})]}),Ne="yO8pzykKincc5zgbdJGdN6xISr03",Z=10,ke=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Ce=({message:c,type:t,onClose:l})=>(r.useEffect(()=>{const u=setTimeout(l,5e3);return()=>clearTimeout(u)},[l]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${t==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:c}),e.jsx("button",{onClick:l,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Se=({children:c,onClose:t,title:l})=>(r.useEffect(()=>{const n=d=>{d.key==="Escape"&&t()};return window.addEventListener("keydown",n),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",n),document.body.style.overflow="auto"}},[t]),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 animate-fade-in",onClick:t,children:e.jsxs("div",{className:"bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:l}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),c]})})),Ee=()=>{const{currentUser:c}=ue(),[t,l]=r.useState([]),[n,d]=r.useState(""),[u,i]=r.useState(""),[m,j]=r.useState(""),[b,M]=r.useState(!0),[U,$]=r.useState(!1),[q,D]=r.useState(1),[F,w]=r.useState(!1),[k,C]=r.useState(!1),[B,S]=r.useState(null),[T,I]=r.useState(null),f=(c==null?void 0:c.uid)===Ne;r.useEffect(()=>{if(!f){M(!1);return}M(!0);const p=E.collection("admins").onSnapshot(P=>{const V=P.docs.map(G=>({id:G.id,uid:G.data().uid,email:G.data().email}));l(V),M(!1)},P=>{console.error(P),v("فشل في تحميل قائمة المشرفين.","error"),M(!1)});return()=>p()},[f]);const v=(p,P)=>{I({message:p,type:P})},_=async p=>{if(p.preventDefault(),j(""),!n.trim()||!u.trim()){j("الرجاء إدخال UID وبريد إلكتروني صالحين.");return}$(!0);try{await E.collection("admins").doc(n).set({uid:n,email:u}),v(`تمت إضافة المشرف ${u} بنجاح.`,"success"),w(!1),d(""),i("")}catch(P){console.error("Error adding admin:",P),v("فشل في إضافة المشرف.","error")}finally{$(!1)}},A=p=>{S(p),C(!0)},K=async()=>{if(B){$(!0);try{await E.collection("admins").doc(B.id).delete(),v(`تم حذف المشرف ${B.email} بنجاح.`,"success")}catch(p){console.error(p),v("حدث خطأ أثناء حذف المشرف.","error")}finally{C(!1),S(null),$(!1)}}};if(!f)return e.jsxs("div",{className:"bg-gray-800 p-8 rounded-lg text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"إدارة المشرفين"}),e.jsx("p",{className:"text-yellow-300",children:"هذه الصفحة متاحة فقط للمشرف الأساسي."})]});const g=Math.ceil(t.length/Z),z=t.slice((q-1)*Z,q*Z);return e.jsxs(e.Fragment,{children:[T&&e.jsx(Ce,{...T,onClose:()=>I(null)}),e.jsx(W,{isOpen:k,onClose:()=>C(!1),onConfirm:K,title:"تأكيد حذف المشرف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المشرف ",e.jsxs("strong",{className:"text-white",children:['"',B==null?void 0:B.email,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"سيؤدي هذا إلى إزالة صلاحيات المشرف الخاصة به."})]}),isLoading:U}),F&&e.jsx(Se,{title:"إضافة مشرف جديد",onClose:()=>w(!1),children:e.jsxs("form",{onSubmit:_,className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"لإضافة مشرف جديد، يجب عليك الحصول على **معرّف المستخدم (UID)** الخاص به من لوحة تحكم Firebase Authentication."}),e.jsx("input",{type:"text",value:n,onChange:p=>d(p.target.value),placeholder:"معرّف المستخدم (UID)",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsx("input",{type:"email",value:u,onChange:p=>i(p.target.value),placeholder:"البريد الإلكتروني للمشرف",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),m&&e.jsx("p",{className:"text-red-500 text-center text-sm",children:m}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:()=>w(!1),className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:U,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:U,children:[U&&e.jsx(ke,{}),U?"جاري الإضافة...":"إضافة مشرف"]})]})]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"المشرفون الحاليون"}),e.jsx("button",{onClick:()=>w(!0),className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة مشرف جديد"})]}),b?e.jsx(ve,{}):e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-gray-900 flex items-center justify-between",children:[e.jsxs("span",{className:"text-white font-bold",children:[c.email," (المشرف الأساسي)"]}),e.jsx("span",{className:"text-sm text-gray-500",children:"لا يمكن حذفه"})]}),e.jsx("div",{className:"divide-y divide-gray-700",children:z.map(p=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-gray-700/50",children:[e.jsx("span",{className:"text-white",children:p.email}),e.jsx("button",{onClick:()=>A(p),className:"bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700 transition-colors",children:"حذف"})]},p.id))}),t.length>Z&&e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx(le,{currentPage:q,totalPages:g,onPageChange:D})})]})]})]})},Ae=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Me=({onSubmit:c,initialData:t,onCancel:l,isLoading:n=!1})=>{const[d,u]=r.useState("");r.useEffect(()=>{u(t?t.name:"")},[t]);const i=m=>{m.preventDefault(),d.trim()&&c({name:d})};return e.jsxs("form",{onSubmit:i,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:d,onChange:m=>u(m.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:l,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:n,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:n,children:[n&&e.jsx(Ae,{}),n?t?"جاري التحديث...":"جاري الإضافة...":t?"تحديث":"إضافة"]})]})]})},Te=10,Ie=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(Te)].map((c,t)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},t))})]})})}),ee=10,Pe=({message:c,type:t,onClose:l})=>(r.useEffect(()=>{const u=setTimeout(l,5e3);return()=>clearTimeout(u)},[l]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${t==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:c}),e.jsx("button",{onClick:l,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Ue=({children:c,onClose:t,title:l})=>(r.useEffect(()=>{const n=d=>{d.key==="Escape"&&t()};return window.addEventListener("keydown",n),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",n),document.body.style.overflow="auto"}},[t]),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 animate-fade-in",onClick:t,children:e.jsxs("div",{className:"bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:l}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),c]})})),$e=()=>{const[c,t]=r.useState([]),[l,n]=r.useState(null),[d,u]=r.useState(!1),[i,m]=r.useState(1),[j,b]=r.useState(!1),[M,U]=r.useState(null),[$,q]=r.useState(!0),[D,F]=r.useState(!1),[w,k]=r.useState(null);r.useEffect(()=>{q(!0);const g=E.collection("categories").orderBy("name").onSnapshot(z=>{const p=z.docs.map(P=>({id:P.id,...P.data()}));t(p),q(!1)},z=>{console.error("Error fetching categories: ",z),C("فشل في تحميل الفئات.","error"),q(!1)});return()=>g()},[]);const C=(g,z)=>{k({message:g,type:z})},B=async g=>{F(!0);try{await E.collection("categories").add(g),C("تمت إضافة الفئة بنجاح!","success"),u(!1),m(1)}catch(z){console.error("Error adding category: ",z),C("حدث خطأ أثناء إضافة الفئة.","error")}finally{F(!1)}},S=async(g,z)=>{F(!0);try{await E.collection("categories").doc(g).update(z),C("تم تحديث الفئة بنجاح!","success"),n(null),u(!1)}catch(p){console.error("Error updating category: ",p),C("حدث خطأ أثناء تحديث الفئة.","error")}finally{F(!1)}},T=g=>{U(g),b(!0)},I=async()=>{if(M){F(!0);try{await E.collection("categories").doc(M.id).delete(),C("تم حذف الفئة بنجاح!","success")}catch(g){console.error("Error deleting category: ",g),C("حدث خطأ أثناء حذف الفئة.","error")}finally{b(!1),U(null),F(!1)}}},f=g=>{n(g),u(!0)},v=()=>{n(null),u(!0)},_=()=>{n(null),u(!1)},A=Math.ceil(c.length/ee),K=c.slice((i-1)*ee,i*ee);return $?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(Ie,{})]}):e.jsxs("div",{children:[w&&e.jsx(Pe,{...w,onClose:()=>k(null)}),e.jsx(W,{isOpen:j,onClose:()=>b(!1),onConfirm:I,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',M==null?void 0:M.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:D}),d&&e.jsx(Ue,{title:l?"تعديل الفئة":"إضافة فئة جديدة",onClose:_,children:e.jsx(Me,{onSubmit:l?g=>S(l.id,g):B,initialData:l,onCancel:_,isLoading:D})}),e.jsx("button",{onClick:v,className:"mb-6 bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:c.length>0?K.map(g=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:g.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>f(g),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>T(g),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},g.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})}),c.length>ee&&e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx(le,{currentPage:i,totalPages:A,onPageChange:m})})]})]})},ae=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(we,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx($e,{})},{key:"admins",label:"إدارة المشرفين",component:e.jsx(Ee,{})}],Fe=({label:c,tabKey:t,activeTab:l,onClick:n})=>e.jsx("button",{onClick:()=>n(t),className:`px-6 py-3 font-bold rounded-t-lg transition-colors duration-300 ${l===t?"bg-gray-800 text-cyan-400":"bg-gray-700 text-white hover:bg-gray-600"}`,role:"tab","aria-selected":l===t,children:c}),Ge=()=>{var n;const[c,t]=r.useState(ae[0].key),l=(n=ae.find(d=>d.key===c))==null?void 0:n.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-gray-700 mb-6",role:"tablist",children:ae.map(d=>e.jsx(Fe,{label:d.label,tabKey:d.key,activeTab:c,onClick:t},d.key))}),e.jsx("div",{role:"tabpanel",children:l})]})};export{Ge as default};
