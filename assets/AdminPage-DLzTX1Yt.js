import{r as n,j as e,s as E,R as ft}from"./index-7uJ0qKqD.js";import{P as nt}from"./Pagination-BK7uePpH.js";import{F as $e,S as Ee}from"./SpinnerIcon-DP9Pwg2V.js";const ut=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),bt=({onSubmit:c,initialData:r,onCancel:g,isKurdishByDefault:p=!1,isLoading:y=!1,allGenres:d=[]})=>{var ne,oe,ae;const[l,m]=n.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"1080p"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:!1,imdb_rating:void 0,quality:"",duration:"",language:"",country:"",directors:[],writers:[],cast:[]}),[C,M]=n.useState(""),[L,J]=n.useState(""),[te,b]=n.useState(!1),[$,S]=n.useState(""),[T,D]=n.useState(!1),[V,R]=n.useState(""),[P,G]=n.useState(""),[se,w]=n.useState(!1),O=n.useRef(null);n.useEffect(()=>{r?(m({title:r.title||"",description:r.description||"",poster_url:r.poster_url||"",backdrop_url:r.backdrop_url||"",year:r.year||new Date().getFullYear(),genres:r.genres||[],tags:r.tags||[],servers:r.servers&&r.servers.length>0?r.servers:[{name:"Server 1",url:"",quality:"1080p"}],backup_servers:r.backup_servers||[],download_url:r.download_url||"",trailer_url:r.trailer_url||"",is_kurdish:r.is_kurdish||!1,imdb_rating:r.imdb_rating,quality:r.quality||"",duration:r.duration||"",language:r.language||"",country:r.country||"",directors:r.directors||[],writers:r.writers||[],cast:r.cast||[]}),M((r.tags||[]).join(", "))):(m({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"1080p"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:p,imdb_rating:void 0,quality:"",duration:"",language:"",country:"",directors:[],writers:[],cast:[]}),M(""))},[r,p]),n.useEffect(()=>{const a=i=>{O.current&&!O.current.contains(i.target)&&D(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]),n.useEffect(()=>{const a=l.download_url;if(a&&a.includes("vidtube.pro/d/")){const i=a.replace("/d/","/embed-");l.servers.length>0&&l.servers[0].url!==i&&m(t=>{const h=[...t.servers];return h[0]={...h[0],url:i},{...t,servers:h}})}},[l.download_url,l.servers]),n.useEffect(()=>{if(!r){const a=l.title.match(/\b(19[89]\d|20\d{2})\b/);if(a&&a[0]){const i=parseInt(a[0],10),t=l.title.replace(a[0],"").replace(/\s\s+/g," ").trim();m(h=>h.year!==i||h.title!==t?{...h,year:i,title:t}:h)}}},[l.title,r]),n.useEffect(()=>{!r&&!l.backdrop_url.trim()&&m(a=>({...a,backdrop_url:a.poster_url}))},[l.poster_url,r,l.backdrop_url]);const x=async a=>{var i;try{if(!((i=navigator.clipboard)!=null&&i.readText))throw new Error("Clipboard API not available.");const t=await navigator.clipboard.readText();t&&a(t)}catch(t){console.error("Failed to read clipboard contents: ",t),alert("فشل لصق النص. يرجى التأكد من منح الإذن لاستخدام الحافظة.")}},o=a=>{const{name:i,value:t,type:h}=a.target;if(h==="checkbox"){const{checked:f}=a.target;m(U=>({...U,[i]:f}))}else if(i==="year"){const f=parseInt(t,10);m(U=>({...U,[i]:isNaN(f)?0:f}))}else if(i==="imdb_rating"){const f=parseFloat(t);m(U=>({...U,imdb_rating:isNaN(f)?void 0:f}))}else m(f=>({...f,[i]:t}))},u=a=>{M(a.target.value)},j=a=>{m(i=>{const t=i.genres||[],h=t.includes(a)?t.filter(f=>f!==a):[...t,a];return{...i,genres:h}})},v=async()=>{const a=P.trim();if(a){if(d.some(i=>i.toLowerCase()===a.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}w(!0);try{const{error:i}=await E.from("categories").insert({name:a});if(i)throw i;m(t=>({...t,genres:[...t.genres||[],a]})),G("")}catch(i){console.error("Error adding new genre:",i),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{w(!1)}}},q=(a,i,t)=>{const h=[...l.servers];h[a]={...h[a],[i]:t},m(f=>({...f,servers:h}))},I=()=>{m(a=>{const i={name:`Server ${a.servers.length+1}`,url:"",quality:"1080p"};return{...a,servers:[...a.servers,i]}})},Z=a=>{m(i=>({...i,servers:i.servers.filter((t,h)=>h!==a)}))},z=(a,i,t)=>{const h=[...l.backup_servers||[]];h[a]={...h[a],[i]:t},m(f=>({...f,backup_servers:h}))},fe=()=>{m(a=>{var i;return{...a,backup_servers:[...a.backup_servers||[],{name:`Server ${(((i=a.backup_servers)==null?void 0:i.length)||0)+1}`,url:"",quality:"1080p",no_sub_url:""}]}})},N=a=>{m(i=>({...i,backup_servers:(i.backup_servers||[]).filter((t,h)=>h!==a)}))},B=async()=>{var a,i,t,h,f,U,s,k,_,W,H,ce,he,ge,Ne,Ce,ot,ct,it;if(!L){S("Please enter a URL.");return}b(!0),S("");try{S("Fetching movie page...");const Te=`https://corsproxy.io/?${encodeURIComponent(L)}`,De=await fetch(Te);if(!De.ok)throw new Error(`Failed to fetch URL: ${De.statusText}`);const pt=await De.text(),dt=new DOMParser,le=dt.parseFromString(pt,"text/html");if(L.includes("a.asd.homes")){S("جلب البيانات من عرب سيد...");const ie=Y=>{var ee,_e;const Q=Array.from(le.querySelectorAll(".info__area__ul > li")).find(xe=>{var pe,Ze;return(Ze=(pe=xe.querySelector(".title__kit span"))==null?void 0:pe.textContent)==null?void 0:Ze.trim().startsWith(Y)});if(!Q)return[];const ue=Array.from(Q.querySelectorAll("ul.tags__list a"));if(ue.length>0)return ue.map(xe=>{var pe;return((pe=xe.textContent)==null?void 0:pe.trim())||""}).filter(Boolean);const me=Array.from(Q.childNodes).find(xe=>{var pe;return xe.nodeType===Node.TEXT_NODE&&((pe=xe.textContent)==null?void 0:pe.trim())});if(me)return[((ee=me.textContent)==null?void 0:ee.trim())||""];const F=Q.querySelector("a");return F?[((_e=F.textContent)==null?void 0:_e.trim())||""]:[]},Se=((i=(a=le.querySelector("h1.post__name"))==null?void 0:a.textContent)==null?void 0:i.trim())||"",be=Se.match(/\(\s*(\d{4})\s*\)/),ze=be?parseInt(be[1],10):new Date().getFullYear(),ye=be?Se.replace(be[0],"").trim():Se,We=((h=(t=le.querySelector(".post__story p"))==null?void 0:t.textContent)==null?void 0:h.trim())||"",qe=((f=le.querySelector(".poster__single img"))==null?void 0:f.getAttribute("data-src"))||((U=le.querySelector(".poster__single img"))==null?void 0:U.getAttribute("src"))||"",Ye=((k=(s=le.querySelector(".rating__box .rate__txt"))==null?void 0:s.textContent)==null?void 0:k.trim().split("/")[0].trim())||"0",Je=parseFloat(Ye)||void 0,Ve=ie("نوع العرض"),He=ie("جودة العرض").join(", "),Qe=ie("مدة العرض").join(", "),Ke=ie("لغة العرض").join(", "),Xe=ie("بلد العرض").join(", "),Oe=[],Pe=[],Le=[];le.querySelectorAll(".persons__list li a").forEach(Y=>{var ue,me,F,ee;const de=(me=(ue=Y.querySelector(".name"))==null?void 0:ue.textContent)==null?void 0:me.trim(),Q=(ee=(F=Y.querySelector(".role"))==null?void 0:F.textContent)==null?void 0:ee.trim();de&&Q&&(Q.includes("مخرج")?Oe.push(de):Q.includes("كاتب")?Pe.push(de):Le.push(de))});const Re=((_=le.querySelector(".show__trailer"))==null?void 0:_.getAttribute("data-iframe"))||"",Ae=async Y=>{var de;if(!Y)return"";try{S("Fetching watch page...");const Q=await fetch(`https://corsproxy.io/?${encodeURIComponent(Y)}`);if(!Q.ok)throw new Error(`Failed to fetch watch page: ${Q.statusText}`);const ue=await Q.text(),F=(de=new DOMParser().parseFromString(ue,"text/html").querySelector(".player__iframe iframe"))==null?void 0:de.getAttribute("src");return F?F.startsWith("/")?`https://a.asd.homes${F}`:new URL(F,Y).href:""}catch(Q){return console.error("Error scraping watch page:",Q),S("Warning: Could not automatically find watch server."),""}},Be=(Y,de,Q)=>new Promise(async(ue,me)=>{if(!Y)return ue("");let F=null,ee=null;const _e=setTimeout(()=>{ee==null||ee.disconnect(),F==null||F.remove(),me(new Error(`Scraping timed out for ${Y}`))},15e3);try{const xe=await fetch(`https://corsproxy.io/?${encodeURIComponent(Y)}`);if(!xe.ok)return me(new Error(`Failed to fetch intermediate page: ${Y}`));const pe=await xe.text(),et=new DOMParser().parseFromString(pe,"text/html").querySelector(de);if(et&&et.getAttribute(Q))return clearTimeout(_e),ue(et.getAttribute(Q)||"");F=document.createElement("div"),F.style.display="none",document.body.appendChild(F),ee=new MutationObserver(()=>{const tt=F==null?void 0:F.querySelector(de);if(tt&&tt.getAttribute(Q)){const gt=tt.getAttribute(Q)||"";ee==null||ee.disconnect(),clearTimeout(_e),F==null||F.remove(),ue(gt)}}),ee.observe(F,{childList:!0,subtree:!0}),F.innerHTML=pe}catch(xe){clearTimeout(_e),ee==null||ee.disconnect(),F==null||F.remove(),me(xe)}});S("Fetching watch & download pages (this may take a moment)...");const we=(W=le.querySelector("a.watch__btn"))==null?void 0:W.getAttribute("href"),Me=(H=le.querySelector("a.download__btn"))==null?void 0:H.getAttribute("href"),[ve,Fe]=await Promise.all([Ae(we),Be(Me,'a.downloadsLink, a[href*="vidtube.pro/d/"], .downloads__links__list a',"href").catch(Y=>(console.warn("Could not scrape download URL:",Y),S("Warning: Could not automatically find download link."),""))]);let ke=[];ve&&(S("Parsing watch servers..."),ke.push({name:"Server 1",url:ve,quality:"HD"})),m(Y=>({...Y,title:ye,year:ze||Y.year,description:We,poster_url:qe,backdrop_url:qe,imdb_rating:Je,genres:[...new Set([...Y.genres,...Ve])],quality:He,duration:Qe,language:Ke,country:Xe,directors:Oe,writers:Pe,cast:Le,trailer_url:Re,servers:ke.length>0?ke:Y.servers,download_url:Fe||Y.download_url})),S("تم جلب البيانات بنجاح!")}else if(L.includes("topcinema.cam")){const ie=we=>{var de,Q,ue;const ve=Array.from(le.querySelectorAll(".RightTaxContent > li")).find(me=>{var F,ee;return(ee=(F=me.querySelector("span"))==null?void 0:F.textContent)==null?void 0:ee.trim().startsWith(we)});if(!ve)return[];const Fe=Array.from(ve.querySelectorAll("a, strong"));if(Fe.length>0)return Fe.map(me=>{var F;return((F=me.textContent)==null?void 0:F.trim())||""}).filter(Boolean);const ke=ve.cloneNode(!0);(de=ke.querySelector("i"))==null||de.remove(),(Q=ke.querySelector("span"))==null||Q.remove();const Y=(ue=ke.textContent)==null?void 0:ue.trim().replace(/^:/,"").trim();return Y?Y.split(/\s*,\s*/):[]},Se=((he=(ce=le.querySelector("h1.post-title"))==null?void 0:ce.textContent)==null?void 0:he.trim())||"",be=Se.match(/\b(19\d{2}|20\d{2})\b/),ze=be?parseInt(be[0],10):new Date().getFullYear();let ye=Se;ye=ye.replace(/فيلم|مترجم|اون لاين|اونلاين|WEB-DL|BluRay|HD/gi,"").replace(/[\u0600-\u06FF]+/g,""),be&&(ye=ye.replace(be[0],"")),ye=ye.trim().replace(/^[^a-zA-Z0-9\s]+|[^a-zA-Z0-9\s]+$/g,"").trim();const We=((Ne=(ge=le.querySelector(".story p"))==null?void 0:ge.textContent)==null?void 0:Ne.trim())||"",qe=((Ce=le.querySelector(".MainSingle .left .image img"))==null?void 0:Ce.getAttribute("src"))||"",Ye=((ct=(ot=le.querySelector(".imdbR span"))==null?void 0:ot.textContent)==null?void 0:ct.trim())||"0",Je=parseFloat(Ye)||void 0,Ve=ie("نوع الفيلم"),He=ie("جودة الفيلم").join(", "),Qe=ie("توقيت الفيلم").join(", "),Ke=ie("لغة الفيلم").join(", "),Xe=ie("دولة الفيلم").join(", "),Oe=ie("المخرجين"),Pe=ie("المؤلفين"),Le=ie("بطولة");let Re="";const Ae=le.querySelector("a.download"),Be=Ae==null?void 0:Ae.getAttribute("href");if(Be){S("Fetching download link...");const we=`https://corsproxy.io/?${encodeURIComponent(Be)}`,Me=await fetch(we);if(Me.ok){const ve=await Me.text();Re=((it=dt.parseFromString(ve,"text/html").querySelector('a.downloadsLink, a[href*="vidtube.pro/d/"]'))==null?void 0:it.getAttribute("href"))||""}}m(we=>({...we,title:ye,year:ze||we.year,description:We,poster_url:qe,backdrop_url:qe,imdb_rating:Je,genres:[...new Set([...we.genres,...Ve])],quality:He,duration:Qe,language:Ke,country:Xe,directors:Oe,writers:Pe,cast:Le,download_url:Re})),S("تم جلب البيانات بنجاح!")}else{S("هذا الموقع غير مدعوم حاليًا للجلب."),b(!1);return}}catch(Te){console.error("Scraping failed:",Te),S(`فشل جلب البيانات: ${Te.message}.`)}finally{b(!1)}},K=a=>{if(a.preventDefault(),l.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const i=C.split(",").map(t=>t.trim()).filter(Boolean);c({...l,tags:i})},re=d.filter(a=>a.toLowerCase().includes(V.toLowerCase())),X="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",A="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:K,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3 p-4 bg-slate-900/50 rounded-lg border border-slate-700",children:[e.jsx("label",{htmlFor:"scrape_url",className:"block text-lg font-semibold text-white",children:"جلب البيانات من رابط"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"scrape_url",type:"url",value:L,onChange:a=>J(a.target.value),placeholder:"https://web6.topcinema.cam/... or https://a.asd.homes/...",className:`${X} flex-grow`}),e.jsxs("button",{type:"button",onClick:B,disabled:te,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700 flex-shrink-0 flex items-center disabled:bg-slate-500",children:[te&&e.jsx(ut,{}),te?"جاري الجلب...":"جلب البيانات"]})]}),$&&e.jsx("p",{className:`text-sm mt-1 ${$.startsWith("فشل")||$.startsWith("هذا")?"text-red-400":"text-green-400"}`,children:$})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx("input",{type:"text",name:"title",value:l.title,onChange:o,placeholder:"عنوان الفيلم (بالانجليزية)",required:!0,className:X})}),e.jsx("input",{type:"number",name:"year",value:l.year||"",onChange:o,placeholder:"سنة الإنتاج",required:!0,className:X})]}),e.jsx("textarea",{name:"description",value:l.description,onChange:o,placeholder:"وصف الفيلم",required:!0,className:`${X} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",name:"poster_url",value:l.poster_url,onChange:o,placeholder:"رابط صورة البوستر",required:!0,className:`${X} flex-grow`}),e.jsx("button",{type:"button",onClick:()=>x(a=>m(i=>({...i,poster_url:a,backdrop_url:a}))),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-2 px-4 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsx("input",{type:"url",name:"backdrop_url",value:l.backdrop_url,onChange:o,placeholder:"رابط صورة الخلفية",required:!0,className:X})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:l.imdb_rating??"",onChange:o,placeholder:"تقيم الفيلم",step:"0.1",min:"0",max:"10",className:X}),e.jsx("input",{type:"url",name:"trailer_url",value:l.trailer_url??"",onChange:o,placeholder:"رابط المقطع الدعائي (اختياري)",className:X})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:C,onChange:u,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:X})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"is_kurdish",type:"checkbox",name:"is_kurdish",checked:!!l.is_kurdish,onChange:o,className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("label",{htmlFor:"is_kurdish",className:"text-white cursor-pointer",children:"هذا الفيلم مدبلج للكردية"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:O,children:[e.jsxs("button",{type:"button",onClick:()=>D(a=>!a),className:`${X} text-right flex justify-between items-center`,children:[e.jsx("span",{children:l.genres.length>0?l.genres.join(", "):"اختر الفئات..."}),e.jsx("svg",{className:`h-5 w-5 transition-transform duration-200 ${T?"rotate-180":""}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),T&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[e.jsx("div",{className:"p-2 border-b border-slate-700",children:e.jsx("input",{type:"text",placeholder:"ابحث أو أضف فئة...",value:V,onChange:a=>R(a.target.value),className:"w-full bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"})}),e.jsx("ul",{className:"p-1",children:re.map(a=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.genres.includes(a),onChange:()=>j(a),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:a})]},a))}),e.jsx("div",{className:"p-2 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"إضافة فئة جديدة...",value:P,onChange:a=>G(a.target.value),className:"flex-grow bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:v,disabled:se||!P.trim(),className:"bg-cyan-600 text-white px-3 py-1 rounded-md text-sm hover:bg-cyan-700 disabled:bg-slate-500",children:se?"...":"إضافة"})]})})]})]})]}),e.jsxs("details",{className:"bg-slate-900/30 p-4 rounded-lg border border-slate-700",open:!0,children:[e.jsx("summary",{className:"text-lg font-semibold text-white cursor-pointer",children:"تفاصيل إضافية للفيلم"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",name:"quality",value:l.quality,onChange:o,placeholder:"الجودة (e.g. 1080p WEB-DL)",className:A}),e.jsx("input",{type:"text",name:"duration",value:l.duration,onChange:o,placeholder:"مدة العرض",className:A}),e.jsx("input",{type:"text",name:"language",value:l.language,onChange:o,placeholder:"اللغة",className:A}),e.jsx("input",{type:"text",name:"country",value:l.country,onChange:o,placeholder:"الدولة",className:A})]}),e.jsx("textarea",{value:(ne=l.directors)==null?void 0:ne.join(", "),onChange:a=>m(i=>({...i,directors:a.target.value.split(",").map(t=>t.trim())})),placeholder:"المخرجين (مفصولة بفاصلة)",className:`${A} w-full`,rows:2}),e.jsx("textarea",{value:(oe=l.writers)==null?void 0:oe.join(", "),onChange:a=>m(i=>({...i,writers:a.target.value.split(",").map(t=>t.trim())})),placeholder:"المؤلفين (مفصولة بفاصلة)",className:`${A} w-full`,rows:2}),e.jsx("textarea",{value:(ae=l.cast)==null?void 0:ae.join(", "),onChange:a=>m(i=>({...i,cast:a.target.value.split(",").map(t=>t.trim())})),placeholder:"البطولة (مفصولة بفاصلة)",className:`${A} w-full`,rows:3})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات المشاهدة"}),l.servers.map((a,i)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:a.name,onChange:t=>q(i,"name",t.target.value),placeholder:"اسم السيرفر",className:`${A} flex-1`}),e.jsxs("select",{value:a.quality,onChange:t=>q(i,"quality",t.target.value),className:`${A} w-28`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),l.servers.length>1&&e.jsx("button",{type:"button",onClick:()=>Z(i),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),i===0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{type:"url",value:a.url,onChange:t=>q(i,"url",t.target.value),placeholder:"رابط السيرفر 1",required:!0,className:`${A} w-full`}),e.jsx("input",{type:"url",name:"download_url",value:l.download_url||"",onChange:o,placeholder:"رابط تحميل الفيلم (اختياري)",className:`${A} w-full`})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:a.url,onChange:t=>q(i,"url",t.target.value),placeholder:`رابط السيرفر ${i+1}`,required:!0,className:`${A} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>x(t=>q(i,"url",t)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]})]},i)),e.jsx("button",{type:"button",onClick:I,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات احتياطية (مشغل خارجي)"}),(l.backup_servers||[]).map((a,i)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:a.name,onChange:t=>z(i,"name",t.target.value),placeholder:"اسم السيرفر",className:`${A} flex-1`}),e.jsxs("select",{value:a.quality,onChange:t=>z(i,"quality",t.target.value),className:`${A} w-28`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>N(i),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{type:"url",value:a.url,onChange:t=>z(i,"url",t.target.value),placeholder:"رابط السيرفر (مع ترجمة)",className:`${A} w-full`}),e.jsx("input",{type:"url",value:a.no_sub_url||"",onChange:t=>z(i,"no_sub_url",t.target.value),placeholder:"رابط السيرفر (بدون ترجمة)",className:`${A} w-full`})]})]},i)),e.jsx("button",{type:"button",onClick:fe,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:g,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",disabled:y,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:y,children:[y&&e.jsx(ut,{}),y?r?"جاري التحديث...":"جاري الإضافة...":r?"تحديث الفيلم":"إضافة الفيلم"]})]})]})},yt=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),je=({isOpen:c,onClose:r,onConfirm:g,title:p,message:y,isLoading:d=!1})=>{const[l,m]=n.useState(c);return n.useEffect(()=>{if(c)m(!0);else{const C=setTimeout(()=>m(!1),300);return()=>clearTimeout(C)}},[c]),l?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${c?"animate-fade-in":"animate-fade-out"}`,onClick:r,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:`relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md border border-slate-700 ${c?"animate-zoom-in":"animate-zoom-out"}`,onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:p}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:y})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:g,disabled:d,children:[d&&e.jsx(yt,{}),d?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:r,disabled:d,children:"إلغاء"})]})]})}):null},wt=10,mt=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((c,r)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},r))})}),e.jsx("tbody",{children:[...Array(wt)].map((c,r)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((g,p)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},p))]},r))})]})})]}),lt=({message:c,type:r,onClose:g})=>(n.useEffect(()=>{const d=setTimeout(g,5e3);return()=>clearTimeout(d)},[g]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${r==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:c}),e.jsx("button",{onClick:g,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),ht=({genres:c,onSubmit:r,onClose:g,isLoading:p})=>{const[y,d]=n.useState(c[0]||""),[l,m]=n.useState("add"),C=M=>{M.preventDefault(),y&&r(y,l)};return e.jsx($e,{title:"تغيير الفئة بشكل جماعي",onClose:g,isOpen:!0,children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:y,onChange:M=>d(M.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:c.map(M=>e.jsx("option",{value:M,children:M},M))}),e.jsxs("select",{value:l,onChange:M=>m(M.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:g,disabled:p,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:p||!y,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[p&&e.jsx(Ee,{}),p?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},jt=({onSubmit:c,onClose:r,isLoading:g})=>{const[p,y]=n.useState(new Date().getFullYear()),d=l=>{l.preventDefault(),c(p)};return e.jsx($e,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:r,isOpen:!0,children:e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:p,onChange:l=>y(parseInt(l.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:r,disabled:g,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:g,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[g&&e.jsx(Ee,{}),g?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},xt=({onSubmit:c,onClose:r,isLoading:g})=>{const[p,y]=n.useState(""),[d,l]=n.useState("add"),m=C=>{C.preventDefault(),p.trim()&&c(p.trim(),d)};return e.jsx($e,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:r,isOpen:!0,children:e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:p,onChange:C=>y(C.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:d,onChange:C=>l(C.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:r,disabled:g,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:g||!p.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[g&&e.jsx(Ee,{}),g?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Ue=10,Nt=()=>{const[c,r]=n.useState([]),[g,p]=n.useState(0),[y,d]=n.useState(null),[l,m]=n.useState(!1),[C,M]=n.useState(1),[L,J]=n.useState("all"),[te,b]=n.useState(""),[$,S]=n.useState(""),[T,D]=n.useState(!1),[V,R]=n.useState(null),[P,G]=n.useState(!0),[se,w]=n.useState(!1),[O,x]=n.useState(null),[o,u]=n.useState([]),[j,v]=n.useState(null),[q,I]=n.useState([]),Z=n.useCallback(async()=>{G(!0);const{data:s,error:k}=await E.from("categories").select("name").order("name");k?console.error("Error fetching categories from ManageMovies: ",k):I(s.map(Ne=>Ne.name));const _=(C-1)*Ue,W=_+Ue-1;let H=E.from("movies").select("*",{count:"exact"});L==="kurdish"&&(H=H.eq("is_kurdish",!0)),L==="non-kurdish"&&(H=H.eq("is_kurdish",!1)),$&&(H=H.ilike("title",`%${$}%`)),H=H.order("created_at",{ascending:!1}).range(_,W);const{data:ce,error:he,count:ge}=await H;he?(console.error("Error fetching movies: ",he),z("فشل في تحميل الأفلام.","error")):(r(ce),p(ge||0)),G(!1)},[C,L,$]);n.useEffect(()=>{Z()},[Z]),n.useEffect(()=>{const s=setTimeout(()=>{S(te),M(1),u([])},500);return()=>clearTimeout(s)},[te]),n.useEffect(()=>{M(1),u([])},[L]);const z=(s,k)=>{x({message:s,type:k})},fe=async s=>{w(!0);try{const{error:k}=await E.from("movies").insert([{...s,created_at:new Date().toISOString()}]);if(k)throw k;await Z(),m(!1),M(1),z("تمت إضافة الفيلم بنجاح.","success")}catch(k){console.error("Error adding movie: ",k),z(`حدث خطأ أثناء إضافة الفيلم: ${k.message}`,"error")}finally{w(!1)}},N=async(s,k)=>{w(!0);try{const{error:_}=await E.from("movies").update(k).eq("id",s);if(_)throw _;await Z(),d(null),m(!1),z("تم تحديث الفيلم بنجاح.","success")}catch(_){console.error("Error updating movie: ",_),z(`حدث خطأ أثناء تحديث الفيلم: ${_.message}`,"error")}finally{w(!1)}},B=s=>{R(s),D(!0)},K=async()=>{if(V){w(!0);try{const{error:s}=await E.from("movies").delete().eq("id",V.id);if(s)throw s;await Z(),z("تم حذف الفيلم بنجاح.","success")}catch(s){console.error("Error deleting movie: ",s),z(`حدث خطأ أثناء حذف الفيلم: ${s.message}`,"error")}finally{D(!1),R(null),w(!1)}}},re=s=>{d(s),m(!0)},X=()=>{d(null),m(!0)},A=()=>{d(null),m(!1),v(null)},ne=s=>{u(k=>k.includes(s)?k.filter(_=>_!==s):[...k,s])},oe=s=>{s.target.checked?u(c.map(k=>k.id)):u([])},ae=async(s,k)=>{w(!0);try{const{error:_}=await E.from("movies").update(s).in("id",o);if(_)throw _;await Z(),z(k,"success"),u([])}catch(_){console.error("Bulk update failed:",_),z("فشل التحديث الجماعي.","error")}finally{w(!1),v(null)}},a=async()=>{w(!0);try{const{error:s}=await E.from("movies").delete().in("id",o);if(s)throw s;await Z(),z(`تم حذف ${o.length} فيلم بنجاح.`,"success"),u([])}catch(s){console.error("Bulk delete failed:",s),z("فشل الحذف الجماعي.","error")}finally{w(!1),v(null)}},i=async(s,k)=>{w(!0);try{const{data:_,error:W}=await E.from("movies").select("id, genres").in("id",o);if(W)throw W;const H=_.map(he=>{const ge=he.genres||[];let Ne=k==="add"?[...new Set([...ge,s])]:ge.filter(Ce=>Ce!==s);return{id:he.id,genres:Ne}}),{error:ce}=await E.from("movies").upsert(H);if(ce)throw ce;await Z(),z(`تم ${k==="add"?"إضافة":"إزالة"} فئة "${s}" بنجاح.`,"success"),u([])}catch(_){console.error("Bulk genre change failed:",_),z("فشل تغيير الفئة الجماعي.","error")}finally{w(!1),v(null)}},t=async(s,k)=>{w(!0);try{const{data:_,error:W}=await E.from("movies").select("id, tags").in("id",o);if(W)throw W;const H=_.map(he=>{const ge=he.tags||[];let Ne=k==="add"?[...new Set([...ge,s])]:ge.filter(Ce=>Ce!==s);return{id:he.id,tags:Ne}}),{error:ce}=await E.from("movies").upsert(H);if(ce)throw ce;await Z(),z(`تم ${k==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${s}" بنجاح.`,"success"),u([])}catch(_){console.error("Bulk tags change failed:",_),z("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{w(!1),v(null)}},h=Math.ceil(g/Ue),f=s=>`px-4 py-2 text-sm font-bold rounded-lg transition-colors duration-200 ${L===s?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-md":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,U=c.length>0&&c.every(s=>o.includes(s.id));return e.jsxs("div",{className:"relative",children:[O&&e.jsx(lt,{...O,onClose:()=>x(null)}),e.jsx(je,{isOpen:T,onClose:()=>D(!1),onConfirm:K,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',V==null?void 0:V.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:se}),j==="delete"&&e.jsx(je,{isOpen:!0,onClose:()=>v(null),onConfirm:a,title:`تأكيد حذف ${o.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:se}),j==="genre"&&e.jsx(ht,{genres:q,onClose:A,onSubmit:i,isLoading:se}),j==="tags"&&e.jsx(xt,{onClose:A,onSubmit:t,isLoading:se}),j==="year"&&e.jsx(jt,{onClose:A,onSubmit:s=>ae({year:s},"تم تحديث السنة بنجاح."),isLoading:se}),j==="markKurdish"&&e.jsx(je,{isOpen:!0,onClose:A,onConfirm:()=>ae({is_kurdish:!0},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد تحديد كل هذه الأفلام على أنها كردية؟",isLoading:se}),j==="unmarkKurdish"&&e.jsx(je,{isOpen:!0,onClose:A,onConfirm:()=>ae({is_kurdish:!1},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد إزالة العلامة الكردية من كل هذه الأفلام؟",isLoading:se}),l&&e.jsx($e,{title:y?"تعديل الفيلم":"إضافة فيلم جديد",onClose:A,isOpen:l,children:e.jsx(bt,{onSubmit:y?s=>N(y.id,s):fe,initialData:y,onCancel:A,isKurdishByDefault:L==="kurdish"&&!y,isLoading:se,allGenres:q})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:X,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:te,onChange:s=>b(s.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("div",{className:"flex flex-wrap justify-center items-center gap-2 p-1 bg-slate-900/50 rounded-lg flex-shrink-0",children:[e.jsx("button",{onClick:()=>J("all"),className:f("all"),children:"الكل"}),e.jsx("button",{onClick:()=>J("kurdish"),className:f("kurdish"),children:"كردي فقط"}),e.jsx("button",{onClick:()=>J("non-kurdish"),className:f("non-kurdish"),children:"غير كردي"})]})]}),o.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[o.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>u([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>v("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>v("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>v("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>v("markKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تحديد ككردي"}),e.jsx("button",{onClick:()=>v("unmarkKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"إلغاء تحديد ككردي"}),e.jsx("button",{onClick:()=>v("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),P?e.jsx(mt,{}):e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto hidden lg:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:oe,checked:U,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"مدبلج كردي"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:c.map(s=>{var k,_;return e.jsxs("tr",{className:`${o.includes(s.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:o.includes(s.id),onChange:()=>ne(s.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:s.poster_url,alt:s.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:s.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:s.imdb_rating?s.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:s.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(k=s.genres)==null?void 0:k.slice(0,3).map(W=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:W},W)),((_=s.genres)==null?void 0:_.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:s.is_kurdish?"نعم":"لا"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:s.created_at?new Date(s.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>re(s),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>B(s),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},s.id)})})]})}),e.jsxs("div",{className:"block lg:hidden space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx("input",{type:"checkbox",onChange:oe,checked:U,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("label",{className:"text-sm text-slate-300",children:"تحديد الكل في هذه الصفحة"})]}),c.map(s=>{var k,_;return e.jsxs("div",{className:`p-3 rounded-lg transition-all duration-200 ${o.includes(s.id)?"bg-cyan-500/20 ring-2 ring-cyan-500":"bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24",children:e.jsx("img",{src:s.poster_url,alt:s.title,className:"w-full rounded object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-bold text-white truncate flex-grow pr-2",children:s.title}),e.jsx("input",{type:"checkbox",checked:o.includes(s.id),onChange:()=>ne(s.id),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 flex-shrink-0"})]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1 flex items-center gap-x-2 flex-wrap",children:[e.jsx("span",{children:s.year}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{className:"text-yellow-400 font-bold",children:s.imdb_rating?s.imdb_rating.toFixed(1):"N/A"}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{children:s.is_kurdish?"كردي":"غير كردي"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[(k=s.genres)==null?void 0:k.slice(0,2).map(W=>e.jsx("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:W},W)),((_=s.genres)==null?void 0:_.length)>2&&e.jsxs("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:["+",s.genres.length-2]})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 flex justify-end items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-xs text-slate-500 mr-auto",children:["أضيف في: ",s.created_at?new Date(s.created_at).toLocaleDateString("ar-EG"):"N/A"]}),e.jsx("button",{onClick:()=>re(s),className:"font-medium text-cyan-400 hover:text-cyan-300",children:"تعديل"}),e.jsx("button",{onClick:()=>B(s),className:"font-medium text-red-500 hover:text-red-400",children:"حذف"})]})]},s.id)})]})]}),g>Ue&&e.jsx("div",{className:"p-4 mt-4 border-t border-slate-700",children:e.jsx(nt,{currentPage:C,totalPages:h,onPageChange:M})})]})},vt=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),kt=({onSubmit:c,initialData:r,onCancel:g,isLoading:p=!1,allGenres:y=[]})=>{const[d,l]=n.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:"",year:new Date().getFullYear(),episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"}],imdb_rating:0}],trailer_url:"",imdb_rating:0}),[m,C]=n.useState(""),[M,L]=n.useState(!1),J=n.useRef(null);n.useEffect(()=>{r&&(l({...r,genres:r.genres||[],tags:r.tags||[],seasons:r.seasons&&r.seasons.length>0?r.seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:r.poster_url,year:r.year,episodes:[],imdb_rating:0}],trailer_url:r.trailer_url||"",imdb_rating:r.imdb_rating||0}),C((r.tags||[]).join(", ")))},[r]),n.useEffect(()=>{const x=o=>{J.current&&!J.current.contains(o.target)&&L(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const te=async x=>{var o;try{if(!((o=navigator.clipboard)!=null&&o.readText))throw new Error("Clipboard API not available.");const u=await navigator.clipboard.readText();u&&x(u)}catch(u){console.error("Failed to read clipboard contents: ",u),alert("فشل لصق النص. يرجى التأكد من منح الإذن لاستخدام الحافظة.")}},b=x=>{const{name:o,value:u}=x.target;if(o==="year"||o==="imdb_rating"){const j=parseFloat(u);l(v=>({...v,[o]:isNaN(j)?0:j}))}else l(j=>({...j,[o]:u}))},$=x=>{C(x.target.value)},S=x=>{l(o=>({...o,genres:o.genres.includes(x)?o.genres.filter(u=>u!==x):[...o.genres,x]}))},T=(x,o,u)=>{const j=[...d.seasons],v={...j[x]};if(o==="season_number"||o==="year"||o==="imdb_rating"){const q=typeof u=="string"?parseFloat(u):u;v[o]=isNaN(q)?0:q}else v[o]=u;j[x]=v,l(q=>({...q,seasons:j}))},D=()=>{const x=d.seasons.length>0?Math.max(...d.seasons.map(u=>u.season_number))+1:1,o=d.seasons.length>0?d.seasons[d.seasons.length-1].year:d.year;l(u=>({...u,seasons:[...u.seasons,{season_number:x,title:`الموسم ${x}`,description:"",poster_url:u.poster_url,year:o+1,episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"}],imdb_rating:0}]}))},V=x=>{l(o=>({...o,seasons:o.seasons.filter((u,j)=>j!==x)}))},R=(x,o,u,j)=>{const v=[...d.seasons],q=[...v[x].episodes],I={...q[o]};if(u==="episode_number"){const Z=typeof j=="string"?parseFloat(j):j;I[u]=isNaN(Z)?0:Z}else I[u]=j;q[o]=I,v[x]={...v[x],episodes:q},l(Z=>({...Z,seasons:v}))},P=x=>{const o=d.seasons[x],u=o.episodes.length>0?Math.max(...o.episodes.map(q=>q.episode_number))+1:1,j={episode_number:u,title:`الحلقة ${u}`,url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"},v=d.seasons.map((q,I)=>I===x?{...q,episodes:[...q.episodes,j]}:q);l(q=>({...q,seasons:v}))},G=(x,o)=>{const u=d.seasons.map((j,v)=>v===x?{...j,episodes:j.episodes.filter((q,I)=>I!==o)}:j);l(j=>({...j,seasons:u}))},se=x=>{x.preventDefault();const o=m.split(",").map(u=>u.trim()).filter(Boolean);c({...d,tags:o})},w="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",O="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:se,className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white border-b border-slate-700 pb-2",children:"معلومات المسلسل الرئيسية"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:d.title,onChange:b,placeholder:"عنوان المسلسل",required:!0,className:w}),e.jsx("input",{type:"number",name:"year",value:d.year||"",onChange:b,placeholder:"سنة بداية العرض",required:!0,className:w})]}),e.jsx("textarea",{name:"description",value:d.description,onChange:b,placeholder:"وصف المسلسل العام",required:!0,className:`${w} h-24`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"poster_url",value:d.poster_url,onChange:b,placeholder:"رابط البوستر الرئيسي",required:!0,className:w}),e.jsx("input",{type:"url",name:"backdrop_url",value:d.backdrop_url,onChange:b,placeholder:"رابط صورة الخلفية",required:!0,className:w})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:d.imdb_rating??"",onChange:b,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:w}),e.jsx("input",{type:"url",name:"trailer_url",value:d.trailer_url??"",onChange:b,placeholder:"رابط المقطع الدعائي (اختياري)",className:w})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات"}),e.jsxs("div",{className:"relative",ref:J,children:[e.jsx("button",{type:"button",onClick:()=>L(x=>!x),className:`${w} text-right`,children:d.genres.length>0?d.genres.join(", "):"اختر الفئات..."}),M&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:y.map(x=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:d.genres.includes(x),onChange:()=>S(x),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:x})]},x))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (مفصولة بفاصلة)"}),e.jsx("input",{type:"text",value:m,onChange:$,placeholder:"أكشن, إثارة...",className:w})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),d.seasons.map((x,o)=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-white font-semibold",children:"الموسم رقم:"}),e.jsx("input",{type:"number",value:x.season_number||"",onChange:u=>T(o,"season_number",u.target.value),className:`${O} w-20`})]}),e.jsx("button",{type:"button",onClick:()=>V(o),className:"bg-red-600 text-white px-3 py-1 rounded-md text-sm",children:"إزالة الموسم"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",value:x.title,onChange:u=>T(o,"title",u.target.value),placeholder:"عنوان الموسم",required:!0,className:O}),e.jsx("input",{type:"number",value:x.year||"",onChange:u=>T(o,"year",u.target.value),placeholder:"سنة الموسم",required:!0,className:O}),e.jsx("input",{type:"number",value:x.imdb_rating??"",onChange:u=>T(o,"imdb_rating",u.target.value),placeholder:"تقييم IMDb",step:"0.1",min:"0",max:"10",className:O}),e.jsx("input",{type:"url",value:x.poster_url,onChange:u=>T(o,"poster_url",u.target.value),placeholder:"رابط بوستر الموسم",required:!0,className:`${O} col-span-1 sm:col-span-3`}),e.jsx("textarea",{value:x.description,onChange:u=>T(o,"description",u.target.value),placeholder:"وصف الموسم",required:!0,className:`${O} h-20 col-span-1 sm:col-span-3`})]}),e.jsxs("div",{className:"space-y-2 pt-3 mt-3 border-t border-slate-600",children:[e.jsxs("h4",{className:"font-semibold text-slate-300",children:["حلقات الموسم ",x.season_number,":"]}),x.episodes.map((u,j)=>e.jsxs("div",{className:"bg-slate-800/60 p-2 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:u.episode_number||"",onChange:v=>R(o,j,"episode_number",v.target.value),placeholder:"رقم",className:`${O} w-16`}),e.jsx("input",{type:"text",value:u.title,onChange:v=>R(o,j,"title",v.target.value),placeholder:"عنوان الحلقة",className:`${O} flex-1`}),e.jsx("button",{type:"button",onClick:()=>G(o,j),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600 text-xs",children:"X"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("input",{type:"url",value:u.url,onChange:v=>R(o,j,"url",v.target.value),placeholder:"رابط المشاهدة",required:!0,className:`${O} flex-1`}),e.jsx("button",{type:"button",onClick:()=>te(v=>R(o,j,"url",v)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsxs("select",{value:u.quality||"1080p",onChange:v=>R(o,j,"quality",v.target.value),className:`${O} w-28 flex-shrink-0`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]})]}),e.jsx("input",{type:"url",value:u.download_url||"",onChange:v=>R(o,j,"download_url",v.target.value),placeholder:"رابط التحميل (اختياري)",className:`${O} w-full`})]})]},j)),e.jsx("button",{type:"button",onClick:()=>P(o),className:"text-sm bg-slate-600 text-white py-1 px-3 rounded-md hover:bg-slate-500",children:"إضافة حلقة"})]})]},o)),e.jsx("button",{type:"button",onClick:D,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700",children:"إضافة موسم"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:g,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg",disabled:p,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg",disabled:p,children:[p&&e.jsx(vt,{}),r?"تحديث المسلسل":"إضافة المسلسل"]})]})]})},Ge=10,Ct=()=>{const[c,r]=n.useState([]),[g,p]=n.useState(0),[y,d]=n.useState(null),[l,m]=n.useState(!1),[C,M]=n.useState(1),[L,J]=n.useState(""),[te,b]=n.useState(""),[$,S]=n.useState(!1),[T,D]=n.useState(null),[V,R]=n.useState(!0),[P,G]=n.useState(!1),[se,w]=n.useState(null),[O,x]=n.useState([]),[o,u]=n.useState(null),[j,v]=n.useState([]),q=n.useCallback(async()=>{R(!0);const{data:t,error:h}=await E.from("categories").select("name").order("name");h?console.error("Error fetching categories: ",h):v(t.map(H=>H.name));const f=(C-1)*Ge,U=f+Ge-1;let s=E.from("series").select("*",{count:"exact"});te&&(s=s.ilike("title",`%${te}%`)),s=s.order("created_at",{ascending:!1}).range(f,U);const{data:k,error:_,count:W}=await s;_?(console.error("Error fetching series: ",_),I("فشل في تحميل المسلسلات.","error")):(r(k),p(W||0)),R(!1)},[C,te]);n.useEffect(()=>{q()},[q]),n.useEffect(()=>{const t=setTimeout(()=>{b(L),M(1),x([])},500);return()=>clearTimeout(t)},[L]);const I=(t,h)=>{w({message:t,type:h})},Z=async t=>{G(!0);try{const{error:h}=await E.from("series").insert([{...t,created_at:new Date().toISOString()}]);if(h)throw h;await q(),m(!1),M(1),I("تمت إضافة المسلسل بنجاح.","success")}catch(h){console.error("Error adding series: ",h),I(`حدث خطأ أثناء إضافة المسلسل: ${h.message}`,"error")}finally{G(!1)}},z=async(t,h)=>{G(!0);try{const{error:f}=await E.from("series").update(h).eq("id",t);if(f)throw f;await q(),d(null),m(!1),I("تم تحديث المسلسل بنجاح.","success")}catch(f){console.error("Error updating series:",f),I(`حدث خطأ أثناء تحديث المسلسل: ${f.message}`,"error")}finally{G(!1)}},fe=t=>{D(t),S(!0)},N=async()=>{if(T){G(!0);try{const{error:t}=await E.from("series").delete().eq("id",T.id);if(t)throw t;await q(),I("تم حذف المسلسل بنجاح.","success")}catch(t){console.error("Error deleting series:",t),I(`حدث خطأ أثناء حذف المسلسل: ${t.message}`,"error")}finally{S(!1),D(null),G(!1)}}},B=t=>{d(t),m(!0)},K=()=>{d(null),m(!0)},re=()=>{d(null),m(!1),u(null)},X=t=>{x(h=>h.includes(t)?h.filter(f=>f!==t):[...h,t])},A=t=>{t.target.checked?x(c.map(h=>h.id)):x([])},ne=async()=>{G(!0);try{const{error:t}=await E.from("series").delete().in("id",O);if(t)throw t;await q(),I(`تم حذف ${O.length} مسلسل بنجاح.`,"success"),x([])}catch(t){console.error("Bulk delete failed:",t),I("فشل الحذف الجماعي.","error")}finally{G(!1),u(null)}},oe=async(t,h)=>{G(!0);try{const{data:f,error:U}=await E.from("series").select("id, genres").in("id",O);if(U)throw U;const s=f.map(_=>{const W=_.genres||[],H=h==="add"?[...new Set([...W,t])]:W.filter(ce=>ce!==t);return{id:_.id,genres:H}}),{error:k}=await E.from("series").upsert(s);if(k)throw k;await q(),I(`تم ${h==="add"?"إضافة":"إزالة"} فئة "${t}" بنجاح.`,"success"),x([])}catch(f){console.error("Bulk genre change failed:",f),I("فشل تغيير الفئة الجماعي.","error")}finally{G(!1),u(null)}},ae=async(t,h)=>{G(!0);try{const{data:f,error:U}=await E.from("series").select("id, tags").in("id",O);if(U)throw U;const s=f.map(_=>{const W=_.tags||[],H=h==="add"?[...new Set([...W,t])]:W.filter(ce=>ce!==t);return{id:_.id,tags:H}}),{error:k}=await E.from("series").upsert(s);if(k)throw k;await q(),I(`تم ${h==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${t}" بنجاح.`,"success"),x([])}catch(f){console.error("Bulk tags change failed:",f),I("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{G(!1),u(null)}},a=Math.ceil(g/Ge),i=c.length>0&&c.every(t=>O.includes(t.id));return e.jsxs("div",{className:"relative",children:[se&&e.jsx(lt,{...se,onClose:()=>w(null)}),e.jsx(je,{isOpen:$,onClose:()=>S(!1),onConfirm:N,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',T==null?void 0:T.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:P}),o==="delete"&&e.jsx(je,{isOpen:!0,onClose:()=>u(null),onConfirm:ne,title:`تأكيد حذف ${O.length} مسلسل`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:P}),o==="genre"&&e.jsx(ht,{genres:j,onClose:re,onSubmit:oe,isLoading:P}),o==="tags"&&e.jsx(xt,{onClose:re,onSubmit:ae,isLoading:P}),l&&e.jsx($e,{title:y?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:re,isOpen:l,children:e.jsx(kt,{onSubmit:y?t=>z(y.id,t):Z,initialData:y,onCancel:re,isLoading:P,allGenres:j})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:K,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:L,onChange:t=>J(t.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a series to edit"})]})]}),O.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[O.length," مسلسل محدد"]}),e.jsx("button",{onClick:()=>x([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>u("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>u("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>u("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),V?e.jsx(mt,{}):e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto hidden lg:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:A,checked:i,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:c.map(t=>{var h,f,U;return e.jsxs("tr",{className:`${O.includes(t.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:O.includes(t.id),onChange:()=>X(t.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:t.poster_url,alt:t.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:t.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:t.imdb_rating?t.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(h=t.genres)==null?void 0:h.slice(0,3).map(s=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:s},s)),((f=t.genres)==null?void 0:f.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:((U=t.seasons)==null?void 0:U.length)||0}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>B(t),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>fe(t),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},t.id)})})]})}),e.jsxs("div",{className:"block lg:hidden space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx("input",{type:"checkbox",onChange:A,checked:i,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("label",{className:"text-sm text-slate-300",children:"تحديد الكل في هذه الصفحة"})]}),c.map(t=>{var h,f,U;return e.jsxs("div",{className:`p-3 rounded-lg transition-all duration-200 ${O.includes(t.id)?"bg-cyan-500/20 ring-2 ring-cyan-500":"bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24",children:e.jsx("img",{src:t.poster_url,alt:t.title,className:"w-full rounded object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-bold text-white truncate flex-grow pr-2",children:t.title}),e.jsx("input",{type:"checkbox",checked:O.includes(t.id),onChange:()=>X(t.id),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 flex-shrink-0"})]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1 flex items-center gap-x-2 flex-wrap",children:[e.jsx("span",{children:t.year}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{className:"text-yellow-400 font-bold",children:t.imdb_rating?t.imdb_rating.toFixed(1):"N/A"}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsxs("span",{children:[((h=t.seasons)==null?void 0:h.length)||0," مواسم"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[(f=t.genres)==null?void 0:f.slice(0,2).map(s=>e.jsx("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:s},s)),((U=t.genres)==null?void 0:U.length)>2&&e.jsxs("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:["+",t.genres.length-2]})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 flex justify-end items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-xs text-slate-500 mr-auto",children:["أضيف في: ",t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"N/A"]}),e.jsx("button",{onClick:()=>B(t),className:"font-medium text-cyan-400 hover:text-cyan-300",children:"تعديل"}),e.jsx("button",{onClick:()=>fe(t),className:"font-medium text-red-500 hover:text-red-400",children:"حذف"})]})]},t.id)})]})]}),g>Ge&&e.jsx("div",{className:"p-4 mt-4 border-t border-slate-700",children:e.jsx(nt,{currentPage:C,totalPages:a,onPageChange:M})})]})},St=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),_t=({onSubmit:c,initialData:r,onCancel:g,isLoading:p=!1})=>{const[y,d]=n.useState("");n.useEffect(()=>{d(r?r.name:"")},[r]);const l=m=>{m.preventDefault(),y.trim()&&c({name:y})};return e.jsxs("form",{onSubmit:l,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:y,onChange:m=>d(m.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:g,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:p,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:p,children:[p&&e.jsx(St,{}),p?r?"جاري التحديث...":"جاري الإضافة...":r?"تحديث":"إضافة"]})]})]})},Et=10,$t=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(Et)].map((c,r)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},r))})]})})}),qt=({isOpen:c,onClose:r,onSubmit:g,isLoading:p,categories:y})=>{const[d,l]=n.useState(""),[m,C]=n.useState(""),[M,L]=n.useState(""),J=ft.useMemo(()=>y.filter(b=>b.name!==d),[y,d]);n.useEffect(()=>{if(c&&y.length>0){const b=y[0].name;l(b);const $=y.filter(S=>S.name!==b);C($.length>0?$[0].name:"")}},[c,y]),n.useEffect(()=>{L(d&&m&&d===m?"لا يمكن دمج فئة مع نفسها. الرجاء اختيار فئتين مختلفتين.":"")},[d,m]),n.useEffect(()=>{J.some(b=>b.name===m)||C(J.length>0?J[0].name:"")},[d,J,m]);const te=b=>{b.preventDefault(),!(M||!d||!m)&&g(d,m)};return e.jsx($e,{title:"توحيد (دمج) الفئات",onClose:r,isOpen:c,children:e.jsxs("form",{onSubmit:te,className:"space-y-6",children:[e.jsx("p",{className:"text-slate-300",children:"سيتم نقل كل المحتوى من الفئة المصدر إلى الفئة الهدف، ثم سيتم حذف الفئة المصدر نهائياً."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source_category",className:"block text-sm font-medium text-slate-300 mb-2",children:"دمج من هذه الفئة (سيتم حذفها):"}),e.jsx("select",{id:"source_category",value:d,onChange:b=>l(b.target.value),required:!0,className:"w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",children:y.map(b=>e.jsx("option",{value:b.name,children:b.name},b.id))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"destination_category",className:"block text-sm font-medium text-slate-300 mb-2",children:"الدمج في هذه الفئة (ستبقى):"}),e.jsx("select",{id:"destination_category",value:m,onChange:b=>C(b.target.value),required:!0,className:"w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",disabled:J.length===0,children:J.map(b=>e.jsx("option",{value:b.name,children:b.name},b.id))})]}),M&&e.jsx("p",{className:"text-red-400 text-center text-sm bg-red-500/10 p-2 rounded-md",children:M}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:r,disabled:p,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:p||!!M||!d||!m,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",children:[p&&e.jsx(Ee,{}),p?"جاري الدمج...":"تنفيذ الدمج"]})]})]})})},Ie=10,At=({message:c,type:r,onClose:g})=>(n.useEffect(()=>{const d=setTimeout(g,5e3);return()=>clearTimeout(d)},[g]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${r==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:c}),e.jsx("button",{onClick:g,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Mt=({children:c,onClose:r,title:g,isOpen:p})=>{const[y,d]=n.useState(p);return n.useEffect(()=>{if(p){d(!0),document.body.style.overflow="hidden";const l=m=>{m.key==="Escape"&&r()};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}}else{const l=setTimeout(()=>{d(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(l)}},[p,r]),y?e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 ${p?"animate-fade-in":"animate-fade-out"}`,onClick:r,children:e.jsxs("div",{className:`bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700 ${p?"animate-zoom-in":"animate-zoom-out"}`,onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:g}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),c]})}):null},Ft=()=>{const[c,r]=n.useState([]),[g,p]=n.useState(null),[y,d]=n.useState(!1),[l,m]=n.useState(1),[C,M]=n.useState(!1),[L,J]=n.useState(null),[te,b]=n.useState(!0),[$,S]=n.useState(!1),[T,D]=n.useState(null),[V,R]=n.useState(!1),[P,G]=n.useState(null),se=async()=>{const{data:N,error:B}=await E.from("categories").select("*").order("name");B?(console.error("Error fetching categories: ",B),w("فشل في تحميل الفئات.","error")):r(N),b(!1)};n.useEffect(()=>{b(!0),se();const N=E.channel("public:categories").on("postgres_changes",{event:"*",schema:"public",table:"categories"},se).subscribe();return()=>{E.removeChannel(N)}},[]);const w=(N,B)=>{D({message:N,type:B})},O=async N=>{S(!0);try{const{error:B}=await E.from("categories").insert([N]);if(B)throw B;w("تمت إضافة الفئة بنجاح!","success"),d(!1),m(1)}catch(B){console.error("Error adding category: ",B);const K=B.message||JSON.stringify(B);w(`حدث خطأ أثناء إضافة الفئة: ${K}`,"error")}finally{S(!1)}},x=async(N,B)=>{S(!0);const K=g==null?void 0:g.name,re=B.name,X=K&&re&&K!==re;try{const{error:A}=await E.from("categories").update(B).eq("id",N);if(A)throw A;if(X){w("تم تحديث الفئة. جاري تحديث المحتوى المرتبط...","success");const{data:ne,error:oe}=await E.from("movies").select("id, genres").contains("genres",[K]);if(oe)console.error("Error fetching movies to update:",oe),w("تم تحديث الفئة، لكن حدث خطأ أثناء جلب الأفلام للتحديث.","error");else if(ne&&ne.length>0){const i=ne.map(f=>{const U=f.genres.map(s=>s===K?re:s);return E.from("movies").update({genres:U}).eq("id",f.id)}),h=(await Promise.all(i)).find(f=>f.error);h&&(console.error("Error updating movies with new category:",h.error),w("تم تحديث الفئة، لكن حدث خطأ أثناء تحديث بعض الأفلام.","error"))}const{data:ae,error:a}=await E.from("series").select("id, genres").contains("genres",[K]);if(a)console.error("Error fetching series to update:",a),w("تم تحديث الفئة، لكن حدث خطأ أثناء جلب المسلسلات للتحديث.","error");else if(ae&&ae.length>0){const i=ae.map(f=>{const U=f.genres.map(s=>s===K?re:s);return E.from("series").update({genres:U}).eq("id",f.id)}),h=(await Promise.all(i)).find(f=>f.error);h&&(console.error("Error updating series with new category:",h.error),w("تم تحديث الفئة، لكن حدث خطأ أثناء تحديث بعض المسلسلات.","error"))}w("تم تحديث الفئة والمحتوى المرتبط بنجاح!","success")}else w("تم تحديث الفئة بنجاح!","success");p(null),d(!1)}catch(A){if(console.error("Error updating category transaction: ",A),A.code==="23505")w(`فشل التحديث: اسم الفئة "${re}" موجود بالفعل.`,"error");else{const ne=A.message||JSON.stringify(A);w(`حدث خطأ أثناء تحديث الفئة: ${ne}`,"error")}}finally{S(!1)}},o=N=>{J(N),M(!0)},u=async()=>{if(L){S(!0);try{const{error:N}=await E.from("categories").delete().eq("id",L.id);if(N)throw N;w("تم حذف الفئة بنجاح!","success")}catch(N){console.error("Error deleting category: ",N);const B=N.message||JSON.stringify(N);w(`حدث خطأ أثناء حذف الفئة: ${B}`,"error")}finally{M(!1),J(null),S(!1)}}},j=N=>{p(N),d(!0)},v=()=>{p(null),d(!0)},q=()=>{p(null),d(!1)},I=(N,B)=>{R(!1),G({source:N,dest:B})},Z=async()=>{if(!P)return;const{source:N,dest:B}=P;S(!0);try{w("جاري تحديث الأفلام...","success");const{data:K,error:re}=await E.from("movies").select("id, genres").contains("genres",[N]);if(re)throw new Error(`Failed to fetch movies: ${re.message}`);if(K&&K.length>0){const oe=K.map(ae=>{const a=[...new Set(ae.genres.filter(i=>i!==N).concat([B]))];return E.from("movies").update({genres:a}).eq("id",ae.id)});await Promise.all(oe)}w("جاري تحديث المسلسلات...","success");const{data:X,error:A}=await E.from("series").select("id, genres").contains("genres",[N]);if(A)throw new Error(`Failed to fetch series: ${A.message}`);if(X&&X.length>0){const oe=X.map(ae=>{const a=[...new Set(ae.genres.filter(i=>i!==N).concat([B]))];return E.from("series").update({genres:a}).eq("id",ae.id)});await Promise.all(oe)}w("جاري حذف الفئة المدمجة...","success");const{error:ne}=await E.from("categories").delete().eq("name",N);if(ne)throw new Error(`Failed to delete category: ${ne.message}`);w("تم دمج الفئات بنجاح!","success")}catch(K){console.error("Error merging categories: ",K),w(`فشل دمج الفئات: ${K.message}`,"error")}finally{G(null),S(!1)}},z=Math.ceil(c.length/Ie),fe=c.slice((l-1)*Ie,l*Ie);return te?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx($t,{})]}):e.jsxs("div",{children:[T&&e.jsx(At,{...T,onClose:()=>D(null)}),e.jsx(je,{isOpen:C,onClose:()=>M(!1),onConfirm:u,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',L==null?void 0:L.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:$}),e.jsx(je,{isOpen:!!P,onClose:()=>G(null),onConfirm:Z,title:"تأكيد عملية الدمج",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد دمج الفئة ",e.jsxs("strong",{className:"text-white",children:['"',P==null?void 0:P.source,'"']})," في الفئة ",e.jsxs("strong",{className:"text-white",children:['"',P==null?void 0:P.dest,'"']}),"؟",e.jsx("br",{}),e.jsxs("span",{className:"text-yellow-400",children:['سيتم حذف الفئة "',P==null?void 0:P.source,'" نهائياً. لا يمكن التراجع عن هذا الإجراء.']})]}),isLoading:$}),e.jsx(qt,{isOpen:V,onClose:()=>R(!1),onSubmit:I,isLoading:$,categories:c}),e.jsx(Mt,{isOpen:y,title:g?"تعديل الفئة":"إضافة فئة جديدة",onClose:q,children:e.jsx(_t,{onSubmit:g?N=>x(g.id,N):O,initialData:g,onCancel:q,isLoading:$})}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsx("button",{onClick:v,className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsx("button",{onClick:()=>R(!0),className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500 transition-colors",children:"توحيد الفئات"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden hidden sm:block",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:c.length>0?fe.map(N=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:N.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>j(N),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>o(N),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},N.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})})}),e.jsx("div",{className:"block sm:hidden space-y-3",children:c.length>0?fe.map(N=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-white",children:N.name}),e.jsxs("div",{className:"flex gap-4 flex-shrink-0",children:[e.jsx("button",{onClick:()=>j(N),className:"text-cyan-400 hover:text-cyan-300 text-sm font-medium",children:"تعديل"}),e.jsx("button",{onClick:()=>o(N),className:"text-red-500 hover:text-red-400 text-sm font-medium",children:"حذف"})]})]},N.id)):e.jsx("div",{className:"text-center py-8 text-gray-400 bg-slate-900/50 rounded-lg",children:"لا توجد فئات حالياً."})})]}),c.length>Ie&&e.jsx("div",{className:"mt-4",children:e.jsx(nt,{currentPage:l,totalPages:z,onPageChange:m})})]})},st=["movies","series","categories"],Tt=c=>c.replace(/[A-Z]/g,r=>`_${r.toLowerCase()}`),at=c=>Array.isArray(c)?c.map(r=>at(r)):c!==null&&typeof c=="object"&&c.constructor===Object?c.hasOwnProperty("seconds")&&c.hasOwnProperty("nanoseconds")&&Object.keys(c).length===2&&typeof c.seconds=="number"&&typeof c.nanoseconds=="number"?new Date(c.seconds*1e3).toISOString():c.hasOwnProperty("_seconds")&&c.hasOwnProperty("_nanoseconds")&&Object.keys(c).length===2&&typeof c._seconds=="number"&&typeof c._nanoseconds=="number"?new Date(c._seconds*1e3).toISOString():Object.keys(c).reduce((r,g)=>{const p=Tt(g);return r[p]=at(c[g]),r},{}):c,Ot=()=>{const[c,r]=n.useState(!1),[g,p]=n.useState(null),[y,d]=n.useState(!1),[l,m]=n.useState(null),C=(b,$)=>{p({message:b,type:$})},M=async()=>{r(!0),C("بدء عملية النسخ الاحتياطي... قد تستغرق هذه العملية بعض الوقت.","success");try{const b={};for(const R of st){const{data:P,error:G}=await E.from(R).select("*");if(G)throw G;b[R]=P||[]}const $=JSON.stringify(b,null,2),S=new Blob([$],{type:"application/json"}),T=URL.createObjectURL(S),D=document.createElement("a");D.href=T;const V=new Date().toISOString().slice(0,10);D.download=`supabase-backup-${V}.json`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(T),C("تم إكمال النسخ الاحتياطي بنجاح!","success")}catch(b){console.error("Backup failed:",b);let $="فشل النسخ الاحتياطي. تحقق من وحدة التحكم لمزيد من التفاصيل.";b.code==="42501"&&($="فشل النسخ الاحتياطي: أذونات غير كافية. تأكد من أن قواعد RLS تسمح للمشرفين بقراءة المجموعات."),C($,"error")}finally{r(!1)}},L=b=>{var S;const $=(S=b.target.files)==null?void 0:S[0];if($){const T=new FileReader;T.onload=D=>{var V;try{const R=(V=D.target)==null?void 0:V.result,P=JSON.parse(R);m(P)}catch(R){C("ملف JSON غير صالح.","error"),console.error("JSON parsing error:",R),m(null)}},T.readAsText($)}},J=()=>{l?d(!0):C("الرجاء تحديد ملف نسخ احتياطي أولاً.","error")},te=async()=>{if(d(!1),!!l){r(!0),C("بدء عملية الاستعادة... هذه العملية ستستغرق وقتاً.","success");try{let b=0,$=[];for(const T of Object.keys(l)){if(!st.includes(T)){$.push(T),console.warn(`Skipping restore for unsupported collection: "${T}"`);continue}const D=l[T];if(Array.isArray(D)&&D.length>0){const V=D.map(P=>at(P)),{error:R}=await E.from(T).upsert(V);if(R)throw console.error(`Error during upsert to "${T}":`,JSON.stringify(R,null,2)),console.error("First failed object (transformed):",JSON.stringify(V[0],null,2)),R;b++}}let S="تمت استعادة البيانات بنجاح!";$.length>0&&(S+=` تم تخطي المجموعات التالية: ${$.join(", ")}.`),b===0&&$.length>0?C(`لم يتم العثور على مجموعات بيانات صالحة للاستعادة في الملف. تم تخطي: ${$.join(", ")}.`,"error"):b>0?C(S,"success"):C("لم يتم العثور على بيانات صالحة للاستعادة في الملف.","error")}catch(b){console.error("Restore failed:",JSON.stringify(b,null,2));const $=`فشلت عملية الاستعادة: ${b.message||"خطأ غير معروف"}. يرجى مراجعة وحدة التحكم للحصول على التفاصيل الفنية.`;C($,"error")}finally{r(!1),m(null)}}};return e.jsxs("div",{className:"space-y-12",children:[g&&e.jsx(lt,{...g,onClose:()=>p(null)}),e.jsx(je,{isOpen:y,onClose:()=>d(!1),onConfirm:te,title:"تأكيد استعادة البيانات",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد استعادة البيانات من هذا الملف؟",e.jsx("br",{}),e.jsx("strong",{className:"text-yellow-400",children:"تحذير:"})," سيتم الكتابة فوق أي بيانات موجودة في المجموعات التي لها نفس الأسماء. لا يمكن التراجع عن هذا الإجراء."]}),isLoading:c}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"النسخ الاحتياطي للبيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:["انقر على الزر أدناه لتصدير بيانات المحتوى العام (",st.join(", "),"). لا يتم تضمين بيانات المستخدمين والمشرفين الخاصة في هذا النسخ الاحتياطي من جانب العميل لأسباب تتعلق بالأمان والأذونات."]}),e.jsxs("button",{onClick:M,disabled:c,className:"w-full flex items-center justify-center bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-800 disabled:cursor-wait",children:[c&&e.jsx(Ee,{}),c?"جاري التصدير...":"تصدير بيانات المحتوى الآن"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"استعادة البيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("div",{className:"p-4 border-l-4 border-yellow-500 bg-yellow-500/10 text-yellow-300 rounded-md",children:[e.jsx("strong",{className:"font-bold",children:"تحذير خطير:"})," استعادة البيانات من ملف ستقوم بالكتابة فوق البيانات الحالية في قاعدة البيانات. استخدم هذه الميزة بحذر شديد وتأكد من أنك تستخدم ملف النسخ الاحتياطي الصحيح."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"1. حدد ملف النسخ الاحتياطي (.json)"}),e.jsx("input",{type:"file",accept:".json",onChange:L,className:"w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-500/20 file:text-cyan-300 hover:file:bg-cyan-500/30"})]}),e.jsxs("button",{onClick:J,disabled:c||!l,className:"w-full flex items-center justify-center bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors disabled:bg-red-800 disabled:cursor-not-allowed disabled:cursor-wait",children:[c&&e.jsx(Ee,{}),c?"جاري الاستعادة...":"2. استعادة البيانات"]})]})]})]})},rt=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(Nt,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx(Ct,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(Ft,{})},{key:"backup",label:"النسخ الاحتياطي والاستعادة",component:e.jsx(Ot,{})}],Pt=({label:c,tabKey:r,activeTab:g,onClick:p})=>e.jsx("button",{onClick:()=>p(r),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex-shrink-0 ${g===r?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":g===r,children:c}),Gt=()=>{var p;const[c,r]=n.useState(rt[0].key),g=(p=rt.find(y=>y.key===c))==null?void 0:p.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6 overflow-x-auto whitespace-nowrap scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",role:"tablist",children:rt.map(y=>e.jsx(Pt,{label:y.label,tabKey:y.key,activeTab:c,onClick:r},y.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-3 sm:p-6 rounded-lg border border-slate-700",children:g})]})};export{Gt as default};
