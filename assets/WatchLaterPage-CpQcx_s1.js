import{r as a,j as e,L as w,d as N}from"./index-COHSSNss.js";import{a as E}from"./MovieCardSkeleton-D7JhNSqL.js";import{M as I}from"./MovieGridSkeleton-5cat1ZpX.js";import{M as P}from"./MovieGrid-B5uZhT3G.js";import{I as k}from"./InfiniteScrollTrigger-1Hd5b64E.js";import"./MovieCard-C6_WItKi.js";const M=28,U=()=>{const[o,i]=a.useState([]),[b,n]=a.useState(!0),{watchLater:r}=E(),[c,v]=a.useState(1),[l,d]=a.useState(!1);a.useEffect(()=>{(async()=>{if(r.length===0){i([]),n(!1);return}n(!0);try{const x=[];for(let t=0;t<r.length;t+=30)x.push(r.slice(t,t+30));const S=x.map(t=>N.collection("movies").where(window.firebase.firestore.FieldPath.documentId(),"in",t).get()),g=(await Promise.all(S)).flatMap(t=>t.docs.map(s=>({id:s.id,...s.data()})));g.sort((t,s)=>{var u,p;return(u=t.createdAt)!=null&&u.toMillis&&((p=s.createdAt)!=null&&p.toMillis)?s.createdAt.toMillis()-t.createdAt.toMillis():0}),i(g)}catch(f){console.error("Error fetching watch later movies: ",f),i([])}finally{n(!1)}})()},[r]);const j=Math.ceil(o.length/M),h=c<j,L=()=>{h&&!l&&(d(!0),setTimeout(()=>{v(m=>m+1),d(!1)},500))},y=o.slice(0,c*M);return b?e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8 border-r-4 border-cyan-400 pr-4",children:"قائمة المشاهدة لاحقاً"}),e.jsx(I,{count:18})]}):e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8 border-r-4 border-cyan-400 pr-4",children:"قائمة المشاهدة لاحقاً"}),o.length>0?e.jsxs(e.Fragment,{children:[e.jsx(P,{movies:y}),e.jsx(k,{onIntersect:L,hasMore:h,isLoading:l})]}):e.jsxs("div",{className:"text-center p-12 bg-gray-800/50 rounded-lg mt-8",children:[e.jsx("p",{className:"text-2xl text-gray-300 mb-4",children:"قائمة المشاهدة لاحقاً فارغة."}),e.jsx("p",{className:"text-gray-400 mb-6",children:"أضف أفلامًا لمشاهدتها لاحقًا بالنقر على أيقونة الإشارة المرجعية."}),e.jsx(w,{to:"/",className:"inline-block bg-cyan-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-cyan-600 transition-colors",children:"تصفح الأفلام"})]})]})};export{U as default};
