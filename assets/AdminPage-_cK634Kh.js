import{r as t,d as $,j as e,f as ue,F as J,T as me,u as be}from"./index-BrT3PjY4.js";import{P as ce}from"./Pagination-D0U2otOD.js";import{F as ae,S as de}from"./SpinnerIcon-D_6Cz6IS.js";const fe=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ye=({onSubmit:p,initialData:s,onCancel:h,isKurdishByDefault:i=!1,isLoading:f=!1,allGenres:l=[]})=>{const[r,g]=t.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:!1,imdbRating:0}),[S,A]=t.useState(""),[G,D]=t.useState(!1),[T,_]=t.useState(""),[K,F]=t.useState(""),[O,z]=t.useState(!1),E=t.useRef(null),[U,P]=t.useState(!1),[L,C]=t.useState(""),j=t.useRef(null);t.useEffect(()=>{s?(g({...s,genres:s.genres||[],tags:s.tags||[],servers:s.servers&&s.servers.length>0?s.servers:[{name:"Server 1",url:"",quality:"720p"}],backupServers:s.backupServers||[],trailerUrl:s.trailerUrl||"",isKurdish:s.isKurdish||!1,imdbRating:s.imdbRating||0,downloadUrl:s.downloadUrl||""}),A((s.tags||[]).join(", "))):(g({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:i,imdbRating:0}),A(""))},[s,i]),t.useEffect(()=>{const a=m=>{E.current&&!E.current.contains(m.target)&&D(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]),t.useEffect(()=>{j.current&&clearTimeout(j.current);const a=r.title.trim();if(!a||s&&a===s.title.trim()){C(""),P(!1);return}return P(!0),C(""),j.current=window.setTimeout(async()=>{try{const m=await $.collection("movies").where("title","==",a).get();let b=!1;m.empty||(s?m.forEach(R=>{R.id!==s.id&&(b=!0)}):b=!0),C(b?"تحذير: فيلم بنفس هذا العنوان موجود بالفعل.":"")}catch(m){console.error("Error checking for duplicate title:",m)}finally{P(!1)}},500),()=>{j.current&&clearTimeout(j.current)}},[r.title,s]);const o=a=>{const{name:m,value:b,type:R}=a.target;if(R==="checkbox"){const{checked:I}=a.target;g(n=>({...n,[m]:I}))}else if(m==="year"||m==="imdbRating"){const I=parseFloat(b);g(n=>({...n,[m]:isNaN(I)?0:I}))}else g(I=>({...I,[m]:b}))},d=a=>{A(a.target.value)},u=a=>{g(m=>{const b=m.genres||[],R=b.includes(a)?b.filter(I=>I!==a):[...b,a];return{...m,genres:R}})},y=async()=>{const a=K.trim();if(a){if(l.some(m=>m.toLowerCase()===a.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}z(!0);try{await $.collection("categories").add({name:a}),g(m=>({...m,genres:[...m.genres||[],a]})),F("")}catch(m){console.error("Error adding new genre:",m),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{z(!1)}}},x=(a,m,b)=>{const R=[...r.servers],I=R[a].url;R[a]={...R[a],[m]:b},g(n=>{const v=n.downloadUrl===I&&m==="url"?b:n.downloadUrl;return{...n,servers:R,downloadUrl:v}})},w=()=>{g(a=>{const m={name:`Server ${a.servers.length+1}`,url:"",quality:"720p"};return{...a,servers:[...a.servers,m]}})},N=a=>{const m=r.servers[a].url;g(b=>({...b,servers:b.servers.filter((R,I)=>I!==a),downloadUrl:b.downloadUrl===m?"":b.downloadUrl}))},q=(a,m,b)=>{const R=[...r.backupServers||[]],I=R[a].url;R[a]={...R[a],[m]:b},g(n=>{const v=n.downloadUrl===I&&m==="url"?b:n.downloadUrl;return{...n,backupServers:R,downloadUrl:v}})},ee=()=>{g(a=>{var m;return{...a,backupServers:[...a.backupServers||[],{name:`Backup Server ${(((m=a.backupServers)==null?void 0:m.length)||0)+1}`,url:"",quality:"720p"}]}})},Y=a=>{const m=(r.backupServers||[])[a].url;g(b=>({...b,backupServers:(b.backupServers||[]).filter((R,I)=>I!==a),downloadUrl:b.downloadUrl===m?"":b.downloadUrl}))},te=a=>{if(a.preventDefault(),r.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const m=S.split(",").map(b=>b.trim()).filter(b=>b!=="");p({...r,tags:m})},H=l.filter(a=>a.toLowerCase().includes(T.toLowerCase())),se=a=>{g(m=>({...m,downloadUrl:a.target.value}))},V="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",W="bg-slate-600 text-white p-2 rounded-md border-2 border-slate-500 focus:border-cyan-500 outline-none focus:ring-2 focus:ring-cyan-500 transition";return e.jsxs("form",{onSubmit:te,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",name:"title",value:r.title,onChange:o,placeholder:"عنوان الفيلم",required:!0,className:V}),U&&e.jsx("p",{className:"text-xs text-slate-400 mt-1 animate-pulse",children:"جاري التحقق من العنوان..."}),L&&e.jsxs("p",{className:"text-sm text-yellow-400 mt-2 font-semibold flex items-center gap-2 animate-fade-in",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.636-1.21 2.37-1.21 3.006 0l5.485 10.47c.616 1.176-.24 2.62-1.503 2.62H4.275c-1.263 0-2.118-1.444-1.503-2.62l5.485-10.47zM9 9a1 1 0 011-1h0a1 1 0 011 1v3a1 1 0 01-2 0V9zm1 6a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),L]})]}),e.jsx("input",{type:"number",name:"year",value:r.year||"",onChange:o,placeholder:"سنة الإنتاج",required:!0,className:V})]}),e.jsx("textarea",{name:"description",value:r.description,onChange:o,placeholder:"وصف الفيلم",required:!0,className:`${V} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:r.posterUrl,onChange:o,placeholder:"رابط صورة البوستر",required:!0,className:V}),e.jsx("input",{type:"url",name:"backdropUrl",value:r.backdropUrl,onChange:o,placeholder:"رابط صورة الخلفية",required:!0,className:V})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdbRating",value:r.imdbRating??"",onChange:o,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:V}),e.jsx("input",{type:"url",name:"trailerUrl",value:r.trailerUrl??"",onChange:o,placeholder:"رابط المقطع الدعائي (اختياري)",className:V})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:S,onChange:d,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:V})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"isKurdish",type:"checkbox",name:"isKurdish",checked:!!r.isKurdish,onChange:o,className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("label",{htmlFor:"isKurdish",className:"text-white cursor-pointer",children:"هذا الفيلم مدبلج للكردية"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:E,children:[e.jsxs("button",{type:"button",onClick:()=>D(a=>!a),className:`${V} text-right flex justify-between items-center`,children:[e.jsx("span",{children:r.genres.length>0?r.genres.join(", "):"اختر الفئات..."}),e.jsx("svg",{className:`h-5 w-5 transition-transform duration-200 ${G?"rotate-180":""}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),G&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[e.jsx("div",{className:"p-2 border-b border-slate-700",children:e.jsx("input",{type:"text",placeholder:"ابحث أو أضف فئة...",value:T,onChange:a=>_(a.target.value),className:"w-full bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"})}),e.jsx("ul",{className:"p-1",children:H.map(a=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.genres.includes(a),onChange:()=>u(a),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:a})]},a))}),e.jsx("div",{className:"p-2 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"إضافة فئة جديدة...",value:K,onChange:a=>F(a.target.value),className:"flex-grow bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:y,disabled:O||!K.trim(),className:"bg-cyan-600 text-white px-3 py-1 rounded-md text-sm hover:bg-cyan-700 disabled:bg-slate-500",children:O?"...":"إضافة"})]})})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات المشاهدة"}),r.servers.map((a,m)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:a.name,onChange:b=>x(m,"name",b.target.value),placeholder:"اسم السيرفر",className:`${W} flex-1`}),e.jsx("input",{type:"text",value:a.quality,onChange:b=>x(m,"quality",b.target.value),placeholder:"الجودة",className:`${W} w-24`}),e.jsx("button",{type:"button",onClick:()=>N(m),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),e.jsx("input",{type:"url",value:a.url,onChange:b=>x(m,"url",b.target.value),placeholder:"رابط السيرفر",required:!0,className:`${W} w-full`})]},m)),e.jsx("button",{type:"button",onClick:w,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات احتياطية (مشغل خارجي)"}),(r.backupServers||[]).map((a,m)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:a.name,onChange:b=>q(m,"name",b.target.value),placeholder:"اسم السيرفر",className:`${W} flex-1`}),e.jsx("input",{type:"text",value:a.quality,onChange:b=>q(m,"quality",b.target.value),placeholder:"الجودة",className:`${W} w-24`}),e.jsx("button",{type:"button",onClick:()=>Y(m),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),e.jsx("input",{type:"url",value:a.url,onChange:b=>q(m,"url",b.target.value),placeholder:"رابط السيرفر",className:`${W} w-full`})]},m)),e.jsx("button",{type:"button",onClick:ee,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"border-t border-slate-700 pt-4",children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"رابط المشغل الخارجي (اختياري)"}),e.jsx("p",{className:"text-sm text-slate-400 mb-2",children:'اختر أحد روابط السيرفرات أعلاه، أو أدخل رابطًا مخصصًا هنا. هذا هو الرابط الذي سيتم فتحه عند النقر على زر "مشغل خارجي" في صفحة الفيلم.'}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[r.servers.map((a,m)=>a.url&&e.jsx("button",{type:"button",onClick:()=>se({target:{value:a.url}}),className:`text-xs p-1 rounded ${r.downloadUrl===a.url?"bg-cyan-500 text-white":"bg-slate-600 text-slate-200"}`,children:a.name},`main-${m}`)),(r.backupServers||[]).map((a,m)=>a.url&&e.jsx("button",{type:"button",onClick:()=>se({target:{value:a.url}}),className:`text-xs p-1 rounded ${r.downloadUrl===a.url?"bg-cyan-500 text-white":"bg-slate-600 text-slate-200"}`,children:a.name},`backup-${m}`))]}),e.jsx("input",{type:"url",name:"downloadUrl",value:r.downloadUrl||"",onChange:se,placeholder:"رابط مشغل خارجي/تحميل مباشر",className:V})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:h,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",disabled:f,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:f||U||!!L,children:[f&&e.jsx(fe,{}),f?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث الفيلم":"إضافة الفيلم"]})]})]})},je=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Z=({isOpen:p,onClose:s,onConfirm:h,title:i,message:f,isLoading:l=!1})=>{const[r,g]=t.useState(p);return t.useEffect(()=>{if(p)g(!0);else{const S=setTimeout(()=>g(!1),300);return()=>clearTimeout(S)}},[p]),r?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${p?"animate-fade-in":"animate-fade-out"}`,onClick:s,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:`relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md border border-slate-700 ${p?"animate-zoom-in":"animate-zoom-out"}`,onClick:S=>S.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:i}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:f})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:h,disabled:l,children:[l&&e.jsx(je,{}),l?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:s,disabled:l,children:"إلغاء"})]})]})}):null},we=10,xe=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((p,s)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},s))})}),e.jsx("tbody",{children:[...Array(we)].map((p,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((h,i)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},i))]},s))})]})})]}),he=({message:p,type:s,onClose:h})=>(t.useEffect(()=>{const l=setTimeout(h,5e3);return()=>clearTimeout(l)},[h]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:p}),e.jsx("button",{onClick:h,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),pe=({genres:p,onSubmit:s,onClose:h,isLoading:i})=>{const[f,l]=t.useState(p[0]||""),[r,g]=t.useState("add"),S=A=>{A.preventDefault(),f&&s(f,r)};return e.jsx(ae,{title:"تغيير الفئة بشكل جماعي",onClose:h,isOpen:!0,children:e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:f,onChange:A=>l(A.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:p.map(A=>e.jsx("option",{value:A,children:A},A))}),e.jsxs("select",{value:r,onChange:A=>g(A.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:h,disabled:i,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:i||!f,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[i&&e.jsx(de,{}),i?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Ne=({onSubmit:p,onClose:s,isLoading:h})=>{const[i,f]=t.useState(new Date().getFullYear()),l=r=>{r.preventDefault(),p(i)};return e.jsx(ae,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:s,isOpen:!0,children:e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:i,onChange:r=>f(parseInt(r.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:h,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:h,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[h&&e.jsx(de,{}),h?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},ge=({onSubmit:p,onClose:s,isLoading:h})=>{const[i,f]=t.useState(""),[l,r]=t.useState("add"),g=S=>{S.preventDefault(),i.trim()&&p(i.trim(),l)};return e.jsx(ae,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:s,isOpen:!0,children:e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:i,onChange:S=>f(S.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:l,onChange:S=>r(S.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:h,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:h||!i.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[h&&e.jsx(de,{}),h?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},re=10,ve=()=>{const[p,s]=t.useState([]),[h,i]=t.useState(null),[f,l]=t.useState(!1),[r,g]=t.useState(1),[S,A]=t.useState("all"),[G,D]=t.useState(""),[T,_]=t.useState(!1),[K,F]=t.useState(null),[O,z]=t.useState(!0),[E,U]=t.useState(!1),[P,L]=t.useState(null),[C,j]=t.useState([]),[o,d]=t.useState(null),[u,y]=t.useState([]);t.useEffect(()=>{z(!0);const c=$.collection("movies").orderBy("createdAt","desc").onSnapshot(B=>{const X=B.docs.map(Q=>({id:Q.id,...Q.data()}));s(X),z(!1)},B=>{console.error("Error fetching movies: ",B),L({message:"فشل في تحميل الأفلام.",type:"error"}),z(!1)}),k=$.collection("categories").orderBy("name").onSnapshot(B=>{const X=B.docs.map(Q=>Q.data().name);y(X)},B=>{console.error("Error fetching categories from ManageMovies: ",B)});return()=>{c(),k()}},[]),t.useEffect(()=>{g(1),j([])},[S,G]);const x=(c,k)=>{L({message:c,type:k})},w=async c=>{U(!0);try{await $.collection("movies").add({...c,createdAt:me.now()}),l(!1),g(1),x("تمت إضافة الفيلم بنجاح.","success")}catch(k){console.error("Error adding movie: ",k),x("حدث خطأ أثناء إضافة الفيلم.","error")}finally{U(!1)}},N=async(c,k)=>{U(!0);try{await $.collection("movies").doc(c).update(k),i(null),l(!1),x("تم تحديث الفيلم بنجاح.","success")}catch(B){console.error("Error updating movie: ",B),x("حدث خطأ أثناء تحديث الفيلم.","error")}finally{U(!1)}},q=c=>{F(c),_(!0)},ee=async()=>{if(K){U(!0);try{await $.collection("movies").doc(K.id).delete(),x("تم حذف الفيلم بنجاح.","success")}catch(c){console.error("Error deleting movie: ",c),x("حدث خطأ أثناء حذف الفيلم.","error")}finally{_(!1),F(null),U(!1)}}},Y=c=>{i(c),l(!0)},te=()=>{i(null),l(!0)},H=()=>{i(null),l(!1),d(null)},se=c=>{j(k=>k.includes(c)?k.filter(B=>B!==c):[...k,c])},V=c=>{c.target.checked?j(n.map(k=>k.id)):j([])},W=async(c,k)=>{U(!0);try{const B=$.batch();C.forEach(X=>{const Q=$.collection("movies").doc(X);B.update(Q,c)}),await B.commit(),x(k,"success"),j([])}catch(B){console.error("Bulk update failed:",B),x("فشل التحديث الجماعي.","error")}finally{U(!1),d(null)}},a=async()=>{U(!0);try{const c=$.batch();C.forEach(k=>{const B=$.collection("movies").doc(k);c.delete(B)}),await c.commit(),x(`تم حذف ${C.length} فيلم بنجاح.`,"success"),j([])}catch(c){console.error("Bulk delete failed:",c),x("فشل الحذف الجماعي.","error")}finally{U(!1),d(null)}},m=async(c,k)=>{const B={genres:k==="add"?J.arrayUnion(c):J.arrayRemove(c)};await W(B,`تم ${k==="add"?"إضافة":"إزالة"} فئة "${c}" بنجاح.`)},b=async(c,k)=>{const B={tags:k==="add"?J.arrayUnion(c):J.arrayRemove(c)};await W(B,`تم ${k==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${c}" بنجاح.`)},R=p.filter(c=>S==="kurdish"?c.isKurdish===!0:S==="non-kurdish"?!c.isKurdish:!0).filter(c=>ue(G,c.title)),I=Math.ceil(R.length/re),n=R.slice((r-1)*re,r*re),v=c=>`px-4 py-2 text-sm font-bold rounded-lg transition-colors duration-200 ${S===c?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-md":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,M=n.length>0&&C.length===n.length;return O?e.jsx(xe,{}):e.jsxs("div",{className:"relative",children:[P&&e.jsx(he,{...P,onClose:()=>L(null)}),e.jsx(Z,{isOpen:T,onClose:()=>_(!1),onConfirm:ee,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',K==null?void 0:K.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:E}),o==="delete"&&e.jsx(Z,{isOpen:!0,onClose:()=>d(null),onConfirm:a,title:`تأكيد حذف ${C.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:E}),o==="genre"&&e.jsx(pe,{genres:u,onClose:H,onSubmit:m,isLoading:E}),o==="tags"&&e.jsx(ge,{onClose:H,onSubmit:b,isLoading:E}),o==="year"&&e.jsx(Ne,{onClose:H,onSubmit:c=>W({year:c},"تم تحديث السنة بنجاح."),isLoading:E}),o==="markKurdish"&&e.jsx(Z,{isOpen:!0,onClose:H,onConfirm:()=>W({isKurdish:!0},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد تحديد كل هذه الأفلام على أنها كردية؟",isLoading:E}),o==="unmarkKurdish"&&e.jsx(Z,{isOpen:!0,onClose:H,onConfirm:()=>W({isKurdish:!1},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد إزالة العلامة الكردية من كل هذه الأفلام؟",isLoading:E}),f&&e.jsx(ae,{title:h?"تعديل الفيلم":"إضافة فيلم جديد",onClose:H,isOpen:f,children:e.jsx(ye,{onSubmit:h?c=>N(h.id,c):w,initialData:h,onCancel:H,isKurdishByDefault:S==="kurdish"&&!h,isLoading:E,allGenres:u})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:te,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:G,onChange:c=>D(c.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-slate-900/50 rounded-lg flex-shrink-0",children:[e.jsx("button",{onClick:()=>A("all"),className:v("all"),children:"الكل"}),e.jsx("button",{onClick:()=>A("kurdish"),className:v("kurdish"),children:"كردي فقط"}),e.jsx("button",{onClick:()=>A("non-kurdish"),className:v("non-kurdish"),children:"غير كردي"})]})]}),C.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[C.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>j([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>d("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>d("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>d("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>d("markKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تحديد ككردي"}),e.jsx("button",{onClick:()=>d("unmarkKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"إلغاء تحديد ككردي"}),e.jsx("button",{onClick:()=>d("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:V,checked:M,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"مدبلج كردي"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:n.map(c=>{var k,B,X;return e.jsxs("tr",{className:`${C.includes(c.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:C.includes(c.id),onChange:()=>se(c.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:c.posterUrl,alt:c.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:c.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:c.imdbRating?c.imdbRating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:c.year}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(k=c.genres)==null?void 0:k.slice(0,3).map(Q=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:Q},Q)),((B=c.genres)==null?void 0:B.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:c.isKurdish?"نعم":"لا"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:(X=c.createdAt)!=null&&X.toDate?c.createdAt.toDate().toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>Y(c),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>q(c),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},c.id)})})]})}),R.length>re&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ce,{currentPage:r,totalPages:I,onPageChange:g})})]})]})},Ce=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ke=({onSubmit:p,initialData:s,onCancel:h,isLoading:i=!1,allGenres:f=[]})=>{const[l,r]=t.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],seasons:[{seasonNumber:1,title:"الموسم 1",description:"",posterUrl:"",year:new Date().getFullYear(),episodes:[{episodeNumber:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",downloadUrl:""}],imdbRating:0}],trailerUrl:"",imdbRating:0}),[g,S]=t.useState(""),[A,G]=t.useState(!1),D=t.useRef(null);t.useEffect(()=>{s&&(r({...s,genres:s.genres||[],tags:s.tags||[],seasons:s.seasons&&s.seasons.length>0?s.seasons:[{seasonNumber:1,title:"الموسم 1",description:"",posterUrl:s.posterUrl,year:s.year,episodes:[],imdbRating:0}],trailerUrl:s.trailerUrl||"",imdbRating:s.imdbRating||0}),S((s.tags||[]).join(", ")))},[s]),t.useEffect(()=>{const o=d=>{D.current&&!D.current.contains(d.target)&&G(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const T=o=>{const{name:d,value:u}=o.target;if(d==="year"||d==="imdbRating"){const y=parseFloat(u);r(x=>({...x,[d]:isNaN(y)?0:y}))}else r(y=>({...y,[d]:u}))},_=o=>{S(o.target.value)},K=o=>{r(d=>({...d,genres:d.genres.includes(o)?d.genres.filter(u=>u!==o):[...d.genres,o]}))},F=(o,d,u)=>{const y=[...l.seasons],x={...y[o]};if(d==="seasonNumber"||d==="year"||d==="imdbRating"){const w=typeof u=="string"?parseFloat(u):u;x[d]=isNaN(w)?0:w}else x[d]=u;y[o]=x,r(w=>({...w,seasons:y}))},O=()=>{const o=l.seasons.length>0?Math.max(...l.seasons.map(u=>u.seasonNumber))+1:1,d=l.seasons.length>0?l.seasons[l.seasons.length-1].year:l.year;r(u=>({...u,seasons:[...u.seasons,{seasonNumber:o,title:`الموسم ${o}`,description:"",posterUrl:u.posterUrl,year:d+1,episodes:[{episodeNumber:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",downloadUrl:""}],imdbRating:0}]}))},z=o=>{r(d=>({...d,seasons:d.seasons.filter((u,y)=>y!==o)}))},E=(o,d,u,y)=>{const x=[...l.seasons],w=[...x[o].episodes],N={...w[d]};if(u==="episodeNumber"){const q=typeof y=="string"?parseFloat(y):y;N[u]=isNaN(q)?0:q}else N[u]=y;w[d]=N,x[o]={...x[o],episodes:w},r(q=>({...q,seasons:x}))},U=o=>{const d=l.seasons[o],u=d.episodes.length>0?Math.max(...d.episodes.map(w=>w.episodeNumber))+1:1,y={episodeNumber:u,title:`الحلقة ${u}`,url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",downloadUrl:""},x=l.seasons.map((w,N)=>N===o?{...w,episodes:[...w.episodes,y]}:w);r(w=>({...w,seasons:x}))},P=(o,d)=>{const u=l.seasons.map((y,x)=>x===o?{...y,episodes:y.episodes.filter((w,N)=>N!==d)}:y);r(y=>({...y,seasons:u}))},L=o=>{o.preventDefault();const d=g.split(",").map(u=>u.trim()).filter(Boolean);p({...l,tags:d})},C="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",j="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white border-b border-slate-700 pb-2",children:"معلومات المسلسل الرئيسية"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:l.title,onChange:T,placeholder:"عنوان المسلسل",required:!0,className:C}),e.jsx("input",{type:"number",name:"year",value:l.year||"",onChange:T,placeholder:"سنة بداية العرض",required:!0,className:C})]}),e.jsx("textarea",{name:"description",value:l.description,onChange:T,placeholder:"وصف المسلسل العام",required:!0,className:`${C} h-24`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:l.posterUrl,onChange:T,placeholder:"رابط البوستر الرئيسي",required:!0,className:C}),e.jsx("input",{type:"url",name:"backdropUrl",value:l.backdropUrl,onChange:T,placeholder:"رابط صورة الخلفية",required:!0,className:C})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdbRating",value:l.imdbRating??"",onChange:T,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:C}),e.jsx("input",{type:"url",name:"trailerUrl",value:l.trailerUrl??"",onChange:T,placeholder:"رابط المقطع الدعائي (اختياري)",className:C})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات"}),e.jsxs("div",{className:"relative",ref:D,children:[e.jsx("button",{type:"button",onClick:()=>G(o=>!o),className:`${C} text-right`,children:l.genres.length>0?l.genres.join(", "):"اختر الفئات..."}),A&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:f.map(o=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.genres.includes(o),onChange:()=>K(o),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:o})]},o))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (مفصولة بفاصلة)"}),e.jsx("input",{type:"text",value:g,onChange:_,placeholder:"أكشن, إثارة...",className:C})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),l.seasons.map((o,d)=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-white font-semibold",children:"الموسم رقم:"}),e.jsx("input",{type:"number",value:o.seasonNumber||"",onChange:u=>F(d,"seasonNumber",u.target.value),className:`${j} w-20`})]}),e.jsx("button",{type:"button",onClick:()=>z(d),className:"bg-red-600 text-white px-3 py-1 rounded-md text-sm",children:"إزالة الموسم"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",value:o.title,onChange:u=>F(d,"title",u.target.value),placeholder:"عنوان الموسم",required:!0,className:j}),e.jsx("input",{type:"number",value:o.year||"",onChange:u=>F(d,"year",u.target.value),placeholder:"سنة الموسم",required:!0,className:j}),e.jsx("input",{type:"number",value:o.imdbRating??"",onChange:u=>F(d,"imdbRating",u.target.value),placeholder:"تقييم IMDb",step:"0.1",min:"0",max:"10",className:j}),e.jsx("input",{type:"url",value:o.posterUrl,onChange:u=>F(d,"posterUrl",u.target.value),placeholder:"رابط بوستر الموسم",required:!0,className:`${j} col-span-1 sm:col-span-3`}),e.jsx("textarea",{value:o.description,onChange:u=>F(d,"description",u.target.value),placeholder:"وصف الموسم",required:!0,className:`${j} h-20 col-span-1 sm:col-span-3`})]}),e.jsxs("div",{className:"space-y-2 pt-3 mt-3 border-t border-slate-600",children:[e.jsxs("h4",{className:"font-semibold text-slate-300",children:["حلقات الموسم ",o.seasonNumber,":"]}),o.episodes.map((u,y)=>e.jsxs("div",{className:"bg-slate-800/60 p-2 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:u.episodeNumber||"",onChange:x=>E(d,y,"episodeNumber",x.target.value),placeholder:"رقم",className:`${j} w-16`}),e.jsx("input",{type:"text",value:u.title,onChange:x=>E(d,y,"title",x.target.value),placeholder:"عنوان الحلقة",className:`${j} flex-1`}),e.jsx("button",{type:"button",onClick:()=>P(d,y),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600 text-xs",children:"X"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:u.url,onChange:x=>E(d,y,"url",x.target.value),placeholder:"رابط المشاهدة",required:!0,className:`${j} flex-1`}),e.jsx("input",{type:"url",value:u.downloadUrl||"",onChange:x=>E(d,y,"downloadUrl",x.target.value),placeholder:"رابط التحميل (اختياري)",className:`${j} flex-1`})]})]},y)),e.jsx("button",{type:"button",onClick:()=>U(d),className:"text-sm bg-slate-600 text-white py-1 px-3 rounded-md hover:bg-slate-500",children:"إضافة حلقة"})]})]},d)),e.jsx("button",{type:"button",onClick:O,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700",children:"إضافة موسم"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:h,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg",disabled:i,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg",disabled:i,children:[i&&e.jsx(Ce,{}),s?"تحديث المسلسل":"إضافة المسلسل"]})]})]})},le=10,Se=()=>{const[p,s]=t.useState([]),[h,i]=t.useState(null),[f,l]=t.useState(!1),[r,g]=t.useState(1),[S,A]=t.useState(""),[G,D]=t.useState(!1),[T,_]=t.useState(null),[K,F]=t.useState(!0),[O,z]=t.useState(!1),[E,U]=t.useState(null),[P,L]=t.useState([]),[C,j]=t.useState(null),[o,d]=t.useState([]);t.useEffect(()=>{F(!0);const n=$.collection("series").orderBy("createdAt","desc").onSnapshot(M=>{const c=M.docs.map(k=>({id:k.id,...k.data()}));s(c),F(!1)},M=>{console.error("Error fetching series: ",M),U({message:"فشل في تحميل المسلسلات.",type:"error"}),F(!1)}),v=$.collection("categories").orderBy("name").onSnapshot(M=>{const c=M.docs.map(k=>k.data().name);d(c)},M=>{console.error("Error fetching categories from ManageSeries: ",M)});return()=>{n(),v()}},[]),t.useEffect(()=>{g(1),L([])},[S]);const u=(n,v)=>{U({message:n,type:v})},y=async n=>{z(!0);try{await $.collection("series").add({...n,createdAt:me.now()}),l(!1),g(1),u("تمت إضافة المسلسل بنجاح.","success")}catch(v){console.error("Error adding series: ",v),u("حدث خطأ أثناء إضافة المسلسل.","error")}finally{z(!1)}},x=async(n,v)=>{z(!0);try{await $.collection("series").doc(n).update(v),i(null),l(!1),u("تم تحديث المسلسل بنجاح.","success")}catch(M){console.error("Error updating series: ",M),u("حدث خطأ أثناء تحديث المسلسل.","error")}finally{z(!1)}},w=n=>{_(n),D(!0)},N=async()=>{if(T){z(!0);try{await $.collection("series").doc(T.id).delete(),u("تم حذف المسلسل بنجاح.","success")}catch(n){console.error("Error deleting series: ",n),u("حدث خطأ أثناء حذف المسلسل.","error")}finally{D(!1),_(null),z(!1)}}},q=n=>{i(n),l(!0)},ee=()=>{i(null),l(!0)},Y=()=>{i(null),l(!1),j(null)},te=n=>{L(v=>v.includes(n)?v.filter(M=>M!==n):[...v,n])},H=n=>{n.target.checked?L(R.map(v=>v.id)):L([])},se=async()=>{z(!0);try{const n=$.batch();P.forEach(v=>{const M=$.collection("series").doc(v);n.delete(M)}),await n.commit(),u(`تم حذف ${P.length} مسلسل بنجاح.`,"success"),L([])}catch(n){console.error("Bulk delete failed:",n),u("فشل الحذف الجماعي.","error")}finally{z(!1),j(null)}},V=async(n,v)=>{const M={genres:v==="add"?J.arrayUnion(n):J.arrayRemove(n)};await a(M,`تم ${v==="add"?"إضافة":"إزالة"} فئة "${n}" بنجاح.`)},W=async(n,v)=>{const M={tags:v==="add"?J.arrayUnion(n):J.arrayRemove(n)};await a(M,`تم ${v==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${n}" بنجاح.`)},a=async(n,v)=>{z(!0);try{const M=$.batch();P.forEach(c=>{const k=$.collection("series").doc(c);M.update(k,n)}),await M.commit(),u(v,"success"),L([])}catch(M){console.error("Bulk update failed:",M),u("فشل التحديث الجماعي.","error")}finally{z(!1),j(null)}},m=p.filter(n=>ue(S,n.title)),b=Math.ceil(m.length/le),R=m.slice((r-1)*le,r*le),I=R.length>0&&P.length===R.length;return K?e.jsx(xe,{}):e.jsxs("div",{className:"relative",children:[E&&e.jsx(he,{...E,onClose:()=>U(null)}),e.jsx(Z,{isOpen:G,onClose:()=>D(!1),onConfirm:N,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',T==null?void 0:T.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:O}),C==="delete"&&e.jsx(Z,{isOpen:!0,onClose:()=>j(null),onConfirm:se,title:`تأكيد حذف ${P.length} مسلسل`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:O}),C==="genre"&&e.jsx(pe,{genres:o,onClose:Y,onSubmit:V,isLoading:O}),C==="tags"&&e.jsx(ge,{onClose:Y,onSubmit:W,isLoading:O}),f&&e.jsx(ae,{title:h?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:Y,isOpen:f,children:e.jsx(ke,{onSubmit:h?n=>x(h.id,n):y,initialData:h,onCancel:Y,isLoading:O,allGenres:o})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:ee,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsx("div",{className:"relative w-full sm:flex-grow",children:e.jsx("input",{type:"text",value:S,onChange:n=>A(n.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-4 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a series to edit"})})]}),P.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("span",{className:"text-white font-bold",children:[P.length," مسلسل محدد"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>j("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>j("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>j("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:H,checked:I})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:R.map(n=>{var v,M;return e.jsxs("tr",{className:`${P.includes(n.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"}`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:P.includes(n.id),onChange:()=>te(n.id)})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("img",{src:n.posterUrl,alt:n.title,className:"h-20 w-auto rounded"})}),e.jsx("td",{className:"px-4 py-2 font-medium text-white",children:n.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:n.imdbRating?n.imdbRating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:n.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:((v=n.seasons)==null?void 0:v.length)||0}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:(M=n.createdAt)!=null&&M.toDate?n.createdAt.toDate().toLocaleDateString("ar-EG"):"N/A"}),e.jsxs("td",{className:"px-4 py-2 font-medium",children:[e.jsx("button",{onClick:()=>q(n),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>w(n),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},n.id)})})]})}),m.length>le&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ce,{currentPage:r,totalPages:b,onPageChange:g})})]})]})},Ee=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsx("div",{className:"p-4 bg-gray-900",children:e.jsx("div",{className:"h-6 bg-gray-600 rounded w-1/3"})}),e.jsx("div",{className:"divide-y divide-gray-700",children:[...Array(5)].map((p,s)=>e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-600 rounded w-20"})]},s))})]}),Ue="yO8pzykKincc5zgbdJGdN6xISr03",ne=10,Ae=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Me=({message:p,type:s,onClose:h})=>(t.useEffect(()=>{const l=setTimeout(h,5e3);return()=>clearTimeout(l)},[h]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:p}),e.jsx("button",{onClick:h,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),$e=({children:p,onClose:s,title:h,isOpen:i})=>{const[f,l]=t.useState(i);return t.useEffect(()=>{if(i){l(!0),document.body.style.overflow="hidden";const r=g=>{g.key==="Escape"&&s()};return window.addEventListener("keydown",r),()=>{window.removeEventListener("keydown",r)}}else{const r=setTimeout(()=>{l(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(r)}},[i,s]),f?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${i?"animate-fade-in":"animate-fade-out"}`,onClick:s,children:e.jsxs("div",{className:`bg-slate-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-slate-700 ${i?"animate-zoom-in":"animate-zoom-out"}`,onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:h}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white text-3xl transition-colors",children:"×"})]}),p]})}):null},Re=()=>{const{currentUser:p}=be(),[s,h]=t.useState([]),[i,f]=t.useState(""),[l,r]=t.useState(""),[g,S]=t.useState(""),[A,G]=t.useState(!0),[D,T]=t.useState(!1),[_,K]=t.useState(1),[F,O]=t.useState(!1),[z,E]=t.useState(!1),[U,P]=t.useState(null),[L,C]=t.useState(null),j=(p==null?void 0:p.uid)===Ue;t.useEffect(()=>{if(!j){G(!1);return}G(!0);const N=$.collection("admins").onSnapshot(q=>{const ee=q.docs.map(Y=>({id:Y.id,uid:Y.data().uid,email:Y.data().email}));h(ee),G(!1)},q=>{console.error(q),o("فشل في تحميل قائمة المشرفين.","error"),G(!1)});return()=>N()},[j]);const o=(N,q)=>{C({message:N,type:q})},d=async N=>{if(N.preventDefault(),S(""),!i.trim()||!l.trim()){S("الرجاء إدخال UID وبريد إلكتروني صالحين.");return}T(!0);try{await $.collection("admins").doc(i).set({uid:i,email:l}),o(`تمت إضافة المشرف ${l} بنجاح.`,"success"),O(!1),f(""),r("")}catch(q){console.error("Error adding admin:",q),o("فشل في إضافة المشرف.","error")}finally{T(!1)}},u=N=>{P(N),E(!0)},y=async()=>{if(U){T(!0);try{await $.collection("admins").doc(U.id).delete(),o(`تم حذف المشرف ${U.email} بنجاح.`,"success")}catch(N){console.error(N),o("حدث خطأ أثناء حذف المشرف.","error")}finally{E(!1),P(null),T(!1)}}};if(!j)return e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"إدارة المشرفين"}),e.jsx("p",{className:"text-yellow-300",children:"هذه الصفحة متاحة فقط للمشرف الأساسي."})]});const x=Math.ceil(s.length/ne),w=s.slice((_-1)*ne,_*ne);return e.jsxs(e.Fragment,{children:[L&&e.jsx(Me,{...L,onClose:()=>C(null)}),e.jsx(Z,{isOpen:z,onClose:()=>E(!1),onConfirm:y,title:"تأكيد حذف المشرف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المشرف ",e.jsxs("strong",{className:"text-white",children:['"',U==null?void 0:U.email,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"سيؤدي هذا إلى إزالة صلاحيات المشرف الخاصة به."})]}),isLoading:D}),e.jsx($e,{isOpen:F,title:"إضافة مشرف جديد",onClose:()=>O(!1),children:e.jsxs("form",{onSubmit:d,className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"لإضافة مشرف جديد، يجب عليك الحصول على **معرّف المستخدم (UID)** الخاص به من لوحة تحكم Firebase Authentication."}),e.jsx("input",{type:"text",value:i,onChange:N=>f(N.target.value),placeholder:"معرّف المستخدم (UID)",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),e.jsx("input",{type:"email",value:l,onChange:N=>r(N.target.value),placeholder:"البريد الإلكتروني للمشرف",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),g&&e.jsx("p",{className:"text-red-500 text-center text-sm",children:g}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:()=>O(!1),className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:D,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:D,children:[D&&e.jsx(Ae,{}),D?"جاري الإضافة...":"إضافة مشرف"]})]})]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"المشرفون الحاليون"}),e.jsx("button",{onClick:()=>O(!0),className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة مشرف جديد"})]}),A?e.jsx(Ee,{}):e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-900/50 flex items-center justify-between",children:[e.jsxs("span",{className:"text-white font-bold",children:[p.email," (المشرف الأساسي)"]}),e.jsx("span",{className:"text-sm text-slate-500",children:"لا يمكن حذفه"})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:w.map(N=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-slate-700/50",children:[e.jsx("span",{className:"text-white",children:N.email}),e.jsx("button",{onClick:()=>u(N),className:"bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700 transition-colors",children:"حذف"})]},N.id))}),s.length>ne&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ce,{currentPage:_,totalPages:x,onPageChange:K})})]})]})]})},Te=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Fe=({onSubmit:p,initialData:s,onCancel:h,isLoading:i=!1})=>{const[f,l]=t.useState("");t.useEffect(()=>{l(s?s.name:"")},[s]);const r=g=>{g.preventDefault(),f.trim()&&p({name:f})};return e.jsxs("form",{onSubmit:r,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:f,onChange:g=>l(g.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:h,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:i,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:i,children:[i&&e.jsx(Te,{}),i?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث":"إضافة"]})]})]})},Be=10,ze=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(Be)].map((p,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},s))})]})})}),oe=10,Pe=({message:p,type:s,onClose:h})=>(t.useEffect(()=>{const l=setTimeout(h,5e3);return()=>clearTimeout(l)},[h]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:p}),e.jsx("button",{onClick:h,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),qe=({children:p,onClose:s,title:h,isOpen:i})=>{const[f,l]=t.useState(i);return t.useEffect(()=>{if(i){l(!0),document.body.style.overflow="hidden";const r=g=>{g.key==="Escape"&&s()};return window.addEventListener("keydown",r),()=>{window.removeEventListener("keydown",r)}}else{const r=setTimeout(()=>{l(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(r)}},[i,s]),f?e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 ${i?"animate-fade-in":"animate-fade-out"}`,onClick:s,children:e.jsxs("div",{className:`bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700 ${i?"animate-zoom-in":"animate-zoom-out"}`,onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:h}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),p]})}):null},Ge=()=>{const[p,s]=t.useState([]),[h,i]=t.useState(null),[f,l]=t.useState(!1),[r,g]=t.useState(1),[S,A]=t.useState(!1),[G,D]=t.useState(null),[T,_]=t.useState(!0),[K,F]=t.useState(!1),[O,z]=t.useState(null);t.useEffect(()=>{_(!0);const x=$.collection("categories").orderBy("name").onSnapshot(w=>{const N=w.docs.map(q=>({id:q.id,...q.data()}));s(N),_(!1)},w=>{console.error("Error fetching categories: ",w),E("فشل في تحميل الفئات.","error"),_(!1)});return()=>x()},[]);const E=(x,w)=>{z({message:x,type:w})},U=async x=>{F(!0);try{await $.collection("categories").add(x),E("تمت إضافة الفئة بنجاح!","success"),l(!1),g(1)}catch(w){console.error("Error adding category: ",w),E("حدث خطأ أثناء إضافة الفئة.","error")}finally{F(!1)}},P=async(x,w)=>{F(!0);try{await $.collection("categories").doc(x).update(w),E("تم تحديث الفئة بنجاح!","success"),i(null),l(!1)}catch(N){console.error("Error updating category: ",N),E("حدث خطأ أثناء تحديث الفئة.","error")}finally{F(!1)}},L=x=>{D(x),A(!0)},C=async()=>{if(G){F(!0);try{await $.collection("categories").doc(G.id).delete(),E("تم حذف الفئة بنجاح!","success")}catch(x){console.error("Error deleting category: ",x),E("حدث خطأ أثناء حذف الفئة.","error")}finally{A(!1),D(null),F(!1)}}},j=x=>{i(x),l(!0)},o=()=>{i(null),l(!0)},d=()=>{i(null),l(!1)},u=Math.ceil(p.length/oe),y=p.slice((r-1)*oe,r*oe);return T?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(ze,{})]}):e.jsxs("div",{children:[O&&e.jsx(Pe,{...O,onClose:()=>z(null)}),e.jsx(Z,{isOpen:S,onClose:()=>A(!1),onConfirm:C,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',G==null?void 0:G.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:K}),e.jsx(qe,{isOpen:f,title:h?"تعديل الفئة":"إضافة فئة جديدة",onClose:d,children:e.jsx(Fe,{onSubmit:h?x=>P(h.id,x):U,initialData:h,onCancel:d,isLoading:K})}),e.jsx("button",{onClick:o,className:"mb-6 bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:p.length>0?y.map(x=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:x.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>j(x),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>L(x),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},x.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})}),p.length>oe&&e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx(ce,{currentPage:r,totalPages:u,onPageChange:g})})]})]})},ie=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(ve,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx(Se,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(Ge,{})},{key:"admins",label:"إدارة المشرفين",component:e.jsx(Re,{})}],De=({label:p,tabKey:s,activeTab:h,onClick:i})=>e.jsx("button",{onClick:()=>i(s),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px ${h===s?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":h===s,children:p}),_e=()=>{var i;const[p,s]=t.useState(ie[0].key),h=(i=ie.find(f=>f.key===p))==null?void 0:i.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8 animate-fade-in",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6",role:"tablist",children:ie.map(f=>e.jsx(De,{label:f.label,tabKey:f.key,activeTab:p,onClick:s},f.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-6 rounded-lg border border-slate-700",children:h})]})};export{_e as default};
