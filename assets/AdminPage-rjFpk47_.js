import{r as t,d as F,j as e,f as he,F as Z,T as xe,u as je}from"./index-SB9iHKDM.js";const we=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ve=({onSubmit:x,initialData:s,onCancel:n,isKurdishByDefault:a=!1,isLoading:b=!1,allGenres:o=[]})=>{const[d,y]=t.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:!1}),[C,w]=t.useState(""),[M,q]=t.useState(!1),[I,P]=t.useState(""),[R,O]=t.useState(""),[z,T]=t.useState(!1),A=t.useRef(null),[B,G]=t.useState(!1),[$,S]=t.useState(""),i=t.useRef(null);t.useEffect(()=>{s?(y({...s,genres:s.genres||[],tags:s.tags||[],servers:s.servers&&s.servers.length>0?s.servers:[{name:"Server 1",url:"",quality:"720p"}],backupServers:s.backupServers||[],trailerUrl:s.trailerUrl||"",isKurdish:s.isKurdish||!1}),w((s.tags||[]).join(", "))):(y({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:a}),w(""))},[s,a]),t.useEffect(()=>{const r=g=>{A.current&&!A.current.contains(g.target)&&q(!1)};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[]),t.useEffect(()=>{i.current&&clearTimeout(i.current);const r=d.title.trim();if(!r||s&&r===s.title.trim()){S(""),G(!1);return}return G(!0),S(""),i.current=window.setTimeout(async()=>{try{const g=await F.collection("movies").where("title","==",r).get();let j=!1;g.empty||(s?g.forEach(L=>{L.id!==s.id&&(j=!0)}):j=!0),S(j?"تحذير: فيلم بنفس هذا العنوان موجود بالفعل.":"")}catch(g){console.error("Error checking for duplicate title:",g)}finally{G(!1)}},500),()=>{i.current&&clearTimeout(i.current)}},[d.title,s]);const c=r=>{const{name:g,value:j,type:L}=r.target;if(L==="checkbox"){const{checked:K}=r.target;y(te=>({...te,[g]:K}))}else y(K=>({...K,[g]:g==="year"?parseInt(j):j}))},p=r=>{w(r.target.value)},u=r=>{y(g=>{const j=g.genres||[],L=j.includes(r)?j.filter(K=>K!==r):[...j,r];return{...g,genres:L}})},N=async()=>{const r=R.trim();if(r){if(o.some(g=>g.toLowerCase()===r.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}T(!0);try{await F.collection("categories").add({name:r}),y(g=>({...g,genres:[...g.genres||[],r]})),O("")}catch(g){console.error("Error adding new genre:",g),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{T(!1)}}},h=(r,g,j)=>{const L=[...d.servers];L[r]={...L[r],[g]:j},y(K=>({...K,servers:L}))},v=()=>{y(r=>{const g={name:`Server ${r.servers.length+1}`,url:"",quality:"720p"};return{...r,servers:[...r.servers,g]}})},f=r=>{y(g=>({...g,servers:g.servers.filter((j,L)=>L!==r)}))},D=(r,g,j)=>{const L=[...d.backupServers||[]];L[r]={...L[r],[g]:j},y(K=>({...K,backupServers:L}))},H=()=>{y(r=>{var g;return{...r,backupServers:[...r.backupServers||[],{name:`Backup Server ${(((g=r.backupServers)==null?void 0:g.length)||0)+1}`,url:"",quality:"720p"}]}})},W=r=>{y(g=>({...g,backupServers:(g.backupServers||[]).filter((j,L)=>L!==r)}))},se=r=>{if(r.preventDefault(),d.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const g=C.split(",").map(j=>j.trim()).filter(j=>j!=="");x({...d,tags:g})},Y=o.filter(r=>r.toLowerCase().includes(I.toLowerCase())),V="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",Q="bg-slate-600 text-white p-2 rounded-md border-2 border-slate-500 focus:border-cyan-500 outline-none focus:ring-2 focus:ring-cyan-500 transition";return e.jsxs("form",{onSubmit:se,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",name:"title",value:d.title,onChange:c,placeholder:"عنوان الفيلم",required:!0,className:V}),B&&e.jsx("p",{className:"text-xs text-slate-400 mt-1 animate-pulse",children:"جاري التحقق من العنوان..."}),$&&e.jsxs("p",{className:"text-sm text-yellow-400 mt-2 font-semibold flex items-center gap-2 animate-fade-in",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.636-1.21 2.37-1.21 3.006 0l5.485 10.47c.616 1.176-.24 2.62-1.503 2.62H4.275c-1.263 0-2.118-1.444-1.503-2.62l5.485-10.47zM9 9a1 1 0 011-1h0a1 1 0 011 1v3a1 1 0 01-2 0V9zm1 6a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),$]})]}),e.jsx("input",{type:"number",name:"year",value:d.year,onChange:c,placeholder:"سنة الإنتاج",required:!0,className:V})]}),e.jsx("textarea",{name:"description",value:d.description,onChange:c,placeholder:"وصف الفيلم",required:!0,className:`${V} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:d.posterUrl,onChange:c,placeholder:"رابط صورة البوستر",required:!0,className:V}),e.jsx("input",{type:"url",name:"backdropUrl",value:d.backdropUrl,onChange:c,placeholder:"رابط صورة الخلفية",required:!0,className:V})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:C,onChange:p,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:V})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"isKurdish",type:"checkbox",name:"isKurdish",checked:!!d.isKurdish,onChange:c,className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("label",{htmlFor:"isKurdish",className:"text-white cursor-pointer",children:"هذا الفيلم مدبلج للكردية"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:A,children:[e.jsxs("button",{type:"button",onClick:()=>q(r=>!r),className:`${V} text-right flex justify-between items-center min-h-[52px]`,"aria-haspopup":"true","aria-expanded":M,children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:d.genres.length>0?d.genres.map(r=>e.jsxs("span",{className:"bg-cyan-500 text-white text-xs font-semibold px-2 py-1 rounded-full flex items-center gap-1",children:[r,e.jsx("button",{type:"button",onClick:g=>{g.stopPropagation(),u(r)},className:"text-cyan-100 hover:text-white leading-none text-lg","aria-label":`إزالة ${r}`,children:"×"})]},r)):e.jsx("span",{className:"text-slate-400 px-1",children:"اختر الفئات..."})}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 text-slate-400 transition-transform ${M?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),M&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg animate-fade-in-up-fast",children:[e.jsx("div",{className:"p-2",children:e.jsx("input",{type:"text",placeholder:"ابحث عن فئة...",value:I,onChange:r=>P(r.target.value),className:"w-full bg-slate-800 text-white p-2 rounded-md focus:ring-2 focus:ring-cyan-500 border border-slate-600 outline-none",autoFocus:!0})}),e.jsx("ul",{className:"max-h-60 overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",children:Y.length>0?Y.map(r=>e.jsx("li",{children:e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-slate-700 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:d.genres.includes(r),onChange:()=>u(r),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("span",{className:"text-white select-none",children:r})]})},r)):e.jsx("li",{className:"text-slate-400 text-center p-4",children:"لا توجد نتائج"})}),e.jsx("div",{className:"border-t border-slate-700 p-2 mt-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"أو أضف فئة جديدة...",value:R,onChange:r=>O(r.target.value),onKeyDown:r=>{r.key==="Enter"&&(r.preventDefault(),N())},className:"flex-grow bg-slate-800 text-white p-2 text-sm rounded-md focus:ring-2 focus:ring-cyan-500 border border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:N,disabled:z||!R.trim(),className:"flex-shrink-0 bg-cyan-600 text-white px-3 py-1.5 text-sm font-bold rounded-md hover:bg-cyan-700 transition-colors disabled:bg-slate-500 disabled:cursor-not-allowed",children:z?"...":"إضافة"})]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"downloadUrl",value:d.downloadUrl??"",onChange:c,placeholder:"رابط التحميل (اختياري)",className:V}),e.jsx("input",{type:"url",name:"trailerUrl",value:d.trailerUrl??"",onChange:c,placeholder:"رابط المقطع الدعائي (اختياري)",className:V})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات المشاهدة"}),d.servers.map((r,g)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-slate-700/50 rounded-md",children:[e.jsx("input",{type:"text",value:r.name,onChange:j=>h(g,"name",j.target.value),placeholder:"اسم السيرفر",className:`${Q} flex-1`}),e.jsx("input",{type:"url",value:r.url,onChange:j=>h(g,"url",j.target.value),placeholder:"رابط السيرفر",required:!0,className:`${Q} flex-grow-[2]`}),e.jsxs("select",{value:r.quality,onChange:j=>h(g,"quality",j.target.value),className:`${Q} flex-1 cursor-pointer`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>f(g),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},g)),e.jsx("button",{type:"button",onClick:v,className:"mt-2 bg-slate-600 text-white py-2 px-4 rounded-md hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات احتياطية (اختياري)"}),(d.backupServers||[]).map((r,g)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-slate-700/50 rounded-md",children:[e.jsx("input",{type:"text",value:r.name,onChange:j=>D(g,"name",j.target.value),placeholder:"اسم السيرفر الاحتياطي",className:`${Q} flex-1`}),e.jsx("input",{type:"url",value:r.url,onChange:j=>D(g,"url",j.target.value),placeholder:"رابط السيرفر الاحتياطي",className:`${Q} flex-grow-[2]`}),e.jsxs("select",{value:r.quality,onChange:j=>D(g,"quality",j.target.value),className:`${Q} flex-1 cursor-pointer`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>W(g),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},g)),e.jsx("button",{type:"button",onClick:H,className:"mt-2 bg-slate-600 text-white py-2 px-4 rounded-md hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:n,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:b,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:b||!!$,children:[b&&e.jsx(we,{}),b?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث":"إضافة"]})]})]})},ce=({currentPage:x,totalPages:s,onPageChange:n})=>{if(s<=1)return null;const b=(()=>{if(s>7){const C=Math.max(2,x-1),w=Math.min(s-1,x+1);let M=[1];C>2&&M.push("...");for(let q=C;q<=w;q++)M.push(q);return w<s-1&&M.push("..."),M.push(s),M}return Array.from({length:s},(C,w)=>w+1)})();return e.jsxs("nav",{"aria-label":"Page navigation",className:"flex items-center justify-between sm:justify-center mt-4 sm:gap-4",children:[e.jsx("button",{onClick:()=>n(x-1),disabled:x===1,className:"px-4 py-2 bg-slate-700 text-white rounded-md disabled:bg-slate-800 disabled:text-slate-500 disabled:cursor-not-allowed hover:bg-slate-600 transition-colors",children:"السابق"}),e.jsx("div",{className:"hidden sm:flex items-center gap-2 flex-wrap justify-center",children:b.map((o,d)=>typeof o=="string"?e.jsx("span",{className:"px-2 py-2 text-slate-400 select-none",children:"..."},`${o}-${d}`):e.jsx("button",{onClick:()=>n(o),className:`w-10 h-10 rounded-md transition-colors text-sm font-bold flex items-center justify-center ${x===o?"bg-cyan-500 text-white":"bg-slate-700 text-white hover:bg-slate-600"}`,"aria-current":x===o?"page":void 0,children:o},o))}),e.jsxs("div",{className:"sm:hidden text-slate-300 font-medium",children:["صفحة ",x," / ",s]}),e.jsx("button",{onClick:()=>n(x+1),disabled:x===s,className:"px-4 py-2 bg-slate-700 text-white rounded-md disabled:bg-slate-800 disabled:text-slate-500 disabled:cursor-not-allowed hover:bg-slate-600 transition-colors",children:"التالي"})]})},Ne=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ee=({isOpen:x,onClose:s,onConfirm:n,title:a,message:b,isLoading:o=!1})=>x?e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4",onClick:s,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md animate-zoom-in border border-slate-700",onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:a}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:b})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:n,disabled:o,children:[o&&e.jsx(Ne,{}),o?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:s,disabled:o,children:"إلغاء"})]})]})}):null,Ce=10,pe=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((x,s)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},s))})}),e.jsx("tbody",{children:[...Array(Ce)].map((x,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((n,a)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},a))]},s))})]})})]}),ge=({message:x,type:s,onClose:n})=>(t.useEffect(()=>{const o=setTimeout(n,5e3);return()=>clearTimeout(o)},[n]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:x}),e.jsx("button",{onClick:n,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),ae=({children:x,onClose:s,title:n})=>(t.useEffect(()=>{const a=b=>{b.key==="Escape"&&s()};return window.addEventListener("keydown",a),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",a),document.body.style.overflow="auto"}},[s]),e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4",onClick:s,children:e.jsx("div",{className:"relative bg-slate-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] animate-zoom-in border border-slate-700",onClick:a=>a.stopPropagation(),children:e.jsxs("div",{className:"p-6 md:p-8 overflow-y-auto max-h-[90vh] scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:n}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white text-3xl transition-colors",children:"×"})]}),x]})})})),ue=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),be=({genres:x,onSubmit:s,onClose:n,isLoading:a})=>{const[b,o]=t.useState(x[0]||""),[d,y]=t.useState("add"),C=w=>{w.preventDefault(),b&&s(b,d)};return e.jsx(ae,{title:"تغيير الفئة بشكل جماعي",onClose:n,children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:b,onChange:w=>o(w.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:x.map(w=>e.jsx("option",{value:w,children:w},w))}),e.jsxs("select",{value:d,onChange:w=>y(w.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:n,disabled:a,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:a||!b,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[a&&e.jsx(ue,{}),a?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},fe=({onSubmit:x,onClose:s,isLoading:n})=>{const[a,b]=t.useState(new Date().getFullYear()),o=d=>{d.preventDefault(),x(a)};return e.jsx(ae,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:s,children:e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:a,onChange:d=>b(parseInt(d.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:n,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:n,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[n&&e.jsx(ue,{}),n?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},ye=({onSubmit:x,onClose:s,isLoading:n})=>{const[a,b]=t.useState(""),[o,d]=t.useState("add"),y=C=>{C.preventDefault(),a.trim()&&x(a.trim(),o)};return e.jsx(ae,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:s,children:e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:a,onChange:C=>b(C.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:o,onChange:C=>d(C.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:n,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:n||!a.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[n&&e.jsx(ue,{}),n?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},le=10,ke=()=>{const[x,s]=t.useState([]),[n,a]=t.useState(null),[b,o]=t.useState(!1),[d,y]=t.useState(1),[C,w]=t.useState("all"),[M,q]=t.useState(""),[I,P]=t.useState(!1),[R,O]=t.useState(null),[z,T]=t.useState(!0),[A,B]=t.useState(!1),[G,$]=t.useState(null),[S,i]=t.useState([]),[c,p]=t.useState(null),[u,N]=t.useState([]);t.useEffect(()=>{T(!0);const l=F.collection("movies").orderBy("createdAt","desc").onSnapshot(_=>{const X=_.docs.map(J=>({id:J.id,...J.data()}));s(X),T(!1)},_=>{console.error("Error fetching movies: ",_),$({message:"فشل في تحميل الأفلام.",type:"error"}),T(!1)}),k=F.collection("categories").orderBy("name").onSnapshot(_=>{const X=_.docs.map(J=>J.data().name);N(X)},_=>{console.error("Error fetching categories from ManageMovies: ",_)});return()=>{l(),k()}},[]),t.useEffect(()=>{y(1),i([])},[C,M]);const h=(l,k)=>{$({message:l,type:k})},v=async l=>{B(!0);try{await F.collection("movies").add({...l,createdAt:xe.now()}),o(!1),y(1),h("تمت إضافة الفيلم بنجاح.","success")}catch(k){console.error("Error adding movie: ",k),h("حدث خطأ أثناء إضافة الفيلم.","error")}finally{B(!1)}},f=async(l,k)=>{B(!0);try{await F.collection("movies").doc(l).update(k),a(null),o(!1),h("تم تحديث الفيلم بنجاح.","success")}catch(_){console.error("Error updating movie: ",_),h("حدث خطأ أثناء تحديث الفيلم.","error")}finally{B(!1)}},D=l=>{O(l),P(!0)},H=async()=>{if(R){B(!0);try{await F.collection("movies").doc(R.id).delete(),h("تم حذف الفيلم بنجاح.","success")}catch(l){console.error("Error deleting movie: ",l),h("حدث خطأ أثناء حذف الفيلم.","error")}finally{P(!1),O(null),B(!1)}}},W=l=>{a(l),o(!0)},se=()=>{a(null),o(!0)},Y=()=>{a(null),o(!1),p(null)},V=l=>{i(k=>k.includes(l)?k.filter(_=>_!==l):[...k,l])},Q=l=>{l.target.checked?i(m.map(k=>k.id)):i([])},r=async(l,k)=>{B(!0);try{const _=F.batch();S.forEach(X=>{const J=F.collection("movies").doc(X);_.update(J,l)}),await _.commit(),h(k,"success"),i([])}catch(_){console.error("Bulk update failed:",_),h("فشل التحديث الجماعي.","error")}finally{B(!1),p(null)}},g=async()=>{B(!0);try{const l=F.batch();S.forEach(k=>{const _=F.collection("movies").doc(k);l.delete(_)}),await l.commit(),h(`تم حذف ${S.length} فيلم بنجاح.`,"success"),i([])}catch(l){console.error("Bulk delete failed:",l),h("فشل الحذف الجماعي.","error")}finally{B(!1),p(null)}},j=async(l,k)=>{const _={genres:k==="add"?Z.arrayUnion(l):Z.arrayRemove(l)};await r(_,`تم ${k==="add"?"إضافة":"إزالة"} فئة "${l}" بنجاح.`)},L=async(l,k)=>{const _={tags:k==="add"?Z.arrayUnion(l):Z.arrayRemove(l)};await r(_,`تم ${k==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${l}" بنجاح.`)},K=x.filter(l=>C==="kurdish"?l.isKurdish===!0:C==="non-kurdish"?!l.isKurdish:!0).filter(l=>he(M,l.title)),te=Math.ceil(K.length/le),m=K.slice((d-1)*le,d*le),E=l=>`px-4 py-2 text-sm font-bold rounded-lg transition-colors duration-200 ${C===l?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-md":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,U=m.length>0&&S.length===m.length;return z?e.jsx(pe,{}):e.jsxs("div",{className:"relative",children:[G&&e.jsx(ge,{...G,onClose:()=>$(null)}),e.jsx(ee,{isOpen:I,onClose:()=>P(!1),onConfirm:H,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',R==null?void 0:R.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:A}),c==="delete"&&e.jsx(ee,{isOpen:!0,onClose:()=>p(null),onConfirm:g,title:`تأكيد حذف ${S.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:A}),c==="genre"&&e.jsx(be,{genres:u,onClose:Y,onSubmit:j,isLoading:A}),c==="tags"&&e.jsx(ye,{onClose:Y,onSubmit:L,isLoading:A}),c==="year"&&e.jsx(fe,{onClose:Y,onSubmit:l=>r({year:l},"تم تحديث السنة بنجاح."),isLoading:A}),c==="markKurdish"&&e.jsx(ee,{isOpen:!0,onClose:Y,onConfirm:()=>r({isKurdish:!0},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد تحديد كل هذه الأفلام على أنها كردية؟",isLoading:A}),c==="unmarkKurdish"&&e.jsx(ee,{isOpen:!0,onClose:Y,onConfirm:()=>r({isKurdish:!1},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد إزالة العلامة الكردية من كل هذه الأفلام؟",isLoading:A}),b&&e.jsx(ae,{title:n?"تعديل الفيلم":"إضافة فيلم جديد",onClose:Y,children:e.jsx(ve,{onSubmit:n?l=>f(n.id,l):v,initialData:n,onCancel:Y,isKurdishByDefault:C==="kurdish"&&!n,isLoading:A,allGenres:u})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:se,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:M,onChange:l=>q(l.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-slate-900/50 rounded-lg flex-shrink-0",children:[e.jsx("button",{onClick:()=>w("all"),className:E("all"),children:"الكل"}),e.jsx("button",{onClick:()=>w("kurdish"),className:E("kurdish"),children:"كردي فقط"}),e.jsx("button",{onClick:()=>w("non-kurdish"),className:E("non-kurdish"),children:"غير كردي"})]})]}),S.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[S.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>i([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>p("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>p("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>p("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>p("markKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تحديد ككردي"}),e.jsx("button",{onClick:()=>p("unmarkKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"إلغاء تحديد ككردي"}),e.jsx("button",{onClick:()=>p("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:Q,checked:U,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الكلمات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"مدبلج كردي"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:m.map(l=>{var k,_,X,J,me;return e.jsxs("tr",{className:`${S.includes(l.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:S.includes(l.id),onChange:()=>V(l.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:l.posterUrl,alt:l.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:l.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:l.year}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(k=l.genres)==null?void 0:k.slice(0,3).map(re=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:re},re)),((_=l.genres)==null?void 0:_.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(X=l.tags)==null?void 0:X.slice(0,3).map(re=>e.jsx("span",{className:"bg-slate-600 text-cyan-200 px-2 py-1 text-xs rounded-full",children:re},re)),((J=l.tags)==null?void 0:J.length)>3&&e.jsx("span",{className:"bg-slate-600 text-cyan-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:l.isKurdish?"نعم":"لا"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:(me=l.createdAt)!=null&&me.toDate?l.createdAt.toDate().toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>W(l),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>D(l),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},l.id)})})]})}),K.length>le&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ce,{currentPage:d,totalPages:te,onPageChange:y})})]})]})},Se=({onSubmit:x,initialData:s,onCancel:n,isLoading:a=!1,allGenres:b=[]})=>{const[o,d]=t.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],trailerUrl:"",seasons:[{seasonNumber:1,episodes:[],_clientId:`s-${Date.now()}`}]}),[y,C]=t.useState("");t.useEffect(()=>{if(s){const i=(s.seasons||[]).map((c,p)=>({...c,_clientId:c._clientId||`s-${Date.now()}-${p}`}));d({...s,genres:s.genres||[],tags:s.tags||[],seasons:i.length>0?i:[{seasonNumber:1,episodes:[],_clientId:`s-${Date.now()}`}]}),C((s.tags||[]).join(", "))}else d({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],trailerUrl:"",seasons:[{seasonNumber:1,episodes:[],_clientId:`s-${Date.now()}`}]}),C("")},[s]);const w=i=>{const{name:c,value:p}=i.target;d(u=>({...u,[c]:c==="year"?parseInt(p):p}))},M=i=>C(i.target.value),q=i=>{const c=Array.from(i.target.selectedOptions,p=>p.value);d(p=>({...p,genres:c}))},I=()=>{d(i=>({...i,seasons:[...i.seasons,{seasonNumber:i.seasons.length+1,episodes:[],_clientId:`s-${Date.now()}`}]}))},P=(i,c)=>{confirm(`هل أنت متأكد من حذف الموسم ${c+1}؟`)&&d(p=>({...p,seasons:p.seasons.filter(u=>u._clientId!==i)}))},R=i=>{d(c=>({...c,seasons:c.seasons.map((p,u)=>{if(u!==i)return p;const N={episodeNumber:p.episodes.length+1,title:`الحلقة ${p.episodes.length+1}`,servers:[{name:"Server 1",url:"",quality:"720p"}],downloadUrl:""};return{...p,episodes:[...p.episodes,N]}})}))},O=(i,c)=>{d(p=>({...p,seasons:p.seasons.map((u,N)=>N!==i?u:{...u,episodes:u.episodes.filter((h,v)=>v!==c)})}))},z=(i,c,p,u)=>{d(N=>({...N,seasons:N.seasons.map((h,v)=>v!==i?h:{...h,episodes:h.episodes.map((f,D)=>D!==c?f:p==="episodeNumber"&&typeof u=="number"?{...f,episodeNumber:u}:p==="title"&&typeof u=="string"?{...f,title:u}:p==="downloadUrl"&&typeof u=="string"?{...f,downloadUrl:u}:f)})}))},T=(i,c,p,u,N)=>{d(h=>({...h,seasons:h.seasons.map((v,f)=>f!==i?v:{...v,episodes:v.episodes.map((D,H)=>H!==c?D:{...D,servers:D.servers.map((W,se)=>se!==p?W:{...W,[u]:N})})})}))},A=(i,c)=>{d(p=>({...p,seasons:p.seasons.map((u,N)=>N!==i?u:{...u,episodes:u.episodes.map((h,v)=>{if(v!==c)return h;const f={name:`Server ${h.servers.length+1}`,url:"",quality:"720p"};return{...h,servers:[...h.servers,f]}})})}))},B=(i,c,p)=>{d(u=>({...u,seasons:u.seasons.map((N,h)=>h!==i?N:{...N,episodes:N.episodes.map((v,f)=>f!==c?v:{...v,servers:v.servers.filter((D,H)=>H!==p)})})}))},G=i=>{i.preventDefault();const c=y.split(",").map(u=>u.trim()).filter(Boolean),p=JSON.parse(JSON.stringify(o));p.seasons.forEach(u=>delete u._clientId),x({...p,tags:c})},$="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",S="bg-slate-600 text-white p-2 rounded-md border-2 border-slate-500 focus:border-cyan-500 outline-none focus:ring-2 focus:ring-cyan-500 transition";return e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:o.title,onChange:w,placeholder:"عنوان المسلسل",required:!0,className:$}),e.jsx("input",{type:"number",name:"year",value:o.year,onChange:w,placeholder:"سنة الإنتاج",required:!0,className:$})]}),e.jsx("textarea",{name:"description",value:o.description,onChange:w,placeholder:"وصف المسلسل",required:!0,className:`${$} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:o.posterUrl,onChange:w,placeholder:"رابط صورة البوستر",required:!0,className:$}),e.jsx("input",{type:"url",name:"backdropUrl",value:o.backdropUrl,onChange:w,placeholder:"رابط صورة الخلفية",required:!0,className:$})]}),e.jsx("input",{type:"url",name:"trailerUrl",value:o.trailerUrl??"",onChange:w,placeholder:"رابط المقطع الدعائي (اختياري)",className:$}),e.jsx("input",{type:"text",name:"tags",value:y,onChange:M,placeholder:"Tags (مفصولة بفاصلة)",className:$}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white mb-2",children:"الفئات"}),e.jsx("select",{multiple:!0,value:o.genres,onChange:q,className:`${$} h-32`,children:b.map(i=>e.jsx("option",{value:i,children:i},i))})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),o.seasons.map((i,c)=>e.jsxs("div",{className:"p-4 bg-slate-700/50 rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h4",{className:"text-lg font-semibold text-cyan-400",children:["الموسم ",c+1]}),e.jsx("button",{type:"button",onClick:()=>P(i._clientId,c),className:"text-red-500 hover:text-red-400",children:"حذف الموسم"})]}),i.episodes.map((p,u)=>e.jsxs("div",{className:"p-3 bg-slate-900/50 rounded-md space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:p.episodeNumber,onChange:N=>z(c,u,"episodeNumber",parseInt(N.target.value)),placeholder:"رقم الحلقة",className:S}),e.jsx("input",{type:"text",value:p.title,onChange:N=>z(c,u,"title",N.target.value),placeholder:"عنوان الحلقة",className:`${S} flex-grow`}),e.jsx("button",{type:"button",onClick:()=>O(c,u),className:"text-red-500 text-sm",children:"حذف"})]}),e.jsx("div",{className:"pl-4",children:e.jsx("input",{type:"url",value:p.downloadUrl||"",onChange:N=>z(c,u,"downloadUrl",N.target.value),placeholder:"رابط تحميل الحلقة (اختياري)",className:`${S} w-full`})}),p.servers.map((N,h)=>e.jsxs("div",{className:"flex items-center gap-2 pl-4",children:[e.jsx("input",{type:"text",value:N.name,onChange:v=>T(c,u,h,"name",v.target.value),placeholder:"اسم السيرفر",className:`${S} flex-1`}),e.jsx("input",{type:"url",value:N.url,onChange:v=>T(c,u,h,"url",v.target.value),placeholder:"رابط السيرفر",required:!0,className:`${S} flex-grow-[2]`}),e.jsxs("select",{value:N.quality,onChange:v=>T(c,u,h,"quality",v.target.value),className:`${S} flex-1`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>B(c,u,h),className:"bg-red-500 text-white p-1 rounded-md text-xs",children:"X"})]},h)),e.jsx("button",{type:"button",onClick:()=>A(c,u),className:"text-xs bg-slate-600 hover:bg-slate-500 text-white py-1 px-2 rounded-md ml-4",children:"إضافة سيرفر"})]},u)),e.jsx("button",{type:"button",onClick:()=>R(c),className:"bg-cyan-600 hover:bg-cyan-700 text-white py-2 px-4 rounded-md",children:"إضافة حلقة"})]},i._clientId||c)),e.jsx("button",{type:"button",onClick:I,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg",children:"إضافة موسم جديد"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:n,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500",disabled:a,children:"إلغاء"}),e.jsx("button",{type:"submit",className:"bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600",disabled:a,children:a?"جاري الحفظ...":s?"تحديث المسلسل":"إضافة المسلسل"})]})]})},ne=10,Ee=()=>{const[x,s]=t.useState([]),[n,a]=t.useState(null),[b,o]=t.useState(!1),[d,y]=t.useState(1),[C,w]=t.useState(""),[M,q]=t.useState(!1),[I,P]=t.useState(null),[R,O]=t.useState(!0),[z,T]=t.useState(!1),[A,B]=t.useState(null),[G,$]=t.useState([]),[S,i]=t.useState(null),[c,p]=t.useState([]);t.useEffect(()=>{O(!0);const m=F.collection("series").orderBy("createdAt","desc").onSnapshot(U=>{const l=U.docs.map(k=>({id:k.id,...k.data()}));s(l),O(!1)},U=>{console.error("Error fetching series: ",U),B({message:"فشل في تحميل المسلسلات.",type:"error"}),O(!1)}),E=F.collection("categories").orderBy("name").onSnapshot(U=>{const l=U.docs.map(k=>k.data().name);p(l)},U=>{console.error("Error fetching categories from ManageSeries: ",U)});return()=>{m(),E()}},[]),t.useEffect(()=>{y(1),$([])},[C]);const u=(m,E)=>{B({message:m,type:E})},N=async m=>{T(!0);try{await F.collection("series").add({...m,createdAt:xe.now()}),o(!1),y(1),u("تمت إضافة المسلسل بنجاح.","success")}catch(E){console.error("Error adding series: ",E),E.code==="permission-denied"?u('خطأ في الأذونات. تأكد من أن قواعد أمان Firestore تسمح بالكتابة في مجموعة "series".',"error"):u("حدث خطأ أثناء إضافة المسلسل.","error")}finally{T(!1)}},h=async(m,E)=>{T(!0);try{await F.collection("series").doc(m).update(E),a(null),o(!1),u("تم تحديث المسلسل بنجاح.","success")}catch(U){console.error("Error updating series: ",U),U.code==="permission-denied"?u('خطأ في الأذونات. تأكد من أن قواعد أمان Firestore تسمح بالكتابة في مجموعة "series".',"error"):u("حدث خطأ أثناء تحديث المسلسل.","error")}finally{T(!1)}},v=m=>{P(m),q(!0)},f=async()=>{if(I){T(!0);try{await F.collection("series").doc(I.id).delete(),u("تم حذف المسلسل بنجاح.","success")}catch(m){console.error("Error deleting series: ",m),u("حدث خطأ أثناء حذف المسلسل.","error")}finally{q(!1),P(null),T(!1)}}},D=m=>{a(m),o(!0)},H=()=>{a(null),o(!0)},W=()=>{a(null),o(!1),i(null)},se=m=>{$(E=>E.includes(m)?E.filter(U=>U!==m):[...E,m])},Y=m=>{m.target.checked?$(K.map(E=>E.id)):$([])},V=async(m,E)=>{T(!0);try{const U=F.batch();G.forEach(l=>{const k=F.collection("series").doc(l);U.update(k,m)}),await U.commit(),u(E,"success"),$([])}catch(U){console.error("Bulk update failed:",U),u("فشل التحديث الجماعي.","error")}finally{T(!1),i(null)}},Q=async()=>{T(!0);try{const m=F.batch();G.forEach(E=>{const U=F.collection("series").doc(E);m.delete(U)}),await m.commit(),u(`تم حذف ${G.length} مسلسل بنجاح.`,"success"),$([])}catch(m){console.error("Bulk delete failed:",m),u("فشل الحذف الجماعي.","error")}finally{T(!1),i(null)}},r=async(m,E)=>{const U={genres:E==="add"?Z.arrayUnion(m):Z.arrayRemove(m)};await V(U,`تم ${E==="add"?"إضافة":"إزالة"} فئة "${m}" بنجاح.`)},g=async(m,E)=>{const U={tags:E==="add"?Z.arrayUnion(m):Z.arrayRemove(m)};await V(U,`تم ${E==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${m}" بنجاح.`)},j=x.filter(m=>he(C,m.title)),L=Math.ceil(j.length/ne),K=j.slice((d-1)*ne,d*ne),te=K.length>0&&G.length===K.length;return R?e.jsx(pe,{}):e.jsxs("div",{className:"relative",children:[A&&e.jsx(ge,{...A,onClose:()=>B(null)}),e.jsx(ee,{isOpen:M,onClose:()=>q(!1),onConfirm:f,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',I==null?void 0:I.title,'"']}),"؟"]}),isLoading:z}),S==="delete"&&e.jsx(ee,{isOpen:!0,onClose:()=>i(null),onConfirm:Q,title:`تأكيد حذف ${G.length} مسلسل`,message:"هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",isLoading:z}),S==="genre"&&e.jsx(be,{genres:c,onClose:W,onSubmit:r,isLoading:z}),S==="tags"&&e.jsx(ye,{onClose:W,onSubmit:g,isLoading:z}),S==="year"&&e.jsx(fe,{onClose:W,onSubmit:m=>V({year:m},"تم تحديث السنة بنجاح."),isLoading:z}),b&&e.jsx(ae,{title:n?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:W,children:e.jsx(Se,{onSubmit:n?m=>h(n.id,m):N,initialData:n,onCancel:W,isLoading:z,allGenres:c})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:H,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsx("div",{className:"relative w-full sm:flex-grow",children:e.jsx("input",{type:"text",value:C,onChange:m=>w(m.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-4 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors"})})]}),G.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[G.length," مسلسل محدد"]}),e.jsx("button",{onClick:()=>$([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>i("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>i("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>i("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>i("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",onChange:Y,checked:te})}),e.jsx("th",{className:"px-4 py-3 text-right",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:K.map(m=>{var E,U;return e.jsxs("tr",{className:`${G.includes(m.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"}`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:G.includes(m.id),onChange:()=>se(m.id)})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("img",{src:m.posterUrl,alt:m.title,className:"h-20 w-auto rounded"})}),e.jsx("td",{className:"px-4 py-2 font-medium text-white",children:m.title}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:m.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:((E=m.seasons)==null?void 0:E.length)||0}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:(U=m.createdAt)!=null&&U.toDate?m.createdAt.toDate().toLocaleDateString("ar-EG"):"N/A"}),e.jsxs("td",{className:"px-4 py-2",children:[e.jsx("button",{onClick:()=>D(m),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>v(m),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},m.id)})})]})}),j.length>ne&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ce,{currentPage:d,totalPages:L,onPageChange:y})})]})},Ae=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsx("div",{className:"p-4 bg-gray-900",children:e.jsx("div",{className:"h-6 bg-gray-600 rounded w-1/3"})}),e.jsx("div",{className:"divide-y divide-gray-700",children:[...Array(5)].map((x,s)=>e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-600 rounded w-20"})]},s))})]}),$e="yO8pzykKincc5zgbdJGdN6xISr03",oe=10,Me=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Ue=({message:x,type:s,onClose:n})=>(t.useEffect(()=>{const o=setTimeout(n,5e3);return()=>clearTimeout(o)},[n]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:x}),e.jsx("button",{onClick:n,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Be=({children:x,onClose:s,title:n})=>(t.useEffect(()=>{const a=b=>{b.key==="Escape"&&s()};return window.addEventListener("keydown",a),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",a),document.body.style.overflow="auto"}},[s]),e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4",onClick:s,children:e.jsxs("div",{className:"bg-slate-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-slate-700 animate-zoom-in",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:n}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white text-3xl transition-colors",children:"×"})]}),x]})})),Fe=()=>{const{currentUser:x}=je(),[s,n]=t.useState([]),[a,b]=t.useState(""),[o,d]=t.useState(""),[y,C]=t.useState(""),[w,M]=t.useState(!0),[q,I]=t.useState(!1),[P,R]=t.useState(1),[O,z]=t.useState(!1),[T,A]=t.useState(!1),[B,G]=t.useState(null),[$,S]=t.useState(null),i=(x==null?void 0:x.uid)===$e;t.useEffect(()=>{if(!i){M(!1);return}M(!0);const f=F.collection("admins").onSnapshot(D=>{const H=D.docs.map(W=>({id:W.id,uid:W.data().uid,email:W.data().email}));n(H),M(!1)},D=>{console.error(D),c("فشل في تحميل قائمة المشرفين.","error"),M(!1)});return()=>f()},[i]);const c=(f,D)=>{S({message:f,type:D})},p=async f=>{if(f.preventDefault(),C(""),!a.trim()||!o.trim()){C("الرجاء إدخال UID وبريد إلكتروني صالحين.");return}I(!0);try{await F.collection("admins").doc(a).set({uid:a,email:o}),c(`تمت إضافة المشرف ${o} بنجاح.`,"success"),z(!1),b(""),d("")}catch(D){console.error("Error adding admin:",D),c("فشل في إضافة المشرف.","error")}finally{I(!1)}},u=f=>{G(f),A(!0)},N=async()=>{if(B){I(!0);try{await F.collection("admins").doc(B.id).delete(),c(`تم حذف المشرف ${B.email} بنجاح.`,"success")}catch(f){console.error(f),c("حدث خطأ أثناء حذف المشرف.","error")}finally{A(!1),G(null),I(!1)}}};if(!i)return e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"إدارة المشرفين"}),e.jsx("p",{className:"text-yellow-300",children:"هذه الصفحة متاحة فقط للمشرف الأساسي."})]});const h=Math.ceil(s.length/oe),v=s.slice((P-1)*oe,P*oe);return e.jsxs(e.Fragment,{children:[$&&e.jsx(Ue,{...$,onClose:()=>S(null)}),e.jsx(ee,{isOpen:T,onClose:()=>A(!1),onConfirm:N,title:"تأكيد حذف المشرف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المشرف ",e.jsxs("strong",{className:"text-white",children:['"',B==null?void 0:B.email,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"سيؤدي هذا إلى إزالة صلاحيات المشرف الخاصة به."})]}),isLoading:q}),O&&e.jsx(Be,{title:"إضافة مشرف جديد",onClose:()=>z(!1),children:e.jsxs("form",{onSubmit:p,className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"لإضافة مشرف جديد، يجب عليك الحصول على **معرّف المستخدم (UID)** الخاص به من لوحة تحكم Firebase Authentication."}),e.jsx("input",{type:"text",value:a,onChange:f=>b(f.target.value),placeholder:"معرّف المستخدم (UID)",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),e.jsx("input",{type:"email",value:o,onChange:f=>d(f.target.value),placeholder:"البريد الإلكتروني للمشرف",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),y&&e.jsx("p",{className:"text-red-500 text-center text-sm",children:y}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:()=>z(!1),className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:q,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:q,children:[q&&e.jsx(Me,{}),q?"جاري الإضافة...":"إضافة مشرف"]})]})]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"المشرفون الحاليون"}),e.jsx("button",{onClick:()=>z(!0),className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة مشرف جديد"})]}),w?e.jsx(Ae,{}):e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-900/50 flex items-center justify-between",children:[e.jsxs("span",{className:"text-white font-bold",children:[x.email," (المشرف الأساسي)"]}),e.jsx("span",{className:"text-sm text-slate-500",children:"لا يمكن حذفه"})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:v.map(f=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-slate-700/50",children:[e.jsx("span",{className:"text-white",children:f.email}),e.jsx("button",{onClick:()=>u(f),className:"bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700 transition-colors",children:"حذف"})]},f.id))}),s.length>oe&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ce,{currentPage:P,totalPages:h,onPageChange:R})})]})]})]})},Te=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),De=({onSubmit:x,initialData:s,onCancel:n,isLoading:a=!1})=>{const[b,o]=t.useState("");t.useEffect(()=>{o(s?s.name:"")},[s]);const d=y=>{y.preventDefault(),b.trim()&&x({name:b})};return e.jsxs("form",{onSubmit:d,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:b,onChange:y=>o(y.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:n,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:a,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:a,children:[a&&e.jsx(Te,{}),a?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث":"إضافة"]})]})]})},_e=10,qe=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(_e)].map((x,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},s))})]})})}),ie=10,ze=({message:x,type:s,onClose:n})=>(t.useEffect(()=>{const o=setTimeout(n,5e3);return()=>clearTimeout(o)},[n]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:x}),e.jsx("button",{onClick:n,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Ge=({children:x,onClose:s,title:n})=>(t.useEffect(()=>{const a=b=>{b.key==="Escape"&&s()};return window.addEventListener("keydown",a),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",a),document.body.style.overflow="auto"}},[s]),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 animate-fade-in",onClick:s,children:e.jsxs("div",{className:"bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:n}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),x]})})),Le=()=>{const[x,s]=t.useState([]),[n,a]=t.useState(null),[b,o]=t.useState(!1),[d,y]=t.useState(1),[C,w]=t.useState(!1),[M,q]=t.useState(null),[I,P]=t.useState(!0),[R,O]=t.useState(!1),[z,T]=t.useState(null);t.useEffect(()=>{P(!0);const h=F.collection("categories").orderBy("name").onSnapshot(v=>{const f=v.docs.map(D=>({id:D.id,...D.data()}));s(f),P(!1)},v=>{console.error("Error fetching categories: ",v),A("فشل في تحميل الفئات.","error"),P(!1)});return()=>h()},[]);const A=(h,v)=>{T({message:h,type:v})},B=async h=>{O(!0);try{await F.collection("categories").add(h),A("تمت إضافة الفئة بنجاح!","success"),o(!1),y(1)}catch(v){console.error("Error adding category: ",v),A("حدث خطأ أثناء إضافة الفئة.","error")}finally{O(!1)}},G=async(h,v)=>{O(!0);try{await F.collection("categories").doc(h).update(v),A("تم تحديث الفئة بنجاح!","success"),a(null),o(!1)}catch(f){console.error("Error updating category: ",f),A("حدث خطأ أثناء تحديث الفئة.","error")}finally{O(!1)}},$=h=>{q(h),w(!0)},S=async()=>{if(M){O(!0);try{await F.collection("categories").doc(M.id).delete(),A("تم حذف الفئة بنجاح!","success")}catch(h){console.error("Error deleting category: ",h),A("حدث خطأ أثناء حذف الفئة.","error")}finally{w(!1),q(null),O(!1)}}},i=h=>{a(h),o(!0)},c=()=>{a(null),o(!0)},p=()=>{a(null),o(!1)},u=Math.ceil(x.length/ie),N=x.slice((d-1)*ie,d*ie);return I?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(qe,{})]}):e.jsxs("div",{children:[z&&e.jsx(ze,{...z,onClose:()=>T(null)}),e.jsx(ee,{isOpen:C,onClose:()=>w(!1),onConfirm:S,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',M==null?void 0:M.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:R}),b&&e.jsx(Ge,{title:n?"تعديل الفئة":"إضافة فئة جديدة",onClose:p,children:e.jsx(De,{onSubmit:n?h=>G(n.id,h):B,initialData:n,onCancel:p,isLoading:R})}),e.jsx("button",{onClick:c,className:"mb-6 bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:x.length>0?N.map(h=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:h.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>i(h),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>$(h),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},h.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})}),x.length>ie&&e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx(ce,{currentPage:d,totalPages:u,onPageChange:y})})]})]})},de=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(ke,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx(Ee,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(Le,{})},{key:"admins",label:"إدارة المشرفين",component:e.jsx(Fe,{})}],Oe=({label:x,tabKey:s,activeTab:n,onClick:a})=>e.jsx("button",{onClick:()=>a(s),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px ${n===s?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":n===s,children:x}),Pe=()=>{var a;const[x,s]=t.useState(de[0].key),n=(a=de.find(b=>b.key===x))==null?void 0:a.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6",role:"tablist",children:de.map(b=>e.jsx(Oe,{label:b.label,tabKey:b.key,activeTab:x,onClick:s},b.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-6 rounded-lg border border-slate-700",children:n})]})};export{Pe as default};
