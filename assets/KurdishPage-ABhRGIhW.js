import{j as t,r as m,a as q,b as I,d as C,f as Q}from"./index-CxNw7T8d.js";import{H as U,a as V,S as W,G as J,T as X,Y as Z}from"./TagFilter-P2ndUNRD.js";import{M as $,a as ee}from"./MovieGridSkeleton-By-76NzA.js";import{P as te}from"./Pagination-Bt0XHF9W.js";import"./MovieCardSkeleton-DE2iVNWi.js";const se=({searchQuery:i,onSearchChange:j})=>t.jsxs("div",{className:"relative w-full md:w-auto md:flex-grow",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t.jsx("input",{type:"text",value:i,onChange:y=>j(y.target.value),placeholder:"ابحث عن فيلم...",className:"w-full bg-gray-700 text-white p-2 pl-10 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none","aria-label":"Search for movies by title"})]}),M=28,ce=()=>{const[i,j]=m.useState([]),[y,N]=m.useState([]),[P,T]=m.useState(!0),{getAverageRating:u}=q(),[d,G]=I(),w=Number(d.get("page")||"1"),x=d.get("year")||"all",o=d.getAll("genre"),l=d.getAll("tag"),f=d.get("sort")||"createdAt_desc",p=d.get("q")||"";m.useEffect(()=>{(async()=>{try{let r=(await C.collection("movies").where("isKurdish","==",!0).get()).docs.map(a=>({id:a.id,...a.data()}));r.sort((a,n)=>{var h,b;const g=(h=a.createdAt)!=null&&h.toMillis?a.createdAt.toMillis():0;return((b=n.createdAt)!=null&&b.toMillis?n.createdAt.toMillis():0)-g}),j(r)}catch(s){console.error("Error fetching movies: ",s)}finally{T(!1)}})()},[]),m.useEffect(()=>{const e=C.collection("categories").orderBy("name").onSnapshot(s=>{const r=s.docs.map(a=>a.data().name);N(r)},s=>{console.error("Error fetching categories for Kurdish page: ",s)});return()=>e()},[]);const c=(e,s=!0)=>{const r=new URLSearchParams(d);Object.entries(e).forEach(([a,n])=>{r.delete(a),Array.isArray(n)?n.forEach(g=>r.append(a,g)):n&&n!=="all"&&r.set(a,n)}),s&&r.set("page","1"),G(r,{replace:!0})},E=e=>c({page:String(e)},!1),_=e=>{const s=o.includes(e)?o.filter(r=>r!==e):[...o,e];c({genre:s})},B=()=>c({genre:[]}),F=e=>{const s=l.includes(e)?l.filter(r=>r!==e):[...l,e];c({tag:s})},Y=()=>c({tag:[]}),k=e=>c({year:e}),R=e=>c({sort:e}),z=e=>c({q:e}),L=[...new Set(i.map(e=>e.year))].sort((e,s)=>s-e),H=y,K=[...new Set(i.flatMap(e=>e.tags||[]))].sort(),A=m.useMemo(()=>i.filter(e=>x==="all"||e.year.toString()===x).filter(e=>o.length===0?!0:o.some(s=>{var r;return(r=e.genres)==null?void 0:r.includes(s)})).filter(e=>l.length===0?!0:l.some(s=>{var r;return(r=e.tags)==null?void 0:r.includes(s)})).filter(e=>Q(p,e.title)).sort((e,s)=>{var r,a,n,g;switch(f){case"rating_desc":return u(s.id).average-u(e.id).average;case"rating_asc":return u(e.id).average-u(s.id).average;case"year_desc":return s.year-e.year;case"year_asc":return e.year-s.year;case"createdAt_asc":{const v=(r=e.createdAt)!=null&&r.toMillis?e.createdAt.toMillis():0,h=(a=s.createdAt)!=null&&a.toMillis?s.createdAt.toMillis():0;return v-h}case"createdAt_desc":default:{const v=(n=s.createdAt)!=null&&n.toMillis?s.createdAt.toMillis():0,h=(g=e.createdAt)!=null&&g.toMillis?e.createdAt.toMillis():0;return v-h}}}),[i,x,o,l,p,f,u]),S=Math.ceil(A.length/M),O=A.slice((w-1)*M,w*M),D=p!==""||x!=="all"||o.length>0||l.length>0||f!=="createdAt_desc";return P?t.jsxs("div",{children:[t.jsx(U,{}),t.jsx("div",{className:"my-8 h-20 bg-gray-800/50 rounded-lg animate-pulse"}),t.jsxs("section",{className:"mb-12",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"الأفلام المدبلجة للكردية"}),t.jsx($,{count:18})]})]}):t.jsxs("div",{children:[t.jsx(V,{movies:i.slice(0,5)}),t.jsxs("div",{className:"relative z-30 my-8 flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl",children:[t.jsx(se,{searchQuery:p,onSearchChange:z}),t.jsxs("div",{className:"w-full md:w-auto flex flex-col md:flex-row md:flex-wrap justify-center items-center gap-4",children:[t.jsx(W,{sortOrder:f,onSortChange:R}),t.jsx(J,{genres:H,selectedGenres:o,onToggleGenre:_,onClearGenres:B}),t.jsx(X,{tags:K,selectedTags:l,onToggleTag:F,onClearTags:Y}),t.jsx(Z,{years:L,selectedYear:x,onYearChange:k})]})]}),t.jsxs("section",{className:"mb-12",children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:D?"نتائج البحث":"الأفلام المدبلجة للكردية"}),A.length>0?t.jsxs(t.Fragment,{children:[t.jsx(ee,{movies:O}),S>1&&t.jsx(te,{currentPage:w,totalPages:S,onPageChange:E})]}):t.jsx("div",{className:"text-center p-8 bg-gray-800 rounded-lg mt-8",children:t.jsx("p",{className:"text-xl text-gray-400",children:"لا توجد أفلام مدبلجة للكردية تطابق معايير البحث."})})]})]})};export{ce as default};
