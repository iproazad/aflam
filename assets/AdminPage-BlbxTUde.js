import{r as o,j as e,s as S,f as Re,R as es}from"./index-DBk5uD67.js";import{P as Se}from"./Pagination-BOvLhDIs.js";import{F as ue,S as de}from"./SpinnerIcon-BBV4J1WC.js";const Be=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ss=({onSubmit:c,initialData:a,onCancel:h,isKurdishByDefault:x=!1,isLoading:j=!1,allGenres:i=[]})=>{var Q,V,Y;const[l,p]=o.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"1080p"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:!1,imdb_rating:void 0,quality:"",duration:"",language:"",country:"",directors:[],writers:[],cast:[]}),[k,T]=o.useState(""),[U,z]=o.useState(""),[W,g]=o.useState(!1),[$,q]=o.useState(""),[A,M]=o.useState(!1),[R,_]=o.useState(""),[E,I]=o.useState(""),[G,y]=o.useState(!1),B=o.useRef(null);o.useEffect(()=>{a?(p({title:a.title||"",description:a.description||"",poster_url:a.poster_url||"",backdrop_url:a.backdrop_url||"",year:a.year||new Date().getFullYear(),genres:a.genres||[],tags:a.tags||[],servers:a.servers&&a.servers.length>0?a.servers:[{name:"Server 1",url:"",quality:"1080p"}],backup_servers:a.backup_servers||[],download_url:a.download_url||"",trailer_url:a.trailer_url||"",is_kurdish:a.is_kurdish||!1,imdb_rating:a.imdb_rating,quality:a.quality||"",duration:a.duration||"",language:a.language||"",country:a.country||"",directors:a.directors||[],writers:a.writers||[],cast:a.cast||[]}),T((a.tags||[]).join(", "))):(p({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"1080p"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:x,imdb_rating:void 0,quality:"",duration:"",language:"",country:"",directors:[],writers:[],cast:[]}),T(""))},[a,x]),o.useEffect(()=>{const s=r=>{B.current&&!B.current.contains(r.target)&&M(!1)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]),o.useEffect(()=>{const s=l.download_url;if(s&&s.includes("vidtube.pro/d/")){const r=s.replace("/d/","/embed-");l.servers.length>0&&l.servers[0].url!==r&&p(n=>{const b=[...n.servers];return b[0]={...b[0],url:r},{...n,servers:b}})}},[l.download_url,l.servers]),o.useEffect(()=>{if(!a){const s=l.title.match(/\b(19[89]\d|20\d{2})\b/);if(s&&s[0]){const r=parseInt(s[0],10),n=l.title.replace(s[0],"").replace(/\s\s+/g," ").trim();p(b=>b.year!==r||b.title!==n?{...b,year:r,title:n}:b)}}},[l.title,a]),o.useEffect(()=>{!a&&!l.backdrop_url.trim()&&p(s=>({...s,backdrop_url:s.poster_url}))},[l.poster_url,a,l.backdrop_url]);const m=async s=>{var r;try{if(!((r=navigator.clipboard)!=null&&r.readText))throw new Error("Clipboard API not available.");const n=await navigator.clipboard.readText();n&&s(n)}catch(n){console.error("Failed to read clipboard contents: ",n),alert("فشل لصق النص. يرجى التأكد من منح الإذن لاستخدام الحافظة.")}},d=s=>{const{name:r,value:n,type:b}=s.target;if(b==="checkbox"){const{checked:t}=s.target;p(f=>({...f,[r]:t}))}else if(r==="year"){const t=parseInt(n,10);p(f=>({...f,[r]:isNaN(t)?0:t}))}else if(r==="imdb_rating"){const t=parseFloat(n);p(f=>({...f,imdb_rating:isNaN(t)?void 0:t}))}else p(t=>({...t,[r]:n}))},u=s=>{T(s.target.value)},C=s=>{p(r=>{const n=r.genres||[],b=n.includes(s)?n.filter(t=>t!==s):[...n,s];return{...r,genres:b}})},w=async()=>{const s=E.trim();if(s){if(i.some(r=>r.toLowerCase()===s.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}y(!0);try{const{error:r}=await S.from("categories").insert({name:s});if(r)throw r;p(n=>({...n,genres:[...n.genres||[],s]})),I("")}catch(r){console.error("Error adding new genre:",r),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{y(!1)}}},P=(s,r,n)=>{const b=[...l.servers];b[s]={...b[s],[r]:n},p(t=>({...t,servers:b}))},H=()=>{p(s=>{const r={name:`Server ${s.servers.length+1}`,url:"",quality:"1080p"};return{...s,servers:[...s.servers,r]}})},X=s=>{p(r=>({...r,servers:r.servers.filter((n,b)=>b!==s)}))},ae=(s,r,n)=>{const b=[...l.backup_servers||[]];b[s]={...b[s],[r]:n},p(t=>({...t,backup_servers:b}))},te=()=>{p(s=>{var r;return{...s,backup_servers:[...s.backup_servers||[],{name:`Server ${(((r=s.backup_servers)==null?void 0:r.length)||0)+1}`,url:"",quality:"1080p",no_sub_url:""}]}})},v=s=>{p(r=>({...r,backup_servers:(r.backup_servers||[]).filter((n,b)=>b!==s)}))},O=async()=>{var s,r,n,b,t,f,N,L;if(!U){q("Please enter a URL.");return}g(!0),q("");try{q("Fetching movie page...");const Z=`https://corsproxy.io/?${encodeURIComponent(U)}`,se=await fetch(Z);if(!se.ok)throw new Error(`Failed to fetch URL: ${se.statusText}`);const oe=await se.text(),le=new DOMParser,ee=le.parseFromString(oe,"text/html"),re=ce=>{var Ae,Fe,Te;const me=Array.from(ee.querySelectorAll(".RightTaxContent > li")).find(Ne=>{var xe,Pe;return(Pe=(xe=Ne.querySelector("span"))==null?void 0:xe.textContent)==null?void 0:Pe.trim().startsWith(ce)});if(!me)return[];const je=Array.from(me.querySelectorAll("a, strong"));if(je.length>0)return je.map(Ne=>{var xe;return((xe=Ne.textContent)==null?void 0:xe.trim())||""}).filter(Boolean);const we=me.cloneNode(!0);(Ae=we.querySelector("i"))==null||Ae.remove(),(Fe=we.querySelector("span"))==null||Fe.remove();const qe=(Te=we.textContent)==null?void 0:Te.trim().replace(/^:/,"").trim();return qe?qe.split(/\s*,\s*/):[]},Ee=((r=(s=ee.querySelector("h1.post-title"))==null?void 0:s.textContent)==null?void 0:r.trim())||"",he=Ee.match(/\b(19\d{2}|20\d{2})\b/),ze=he?parseInt(he[0],10):new Date().getFullYear();let ie=Ee;ie=ie.replace(/فيلم|مترجم|اون لاين|اونلاين|WEB-DL|BluRay|HD/gi,"").replace(/[\u0600-\u06FF]+/g,""),he&&(ie=ie.replace(he[0],"")),ie=ie.trim().replace(/^[^a-zA-Z0-9\s]+|[^a-zA-Z0-9\s]+$/g,"").trim();const Ie=((b=(n=ee.querySelector(".story p"))==null?void 0:n.textContent)==null?void 0:b.trim())||"",$e=((t=ee.querySelector(".MainSingle .left .image img"))==null?void 0:t.getAttribute("src"))||"",De=((N=(f=ee.querySelector(".imdbR span"))==null?void 0:f.textContent)==null?void 0:N.trim())||"0",Je=parseFloat(De)||void 0,We=re("نوع الفيلم"),Ye=re("جودة الفيلم").join(", "),Ve=re("توقيت الفيلم").join(", "),He=re("لغة الفيلم").join(", "),Ke=re("دولة الفيلم").join(", "),Qe=re("المخرجين"),Xe=re("المؤلفين"),Ze=re("بطولة");let Me="";const be=ee.querySelector("a.download"),Oe=be==null?void 0:be.getAttribute("href");if(Oe){q("Fetching download link...");const ce=`https://corsproxy.io/?${encodeURIComponent(Oe)}`,ye=await fetch(ce);if(ye.ok){const me=await ye.text();Me=((L=le.parseFromString(me,"text/html").querySelector('a.downloadsLink, a[href*="vidtube.pro/d/"]'))==null?void 0:L.getAttribute("href"))||""}}p(ce=>({...ce,title:ie,year:ze||ce.year,description:Ie,poster_url:$e,backdrop_url:$e,imdb_rating:Je,genres:[...new Set([...ce.genres,...We])],quality:Ye,duration:Ve,language:He,country:Ke,directors:Qe,writers:Xe,cast:Ze,download_url:Me})),q("تم جلب البيانات بنجاح!")}catch(Z){console.error("Scraping failed:",Z),q(`فشل جلب البيانات: ${Z.message}.`)}finally{g(!1)}},D=s=>{if(s.preventDefault(),l.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const r=k.split(",").map(n=>n.trim()).filter(Boolean);c({...l,tags:r})},K=i.filter(s=>s.toLowerCase().includes(R.toLowerCase())),J="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",F="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3 p-4 bg-slate-900/50 rounded-lg border border-slate-700",children:[e.jsx("label",{htmlFor:"scrape_url",className:"block text-lg font-semibold text-white",children:"جلب البيانات من رابط"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"scrape_url",type:"url",value:U,onChange:s=>z(s.target.value),placeholder:"https://web6.topcinema.cam/...",className:`${J} flex-grow`}),e.jsxs("button",{type:"button",onClick:O,disabled:W,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700 flex-shrink-0 flex items-center disabled:bg-slate-500",children:[W&&e.jsx(Be,{}),W?"جاري الجلب...":"جلب البيانات"]})]}),$&&e.jsx("p",{className:`text-sm mt-1 ${$.startsWith("فشل")?"text-red-400":"text-green-400"}`,children:$})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx("input",{type:"text",name:"title",value:l.title,onChange:d,placeholder:"عنوان الفيلم (بالانجليزية)",required:!0,className:J})}),e.jsx("input",{type:"number",name:"year",value:l.year||"",onChange:d,placeholder:"سنة الإنتاج",required:!0,className:J})]}),e.jsx("textarea",{name:"description",value:l.description,onChange:d,placeholder:"وصف الفيلم",required:!0,className:`${J} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",name:"poster_url",value:l.poster_url,onChange:d,placeholder:"رابط صورة البوستر",required:!0,className:`${J} flex-grow`}),e.jsx("button",{type:"button",onClick:()=>m(s=>p(r=>({...r,poster_url:s,backdrop_url:s}))),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-2 px-4 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsx("input",{type:"url",name:"backdrop_url",value:l.backdrop_url,onChange:d,placeholder:"رابط صورة الخلفية",required:!0,className:J})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:l.imdb_rating??"",onChange:d,placeholder:"تقيم الفيلم",step:"0.1",min:"0",max:"10",className:J}),e.jsx("input",{type:"url",name:"trailer_url",value:l.trailer_url??"",onChange:d,placeholder:"رابط المقطع الدعائي (اختياري)",className:J})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:k,onChange:u,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:J})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"is_kurdish",type:"checkbox",name:"is_kurdish",checked:!!l.is_kurdish,onChange:d,className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("label",{htmlFor:"is_kurdish",className:"text-white cursor-pointer",children:"هذا الفيلم مدبلج للكردية"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:B,children:[e.jsxs("button",{type:"button",onClick:()=>M(s=>!s),className:`${J} text-right flex justify-between items-center`,children:[e.jsx("span",{children:l.genres.length>0?l.genres.join(", "):"اختر الفئات..."}),e.jsx("svg",{className:`h-5 w-5 transition-transform duration-200 ${A?"rotate-180":""}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),A&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[e.jsx("div",{className:"p-2 border-b border-slate-700",children:e.jsx("input",{type:"text",placeholder:"ابحث أو أضف فئة...",value:R,onChange:s=>_(s.target.value),className:"w-full bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"})}),e.jsx("ul",{className:"p-1",children:K.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.genres.includes(s),onChange:()=>C(s),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:s})]},s))}),e.jsx("div",{className:"p-2 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"إضافة فئة جديدة...",value:E,onChange:s=>I(s.target.value),className:"flex-grow bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:w,disabled:G||!E.trim(),className:"bg-cyan-600 text-white px-3 py-1 rounded-md text-sm hover:bg-cyan-700 disabled:bg-slate-500",children:G?"...":"إضافة"})]})})]})]})]}),e.jsxs("details",{className:"bg-slate-900/30 p-4 rounded-lg border border-slate-700",open:!0,children:[e.jsx("summary",{className:"text-lg font-semibold text-white cursor-pointer",children:"تفاصيل إضافية للفيلم"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",name:"quality",value:l.quality,onChange:d,placeholder:"الجودة (e.g. 1080p WEB-DL)",className:F}),e.jsx("input",{type:"text",name:"duration",value:l.duration,onChange:d,placeholder:"مدة العرض",className:F}),e.jsx("input",{type:"text",name:"language",value:l.language,onChange:d,placeholder:"اللغة",className:F}),e.jsx("input",{type:"text",name:"country",value:l.country,onChange:d,placeholder:"الدولة",className:F})]}),e.jsx("textarea",{value:(Q=l.directors)==null?void 0:Q.join(", "),onChange:s=>p(r=>({...r,directors:s.target.value.split(",").map(n=>n.trim())})),placeholder:"المخرجين (مفصولة بفاصلة)",className:`${F} w-full`,rows:2}),e.jsx("textarea",{value:(V=l.writers)==null?void 0:V.join(", "),onChange:s=>p(r=>({...r,writers:s.target.value.split(",").map(n=>n.trim())})),placeholder:"المؤلفين (مفصولة بفاصلة)",className:`${F} w-full`,rows:2}),e.jsx("textarea",{value:(Y=l.cast)==null?void 0:Y.join(", "),onChange:s=>p(r=>({...r,cast:s.target.value.split(",").map(n=>n.trim())})),placeholder:"البطولة (مفصولة بفاصلة)",className:`${F} w-full`,rows:3})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات المشاهدة"}),l.servers.map((s,r)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:s.name,onChange:n=>P(r,"name",n.target.value),placeholder:"اسم السيرفر",className:`${F} flex-1`}),e.jsxs("select",{value:s.quality,onChange:n=>P(r,"quality",n.target.value),className:`${F} w-28`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),l.servers.length>1&&e.jsx("button",{type:"button",onClick:()=>X(r),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),r===0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{type:"url",value:s.url,onChange:n=>P(r,"url",n.target.value),placeholder:"رابط السيرفر 1",required:!0,className:`${F} w-full`}),e.jsx("input",{type:"url",name:"download_url",value:l.download_url||"",onChange:d,placeholder:"رابط تحميل الفيلم (اختياري)",className:`${F} w-full`})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:s.url,onChange:n=>P(r,"url",n.target.value),placeholder:`رابط السيرفر ${r+1}`,required:!0,className:`${F} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>m(n=>P(r,"url",n)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]})]},r)),e.jsx("button",{type:"button",onClick:H,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات احتياطية (مشغل خارجي)"}),(l.backup_servers||[]).map((s,r)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:s.name,onChange:n=>ae(r,"name",n.target.value),placeholder:"اسم السيرفر",className:`${F} flex-1`}),e.jsxs("select",{value:s.quality,onChange:n=>ae(r,"quality",n.target.value),className:`${F} w-28`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>v(r),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{type:"url",value:s.url,onChange:n=>ae(r,"url",n.target.value),placeholder:"رابط السيرفر (مع ترجمة)",className:`${F} w-full`}),e.jsx("input",{type:"url",value:s.no_sub_url||"",onChange:n=>ae(r,"no_sub_url",n.target.value),placeholder:"رابط السيرفر (بدون ترجمة)",className:`${F} w-full`})]})]},r)),e.jsx("button",{type:"button",onClick:te,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:h,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",disabled:j,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:j,children:[j&&e.jsx(Be,{}),j?a?"جاري التحديث...":"جاري الإضافة...":a?"تحديث الفيلم":"إضافة الفيلم"]})]})]})},ts=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ne=({isOpen:c,onClose:a,onConfirm:h,title:x,message:j,isLoading:i=!1})=>{const[l,p]=o.useState(c);return o.useEffect(()=>{if(c)p(!0);else{const k=setTimeout(()=>p(!1),300);return()=>clearTimeout(k)}},[c]),l?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${c?"animate-fade-in":"animate-fade-out"}`,onClick:a,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:`relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md border border-slate-700 ${c?"animate-zoom-in":"animate-zoom-out"}`,onClick:k=>k.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:x}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:j})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:h,disabled:i,children:[i&&e.jsx(ts,{}),i?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:a,disabled:i,children:"إلغاء"})]})]})}):null},rs=10,Ge=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((c,a)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},a))})}),e.jsx("tbody",{children:[...Array(rs)].map((c,a)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((h,x)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},x))]},a))})]})})]}),_e=({message:c,type:a,onClose:h})=>(o.useEffect(()=>{const i=setTimeout(h,5e3);return()=>clearTimeout(i)},[h]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${a==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:c}),e.jsx("button",{onClick:h,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Le=({genres:c,onSubmit:a,onClose:h,isLoading:x})=>{const[j,i]=o.useState(c[0]||""),[l,p]=o.useState("add"),k=T=>{T.preventDefault(),j&&a(j,l)};return e.jsx(ue,{title:"تغيير الفئة بشكل جماعي",onClose:h,isOpen:!0,children:e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:j,onChange:T=>i(T.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:c.map(T=>e.jsx("option",{value:T,children:T},T))}),e.jsxs("select",{value:l,onChange:T=>p(T.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:h,disabled:x,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:x||!j,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[x&&e.jsx(de,{}),x?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},as=({onSubmit:c,onClose:a,isLoading:h})=>{const[x,j]=o.useState(new Date().getFullYear()),i=l=>{l.preventDefault(),c(x)};return e.jsx(ue,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:a,isOpen:!0,children:e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:x,onChange:l=>j(parseInt(l.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:a,disabled:h,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:h,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[h&&e.jsx(de,{}),h?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Ue=({onSubmit:c,onClose:a,isLoading:h})=>{const[x,j]=o.useState(""),[i,l]=o.useState("add"),p=k=>{k.preventDefault(),x.trim()&&c(x.trim(),i)};return e.jsx(ue,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:a,isOpen:!0,children:e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:x,onChange:k=>j(k.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:i,onChange:k=>l(k.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:a,disabled:h,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:h||!x.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[h&&e.jsx(de,{}),h?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},pe=10,ns=()=>{const[c,a]=o.useState([]),[h,x]=o.useState(null),[j,i]=o.useState(!1),[l,p]=o.useState(1),[k,T]=o.useState("all"),[U,z]=o.useState(""),[W,g]=o.useState(!1),[$,q]=o.useState(null),[A,M]=o.useState(!0),[R,_]=o.useState(!1),[E,I]=o.useState(null),[G,y]=o.useState([]),[B,m]=o.useState(null),[d,u]=o.useState([]),C=async()=>{const{data:t,error:f}=await S.from("movies").select("*").order("created_at",{ascending:!1});f?(console.error("Error fetching movies: ",f),w("فشل في تحميل الأفلام.","error")):a(t);const{data:N,error:L}=await S.from("categories").select("name").order("name");L?console.error("Error fetching categories from ManageMovies: ",L):u(N.map(Z=>Z.name)),M(!1)};o.useEffect(()=>{M(!0),C();const t=S.channel("public:movies").on("postgres_changes",{event:"*",schema:"public",table:"movies"},()=>C()).subscribe();return()=>{S.removeChannel(t)}},[]),o.useEffect(()=>{p(1),y([])},[k,U]);const w=(t,f)=>{I({message:t,type:f})},P=async t=>{_(!0);try{const{error:f}=await S.from("movies").insert([{...t,created_at:new Date().toISOString()}]);if(f)throw f;await C(),i(!1),p(1),w("تمت إضافة الفيلم بنجاح.","success")}catch(f){console.error("Error adding movie: ",f);const N=f.message||JSON.stringify(f);w(`حدث خطأ أثناء إضافة الفيلم: ${N}`,"error")}finally{_(!1)}},H=async(t,f)=>{_(!0);try{const{error:N}=await S.from("movies").update(f).eq("id",t);if(N)throw N;await C(),x(null),i(!1),w("تم تحديث الفيلم بنجاح.","success")}catch(N){console.error("Error updating movie: ",N);const L=N.message||JSON.stringify(N);w(`حدث خطأ أثناء تحديث الفيلم: ${L}`,"error")}finally{_(!1)}},X=t=>{q(t),g(!0)},ae=async()=>{if($){_(!0);try{const{error:t}=await S.from("movies").delete().eq("id",$.id);if(t)throw t;w("تم حذف الفيلم بنجاح.","success")}catch(t){console.error("Error deleting movie: ",t);const f=t.message||JSON.stringify(t);w(`حدث خطأ أثناء حذف الفيلم: ${f}`,"error")}finally{g(!1),q(null),_(!1)}}},te=t=>{x(t),i(!0)},v=()=>{x(null),i(!0)},O=()=>{x(null),i(!1),m(null)},D=t=>{y(f=>f.includes(t)?f.filter(N=>N!==t):[...f,t])},K=t=>{t.target.checked?y(r.map(f=>f.id)):y(G.filter(f=>!r.some(N=>N.id===f)))},J=async(t,f)=>{_(!0);try{const{error:N}=await S.from("movies").update(t).in("id",G);if(N)throw N;w(f,"success"),y([])}catch(N){console.error("Bulk update failed:",N),w("فشل التحديث الجماعي.","error")}finally{_(!1),m(null)}},F=async()=>{_(!0);try{const{error:t}=await S.from("movies").delete().in("id",G);if(t)throw t;w(`تم حذف ${G.length} فيلم بنجاح.`,"success"),y([])}catch(t){console.error("Bulk delete failed:",t),w("فشل الحذف الجماعي.","error")}finally{_(!1),m(null)}},Q=async(t,f)=>{_(!0);try{const{data:N,error:L}=await S.from("movies").select("id, genres").in("id",G);if(L)throw L;const Z=N.map(oe=>{const le=oe.genres||[];let ee;return f==="add"?ee=[...new Set([...le,t])]:ee=le.filter(re=>re!==t),{id:oe.id,genres:ee}}),{error:se}=await S.from("movies").upsert(Z);if(se)throw se;w(`تم ${f==="add"?"إضافة":"إزالة"} فئة "${t}" بنجاح.`,"success"),y([])}catch(N){console.error("Bulk genre change failed:",N),w("فشل تغيير الفئة الجماعي.","error")}finally{_(!1),m(null)}},V=async(t,f)=>{_(!0);try{const{data:N,error:L}=await S.from("movies").select("id, tags").in("id",G);if(L)throw L;const Z=N.map(oe=>{const le=oe.tags||[];let ee;return f==="add"?ee=[...new Set([...le,t])]:ee=le.filter(re=>re!==t),{id:oe.id,tags:ee}}),{error:se}=await S.from("movies").upsert(Z);if(se)throw se;w(`تم ${f==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${t}" بنجاح.`,"success"),y([])}catch(N){console.error("Bulk tags change failed:",N),w("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{_(!1),m(null)}},Y=c.filter(t=>k==="kurdish"?t.is_kurdish===!0:k==="non-kurdish"?!t.is_kurdish:!0).filter(t=>Re(U,t.title)),s=Math.ceil(Y.length/pe),r=Y.slice((l-1)*pe,l*pe),n=t=>`px-4 py-2 text-sm font-bold rounded-lg transition-colors duration-200 ${k===t?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-md":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,b=r.length>0&&r.every(t=>G.includes(t.id));return A?e.jsx(Ge,{}):e.jsxs("div",{className:"relative",children:[E&&e.jsx(_e,{...E,onClose:()=>I(null)}),e.jsx(ne,{isOpen:W,onClose:()=>g(!1),onConfirm:ae,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',$==null?void 0:$.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:R}),B==="delete"&&e.jsx(ne,{isOpen:!0,onClose:()=>m(null),onConfirm:F,title:`تأكيد حذف ${G.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:R}),B==="genre"&&e.jsx(Le,{genres:d,onClose:O,onSubmit:Q,isLoading:R}),B==="tags"&&e.jsx(Ue,{onClose:O,onSubmit:V,isLoading:R}),B==="year"&&e.jsx(as,{onClose:O,onSubmit:t=>J({year:t},"تم تحديث السنة بنجاح."),isLoading:R}),B==="markKurdish"&&e.jsx(ne,{isOpen:!0,onClose:O,onConfirm:()=>J({is_kurdish:!0},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد تحديد كل هذه الأفلام على أنها كردية؟",isLoading:R}),B==="unmarkKurdish"&&e.jsx(ne,{isOpen:!0,onClose:O,onConfirm:()=>J({is_kurdish:!1},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد إزالة العلامة الكردية من كل هذه الأفلام؟",isLoading:R}),j&&e.jsx(ue,{title:h?"تعديل الفيلم":"إضافة فيلم جديد",onClose:O,isOpen:j,children:e.jsx(ss,{onSubmit:h?t=>H(h.id,t):P,initialData:h,onCancel:O,isKurdishByDefault:k==="kurdish"&&!h,isLoading:R,allGenres:d})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:v,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:U,onChange:t=>z(t.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("div",{className:"flex flex-wrap justify-center items-center gap-2 p-1 bg-slate-900/50 rounded-lg flex-shrink-0",children:[e.jsx("button",{onClick:()=>T("all"),className:n("all"),children:"الكل"}),e.jsx("button",{onClick:()=>T("kurdish"),className:n("kurdish"),children:"كردي فقط"}),e.jsx("button",{onClick:()=>T("non-kurdish"),className:n("non-kurdish"),children:"غير كردي"})]})]}),G.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[G.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>y([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>m("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>m("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>m("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>m("markKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تحديد ككردي"}),e.jsx("button",{onClick:()=>m("unmarkKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"إلغاء تحديد ككردي"}),e.jsx("button",{onClick:()=>m("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto hidden lg:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:K,checked:b,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"مدبلج كردي"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:r.map(t=>{var f,N;return e.jsxs("tr",{className:`${G.includes(t.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:G.includes(t.id),onChange:()=>D(t.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:t.poster_url,alt:t.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:t.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:t.imdb_rating?t.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(f=t.genres)==null?void 0:f.slice(0,3).map(L=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:L},L)),((N=t.genres)==null?void 0:N.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.is_kurdish?"نعم":"لا"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>te(t),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>X(t),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},t.id)})})]})}),e.jsxs("div",{className:"block lg:hidden space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx("input",{type:"checkbox",onChange:K,checked:b,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("label",{className:"text-sm text-slate-300",children:"تحديد الكل في هذه الصفحة"})]}),r.map(t=>{var f,N;return e.jsxs("div",{className:`p-3 rounded-lg transition-all duration-200 ${G.includes(t.id)?"bg-cyan-500/20 ring-2 ring-cyan-500":"bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24",children:e.jsx("img",{src:t.poster_url,alt:t.title,className:"w-full rounded object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-bold text-white truncate flex-grow pr-2",children:t.title}),e.jsx("input",{type:"checkbox",checked:G.includes(t.id),onChange:()=>D(t.id),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 flex-shrink-0"})]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1 flex items-center gap-x-2 flex-wrap",children:[e.jsx("span",{children:t.year}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{className:"text-yellow-400 font-bold",children:t.imdb_rating?t.imdb_rating.toFixed(1):"N/A"}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{children:t.is_kurdish?"كردي":"غير كردي"})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[(f=t.genres)==null?void 0:f.slice(0,2).map(L=>e.jsx("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:L},L)),((N=t.genres)==null?void 0:N.length)>2&&e.jsxs("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:["+",t.genres.length-2]})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 flex justify-end items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-xs text-slate-500 mr-auto",children:["أضيف في: ",t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"N/A"]}),e.jsx("button",{onClick:()=>te(t),className:"font-medium text-cyan-400 hover:text-cyan-300",children:"تعديل"}),e.jsx("button",{onClick:()=>X(t),className:"font-medium text-red-500 hover:text-red-400",children:"حذف"})]})]},t.id)})]})]}),Y.length>pe&&e.jsx("div",{className:"p-4 mt-4 border-t border-slate-700",children:e.jsx(Se,{currentPage:l,totalPages:s,onPageChange:p})})]})},ls=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),os=({onSubmit:c,initialData:a,onCancel:h,isLoading:x=!1,allGenres:j=[]})=>{const[i,l]=o.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:"",year:new Date().getFullYear(),episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"}],imdb_rating:0}],trailer_url:"",imdb_rating:0}),[p,k]=o.useState(""),[T,U]=o.useState(!1),z=o.useRef(null);o.useEffect(()=>{a&&(l({...a,genres:a.genres||[],tags:a.tags||[],seasons:a.seasons&&a.seasons.length>0?a.seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:a.poster_url,year:a.year,episodes:[],imdb_rating:0}],trailer_url:a.trailer_url||"",imdb_rating:a.imdb_rating||0}),k((a.tags||[]).join(", ")))},[a]),o.useEffect(()=>{const m=d=>{z.current&&!z.current.contains(d.target)&&U(!1)};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[]);const W=async m=>{var d;try{if(!((d=navigator.clipboard)!=null&&d.readText))throw new Error("Clipboard API not available.");const u=await navigator.clipboard.readText();u&&m(u)}catch(u){console.error("Failed to read clipboard contents: ",u),alert("فشل لصق النص. يرجى التأكد من منح الإذن لاستخدام الحافظة.")}},g=m=>{const{name:d,value:u}=m.target;if(d==="year"||d==="imdb_rating"){const C=parseFloat(u);l(w=>({...w,[d]:isNaN(C)?0:C}))}else l(C=>({...C,[d]:u}))},$=m=>{k(m.target.value)},q=m=>{l(d=>({...d,genres:d.genres.includes(m)?d.genres.filter(u=>u!==m):[...d.genres,m]}))},A=(m,d,u)=>{const C=[...i.seasons],w={...C[m]};if(d==="season_number"||d==="year"||d==="imdb_rating"){const P=typeof u=="string"?parseFloat(u):u;w[d]=isNaN(P)?0:P}else w[d]=u;C[m]=w,l(P=>({...P,seasons:C}))},M=()=>{const m=i.seasons.length>0?Math.max(...i.seasons.map(u=>u.season_number))+1:1,d=i.seasons.length>0?i.seasons[i.seasons.length-1].year:i.year;l(u=>({...u,seasons:[...u.seasons,{season_number:m,title:`الموسم ${m}`,description:"",poster_url:u.poster_url,year:d+1,episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"}],imdb_rating:0}]}))},R=m=>{l(d=>({...d,seasons:d.seasons.filter((u,C)=>C!==m)}))},_=(m,d,u,C)=>{const w=[...i.seasons],P=[...w[m].episodes],H={...P[d]};if(u==="episode_number"){const X=typeof C=="string"?parseFloat(C):C;H[u]=isNaN(X)?0:X}else H[u]=C;P[d]=H,w[m]={...w[m],episodes:P},l(X=>({...X,seasons:w}))},E=m=>{const d=i.seasons[m],u=d.episodes.length>0?Math.max(...d.episodes.map(P=>P.episode_number))+1:1,C={episode_number:u,title:`الحلقة ${u}`,url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"},w=i.seasons.map((P,H)=>H===m?{...P,episodes:[...P.episodes,C]}:P);l(P=>({...P,seasons:w}))},I=(m,d)=>{const u=i.seasons.map((C,w)=>w===m?{...C,episodes:C.episodes.filter((P,H)=>H!==d)}:C);l(C=>({...C,seasons:u}))},G=m=>{m.preventDefault();const d=p.split(",").map(u=>u.trim()).filter(Boolean);c({...i,tags:d})},y="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",B="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white border-b border-slate-700 pb-2",children:"معلومات المسلسل الرئيسية"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:i.title,onChange:g,placeholder:"عنوان المسلسل",required:!0,className:y}),e.jsx("input",{type:"number",name:"year",value:i.year||"",onChange:g,placeholder:"سنة بداية العرض",required:!0,className:y})]}),e.jsx("textarea",{name:"description",value:i.description,onChange:g,placeholder:"وصف المسلسل العام",required:!0,className:`${y} h-24`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"poster_url",value:i.poster_url,onChange:g,placeholder:"رابط البوستر الرئيسي",required:!0,className:y}),e.jsx("input",{type:"url",name:"backdrop_url",value:i.backdrop_url,onChange:g,placeholder:"رابط صورة الخلفية",required:!0,className:y})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:i.imdb_rating??"",onChange:g,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:y}),e.jsx("input",{type:"url",name:"trailer_url",value:i.trailer_url??"",onChange:g,placeholder:"رابط المقطع الدعائي (اختياري)",className:y})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات"}),e.jsxs("div",{className:"relative",ref:z,children:[e.jsx("button",{type:"button",onClick:()=>U(m=>!m),className:`${y} text-right`,children:i.genres.length>0?i.genres.join(", "):"اختر الفئات..."}),T&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:j.map(m=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:i.genres.includes(m),onChange:()=>q(m),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:m})]},m))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (مفصولة بفاصلة)"}),e.jsx("input",{type:"text",value:p,onChange:$,placeholder:"أكشن, إثارة...",className:y})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),i.seasons.map((m,d)=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-white font-semibold",children:"الموسم رقم:"}),e.jsx("input",{type:"number",value:m.season_number||"",onChange:u=>A(d,"season_number",u.target.value),className:`${B} w-20`})]}),e.jsx("button",{type:"button",onClick:()=>R(d),className:"bg-red-600 text-white px-3 py-1 rounded-md text-sm",children:"إزالة الموسم"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",value:m.title,onChange:u=>A(d,"title",u.target.value),placeholder:"عنوان الموسم",required:!0,className:B}),e.jsx("input",{type:"number",value:m.year||"",onChange:u=>A(d,"year",u.target.value),placeholder:"سنة الموسم",required:!0,className:B}),e.jsx("input",{type:"number",value:m.imdb_rating??"",onChange:u=>A(d,"imdb_rating",u.target.value),placeholder:"تقييم IMDb",step:"0.1",min:"0",max:"10",className:B}),e.jsx("input",{type:"url",value:m.poster_url,onChange:u=>A(d,"poster_url",u.target.value),placeholder:"رابط بوستر الموسم",required:!0,className:`${B} col-span-1 sm:col-span-3`}),e.jsx("textarea",{value:m.description,onChange:u=>A(d,"description",u.target.value),placeholder:"وصف الموسم",required:!0,className:`${B} h-20 col-span-1 sm:col-span-3`})]}),e.jsxs("div",{className:"space-y-2 pt-3 mt-3 border-t border-slate-600",children:[e.jsxs("h4",{className:"font-semibold text-slate-300",children:["حلقات الموسم ",m.season_number,":"]}),m.episodes.map((u,C)=>e.jsxs("div",{className:"bg-slate-800/60 p-2 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:u.episode_number||"",onChange:w=>_(d,C,"episode_number",w.target.value),placeholder:"رقم",className:`${B} w-16`}),e.jsx("input",{type:"text",value:u.title,onChange:w=>_(d,C,"title",w.target.value),placeholder:"عنوان الحلقة",className:`${B} flex-1`}),e.jsx("button",{type:"button",onClick:()=>I(d,C),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600 text-xs",children:"X"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("input",{type:"url",value:u.url,onChange:w=>_(d,C,"url",w.target.value),placeholder:"رابط المشاهدة",required:!0,className:`${B} flex-1`}),e.jsx("button",{type:"button",onClick:()=>W(w=>_(d,C,"url",w)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsxs("select",{value:u.quality||"1080p",onChange:w=>_(d,C,"quality",w.target.value),className:`${B} w-28 flex-shrink-0`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]})]}),e.jsx("input",{type:"url",value:u.download_url||"",onChange:w=>_(d,C,"download_url",w.target.value),placeholder:"رابط التحميل (اختياري)",className:`${B} w-full`})]})]},C)),e.jsx("button",{type:"button",onClick:()=>E(d),className:"text-sm bg-slate-600 text-white py-1 px-3 rounded-md hover:bg-slate-500",children:"إضافة حلقة"})]})]},d)),e.jsx("button",{type:"button",onClick:M,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700",children:"إضافة موسم"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:h,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg",disabled:x,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg",disabled:x,children:[x&&e.jsx(ls,{}),a?"تحديث المسلسل":"إضافة المسلسل"]})]})]})},ge=10,is=()=>{const[c,a]=o.useState([]),[h,x]=o.useState(null),[j,i]=o.useState(!1),[l,p]=o.useState(1),[k,T]=o.useState(""),[U,z]=o.useState(!1),[W,g]=o.useState(null),[$,q]=o.useState(!0),[A,M]=o.useState(!1),[R,_]=o.useState(null),[E,I]=o.useState([]),[G,y]=o.useState(null),[B,m]=o.useState([]),d=async()=>{const{data:s,error:r}=await S.from("series").select("*").order("created_at",{ascending:!1});r?(console.error("Error fetching series: ",r),u("فشل في تحميل المسلسلات.","error")):a(s);const{data:n,error:b}=await S.from("categories").select("name").order("name");b?console.error("Error fetching categories: ",b):m(n.map(t=>t.name)),q(!1)};o.useEffect(()=>{q(!0),d();const s=S.channel("public:series").on("postgres_changes",{event:"*",schema:"public",table:"series"},d).subscribe();return()=>{S.removeChannel(s)}},[]),o.useEffect(()=>{p(1),I([])},[k]);const u=(s,r)=>{_({message:s,type:r})},C=async s=>{M(!0);try{const{error:r}=await S.from("series").insert([{...s,created_at:new Date().toISOString()}]);if(r)throw r;await d(),i(!1),p(1),u("تمت إضافة المسلسل بنجاح.","success")}catch(r){console.error("Error adding series: ",r);const n=r.message||JSON.stringify(r);u(`حدث خطأ أثناء إضافة المسلسل: ${n}`,"error")}finally{M(!1)}},w=async(s,r)=>{M(!0);try{const{error:n}=await S.from("series").update(r).eq("id",s);if(n)throw n;await d(),x(null),i(!1),u("تم تحديث المسلسل بنجاح.","success")}catch(n){console.error("Error updating series:",n);const b=n.message||JSON.stringify(n);u(`حدث خطأ أثناء تحديث المسلسل: ${b}`,"error")}finally{M(!1)}},P=s=>{g(s),z(!0)},H=async()=>{if(W){M(!0);try{const{error:s}=await S.from("series").delete().eq("id",W.id);if(s)throw s;u("تم حذف المسلسل بنجاح.","success")}catch(s){console.error("Error deleting series:",s);const r=s.message||JSON.stringify(s);u(`حدث خطأ أثناء حذف المسلسل: ${r}`,"error")}finally{z(!1),g(null),M(!1)}}},X=s=>{x(s),i(!0)},ae=()=>{x(null),i(!0)},te=()=>{x(null),i(!1),y(null)},v=s=>{I(r=>r.includes(s)?r.filter(n=>n!==s):[...r,s])},O=s=>{s.target.checked?I(V.map(r=>r.id)):I(E.filter(r=>!V.some(n=>n.id===r)))},D=async()=>{M(!0);try{const{error:s}=await S.from("series").delete().in("id",E);if(s)throw s;u(`تم حذف ${E.length} مسلسل بنجاح.`,"success"),I([])}catch(s){console.error("Bulk delete failed:",s),u("فشل الحذف الجماعي.","error")}finally{M(!1),y(null)}},K=async(s,r)=>{M(!0);try{const{data:n,error:b}=await S.from("series").select("id, genres").in("id",E);if(b)throw b;const t=n.map(N=>{const L=N.genres||[],Z=r==="add"?[...new Set([...L,s])]:L.filter(se=>se!==s);return{id:N.id,genres:Z}}),{error:f}=await S.from("series").upsert(t);if(f)throw f;u(`تم ${r==="add"?"إضافة":"إزالة"} فئة "${s}" بنجاح.`,"success"),I([])}catch(n){console.error("Bulk genre change failed:",n),u("فشل تغيير الفئة الجماعي.","error")}finally{M(!1),y(null)}},J=async(s,r)=>{M(!0);try{const{data:n,error:b}=await S.from("series").select("id, tags").in("id",E);if(b)throw b;const t=n.map(N=>{const L=N.tags||[],Z=r==="add"?[...new Set([...L,s])]:L.filter(se=>se!==s);return{id:N.id,tags:Z}}),{error:f}=await S.from("series").upsert(t);if(f)throw f;u(`تم ${r==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${s}" بنجاح.`,"success"),I([])}catch(n){console.error("Bulk tags change failed:",n),u("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{M(!1),y(null)}},F=c.filter(s=>Re(k,s.title)),Q=Math.ceil(F.length/ge),V=F.slice((l-1)*ge,l*ge),Y=V.length>0&&V.every(s=>E.includes(s.id));return $?e.jsx(Ge,{}):e.jsxs("div",{className:"relative",children:[R&&e.jsx(_e,{...R,onClose:()=>_(null)}),e.jsx(ne,{isOpen:U,onClose:()=>z(!1),onConfirm:H,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',W==null?void 0:W.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:A}),G==="delete"&&e.jsx(ne,{isOpen:!0,onClose:()=>y(null),onConfirm:D,title:`تأكيد حذف ${E.length} مسلسل`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:A}),G==="genre"&&e.jsx(Le,{genres:B,onClose:te,onSubmit:K,isLoading:A}),G==="tags"&&e.jsx(Ue,{onClose:te,onSubmit:J,isLoading:A}),j&&e.jsx(ue,{title:h?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:te,isOpen:j,children:e.jsx(os,{onSubmit:h?s=>w(h.id,s):C,initialData:h,onCancel:te,isLoading:A,allGenres:B})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:ae,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:k,onChange:s=>T(s.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a series to edit"})]})]}),E.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[E.length," مسلسل محدد"]}),e.jsx("button",{onClick:()=>I([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>y("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>y("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>y("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto hidden lg:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:O,checked:Y,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:V.map(s=>{var r,n,b;return e.jsxs("tr",{className:`${E.includes(s.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:E.includes(s.id),onChange:()=>v(s.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:s.poster_url,alt:s.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:s.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:s.imdb_rating?s.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:s.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(r=s.genres)==null?void 0:r.slice(0,3).map(t=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:t},t)),((n=s.genres)==null?void 0:n.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:((b=s.seasons)==null?void 0:b.length)||0}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:s.created_at?new Date(s.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>X(s),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>P(s),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},s.id)})})]})}),e.jsxs("div",{className:"block lg:hidden space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx("input",{type:"checkbox",onChange:O,checked:Y,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("label",{className:"text-sm text-slate-300",children:"تحديد الكل في هذه الصفحة"})]}),V.map(s=>{var r,n,b;return e.jsxs("div",{className:`p-3 rounded-lg transition-all duration-200 ${E.includes(s.id)?"bg-cyan-500/20 ring-2 ring-cyan-500":"bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24",children:e.jsx("img",{src:s.poster_url,alt:s.title,className:"w-full rounded object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-bold text-white truncate flex-grow pr-2",children:s.title}),e.jsx("input",{type:"checkbox",checked:E.includes(s.id),onChange:()=>v(s.id),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 flex-shrink-0"})]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1 flex items-center gap-x-2 flex-wrap",children:[e.jsx("span",{children:s.year}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{className:"text-yellow-400 font-bold",children:s.imdb_rating?s.imdb_rating.toFixed(1):"N/A"}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsxs("span",{children:[((r=s.seasons)==null?void 0:r.length)||0," مواسم"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[(n=s.genres)==null?void 0:n.slice(0,2).map(t=>e.jsx("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:t},t)),((b=s.genres)==null?void 0:b.length)>2&&e.jsxs("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:["+",s.genres.length-2]})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 flex justify-end items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-xs text-slate-500 mr-auto",children:["أضيف في: ",s.created_at?new Date(s.created_at).toLocaleDateString("ar-EG"):"N/A"]}),e.jsx("button",{onClick:()=>X(s),className:"font-medium text-cyan-400 hover:text-cyan-300",children:"تعديل"}),e.jsx("button",{onClick:()=>P(s),className:"font-medium text-red-500 hover:text-red-400",children:"حذف"})]})]},s.id)})]})]}),F.length>ge&&e.jsx("div",{className:"p-4 mt-4 border-t border-slate-700",children:e.jsx(Se,{currentPage:l,totalPages:Q,onPageChange:p})})]})},cs=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ds=({onSubmit:c,initialData:a,onCancel:h,isLoading:x=!1})=>{const[j,i]=o.useState("");o.useEffect(()=>{i(a?a.name:"")},[a]);const l=p=>{p.preventDefault(),j.trim()&&c({name:j})};return e.jsxs("form",{onSubmit:l,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:j,onChange:p=>i(p.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:h,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:x,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:x,children:[x&&e.jsx(cs,{}),x?a?"جاري التحديث...":"جاري الإضافة...":a?"تحديث":"إضافة"]})]})]})},us=10,ms=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(us)].map((c,a)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},a))})]})})}),xs=({isOpen:c,onClose:a,onSubmit:h,isLoading:x,categories:j})=>{const[i,l]=o.useState(""),[p,k]=o.useState(""),[T,U]=o.useState(""),z=es.useMemo(()=>j.filter(g=>g.name!==i),[j,i]);o.useEffect(()=>{if(c&&j.length>0){const g=j[0].name;l(g);const $=j.filter(q=>q.name!==g);k($.length>0?$[0].name:"")}},[c,j]),o.useEffect(()=>{U(i&&p&&i===p?"لا يمكن دمج فئة مع نفسها. الرجاء اختيار فئتين مختلفتين.":"")},[i,p]),o.useEffect(()=>{z.some(g=>g.name===p)||k(z.length>0?z[0].name:"")},[i,z,p]);const W=g=>{g.preventDefault(),!(T||!i||!p)&&h(i,p)};return e.jsx(ue,{title:"توحيد (دمج) الفئات",onClose:a,isOpen:c,children:e.jsxs("form",{onSubmit:W,className:"space-y-6",children:[e.jsx("p",{className:"text-slate-300",children:"سيتم نقل كل المحتوى من الفئة المصدر إلى الفئة الهدف، ثم سيتم حذف الفئة المصدر نهائياً."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source_category",className:"block text-sm font-medium text-slate-300 mb-2",children:"دمج من هذه الفئة (سيتم حذفها):"}),e.jsx("select",{id:"source_category",value:i,onChange:g=>l(g.target.value),required:!0,className:"w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",children:j.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"destination_category",className:"block text-sm font-medium text-slate-300 mb-2",children:"الدمج في هذه الفئة (ستبقى):"}),e.jsx("select",{id:"destination_category",value:p,onChange:g=>k(g.target.value),required:!0,className:"w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",disabled:z.length===0,children:z.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id))})]}),T&&e.jsx("p",{className:"text-red-400 text-center text-sm bg-red-500/10 p-2 rounded-md",children:T}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:a,disabled:x,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:x||!!T||!i||!p,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",children:[x&&e.jsx(de,{}),x?"جاري الدمج...":"تنفيذ الدمج"]})]})]})})},fe=10,hs=({message:c,type:a,onClose:h})=>(o.useEffect(()=>{const i=setTimeout(h,5e3);return()=>clearTimeout(i)},[h]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${a==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:c}),e.jsx("button",{onClick:h,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),ps=({children:c,onClose:a,title:h,isOpen:x})=>{const[j,i]=o.useState(x);return o.useEffect(()=>{if(x){i(!0),document.body.style.overflow="hidden";const l=p=>{p.key==="Escape"&&a()};return window.addEventListener("keydown",l),()=>{window.removeEventListener("keydown",l)}}else{const l=setTimeout(()=>{i(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(l)}},[x,a]),j?e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 ${x?"animate-fade-in":"animate-fade-out"}`,onClick:a,children:e.jsxs("div",{className:`bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700 ${x?"animate-zoom-in":"animate-zoom-out"}`,onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:h}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),c]})}):null},gs=()=>{const[c,a]=o.useState([]),[h,x]=o.useState(null),[j,i]=o.useState(!1),[l,p]=o.useState(1),[k,T]=o.useState(!1),[U,z]=o.useState(null),[W,g]=o.useState(!0),[$,q]=o.useState(!1),[A,M]=o.useState(null),[R,_]=o.useState(!1),[E,I]=o.useState(null),G=async()=>{const{data:v,error:O}=await S.from("categories").select("*").order("name");O?(console.error("Error fetching categories: ",O),y("فشل في تحميل الفئات.","error")):a(v),g(!1)};o.useEffect(()=>{g(!0),G();const v=S.channel("public:categories").on("postgres_changes",{event:"*",schema:"public",table:"categories"},G).subscribe();return()=>{S.removeChannel(v)}},[]);const y=(v,O)=>{M({message:v,type:O})},B=async v=>{q(!0);try{const{error:O}=await S.from("categories").insert([v]);if(O)throw O;y("تمت إضافة الفئة بنجاح!","success"),i(!1),p(1)}catch(O){console.error("Error adding category: ",O);const D=O.message||JSON.stringify(O);y(`حدث خطأ أثناء إضافة الفئة: ${D}`,"error")}finally{q(!1)}},m=async(v,O)=>{q(!0);const D=h==null?void 0:h.name,K=O.name,J=D&&K&&D!==K;try{const{error:F}=await S.from("categories").update(O).eq("id",v);if(F)throw F;if(J){y("تم تحديث الفئة. جاري تحديث المحتوى المرتبط...","success");const{data:Q,error:V}=await S.from("movies").select("id, genres").contains("genres",[D]);if(V)console.error("Error fetching movies to update:",V),y("تم تحديث الفئة، لكن حدث خطأ أثناء جلب الأفلام للتحديث.","error");else if(Q&&Q.length>0){const r=Q.map(t=>{const f=t.genres.map(N=>N===D?K:N);return S.from("movies").update({genres:f}).eq("id",t.id)}),b=(await Promise.all(r)).find(t=>t.error);b&&(console.error("Error updating movies with new category:",b.error),y("تم تحديث الفئة، لكن حدث خطأ أثناء تحديث بعض الأفلام.","error"))}const{data:Y,error:s}=await S.from("series").select("id, genres").contains("genres",[D]);if(s)console.error("Error fetching series to update:",s),y("تم تحديث الفئة، لكن حدث خطأ أثناء جلب المسلسلات للتحديث.","error");else if(Y&&Y.length>0){const r=Y.map(t=>{const f=t.genres.map(N=>N===D?K:N);return S.from("series").update({genres:f}).eq("id",t.id)}),b=(await Promise.all(r)).find(t=>t.error);b&&(console.error("Error updating series with new category:",b.error),y("تم تحديث الفئة، لكن حدث خطأ أثناء تحديث بعض المسلسلات.","error"))}y("تم تحديث الفئة والمحتوى المرتبط بنجاح!","success")}else y("تم تحديث الفئة بنجاح!","success");x(null),i(!1)}catch(F){if(console.error("Error updating category transaction: ",F),F.code==="23505")y(`فشل التحديث: اسم الفئة "${K}" موجود بالفعل.`,"error");else{const Q=F.message||JSON.stringify(F);y(`حدث خطأ أثناء تحديث الفئة: ${Q}`,"error")}}finally{q(!1)}},d=v=>{z(v),T(!0)},u=async()=>{if(U){q(!0);try{const{error:v}=await S.from("categories").delete().eq("id",U.id);if(v)throw v;y("تم حذف الفئة بنجاح!","success")}catch(v){console.error("Error deleting category: ",v);const O=v.message||JSON.stringify(v);y(`حدث خطأ أثناء حذف الفئة: ${O}`,"error")}finally{T(!1),z(null),q(!1)}}},C=v=>{x(v),i(!0)},w=()=>{x(null),i(!0)},P=()=>{x(null),i(!1)},H=(v,O)=>{_(!1),I({source:v,dest:O})},X=async()=>{if(!E)return;const{source:v,dest:O}=E;q(!0);try{y("جاري تحديث الأفلام...","success");const{data:D,error:K}=await S.from("movies").select("id, genres").contains("genres",[v]);if(K)throw new Error(`Failed to fetch movies: ${K.message}`);if(D&&D.length>0){const V=D.map(Y=>{const s=[...new Set(Y.genres.filter(r=>r!==v).concat([O]))];return S.from("movies").update({genres:s}).eq("id",Y.id)});await Promise.all(V)}y("جاري تحديث المسلسلات...","success");const{data:J,error:F}=await S.from("series").select("id, genres").contains("genres",[v]);if(F)throw new Error(`Failed to fetch series: ${F.message}`);if(J&&J.length>0){const V=J.map(Y=>{const s=[...new Set(Y.genres.filter(r=>r!==v).concat([O]))];return S.from("series").update({genres:s}).eq("id",Y.id)});await Promise.all(V)}y("جاري حذف الفئة المدمجة...","success");const{error:Q}=await S.from("categories").delete().eq("name",v);if(Q)throw new Error(`Failed to delete category: ${Q.message}`);y("تم دمج الفئات بنجاح!","success")}catch(D){console.error("Error merging categories: ",D),y(`فشل دمج الفئات: ${D.message}`,"error")}finally{I(null),q(!1)}},ae=Math.ceil(c.length/fe),te=c.slice((l-1)*fe,l*fe);return W?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(ms,{})]}):e.jsxs("div",{children:[A&&e.jsx(hs,{...A,onClose:()=>M(null)}),e.jsx(ne,{isOpen:k,onClose:()=>T(!1),onConfirm:u,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',U==null?void 0:U.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:$}),e.jsx(ne,{isOpen:!!E,onClose:()=>I(null),onConfirm:X,title:"تأكيد عملية الدمج",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد دمج الفئة ",e.jsxs("strong",{className:"text-white",children:['"',E==null?void 0:E.source,'"']})," في الفئة ",e.jsxs("strong",{className:"text-white",children:['"',E==null?void 0:E.dest,'"']}),"؟",e.jsx("br",{}),e.jsxs("span",{className:"text-yellow-400",children:['سيتم حذف الفئة "',E==null?void 0:E.source,'" نهائياً. لا يمكن التراجع عن هذا الإجراء.']})]}),isLoading:$}),e.jsx(xs,{isOpen:R,onClose:()=>_(!1),onSubmit:H,isLoading:$,categories:c}),e.jsx(ps,{isOpen:j,title:h?"تعديل الفئة":"إضافة فئة جديدة",onClose:P,children:e.jsx(ds,{onSubmit:h?v=>m(h.id,v):B,initialData:h,onCancel:P,isLoading:$})}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsx("button",{onClick:w,className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsx("button",{onClick:()=>_(!0),className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500 transition-colors",children:"توحيد الفئات"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden hidden sm:block",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:c.length>0?te.map(v=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:v.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>C(v),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>d(v),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},v.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})})}),e.jsx("div",{className:"block sm:hidden space-y-3",children:c.length>0?te.map(v=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-white",children:v.name}),e.jsxs("div",{className:"flex gap-4 flex-shrink-0",children:[e.jsx("button",{onClick:()=>C(v),className:"text-cyan-400 hover:text-cyan-300 text-sm font-medium",children:"تعديل"}),e.jsx("button",{onClick:()=>d(v),className:"text-red-500 hover:text-red-400 text-sm font-medium",children:"حذف"})]})]},v.id)):e.jsx("div",{className:"text-center py-8 text-gray-400 bg-slate-900/50 rounded-lg",children:"لا توجد فئات حالياً."})})]}),c.length>fe&&e.jsx("div",{className:"mt-4",children:e.jsx(Se,{currentPage:l,totalPages:ae,onPageChange:p})})]})},ve=["movies","series","categories"],fs=c=>c.replace(/[A-Z]/g,a=>`_${a.toLowerCase()}`),Ce=c=>Array.isArray(c)?c.map(a=>Ce(a)):c!==null&&typeof c=="object"&&c.constructor===Object?c.hasOwnProperty("seconds")&&c.hasOwnProperty("nanoseconds")&&Object.keys(c).length===2&&typeof c.seconds=="number"&&typeof c.nanoseconds=="number"?new Date(c.seconds*1e3).toISOString():c.hasOwnProperty("_seconds")&&c.hasOwnProperty("_nanoseconds")&&Object.keys(c).length===2&&typeof c._seconds=="number"&&typeof c._nanoseconds=="number"?new Date(c._seconds*1e3).toISOString():Object.keys(c).reduce((a,h)=>{const x=fs(h);return a[x]=Ce(c[h]),a},{}):c,bs=()=>{const[c,a]=o.useState(!1),[h,x]=o.useState(null),[j,i]=o.useState(!1),[l,p]=o.useState(null),k=(g,$)=>{x({message:g,type:$})},T=async()=>{a(!0),k("بدء عملية النسخ الاحتياطي... قد تستغرق هذه العملية بعض الوقت.","success");try{const g={};for(const _ of ve){const{data:E,error:I}=await S.from(_).select("*");if(I)throw I;g[_]=E||[]}const $=JSON.stringify(g,null,2),q=new Blob([$],{type:"application/json"}),A=URL.createObjectURL(q),M=document.createElement("a");M.href=A;const R=new Date().toISOString().slice(0,10);M.download=`supabase-backup-${R}.json`,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(A),k("تم إكمال النسخ الاحتياطي بنجاح!","success")}catch(g){console.error("Backup failed:",g);let $="فشل النسخ الاحتياطي. تحقق من وحدة التحكم لمزيد من التفاصيل.";g.code==="42501"&&($="فشل النسخ الاحتياطي: أذونات غير كافية. تأكد من أن قواعد RLS تسمح للمشرفين بقراءة المجموعات."),k($,"error")}finally{a(!1)}},U=g=>{var q;const $=(q=g.target.files)==null?void 0:q[0];if($){const A=new FileReader;A.onload=M=>{var R;try{const _=(R=M.target)==null?void 0:R.result,E=JSON.parse(_);p(E)}catch(_){k("ملف JSON غير صالح.","error"),console.error("JSON parsing error:",_),p(null)}},A.readAsText($)}},z=()=>{l?i(!0):k("الرجاء تحديد ملف نسخ احتياطي أولاً.","error")},W=async()=>{if(i(!1),!!l){a(!0),k("بدء عملية الاستعادة... هذه العملية ستستغرق وقتاً.","success");try{let g=0,$=[];for(const A of Object.keys(l)){if(!ve.includes(A)){$.push(A),console.warn(`Skipping restore for unsupported collection: "${A}"`);continue}const M=l[A];if(Array.isArray(M)&&M.length>0){const R=M.map(E=>Ce(E)),{error:_}=await S.from(A).upsert(R);if(_)throw console.error(`Error during upsert to "${A}":`,JSON.stringify(_,null,2)),console.error("First failed object (transformed):",JSON.stringify(R[0],null,2)),_;g++}}let q="تمت استعادة البيانات بنجاح!";$.length>0&&(q+=` تم تخطي المجموعات التالية: ${$.join(", ")}.`),g===0&&$.length>0?k(`لم يتم العثور على مجموعات بيانات صالحة للاستعادة في الملف. تم تخطي: ${$.join(", ")}.`,"error"):g>0?k(q,"success"):k("لم يتم العثور على بيانات صالحة للاستعادة في الملف.","error")}catch(g){console.error("Restore failed:",JSON.stringify(g,null,2));const $=`فشلت عملية الاستعادة: ${g.message||"خطأ غير معروف"}. يرجى مراجعة وحدة التحكم للحصول على التفاصيل الفنية.`;k($,"error")}finally{a(!1),p(null)}}};return e.jsxs("div",{className:"space-y-12",children:[h&&e.jsx(_e,{...h,onClose:()=>x(null)}),e.jsx(ne,{isOpen:j,onClose:()=>i(!1),onConfirm:W,title:"تأكيد استعادة البيانات",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد استعادة البيانات من هذا الملف؟",e.jsx("br",{}),e.jsx("strong",{className:"text-yellow-400",children:"تحذير:"})," سيتم الكتابة فوق أي بيانات موجودة في المجموعات التي لها نفس الأسماء. لا يمكن التراجع عن هذا الإجراء."]}),isLoading:c}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"النسخ الاحتياطي للبيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:["انقر على الزر أدناه لتصدير بيانات المحتوى العام (",ve.join(", "),"). لا يتم تضمين بيانات المستخدمين والمشرفين الخاصة في هذا النسخ الاحتياطي من جانب العميل لأسباب تتعلق بالأمان والأذونات."]}),e.jsxs("button",{onClick:T,disabled:c,className:"w-full flex items-center justify-center bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-800 disabled:cursor-wait",children:[c&&e.jsx(de,{}),c?"جاري التصدير...":"تصدير بيانات المحتوى الآن"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"استعادة البيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("div",{className:"p-4 border-l-4 border-yellow-500 bg-yellow-500/10 text-yellow-300 rounded-md",children:[e.jsx("strong",{className:"font-bold",children:"تحذير خطير:"})," استعادة البيانات من ملف ستقوم بالكتابة فوق البيانات الحالية في قاعدة البيانات. استخدم هذه الميزة بحذر شديد وتأكد من أنك تستخدم ملف النسخ الاحتياطي الصحيح."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"1. حدد ملف النسخ الاحتياطي (.json)"}),e.jsx("input",{type:"file",accept:".json",onChange:U,className:"w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-500/20 file:text-cyan-300 hover:file:bg-cyan-500/30"})]}),e.jsxs("button",{onClick:z,disabled:c||!l,className:"w-full flex items-center justify-center bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors disabled:bg-red-800 disabled:cursor-not-allowed disabled:cursor-wait",children:[c&&e.jsx(de,{}),c?"جاري الاستعادة...":"2. استعادة البيانات"]})]})]})]})},ke=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(ns,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx(is,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(gs,{})},{key:"backup",label:"النسخ الاحتياطي والاستعادة",component:e.jsx(bs,{})}],ys=({label:c,tabKey:a,activeTab:h,onClick:x})=>e.jsx("button",{onClick:()=>x(a),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex-shrink-0 ${h===a?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":h===a,children:c}),vs=()=>{var x;const[c,a]=o.useState(ke[0].key),h=(x=ke.find(j=>j.key===c))==null?void 0:x.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6 overflow-x-auto whitespace-nowrap scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",role:"tablist",children:ke.map(j=>e.jsx(ys,{label:j.label,tabKey:j.key,activeTab:c,onClick:a},j.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-3 sm:p-6 rounded-lg border border-slate-700",children:h})]})};export{vs as default};
