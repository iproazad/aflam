import{r as s,d as U,j as e,f as xe,F as Z,T as he,u as je}from"./index-COHSSNss.js";import{P as ie}from"./Pagination-4153t60u.js";const ve=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),we=({onSubmit:g,initialData:t,onCancel:c,isKurdishByDefault:l=!1,isLoading:b=!1,allGenres:h=[]})=>{const[m,y]=s.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:!1}),[S,w]=s.useState(""),[P,G]=s.useState(!1),[L,O]=s.useState(""),[R,z]=s.useState(""),[B,_]=s.useState(!1),E=s.useRef(null),[I,T]=s.useState(!1),[A,C]=s.useState(""),a=s.useRef(null);s.useEffect(()=>{t?(y({...t,genres:t.genres||[],tags:t.tags||[],servers:t.servers&&t.servers.length>0?t.servers:[{name:"Server 1",url:"",quality:"720p"}],backupServers:t.backupServers||[],trailerUrl:t.trailerUrl||"",isKurdish:t.isKurdish||!1}),w((t.tags||[]).join(", "))):(y({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:l}),w(""))},[t,l]),s.useEffect(()=>{const r=p=>{E.current&&!E.current.contains(p.target)&&G(!1)};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[]),s.useEffect(()=>{a.current&&clearTimeout(a.current);const r=m.title.trim();if(!r||t&&r===t.title.trim()){C(""),T(!1);return}return T(!0),C(""),a.current=window.setTimeout(async()=>{try{const p=await U.collection("movies").where("title","==",r).get();let f=!1;p.empty||(t?p.forEach(q=>{q.id!==t.id&&(f=!0)}):f=!0),C(f?"تحذير: فيلم بنفس هذا العنوان موجود بالفعل.":"")}catch(p){console.error("Error checking for duplicate title:",p)}finally{T(!1)}},500),()=>{a.current&&clearTimeout(a.current)}},[m.title,t]);const x=r=>{const{name:p,value:f,type:q}=r.target;if(q==="checkbox"){const{checked:K}=r.target;y(se=>({...se,[p]:K}))}else y(K=>({...K,[p]:p==="year"?parseInt(f):f}))},o=r=>{w(r.target.value)},i=r=>{y(p=>{const f=p.genres||[],q=f.includes(r)?f.filter(K=>K!==r):[...f,r];return{...p,genres:q}})},N=async()=>{const r=R.trim();if(r){if(h.some(p=>p.toLowerCase()===r.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}_(!0);try{await U.collection("categories").add({name:r}),y(p=>({...p,genres:[...p.genres||[],r]})),z("")}catch(p){console.error("Error adding new genre:",p),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{_(!1)}}},d=(r,p,f)=>{const q=[...m.servers];q[r]={...q[r],[p]:f},y(K=>({...K,servers:q}))},M=()=>{y(r=>{const p={name:`Server ${r.servers.length+1}`,url:"",quality:"720p"};return{...r,servers:[...r.servers,p]}})},j=r=>{y(p=>({...p,servers:p.servers.filter((f,q)=>q!==r)}))},D=(r,p,f)=>{const q=[...m.backupServers||[]];q[r]={...q[r],[p]:f},y(K=>({...K,backupServers:q}))},H=()=>{y(r=>{var p;return{...r,backupServers:[...r.backupServers||[],{name:`Backup Server ${(((p=r.backupServers)==null?void 0:p.length)||0)+1}`,url:"",quality:"720p"}]}})},W=r=>{y(p=>({...p,backupServers:(p.backupServers||[]).filter((f,q)=>q!==r)}))},te=r=>{if(r.preventDefault(),m.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const p=S.split(",").map(f=>f.trim()).filter(f=>f!=="");g({...m,tags:p})},Y=h.filter(r=>r.toLowerCase().includes(L.toLowerCase())),V="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",Q="bg-slate-600 text-white p-2 rounded-md border-2 border-slate-500 focus:border-cyan-500 outline-none focus:ring-2 focus:ring-cyan-500 transition";return e.jsxs("form",{onSubmit:te,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",name:"title",value:m.title,onChange:x,placeholder:"عنوان الفيلم",required:!0,className:V}),I&&e.jsx("p",{className:"text-xs text-slate-400 mt-1 animate-pulse",children:"جاري التحقق من العنوان..."}),A&&e.jsxs("p",{className:"text-sm text-yellow-400 mt-2 font-semibold flex items-center gap-2 animate-fade-in",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.636-1.21 2.37-1.21 3.006 0l5.485 10.47c.616 1.176-.24 2.62-1.503 2.62H4.275c-1.263 0-2.118-1.444-1.503-2.62l5.485-10.47zM9 9a1 1 0 011-1h0a1 1 0 011 1v3a1 1 0 01-2 0V9zm1 6a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),A]})]}),e.jsx("input",{type:"number",name:"year",value:m.year,onChange:x,placeholder:"سنة الإنتاج",required:!0,className:V})]}),e.jsx("textarea",{name:"description",value:m.description,onChange:x,placeholder:"وصف الفيلم",required:!0,className:`${V} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:m.posterUrl,onChange:x,placeholder:"رابط صورة البوستر",required:!0,className:V}),e.jsx("input",{type:"url",name:"backdropUrl",value:m.backdropUrl,onChange:x,placeholder:"رابط صورة الخلفية",required:!0,className:V})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:S,onChange:o,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:V})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"isKurdish",type:"checkbox",name:"isKurdish",checked:!!m.isKurdish,onChange:x,className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("label",{htmlFor:"isKurdish",className:"text-white cursor-pointer",children:"هذا الفيلم مدبلج للكردية"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:E,children:[e.jsxs("button",{type:"button",onClick:()=>G(r=>!r),className:`${V} text-right flex justify-between items-center min-h-[52px]`,"aria-haspopup":"true","aria-expanded":P,children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:m.genres.length>0?m.genres.map(r=>e.jsxs("span",{className:"bg-cyan-500 text-white text-xs font-semibold px-2 py-1 rounded-full flex items-center gap-1",children:[r,e.jsx("button",{type:"button",onClick:p=>{p.stopPropagation(),i(r)},className:"text-cyan-100 hover:text-white leading-none text-lg","aria-label":`إزالة ${r}`,children:"×"})]},r)):e.jsx("span",{className:"text-slate-400 px-1",children:"اختر الفئات..."})}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 text-slate-400 transition-transform ${P?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),P&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg animate-fade-in-up-fast",children:[e.jsx("div",{className:"p-2",children:e.jsx("input",{type:"text",placeholder:"ابحث عن فئة...",value:L,onChange:r=>O(r.target.value),className:"w-full bg-slate-800 text-white p-2 rounded-md focus:ring-2 focus:ring-cyan-500 border border-slate-600 outline-none",autoFocus:!0})}),e.jsx("ul",{className:"max-h-60 overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",children:Y.length>0?Y.map(r=>e.jsx("li",{children:e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-slate-700 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:m.genres.includes(r),onChange:()=>i(r),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("span",{className:"text-white select-none",children:r})]})},r)):e.jsx("li",{className:"text-slate-400 text-center p-4",children:"لا توجد نتائج"})}),e.jsx("div",{className:"border-t border-slate-700 p-2 mt-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"أو أضف فئة جديدة...",value:R,onChange:r=>z(r.target.value),onKeyDown:r=>{r.key==="Enter"&&(r.preventDefault(),N())},className:"flex-grow bg-slate-800 text-white p-2 text-sm rounded-md focus:ring-2 focus:ring-cyan-500 border border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:N,disabled:B||!R.trim(),className:"flex-shrink-0 bg-cyan-600 text-white px-3 py-1.5 text-sm font-bold rounded-md hover:bg-cyan-700 transition-colors disabled:bg-slate-500 disabled:cursor-not-allowed",children:B?"...":"إضافة"})]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"downloadUrl",value:m.downloadUrl??"",onChange:x,placeholder:"رابط التحميل (اختياري)",className:V}),e.jsx("input",{type:"url",name:"trailerUrl",value:m.trailerUrl??"",onChange:x,placeholder:"رابط المقطع الدعائي (اختياري)",className:V})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات المشاهدة"}),m.servers.map((r,p)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-slate-700/50 rounded-md",children:[e.jsx("input",{type:"text",value:r.name,onChange:f=>d(p,"name",f.target.value),placeholder:"اسم السيرفر",className:`${Q} flex-1`}),e.jsx("input",{type:"url",value:r.url,onChange:f=>d(p,"url",f.target.value),placeholder:"رابط السيرفر",required:!0,className:`${Q} flex-grow-[2]`}),e.jsxs("select",{value:r.quality,onChange:f=>d(p,"quality",f.target.value),className:`${Q} flex-1 cursor-pointer`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>j(p),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},p)),e.jsx("button",{type:"button",onClick:M,className:"mt-2 bg-slate-600 text-white py-2 px-4 rounded-md hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات احتياطية (اختياري)"}),(m.backupServers||[]).map((r,p)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-slate-700/50 rounded-md",children:[e.jsx("input",{type:"text",value:r.name,onChange:f=>D(p,"name",f.target.value),placeholder:"اسم السيرفر الاحتياطي",className:`${Q} flex-1`}),e.jsx("input",{type:"url",value:r.url,onChange:f=>D(p,"url",f.target.value),placeholder:"رابط السيرفر الاحتياطي",className:`${Q} flex-grow-[2]`}),e.jsxs("select",{value:r.quality,onChange:f=>D(p,"quality",f.target.value),className:`${Q} flex-1 cursor-pointer`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>W(p),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},p)),e.jsx("button",{type:"button",onClick:H,className:"mt-2 bg-slate-600 text-white py-2 px-4 rounded-md hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:c,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:b,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:b||!!A,children:[b&&e.jsx(ve,{}),b?t?"جاري التحديث...":"جاري الإضافة...":t?"تحديث":"إضافة"]})]})]})},Ne=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ee=({isOpen:g,onClose:t,onConfirm:c,title:l,message:b,isLoading:h=!1})=>g?e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4",onClick:t,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md animate-zoom-in border border-slate-700",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:l}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:b})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:c,disabled:h,children:[h&&e.jsx(Ne,{}),h?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:t,disabled:h,children:"إلغاء"})]})]})}):null,Ce=10,pe=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((g,t)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},t))})}),e.jsx("tbody",{children:[...Array(Ce)].map((g,t)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((c,l)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},l))]},t))})]})})]}),ge=({message:g,type:t,onClose:c})=>(s.useEffect(()=>{const h=setTimeout(c,5e3);return()=>clearTimeout(h)},[c]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${t==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:g}),e.jsx("button",{onClick:c,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),ae=({children:g,onClose:t,title:c})=>(s.useEffect(()=>{const l=b=>{b.key==="Escape"&&t()};return window.addEventListener("keydown",l),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",l),document.body.style.overflow="auto"}},[t]),e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4",onClick:t,children:e.jsx("div",{className:"relative bg-slate-800 rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] animate-zoom-in border border-slate-700",onClick:l=>l.stopPropagation(),children:e.jsxs("div",{className:"p-6 md:p-8 overflow-y-auto max-h-[90vh] scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:c}),e.jsx("button",{onClick:t,className:"text-slate-400 hover:text-white text-3xl transition-colors",children:"×"})]}),g]})})})),ue=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),be=({genres:g,onSubmit:t,onClose:c,isLoading:l})=>{const[b,h]=s.useState(g[0]||""),[m,y]=s.useState("add"),S=w=>{w.preventDefault(),b&&t(b,m)};return e.jsx(ae,{title:"تغيير الفئة بشكل جماعي",onClose:c,children:e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:b,onChange:w=>h(w.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:g.map(w=>e.jsx("option",{value:w,children:w},w))}),e.jsxs("select",{value:m,onChange:w=>y(w.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:c,disabled:l,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:l||!b,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[l&&e.jsx(ue,{}),l?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},fe=({onSubmit:g,onClose:t,isLoading:c})=>{const[l,b]=s.useState(new Date().getFullYear()),h=m=>{m.preventDefault(),g(l)};return e.jsx(ae,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:t,children:e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:l,onChange:m=>b(parseInt(m.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:t,disabled:c,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:c,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[c&&e.jsx(ue,{}),c?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},ye=({onSubmit:g,onClose:t,isLoading:c})=>{const[l,b]=s.useState(""),[h,m]=s.useState("add"),y=S=>{S.preventDefault(),l.trim()&&g(l.trim(),h)};return e.jsx(ae,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:t,children:e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:l,onChange:S=>b(S.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:h,onChange:S=>m(S.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:t,disabled:c,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:c||!l.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[c&&e.jsx(ue,{}),c?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},le=10,ke=()=>{const[g,t]=s.useState([]),[c,l]=s.useState(null),[b,h]=s.useState(!1),[m,y]=s.useState(1),[S,w]=s.useState("all"),[P,G]=s.useState(""),[L,O]=s.useState(!1),[R,z]=s.useState(null),[B,_]=s.useState(!0),[E,I]=s.useState(!1),[T,A]=s.useState(null),[C,a]=s.useState([]),[x,o]=s.useState(null),[i,N]=s.useState([]);s.useEffect(()=>{_(!0);const n=U.collection("movies").orderBy("createdAt","desc").onSnapshot(F=>{const X=F.docs.map(J=>({id:J.id,...J.data()}));t(X),_(!1)},F=>{console.error("Error fetching movies: ",F),A({message:"فشل في تحميل الأفلام.",type:"error"}),_(!1)}),v=U.collection("categories").orderBy("name").onSnapshot(F=>{const X=F.docs.map(J=>J.data().name);N(X)},F=>{console.error("Error fetching categories from ManageMovies: ",F)});return()=>{n(),v()}},[]),s.useEffect(()=>{y(1),a([])},[S,P]);const d=(n,v)=>{A({message:n,type:v})},M=async n=>{I(!0);try{await U.collection("movies").add({...n,createdAt:he.now()}),h(!1),y(1),d("تمت إضافة الفيلم بنجاح.","success")}catch(v){console.error("Error adding movie: ",v),d("حدث خطأ أثناء إضافة الفيلم.","error")}finally{I(!1)}},j=async(n,v)=>{I(!0);try{await U.collection("movies").doc(n).update(v),l(null),h(!1),d("تم تحديث الفيلم بنجاح.","success")}catch(F){console.error("Error updating movie: ",F),d("حدث خطأ أثناء تحديث الفيلم.","error")}finally{I(!1)}},D=n=>{z(n),O(!0)},H=async()=>{if(R){I(!0);try{await U.collection("movies").doc(R.id).delete(),d("تم حذف الفيلم بنجاح.","success")}catch(n){console.error("Error deleting movie: ",n),d("حدث خطأ أثناء حذف الفيلم.","error")}finally{O(!1),z(null),I(!1)}}},W=n=>{l(n),h(!0)},te=()=>{l(null),h(!0)},Y=()=>{l(null),h(!1),o(null)},V=n=>{a(v=>v.includes(n)?v.filter(F=>F!==n):[...v,n])},Q=n=>{n.target.checked?a(u.map(v=>v.id)):a([])},r=async(n,v)=>{I(!0);try{const F=U.batch();C.forEach(X=>{const J=U.collection("movies").doc(X);F.update(J,n)}),await F.commit(),d(v,"success"),a([])}catch(F){console.error("Bulk update failed:",F),d("فشل التحديث الجماعي.","error")}finally{I(!1),o(null)}},p=async()=>{I(!0);try{const n=U.batch();C.forEach(v=>{const F=U.collection("movies").doc(v);n.delete(F)}),await n.commit(),d(`تم حذف ${C.length} فيلم بنجاح.`,"success"),a([])}catch(n){console.error("Bulk delete failed:",n),d("فشل الحذف الجماعي.","error")}finally{I(!1),o(null)}},f=async(n,v)=>{const F={genres:v==="add"?Z.arrayUnion(n):Z.arrayRemove(n)};await r(F,`تم ${v==="add"?"إضافة":"إزالة"} فئة "${n}" بنجاح.`)},q=async(n,v)=>{const F={tags:v==="add"?Z.arrayUnion(n):Z.arrayRemove(n)};await r(F,`تم ${v==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${n}" بنجاح.`)},K=g.filter(n=>S==="kurdish"?n.isKurdish===!0:S==="non-kurdish"?!n.isKurdish:!0).filter(n=>xe(P,n.title)),se=Math.ceil(K.length/le),u=K.slice((m-1)*le,m*le),k=n=>`px-4 py-2 text-sm font-bold rounded-lg transition-colors duration-200 ${S===n?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-md":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,$=u.length>0&&C.length===u.length;return B?e.jsx(pe,{}):e.jsxs("div",{className:"relative",children:[T&&e.jsx(ge,{...T,onClose:()=>A(null)}),e.jsx(ee,{isOpen:L,onClose:()=>O(!1),onConfirm:H,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',R==null?void 0:R.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:E}),x==="delete"&&e.jsx(ee,{isOpen:!0,onClose:()=>o(null),onConfirm:p,title:`تأكيد حذف ${C.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:E}),x==="genre"&&e.jsx(be,{genres:i,onClose:Y,onSubmit:f,isLoading:E}),x==="tags"&&e.jsx(ye,{onClose:Y,onSubmit:q,isLoading:E}),x==="year"&&e.jsx(fe,{onClose:Y,onSubmit:n=>r({year:n},"تم تحديث السنة بنجاح."),isLoading:E}),x==="markKurdish"&&e.jsx(ee,{isOpen:!0,onClose:Y,onConfirm:()=>r({isKurdish:!0},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد تحديد كل هذه الأفلام على أنها كردية؟",isLoading:E}),x==="unmarkKurdish"&&e.jsx(ee,{isOpen:!0,onClose:Y,onConfirm:()=>r({isKurdish:!1},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد إزالة العلامة الكردية من كل هذه الأفلام؟",isLoading:E}),b&&e.jsx(ae,{title:c?"تعديل الفيلم":"إضافة فيلم جديد",onClose:Y,children:e.jsx(we,{onSubmit:c?n=>j(c.id,n):M,initialData:c,onCancel:Y,isKurdishByDefault:S==="kurdish"&&!c,isLoading:E,allGenres:i})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:te,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:P,onChange:n=>G(n.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-slate-900/50 rounded-lg flex-shrink-0",children:[e.jsx("button",{onClick:()=>w("all"),className:k("all"),children:"الكل"}),e.jsx("button",{onClick:()=>w("kurdish"),className:k("kurdish"),children:"كردي فقط"}),e.jsx("button",{onClick:()=>w("non-kurdish"),className:k("non-kurdish"),children:"غير كردي"})]})]}),C.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[C.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>a([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>o("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>o("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>o("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>o("markKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تحديد ككردي"}),e.jsx("button",{onClick:()=>o("unmarkKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"إلغاء تحديد ككردي"}),e.jsx("button",{onClick:()=>o("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:Q,checked:$,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الكلمات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"مدبلج كردي"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:u.map(n=>{var v,F,X,J,me;return e.jsxs("tr",{className:`${C.includes(n.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:C.includes(n.id),onChange:()=>V(n.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:n.posterUrl,alt:n.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:n.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:n.year}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(v=n.genres)==null?void 0:v.slice(0,3).map(re=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:re},re)),((F=n.genres)==null?void 0:F.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(X=n.tags)==null?void 0:X.slice(0,3).map(re=>e.jsx("span",{className:"bg-slate-600 text-cyan-200 px-2 py-1 text-xs rounded-full",children:re},re)),((J=n.tags)==null?void 0:J.length)>3&&e.jsx("span",{className:"bg-slate-600 text-cyan-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:n.isKurdish?"نعم":"لا"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:(me=n.createdAt)!=null&&me.toDate?n.createdAt.toDate().toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>W(n),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>D(n),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},n.id)})})]})}),K.length>le&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ie,{currentPage:m,totalPages:se,onPageChange:y})})]})]})},Se=({onSubmit:g,initialData:t,onCancel:c,isLoading:l=!1,allGenres:b=[]})=>{const[h,m]=s.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],trailerUrl:"",seasons:[{seasonNumber:1,episodes:[],_clientId:`s-${Date.now()}`}]}),[y,S]=s.useState("");s.useEffect(()=>{if(t){const a=(t.seasons||[]).map((x,o)=>({...x,episodes:(x.episodes||[]).map(i=>({...i,servers:i.servers&&i.servers.length>0?i.servers:[{name:"Server 1",url:"",quality:"720p"}]})),_clientId:x._clientId||`s-${Date.now()}-${o}`}));m({...t,genres:t.genres||[],tags:t.tags||[],seasons:a.length>0?a:[{seasonNumber:1,episodes:[],_clientId:`s-${Date.now()}`}]}),S((t.tags||[]).join(", "))}else m({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],trailerUrl:"",seasons:[{seasonNumber:1,episodes:[],_clientId:`s-${Date.now()}`}]}),S("")},[t]);const w=a=>{const{name:x,value:o}=a.target;m(i=>({...i,[x]:x==="year"?parseInt(o):o}))},P=a=>S(a.target.value),G=a=>{const x=Array.from(a.target.selectedOptions,o=>o.value);m(o=>({...o,genres:x}))},L=()=>{m(a=>({...a,seasons:[...a.seasons,{seasonNumber:a.seasons.length+1,episodes:[],_clientId:`s-${Date.now()}`}]}))},O=a=>{confirm("هل أنت متأكد من حذف هذا الموسم؟")&&m(x=>({...x,seasons:x.seasons.filter(o=>o._clientId!==a)}))},R=a=>{m(x=>({...x,seasons:x.seasons.map(o=>{if(o._clientId!==a)return o;const i={episodeNumber:o.episodes.length+1,title:`الحلقة ${o.episodes.length+1}`,servers:[{name:"Server 1",url:"",quality:"720p"}],downloadUrl:""};return{...o,episodes:[...o.episodes,i]}})}))},z=(a,x)=>{m(o=>({...o,seasons:o.seasons.map(i=>i._clientId!==a?i:{...i,episodes:i.episodes.filter((N,d)=>d!==x)})}))},B=(a,x,o,i)=>{m(N=>({...N,seasons:N.seasons.map(d=>d._clientId!==a?d:{...d,episodes:d.episodes.map((M,j)=>j!==x?M:{...M,[o]:i})})}))},_=(a,x,o,i,N)=>{m(d=>({...d,seasons:d.seasons.map(M=>M._clientId!==a?M:{...M,episodes:M.episodes.map((j,D)=>D!==x?j:{...j,servers:j.servers.map((H,W)=>W!==o?H:{...H,[i]:N})})})}))},E=(a,x)=>{m(o=>({...o,seasons:o.seasons.map(i=>i._clientId!==a?i:{...i,episodes:i.episodes.map((N,d)=>{if(d!==x)return N;const M={name:`Server ${N.servers.length+1}`,url:"",quality:"720p"};return{...N,servers:[...N.servers,M]}})})}))},I=(a,x,o)=>{m(i=>({...i,seasons:i.seasons.map(N=>N._clientId!==a?N:{...N,episodes:N.episodes.map((d,M)=>M!==x?d:{...d,servers:d.servers.filter((j,D)=>D!==o)})})}))},T=a=>{a.preventDefault();const x=y.split(",").map(i=>i.trim()).filter(Boolean),o=JSON.parse(JSON.stringify(h));o.seasons.forEach(i=>delete i._clientId),g({...o,tags:x})},A="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",C="bg-slate-600 text-white p-2 rounded-md border-2 border-slate-500 focus:border-cyan-500 outline-none focus:ring-2 focus:ring-cyan-500 transition";return e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:h.title,onChange:w,placeholder:"عنوان المسلسل",required:!0,className:A}),e.jsx("input",{type:"number",name:"year",value:h.year,onChange:w,placeholder:"سنة الإنتاج",required:!0,className:A})]}),e.jsx("textarea",{name:"description",value:h.description,onChange:w,placeholder:"وصف المسلسل",required:!0,className:`${A} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:h.posterUrl,onChange:w,placeholder:"رابط صورة البوستر",required:!0,className:A}),e.jsx("input",{type:"url",name:"backdropUrl",value:h.backdropUrl,onChange:w,placeholder:"رابط صورة الخلفية",required:!0,className:A})]}),e.jsx("input",{type:"url",name:"trailerUrl",value:h.trailerUrl??"",onChange:w,placeholder:"رابط المقطع الدعائي (اختياري)",className:A}),e.jsx("input",{type:"text",name:"tags",value:y,onChange:P,placeholder:"Tags (مفصولة بفاصلة)",className:A}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-white mb-2",children:"الفئات"}),e.jsx("select",{multiple:!0,value:h.genres,onChange:G,className:`${A} h-32`,children:b.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),h.seasons.map(a=>e.jsxs("div",{className:"p-4 bg-slate-700/50 rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h4",{className:"text-lg font-semibold text-cyan-400",children:["الموسم ",a.seasonNumber]}),e.jsx("button",{type:"button",onClick:()=>O(a._clientId),className:"text-red-500 hover:text-red-400",children:"حذف الموسم"})]}),a.episodes.map((x,o)=>e.jsxs("div",{className:"p-3 bg-slate-900/50 rounded-md space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:x.episodeNumber,onChange:i=>B(a._clientId,o,"episodeNumber",parseInt(i.target.value)),placeholder:"رقم الحلقة",className:C}),e.jsx("input",{type:"text",value:x.title,onChange:i=>B(a._clientId,o,"title",i.target.value),placeholder:"عنوان الحلقة",className:`${C} flex-grow`}),e.jsx("button",{type:"button",onClick:()=>z(a._clientId,o),className:"text-red-500 text-sm",children:"حذف"})]}),e.jsx("div",{className:"pl-4",children:e.jsx("input",{type:"url",value:x.downloadUrl||"",onChange:i=>B(a._clientId,o,"downloadUrl",i.target.value),placeholder:"رابط تحميل الحلقة (اختياري)",className:`${C} w-full`})}),x.servers.map((i,N)=>e.jsxs("div",{className:"flex items-center gap-2 pl-4",children:[e.jsx("input",{type:"text",value:i.name,onChange:d=>_(a._clientId,o,N,"name",d.target.value),placeholder:"اسم السيرفر",className:`${C} flex-1`}),e.jsx("input",{type:"url",value:i.url,onChange:d=>_(a._clientId,o,N,"url",d.target.value),placeholder:"رابط السيرفر",required:!0,className:`${C} flex-grow-[2]`}),e.jsxs("select",{value:i.quality,onChange:d=>_(a._clientId,o,N,"quality",d.target.value),className:`${C} flex-1`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>I(a._clientId,o,N),className:"bg-red-500 text-white p-1 rounded-md text-xs",children:"X"})]},N)),e.jsx("button",{type:"button",onClick:()=>E(a._clientId,o),className:"text-xs bg-slate-600 hover:bg-slate-500 text-white py-1 px-2 rounded-md ml-4",children:"إضافة سيرفر"})]},o)),e.jsx("button",{type:"button",onClick:()=>R(a._clientId),className:"bg-cyan-600 hover:bg-cyan-700 text-white py-2 px-4 rounded-md",children:"إضافة حلقة"})]},a._clientId)),e.jsx("button",{type:"button",onClick:L,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-5 rounded-lg",children:"إضافة موسم جديد"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:c,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500",disabled:l,children:"إلغاء"}),e.jsx("button",{type:"submit",className:"bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600",disabled:l,children:l?"جاري الحفظ...":t?"تحديث المسلسل":"إضافة المسلسل"})]})]})},ne=10,Ee=()=>{const[g,t]=s.useState([]),[c,l]=s.useState(null),[b,h]=s.useState(!1),[m,y]=s.useState(1),[S,w]=s.useState(""),[P,G]=s.useState(!1),[L,O]=s.useState(null),[R,z]=s.useState(!0),[B,_]=s.useState(!1),[E,I]=s.useState(null),[T,A]=s.useState([]),[C,a]=s.useState(null),[x,o]=s.useState([]);s.useEffect(()=>{z(!0);const u=U.collection("series").orderBy("createdAt","desc").onSnapshot($=>{const n=$.docs.map(v=>({id:v.id,...v.data()}));t(n),z(!1)},$=>{console.error("Error fetching series: ",$),I({message:"فشل في تحميل المسلسلات.",type:"error"}),z(!1)}),k=U.collection("categories").orderBy("name").onSnapshot($=>{const n=$.docs.map(v=>v.data().name);o(n)},$=>{console.error("Error fetching categories from ManageSeries: ",$)});return()=>{u(),k()}},[]),s.useEffect(()=>{y(1),A([])},[S]);const i=(u,k)=>{I({message:u,type:k})},N=async u=>{_(!0);try{await U.collection("series").add({...u,createdAt:he.now()}),h(!1),y(1),i("تمت إضافة المسلسل بنجاح.","success")}catch(k){console.error("Error adding series: ",k),k.code==="permission-denied"?i('خطأ في الأذونات. تأكد من أن قواعد أمان Firestore تسمح بالكتابة في مجموعة "series".',"error"):i("حدث خطأ أثناء إضافة المسلسل.","error")}finally{_(!1)}},d=async(u,k)=>{_(!0);try{await U.collection("series").doc(u).update(k),l(null),h(!1),i("تم تحديث المسلسل بنجاح.","success")}catch($){console.error("Error updating series: ",$),$.code==="permission-denied"?i('خطأ في الأذونات. تأكد من أن قواعد أمان Firestore تسمح بالكتابة في مجموعة "series".',"error"):i("حدث خطأ أثناء تحديث المسلسل.","error")}finally{_(!1)}},M=u=>{O(u),G(!0)},j=async()=>{if(L){_(!0);try{await U.collection("series").doc(L.id).delete(),i("تم حذف المسلسل بنجاح.","success")}catch(u){console.error("Error deleting series: ",u),i("حدث خطأ أثناء حذف المسلسل.","error")}finally{G(!1),O(null),_(!1)}}},D=u=>{l(u),h(!0)},H=()=>{l(null),h(!0)},W=()=>{l(null),h(!1),a(null)},te=u=>{A(k=>k.includes(u)?k.filter($=>$!==u):[...k,u])},Y=u=>{u.target.checked?A(K.map(k=>k.id)):A([])},V=async(u,k)=>{_(!0);try{const $=U.batch();T.forEach(n=>{const v=U.collection("series").doc(n);$.update(v,u)}),await $.commit(),i(k,"success"),A([])}catch($){console.error("Bulk update failed:",$),i("فشل التحديث الجماعي.","error")}finally{_(!1),a(null)}},Q=async()=>{_(!0);try{const u=U.batch();T.forEach(k=>{const $=U.collection("series").doc(k);u.delete($)}),await u.commit(),i(`تم حذف ${T.length} مسلسل بنجاح.`,"success"),A([])}catch(u){console.error("Bulk delete failed:",u),i("فشل الحذف الجماعي.","error")}finally{_(!1),a(null)}},r=async(u,k)=>{const $={genres:k==="add"?Z.arrayUnion(u):Z.arrayRemove(u)};await V($,`تم ${k==="add"?"إضافة":"إزالة"} فئة "${u}" بنجاح.`)},p=async(u,k)=>{const $={tags:k==="add"?Z.arrayUnion(u):Z.arrayRemove(u)};await V($,`تم ${k==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${u}" بنجاح.`)},f=g.filter(u=>xe(S,u.title)),q=Math.ceil(f.length/ne),K=f.slice((m-1)*ne,m*ne),se=K.length>0&&T.length===K.length;return R?e.jsx(pe,{}):e.jsxs("div",{className:"relative",children:[E&&e.jsx(ge,{...E,onClose:()=>I(null)}),e.jsx(ee,{isOpen:P,onClose:()=>G(!1),onConfirm:j,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',L==null?void 0:L.title,'"']}),"؟"]}),isLoading:B}),C==="delete"&&e.jsx(ee,{isOpen:!0,onClose:()=>a(null),onConfirm:Q,title:`تأكيد حذف ${T.length} مسلسل`,message:"هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",isLoading:B}),C==="genre"&&e.jsx(be,{genres:x,onClose:W,onSubmit:r,isLoading:B}),C==="tags"&&e.jsx(ye,{onClose:W,onSubmit:p,isLoading:B}),C==="year"&&e.jsx(fe,{onClose:W,onSubmit:u=>V({year:u},"تم تحديث السنة بنجاح."),isLoading:B}),b&&e.jsx(ae,{title:c?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:W,children:e.jsx(Se,{onSubmit:c?u=>d(c.id,u):N,initialData:c,onCancel:W,isLoading:B,allGenres:x})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:H,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsx("div",{className:"relative w-full sm:flex-grow",children:e.jsx("input",{type:"text",value:S,onChange:u=>w(u.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-4 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors"})})]}),T.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[T.length," مسلسل محدد"]}),e.jsx("button",{onClick:()=>A([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>a("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>a("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>a("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>a("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",onChange:Y,checked:se,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:K.map(u=>{var k,$;return e.jsxs("tr",{className:`${T.includes(u.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"}`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:T.includes(u.id),onChange:()=>te(u.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("img",{src:u.posterUrl,alt:u.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 font-medium text-white align-middle",children:u.title}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:u.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:((k=u.seasons)==null?void 0:k.length)||0}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:($=u.createdAt)!=null&&$.toDate?u.createdAt.toDate().toLocaleDateString("ar-EG"):"N/A"}),e.jsxs("td",{className:"px-4 py-2 align-middle",children:[e.jsx("button",{onClick:()=>D(u),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>M(u),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},u.id)})})]})}),f.length>ne&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ie,{currentPage:m,totalPages:q,onPageChange:y})})]})},Ae=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsx("div",{className:"p-4 bg-gray-900",children:e.jsx("div",{className:"h-6 bg-gray-600 rounded w-1/3"})}),e.jsx("div",{className:"divide-y divide-gray-700",children:[...Array(5)].map((g,t)=>e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-600 rounded w-20"})]},t))})]}),Me="yO8pzykKincc5zgbdJGdN6xISr03",oe=10,$e=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Ie=({message:g,type:t,onClose:c})=>(s.useEffect(()=>{const h=setTimeout(c,5e3);return()=>clearTimeout(h)},[c]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${t==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:g}),e.jsx("button",{onClick:c,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Ue=({children:g,onClose:t,title:c})=>(s.useEffect(()=>{const l=b=>{b.key==="Escape"&&t()};return window.addEventListener("keydown",l),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",l),document.body.style.overflow="auto"}},[t]),e.jsx("div",{className:"fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 animate-fade-in p-4",onClick:t,children:e.jsxs("div",{className:"bg-slate-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-slate-700 animate-zoom-in",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:c}),e.jsx("button",{onClick:t,className:"text-slate-400 hover:text-white text-3xl transition-colors",children:"×"})]}),g]})})),_e=()=>{const{currentUser:g}=je(),[t,c]=s.useState([]),[l,b]=s.useState(""),[h,m]=s.useState(""),[y,S]=s.useState(""),[w,P]=s.useState(!0),[G,L]=s.useState(!1),[O,R]=s.useState(1),[z,B]=s.useState(!1),[_,E]=s.useState(!1),[I,T]=s.useState(null),[A,C]=s.useState(null),a=(g==null?void 0:g.uid)===Me;s.useEffect(()=>{if(!a){P(!1);return}P(!0);const j=U.collection("admins").onSnapshot(D=>{const H=D.docs.map(W=>({id:W.id,uid:W.data().uid,email:W.data().email}));c(H),P(!1)},D=>{console.error(D),x("فشل في تحميل قائمة المشرفين.","error"),P(!1)});return()=>j()},[a]);const x=(j,D)=>{C({message:j,type:D})},o=async j=>{if(j.preventDefault(),S(""),!l.trim()||!h.trim()){S("الرجاء إدخال UID وبريد إلكتروني صالحين.");return}L(!0);try{await U.collection("admins").doc(l).set({uid:l,email:h}),x(`تمت إضافة المشرف ${h} بنجاح.`,"success"),B(!1),b(""),m("")}catch(D){console.error("Error adding admin:",D),x("فشل في إضافة المشرف.","error")}finally{L(!1)}},i=j=>{T(j),E(!0)},N=async()=>{if(I){L(!0);try{await U.collection("admins").doc(I.id).delete(),x(`تم حذف المشرف ${I.email} بنجاح.`,"success")}catch(j){console.error(j),x("حدث خطأ أثناء حذف المشرف.","error")}finally{E(!1),T(null),L(!1)}}};if(!a)return e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"إدارة المشرفين"}),e.jsx("p",{className:"text-yellow-300",children:"هذه الصفحة متاحة فقط للمشرف الأساسي."})]});const d=Math.ceil(t.length/oe),M=t.slice((O-1)*oe,O*oe);return e.jsxs(e.Fragment,{children:[A&&e.jsx(Ie,{...A,onClose:()=>C(null)}),e.jsx(ee,{isOpen:_,onClose:()=>E(!1),onConfirm:N,title:"تأكيد حذف المشرف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المشرف ",e.jsxs("strong",{className:"text-white",children:['"',I==null?void 0:I.email,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"سيؤدي هذا إلى إزالة صلاحيات المشرف الخاصة به."})]}),isLoading:G}),z&&e.jsx(Ue,{title:"إضافة مشرف جديد",onClose:()=>B(!1),children:e.jsxs("form",{onSubmit:o,className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"لإضافة مشرف جديد، يجب عليك الحصول على **معرّف المستخدم (UID)** الخاص به من لوحة تحكم Firebase Authentication."}),e.jsx("input",{type:"text",value:l,onChange:j=>b(j.target.value),placeholder:"معرّف المستخدم (UID)",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),e.jsx("input",{type:"email",value:h,onChange:j=>m(j.target.value),placeholder:"البريد الإلكتروني للمشرف",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),y&&e.jsx("p",{className:"text-red-500 text-center text-sm",children:y}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:()=>B(!1),className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:G,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:G,children:[G&&e.jsx($e,{}),G?"جاري الإضافة...":"إضافة مشرف"]})]})]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"المشرفون الحاليون"}),e.jsx("button",{onClick:()=>B(!0),className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة مشرف جديد"})]}),w?e.jsx(Ae,{}):e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-900/50 flex items-center justify-between",children:[e.jsxs("span",{className:"text-white font-bold",children:[g.email," (المشرف الأساسي)"]}),e.jsx("span",{className:"text-sm text-slate-500",children:"لا يمكن حذفه"})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:M.map(j=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-slate-700/50",children:[e.jsx("span",{className:"text-white",children:j.email}),e.jsx("button",{onClick:()=>i(j),className:"bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700 transition-colors",children:"حذف"})]},j.id))}),t.length>oe&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ie,{currentPage:O,totalPages:d,onPageChange:R})})]})]})]})},Fe=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Be=({onSubmit:g,initialData:t,onCancel:c,isLoading:l=!1})=>{const[b,h]=s.useState("");s.useEffect(()=>{h(t?t.name:"")},[t]);const m=y=>{y.preventDefault(),b.trim()&&g({name:b})};return e.jsxs("form",{onSubmit:m,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:b,onChange:y=>h(y.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:c,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:l,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:l,children:[l&&e.jsx(Fe,{}),l?t?"جاري التحديث...":"جاري الإضافة...":t?"تحديث":"إضافة"]})]})]})},Te=10,Pe=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(Te)].map((g,t)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},t))})]})})}),ce=10,De=({message:g,type:t,onClose:c})=>(s.useEffect(()=>{const h=setTimeout(c,5e3);return()=>clearTimeout(h)},[c]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${t==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:g}),e.jsx("button",{onClick:c,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),qe=({children:g,onClose:t,title:c})=>(s.useEffect(()=>{const l=b=>{b.key==="Escape"&&t()};return window.addEventListener("keydown",l),document.body.style.overflow="hidden",()=>{window.removeEventListener("keydown",l),document.body.style.overflow="auto"}},[t]),e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 animate-fade-in",onClick:t,children:e.jsxs("div",{className:"bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700",onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:c}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),g]})})),ze=()=>{const[g,t]=s.useState([]),[c,l]=s.useState(null),[b,h]=s.useState(!1),[m,y]=s.useState(1),[S,w]=s.useState(!1),[P,G]=s.useState(null),[L,O]=s.useState(!0),[R,z]=s.useState(!1),[B,_]=s.useState(null);s.useEffect(()=>{O(!0);const d=U.collection("categories").orderBy("name").onSnapshot(M=>{const j=M.docs.map(D=>({id:D.id,...D.data()}));t(j),O(!1)},M=>{console.error("Error fetching categories: ",M),E("فشل في تحميل الفئات.","error"),O(!1)});return()=>d()},[]);const E=(d,M)=>{_({message:d,type:M})},I=async d=>{z(!0);try{await U.collection("categories").add(d),E("تمت إضافة الفئة بنجاح!","success"),h(!1),y(1)}catch(M){console.error("Error adding category: ",M),E("حدث خطأ أثناء إضافة الفئة.","error")}finally{z(!1)}},T=async(d,M)=>{z(!0);try{await U.collection("categories").doc(d).update(M),E("تم تحديث الفئة بنجاح!","success"),l(null),h(!1)}catch(j){console.error("Error updating category: ",j),E("حدث خطأ أثناء تحديث الفئة.","error")}finally{z(!1)}},A=d=>{G(d),w(!0)},C=async()=>{if(P){z(!0);try{await U.collection("categories").doc(P.id).delete(),E("تم حذف الفئة بنجاح!","success")}catch(d){console.error("Error deleting category: ",d),E("حدث خطأ أثناء حذف الفئة.","error")}finally{w(!1),G(null),z(!1)}}},a=d=>{l(d),h(!0)},x=()=>{l(null),h(!0)},o=()=>{l(null),h(!1)},i=Math.ceil(g.length/ce),N=g.slice((m-1)*ce,m*ce);return L?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(Pe,{})]}):e.jsxs("div",{children:[B&&e.jsx(De,{...B,onClose:()=>_(null)}),e.jsx(ee,{isOpen:S,onClose:()=>w(!1),onConfirm:C,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',P==null?void 0:P.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:R}),b&&e.jsx(qe,{title:c?"تعديل الفئة":"إضافة فئة جديدة",onClose:o,children:e.jsx(Be,{onSubmit:c?d=>T(c.id,d):I,initialData:c,onCancel:o,isLoading:R})}),e.jsx("button",{onClick:x,className:"mb-6 bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:g.length>0?N.map(d=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:d.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>a(d),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>A(d),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},d.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})}),g.length>ce&&e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx(ie,{currentPage:m,totalPages:i,onPageChange:y})})]})]})},de=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(ke,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx(Ee,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(ze,{})},{key:"admins",label:"إدارة المشرفين",component:e.jsx(_e,{})}],Ge=({label:g,tabKey:t,activeTab:c,onClick:l})=>e.jsx("button",{onClick:()=>l(t),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px ${c===t?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":c===t,children:g}),Re=()=>{var l;const[g,t]=s.useState(de[0].key),c=(l=de.find(b=>b.key===g))==null?void 0:l.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6",role:"tablist",children:de.map(b=>e.jsx(Ge,{label:b.label,tabKey:b.key,activeTab:g,onClick:t},b.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-6 rounded-lg border border-slate-700",children:c})]})};export{Re as default};
