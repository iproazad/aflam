import{j as s,r as a,d as C,f as O}from"./index-O_ywPToh.js";import{H as D,a as Q}from"./HeroSliderSkeleton-D2fzt1tV.js";import{S as I,G as V,T as W,Y as q}from"./TagFilter-FcY2ThVR.js";import{M as J}from"./MovieGrid--G_F_iRi.js";import{M as U}from"./MovieGridSkeleton-C7iyvXZ4.js";import{P as X}from"./Pagination-Ip8Fm5_1.js";import"./useWatchLater-CPNT0oxF.js";import"./MovieCardSkeleton-WNI5yuEr.js";const Z=({searchQuery:l,onSearchChange:f})=>s.jsxs("div",{className:"relative w-full md:w-auto md:flex-grow",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),s.jsx("input",{type:"text",value:l,onChange:p=>f(p.target.value),placeholder:"ابحث عن فيلم...",className:"w-full bg-gray-700 text-white p-2 pl-10 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none","aria-label":"Search for movies by title"})]}),y=28,ne=()=>{const[l,f]=a.useState([]),[p,N]=a.useState([]),[T,G]=a.useState(!0),[n,E]=a.useState("all"),[i,S]=a.useState([]),[c,M]=a.useState([]),[g,_]=a.useState("createdAt_desc"),[m,P]=a.useState(""),[j,w]=a.useState(1);a.useEffect(()=>{(async()=>{try{let r=(await C.collection("movies").where("isKurdish","==",!0).get()).docs.map(o=>({id:o.id,...o.data()}));r.sort((o,u)=>{var d,A;const x=(d=o.createdAt)!=null&&d.toMillis?o.createdAt.toMillis():0;return((A=u.createdAt)!=null&&A.toMillis?u.createdAt.toMillis():0)-x}),f(r)}catch(t){console.error("Error fetching movies: ",t)}finally{G(!1)}})()},[]),a.useEffect(()=>{const e=C.collection("categories").orderBy("name").onSnapshot(t=>{const r=t.docs.map(o=>o.data().name);N(r)},t=>{console.error("Error fetching categories for Kurdish page: ",t)});return()=>e()},[]);const k=e=>{S(t=>t.includes(e)?t.filter(r=>r!==e):[...t,e])},B=()=>{S([])},F=e=>{M(t=>t.includes(e)?t.filter(r=>r!==e):[...t,e])},R=()=>{M([])},Y=[...new Set(l.map(e=>e.year))].sort((e,t)=>t-e),z=p,H=[...new Set(l.flatMap(e=>e.tags||[]))].sort(),v=a.useMemo(()=>l.filter(e=>n==="all"||e.year.toString()===n).filter(e=>i.length===0?!0:i.some(t=>{var r;return(r=e.genres)==null?void 0:r.includes(t)})).filter(e=>c.length===0?!0:c.some(t=>{var r;return(r=e.tags)==null?void 0:r.includes(t)})).filter(e=>O(m,e.title)).sort((e,t)=>{var r,o,u,x;switch(g){case"rating_desc":return(t.imdbRating||0)-(e.imdbRating||0);case"rating_asc":return(e.imdbRating||0)-(t.imdbRating||0);case"year_desc":return t.year-e.year;case"year_asc":return e.year-t.year;case"createdAt_asc":{const h=(r=e.createdAt)!=null&&r.toMillis?e.createdAt.toMillis():0,d=(o=t.createdAt)!=null&&o.toMillis?t.createdAt.toMillis():0;return h-d}case"createdAt_desc":default:{const h=(u=t.createdAt)!=null&&u.toMillis?t.createdAt.toMillis():0,d=(x=e.createdAt)!=null&&x.toMillis?e.createdAt.toMillis():0;return h-d}}}),[l,n,i,c,m,g]);a.useEffect(()=>{w(1)},[n,i,c,m,g]);const b=Math.ceil(v.length/y),K=v.slice((j-1)*y,j*y),L=m!==""||n!=="all"||i.length>0||c.length>0||g!=="createdAt_desc";return T?s.jsxs("div",{children:[s.jsx(D,{}),s.jsx("div",{className:"my-8 h-20 bg-gray-800/50 rounded-lg animate-pulse"}),s.jsxs("section",{className:"mb-12",children:[s.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"الأفلام المدبلجة للكردية"}),s.jsx(U,{count:18})]})]}):s.jsxs("div",{className:"animate-fade-in",children:[s.jsx(Q,{movies:l.slice(0,5)}),s.jsxs("div",{className:"relative z-30 my-8 flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl",children:[s.jsx(Z,{searchQuery:m,onSearchChange:P}),s.jsxs("div",{className:"w-full md:w-auto flex flex-col md:flex-row md:flex-wrap justify-center items-center gap-4",children:[s.jsx(I,{sortOrder:g,onSortChange:_}),s.jsx(V,{genres:z,selectedGenres:i,onToggleGenre:k,onClearGenres:B}),s.jsx(W,{tags:H,selectedTags:c,onToggleTag:F,onClearTags:R}),s.jsx(q,{years:Y,selectedYear:n,onYearChange:E})]})]}),s.jsxs("section",{className:"mb-12",children:[s.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:L?"نتائج البحث":"الأفلام المدبلجة للكردية"}),v.length>0?s.jsxs(s.Fragment,{children:[s.jsx(J,{movies:K}),b>1&&s.jsx(X,{currentPage:j,totalPages:b,onPageChange:w})]}):s.jsx("div",{className:"text-center p-8 bg-gray-800 rounded-lg mt-8",children:s.jsx("p",{className:"text-xl text-gray-400",children:"لا توجد أفلام مدبلجة للكردية تطابق معايير البحث."})})]})]})};export{ne as default};
