import{u as v,r as i,d as g,F as x,R as L,a as z,j as e,L as C}from"./index-fp27qG5V.js";const M=()=>{const{currentUser:t}=v(),[r,n]=i.useState([]);i.useEffect(()=>{if(!t){n([]);return}const o=g.collection("user_lists").doc(t.uid).onSnapshot(a=>{if(a.exists){const l=a.data();n((l==null?void 0:l.favorites)||[])}else n([])},a=>{console.error("Error listening to favorites:",a)});return()=>o()},[t]);const d=i.useCallback(async s=>{if(!t){console.warn("User must be logged in to manage favorites.");return}const o=g.collection("user_lists").doc(t.uid),a=r.includes(s);try{a?await o.update({favorites:x.arrayRemove(s)}):await o.set({favorites:x.arrayUnion(s)},{merge:!0})}catch(l){console.error("Error toggling favorite in Firestore:",l)}},[t,r]),c=i.useCallback(s=>r.includes(s),[r]);return{favorites:r,toggleFavorite:d,isFavorite:c}},R=()=>{const{currentUser:t}=v(),[r,n]=i.useState([]);i.useEffect(()=>{if(!t){n([]);return}const o=g.collection("user_lists").doc(t.uid).onSnapshot(a=>{if(a.exists){const l=a.data();n((l==null?void 0:l.watchLater)||[])}else n([])},a=>{console.error("Error listening to watch later list:",a)});return()=>o()},[t]);const d=i.useCallback(async s=>{if(!t){console.warn("User must be logged in to manage watch later list.");return}const o=g.collection("user_lists").doc(t.uid),a=r.includes(s);try{a?await o.update({watchLater:x.arrayRemove(s)}):await o.set({watchLater:x.arrayUnion(s)},{merge:!0})}catch(l){console.error("Error toggling watch later in Firestore:",l)}},[t,r]),c=i.useCallback(s=>r.includes(s),[r]);return{watchLater:r,toggleWatchLater:d,isWatchLater:c}},F=({isFavorite:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 sm:h-6 sm:w-6 transition-all duration-300 ${t?"text-red-500":"text-white"}`,fill:t?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.318 6.318a4.5 4.5 0 016.364 0L12 7.636l1.318-1.318a4.5 4.5 0 016.364 6.364L12 20.364l-7.682-7.682a4.5 4.5 0 010-6.364z"})}),W=({isWatchLater:t})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 sm:h-6 sm:w-6 transition-all duration-300 ${t?"text-cyan-400":"text-white"}`,fill:t?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"})}),A=()=>e.jsx("svg",{className:"h-4 w-4 text-yellow-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}),E=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 2a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 0110 2zM5.404 4.343a.75.75 0 010 1.06l-1.06 1.06a.75.75 0 01-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm9.192 0a.75.75 0 011.06 0l1.06 1.06a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zM2.75 10a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5h-1.5A.75.75 0 012.75 10zm12.5 0a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5h-1.5a.75.75 0 01-.75-.75zM5.404 15.657a.75.75 0 011.06 0l-1.06 1.06a.75.75 0 01-1.06-1.06l1.06-1.06zm9.192 0a.75.75 0 010 1.06l1.06 1.06a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 011.06 0zM10 14.25a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5a.75.75 0 01.75-.75z",clipRule:"evenodd"})}),S=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12.395 2.553a1 1 0 00-1.45-.385c-.345.675-.865 1.228-1.462 1.756C9.07 5.25 8.247 5.5 7.5 5.5c-1.25 0-2.312-.746-2.813-1.846a1 1 0 00-1.748.817c.22.48.51.92.85 1.307.34.386.72.724 1.14 1.003C6.152 7.64 7.042 8 8 8c.675 0 1.32-.206 1.84-.572A4.413 4.413 0 0011.03 6.16c.41-.37.77-.79.99-1.272a1 1 0 00-.01-1.107l-.02-.02zM15 12a1 1 0 100 2h.01a1 1 0 100-2H15zM3 12a1 1 0 100 2h.01a1 1 0 100-2H3zM9 12a1 1 0 100 2h.01a1 1 0 100-2H9z",clipRule:"evenodd"})}),U=()=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M7 4a1 1 0 012 0v12a1 1 0 11-2 0V4zM3 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm8 0a1 1 0 012 0v4a1 1 0 11-2 0V8zm4-2a1 1 0 012 0v8a1 1 0 11-2 0V6z"})}),V=({movie:t})=>{var w;const{currentUser:r}=v(),{isFavorite:n,toggleFavorite:d}=M(),{isWatchLater:c,toggleWatchLater:s}=R(),{getAverageRating:o}=z(),[a,l]=i.useState(!1),[p,f]=i.useState(!1),{average:m,count:u}=o(t.id),b=m>=4&&u>=10,j=(w=t.createdAt)!=null&&w.toDate?new Date().getTime()-t.createdAt.toDate().getTime()<10080*60*1e3:!1,y=t.isKurdish===!0,N=h=>{h.preventDefault(),h.stopPropagation(),d(t.id)},k=h=>{h.preventDefault(),h.stopPropagation(),s(t.id)};return e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-lg opacity-0 group-hover:opacity-75 transition duration-300"}),e.jsxs(C,{to:`/movie/${t.id}`,className:"relative block z-10 rounded-lg overflow-hidden shadow-lg transform transition-all duration-300 ease-in-out group-hover:scale-105 bg-gray-800",children:[r&&e.jsxs("div",{className:"absolute top-1.5 right-1.5 z-20 flex flex-col gap-1.5 opacity-0 group-hover:opacity-100 translate-y-2 group-hover:translate-y-0 transition-all duration-300",children:[e.jsx("button",{onClick:N,className:"p-1.5 bg-black/60 rounded-full hover:bg-black/80 transition-all duration-200 hover:scale-110","aria-label":n(t.id)?"إزالة من المفضلة":"إضافة إلى المفضلة",children:e.jsx(F,{isFavorite:n(t.id)})}),e.jsx("button",{onClick:k,className:"p-1.5 bg-black/60 rounded-full hover:bg-black/80 transition-all duration-200 hover:scale-110","aria-label":c(t.id)?"إزالة من قائمة المشاهدة لاحقاً":"إضافة إلى قائمة المشاهدة لاحقاً",children:e.jsx(W,{isWatchLater:c(t.id)})})]}),e.jsx("div",{className:"relative w-full aspect-[2/3] bg-gray-800 overflow-hidden",children:e.jsx("img",{src:t.posterUrl,loading:"lazy",onLoad:()=>l(!0),alt:t.title,className:`
              w-full h-full object-cover
              transition-all duration-700 ease-in-out group-hover:opacity-75
              ${a?"scale-100 blur-0":"scale-110 blur-md"}
            `})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/95 via-black/60 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 sm:p-3 md:p-4 transition-all duration-300 group-hover:-translate-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-white text-sm sm:text-base font-bold truncate flex-shrink min-w-0",children:t.title}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[j&&e.jsx("div",{title:"إضافة جديدة",className:"flex items-center justify-center h-5 w-5 bg-yellow-400/20 text-yellow-300 rounded-full",children:e.jsx(E,{})}),b&&e.jsx("div",{title:"شائع حالياً",className:"flex items-center justify-center h-5 w-5 bg-orange-400/20 text-orange-400 rounded-full",children:e.jsx(S,{})}),y&&e.jsx("div",{title:"مدبلج للكردية",className:"flex items-center justify-center h-5 w-5 bg-cyan-400/20 text-cyan-300 rounded-full",children:e.jsx(U,{})})]})]}),e.jsxs("div",{className:"mt-1 space-y-0.5",children:[t.genres&&t.genres.length>0&&e.jsxs("div",{className:"relative",onMouseEnter:()=>f(!0),onMouseLeave:()=>f(!1),children:[e.jsx("p",{className:"text-gray-400 text-xs truncate",children:t.genres.join(" / ")}),p&&e.jsx("div",{className:"absolute bottom-full left-0 mb-1 w-max max-w-xs bg-gray-900 text-white text-xs rounded py-1.5 px-3 z-10 shadow-lg border border-gray-700 pointer-events-none animate-fade-in-up-fast",children:t.genres.join(", ")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-gray-300 text-xs sm:text-sm",children:t.year}),u>0?e.jsxs("div",{className:"flex items-center gap-1 text-xs sm:text-sm text-yellow-400",title:`Average rating: ${m.toFixed(1)} from ${u} user${u>1?"s":""}`,children:[e.jsx(A,{}),e.jsx("span",{className:"font-bold text-white",children:m.toFixed(1)}),e.jsxs("span",{className:"text-gray-400 text-xs ml-1 font-normal",children:["(",u,")"]})]}):e.jsx("div",{className:"h-5"})]})]})]})]})]})},B=L.memo(V),I=()=>e.jsxs("div",{className:"block group relative rounded-lg overflow-hidden shadow-lg bg-gray-800 animate-pulse",children:[e.jsx("div",{className:"relative w-full aspect-[2/3] bg-gray-700"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-2 sm:p-3 md:p-4",children:[e.jsx("div",{className:"h-5 bg-gray-600 rounded w-3/4 mb-2"}),e.jsxs("div",{className:"flex justify-between items-center mt-1",children:[e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})]})]})]});export{B as M,R as a,I as b,M as u};
