import{r as t,d as U,j as e,f as ue,F as J,T as me,u as be}from"./index-JVnycubb.js";import{P as ie}from"./Pagination-BLfem9xc.js";import{F as ae,S as de}from"./SpinnerIcon-UFawJum6.js";const fe=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ye=({onSubmit:p,initialData:s,onCancel:u,isKurdishByDefault:i=!1,isLoading:g=!1,allGenres:a=[]})=>{const[n,b]=t.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:!1,imdbRating:0}),[C,A]=t.useState(""),[P,G]=t.useState(!1),[R,I]=t.useState(""),[O,F]=t.useState(""),[L,B]=t.useState(!1),k=t.useRef(null),[M,z]=t.useState(!1),[q,w]=t.useState(""),f=t.useRef(null);t.useEffect(()=>{s?(b({...s,genres:s.genres||[],tags:s.tags||[],servers:s.servers&&s.servers.length>0?s.servers:[{name:"Server 1",url:"",quality:"720p"}],backupServers:s.backupServers||[],trailerUrl:s.trailerUrl||"",isKurdish:s.isKurdish||!1,imdbRating:s.imdbRating||0}),A((s.tags||[]).join(", "))):(b({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:i,imdbRating:0}),A(""))},[s,i]),t.useEffect(()=>{const r=h=>{k.current&&!k.current.contains(h.target)&&G(!1)};return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[]),t.useEffect(()=>{f.current&&clearTimeout(f.current);const r=n.title.trim();if(!r||s&&r===s.title.trim()){w(""),z(!1);return}return z(!0),w(""),f.current=window.setTimeout(async()=>{try{const h=await U.collection("movies").where("title","==",r).get();let y=!1;h.empty||(s?h.forEach(D=>{D.id!==s.id&&(y=!0)}):y=!0),w(y?"تحذير: فيلم بنفس هذا العنوان موجود بالفعل.":"")}catch(h){console.error("Error checking for duplicate title:",h)}finally{z(!1)}},500),()=>{f.current&&clearTimeout(f.current)}},[n.title,s]);const l=r=>{const{name:h,value:y,type:D}=r.target;if(D==="checkbox"){const{checked:K}=r.target;b(te=>({...te,[h]:K}))}else b(K=>({...K,[h]:h==="year"||h==="imdbRating"?parseFloat(y):y}))},c=r=>{A(r.target.value)},m=r=>{b(h=>{const y=h.genres||[],D=y.includes(r)?y.filter(K=>K!==r):[...y,r];return{...h,genres:D}})},j=async()=>{const r=O.trim();if(r){if(a.some(h=>h.toLowerCase()===r.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}B(!0);try{await U.collection("categories").add({name:r}),b(h=>({...h,genres:[...h.genres||[],r]})),F("")}catch(h){console.error("Error adding new genre:",h),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{B(!1)}}},x=(r,h,y)=>{const D=[...n.servers];D[r]={...D[r],[h]:y},b(K=>({...K,servers:D}))},S=()=>{b(r=>{const h={name:`Server ${r.servers.length+1}`,url:"",quality:"720p"};return{...r,servers:[...r.servers,h]}})},N=r=>{b(h=>({...h,servers:h.servers.filter((y,D)=>D!==r)}))},_=(r,h,y)=>{const D=[...n.backupServers||[]];D[r]={...D[r],[h]:y},b(K=>({...K,backupServers:D}))},ee=()=>{b(r=>{var h;return{...r,backupServers:[...r.backupServers||[],{name:`Backup Server ${(((h=r.backupServers)==null?void 0:h.length)||0)+1}`,url:"",quality:"720p"}]}})},Y=r=>{b(h=>({...h,backupServers:(h.backupServers||[]).filter((y,D)=>D!==r)}))},se=r=>{if(r.preventDefault(),n.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const h=C.split(",").map(y=>y.trim()).filter(y=>y!=="");p({...n,tags:h})},V=a.filter(r=>r.toLowerCase().includes(R.toLowerCase())),W="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",H="bg-slate-600 text-white p-2 rounded-md border-2 border-slate-500 focus:border-cyan-500 outline-none focus:ring-2 focus:ring-cyan-500 transition";return e.jsxs("form",{onSubmit:se,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",name:"title",value:n.title,onChange:l,placeholder:"عنوان الفيلم",required:!0,className:W}),M&&e.jsx("p",{className:"text-xs text-slate-400 mt-1 animate-pulse",children:"جاري التحقق من العنوان..."}),q&&e.jsxs("p",{className:"text-sm text-yellow-400 mt-2 font-semibold flex items-center gap-2 animate-fade-in",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.636-1.21 2.37-1.21 3.006 0l5.485 10.47c.616 1.176-.24 2.62-1.503 2.62H4.275c-1.263 0-2.118-1.444-1.503-2.62l5.485-10.47zM9 9a1 1 0 011-1h0a1 1 0 011 1v3a1 1 0 01-2 0V9zm1 6a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),q]})]}),e.jsx("input",{type:"number",name:"year",value:n.year,onChange:l,placeholder:"سنة الإنتاج",required:!0,className:W})]}),e.jsx("textarea",{name:"description",value:n.description,onChange:l,placeholder:"وصف الفيلم",required:!0,className:`${W} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:n.posterUrl,onChange:l,placeholder:"رابط صورة البوستر",required:!0,className:W}),e.jsx("input",{type:"url",name:"backdropUrl",value:n.backdropUrl,onChange:l,placeholder:"رابط صورة الخلفية",required:!0,className:W})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdbRating",value:n.imdbRating||"",onChange:l,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:W}),e.jsx("input",{type:"url",name:"trailerUrl",value:n.trailerUrl??"",onChange:l,placeholder:"رابط المقطع الدعائي (اختياري)",className:W})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:C,onChange:c,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:W})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"isKurdish",type:"checkbox",name:"isKurdish",checked:!!n.isKurdish,onChange:l,className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("label",{htmlFor:"isKurdish",className:"text-white cursor-pointer",children:"هذا الفيلم مدبلج للكردية"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:k,children:[e.jsxs("button",{type:"button",onClick:()=>G(r=>!r),className:`${W} text-right flex justify-between items-center min-h-[52px]`,"aria-haspopup":"true","aria-expanded":P,children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:n.genres.length>0?n.genres.map(r=>e.jsxs("span",{className:"bg-cyan-500 text-white text-xs font-semibold px-2 py-1 rounded-full flex items-center gap-1",children:[r,e.jsx("button",{type:"button",onClick:h=>{h.stopPropagation(),m(r)},className:"text-cyan-100 hover:text-white leading-none text-lg","aria-label":`إزالة ${r}`,children:"×"})]},r)):e.jsx("span",{className:"text-slate-400 px-1",children:"اختر الفئات..."})}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 text-slate-400 transition-transform ${P?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),P&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg animate-fade-in-up-fast",children:[e.jsx("div",{className:"p-2",children:e.jsx("input",{type:"text",placeholder:"ابحث عن فئة...",value:R,onChange:r=>I(r.target.value),className:"w-full bg-slate-800 text-white p-2 rounded-md focus:ring-2 focus:ring-cyan-500 border border-slate-600 outline-none",autoFocus:!0})}),e.jsx("ul",{className:"max-h-60 overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",children:V.length>0?V.map(r=>e.jsx("li",{children:e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-slate-700 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:n.genres.includes(r),onChange:()=>m(r),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("span",{className:"text-white select-none",children:r})]})},r)):e.jsx("li",{className:"text-slate-400 text-center p-4",children:"لا توجد نتائج"})}),e.jsx("div",{className:"border-t border-slate-700 p-2 mt-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"أو أضف فئة جديدة...",value:O,onChange:r=>F(r.target.value),onKeyDown:r=>{r.key==="Enter"&&(r.preventDefault(),j())},className:"flex-grow bg-slate-800 text-white p-2 text-sm rounded-md focus:ring-2 focus:ring-cyan-500 border border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:j,disabled:L||!O.trim(),className:"flex-shrink-0 bg-cyan-600 text-white px-3 py-1.5 text-sm font-bold rounded-md hover:bg-cyan-700 transition-colors disabled:bg-slate-500 disabled:cursor-not-allowed",children:L?"...":"إضافة"})]})})]})]})]}),e.jsx("input",{type:"url",name:"downloadUrl",value:n.downloadUrl??"",onChange:l,placeholder:"رابط التحميل (اختياري)",className:W}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات المشاهدة"}),n.servers.map((r,h)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-slate-700/50 rounded-md",children:[e.jsx("input",{type:"text",value:r.name,onChange:y=>x(h,"name",y.target.value),placeholder:"اسم السيرفر",className:`${H} flex-1`}),e.jsx("input",{type:"url",value:r.url,onChange:y=>x(h,"url",y.target.value),placeholder:"رابط السيرفر",required:!0,className:`${H} flex-grow-[2]`}),e.jsxs("select",{value:r.quality,onChange:y=>x(h,"quality",y.target.value),className:`${H} flex-1 cursor-pointer`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>N(h),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},h)),e.jsx("button",{type:"button",onClick:S,className:"mt-2 bg-slate-600 text-white py-2 px-4 rounded-md hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات احتياطية (اختياري)"}),(n.backupServers||[]).map((r,h)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-slate-700/50 rounded-md",children:[e.jsx("input",{type:"text",value:r.name,onChange:y=>_(h,"name",y.target.value),placeholder:"اسم السيرفر الاحتياطي",className:`${H} flex-1`}),e.jsx("input",{type:"url",value:r.url,onChange:y=>_(h,"url",y.target.value),placeholder:"رابط السيرفر الاحتياطي",className:`${H} flex-grow-[2]`}),e.jsxs("select",{value:r.quality,onChange:y=>_(h,"quality",y.target.value),className:`${H} flex-1 cursor-pointer`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>Y(h),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},h)),e.jsx("button",{type:"button",onClick:ee,className:"mt-2 bg-slate-600 text-white py-2 px-4 rounded-md hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:u,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:g,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:g||!!q,children:[g&&e.jsx(fe,{}),g?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث":"إضافة"]})]})]})},je=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Z=({isOpen:p,onClose:s,onConfirm:u,title:i,message:g,isLoading:a=!1})=>{const[n,b]=t.useState(p);return t.useEffect(()=>{if(p)b(!0);else{const C=setTimeout(()=>b(!1),300);return()=>clearTimeout(C)}},[p]),n?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${p?"animate-fade-in":"animate-fade-out"}`,onClick:s,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:`relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md border border-slate-700 ${p?"animate-zoom-in":"animate-zoom-out"}`,onClick:C=>C.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:i}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:g})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:u,disabled:a,children:[a&&e.jsx(je,{}),a?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:s,disabled:a,children:"إلغاء"})]})]})}):null},we=10,xe=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((p,s)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},s))})}),e.jsx("tbody",{children:[...Array(we)].map((p,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((u,i)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},i))]},s))})]})})]}),he=({message:p,type:s,onClose:u})=>(t.useEffect(()=>{const a=setTimeout(u,5e3);return()=>clearTimeout(a)},[u]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:p}),e.jsx("button",{onClick:u,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),pe=({genres:p,onSubmit:s,onClose:u,isLoading:i})=>{const[g,a]=t.useState(p[0]||""),[n,b]=t.useState("add"),C=A=>{A.preventDefault(),g&&s(g,n)};return e.jsx(ae,{title:"تغيير الفئة بشكل جماعي",onClose:u,isOpen:!0,children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:g,onChange:A=>a(A.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:p.map(A=>e.jsx("option",{value:A,children:A},A))}),e.jsxs("select",{value:n,onChange:A=>b(A.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:u,disabled:i,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:i||!g,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[i&&e.jsx(de,{}),i?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Ne=({onSubmit:p,onClose:s,isLoading:u})=>{const[i,g]=t.useState(new Date().getFullYear()),a=n=>{n.preventDefault(),p(i)};return e.jsx(ae,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:s,isOpen:!0,children:e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:i,onChange:n=>g(parseInt(n.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:u,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:u,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[u&&e.jsx(de,{}),u?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},ge=({onSubmit:p,onClose:s,isLoading:u})=>{const[i,g]=t.useState(""),[a,n]=t.useState("add"),b=C=>{C.preventDefault(),i.trim()&&p(i.trim(),a)};return e.jsx(ae,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:s,isOpen:!0,children:e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:i,onChange:C=>g(C.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:a,onChange:C=>n(C.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:u,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:u||!i.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[u&&e.jsx(de,{}),u?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},re=10,ve=()=>{const[p,s]=t.useState([]),[u,i]=t.useState(null),[g,a]=t.useState(!1),[n,b]=t.useState(1),[C,A]=t.useState("all"),[P,G]=t.useState(""),[R,I]=t.useState(!1),[O,F]=t.useState(null),[L,B]=t.useState(!0),[k,M]=t.useState(!1),[z,q]=t.useState(null),[w,f]=t.useState([]),[l,c]=t.useState(null),[m,j]=t.useState([]);t.useEffect(()=>{B(!0);const o=U.collection("movies").orderBy("createdAt","desc").onSnapshot(T=>{const X=T.docs.map(Q=>({id:Q.id,...Q.data()}));s(X),B(!1)},T=>{console.error("Error fetching movies: ",T),q({message:"فشل في تحميل الأفلام.",type:"error"}),B(!1)}),v=U.collection("categories").orderBy("name").onSnapshot(T=>{const X=T.docs.map(Q=>Q.data().name);j(X)},T=>{console.error("Error fetching categories from ManageMovies: ",T)});return()=>{o(),v()}},[]),t.useEffect(()=>{b(1),f([])},[C,P]);const x=(o,v)=>{q({message:o,type:v})},S=async o=>{M(!0);try{await U.collection("movies").add({...o,createdAt:me.now()}),a(!1),b(1),x("تمت إضافة الفيلم بنجاح.","success")}catch(v){console.error("Error adding movie: ",v),x("حدث خطأ أثناء إضافة الفيلم.","error")}finally{M(!1)}},N=async(o,v)=>{M(!0);try{await U.collection("movies").doc(o).update(v),i(null),a(!1),x("تم تحديث الفيلم بنجاح.","success")}catch(T){console.error("Error updating movie: ",T),x("حدث خطأ أثناء تحديث الفيلم.","error")}finally{M(!1)}},_=o=>{F(o),I(!0)},ee=async()=>{if(O){M(!0);try{await U.collection("movies").doc(O.id).delete(),x("تم حذف الفيلم بنجاح.","success")}catch(o){console.error("Error deleting movie: ",o),x("حدث خطأ أثناء حذف الفيلم.","error")}finally{I(!1),F(null),M(!1)}}},Y=o=>{i(o),a(!0)},se=()=>{i(null),a(!0)},V=()=>{i(null),a(!1),c(null)},W=o=>{f(v=>v.includes(o)?v.filter(T=>T!==o):[...v,o])},H=o=>{o.target.checked?f(d.map(v=>v.id)):f([])},r=async(o,v)=>{M(!0);try{const T=U.batch();w.forEach(X=>{const Q=U.collection("movies").doc(X);T.update(Q,o)}),await T.commit(),x(v,"success"),f([])}catch(T){console.error("Bulk update failed:",T),x("فشل التحديث الجماعي.","error")}finally{M(!1),c(null)}},h=async()=>{M(!0);try{const o=U.batch();w.forEach(v=>{const T=U.collection("movies").doc(v);o.delete(T)}),await o.commit(),x(`تم حذف ${w.length} فيلم بنجاح.`,"success"),f([])}catch(o){console.error("Bulk delete failed:",o),x("فشل الحذف الجماعي.","error")}finally{M(!1),c(null)}},y=async(o,v)=>{const T={genres:v==="add"?J.arrayUnion(o):J.arrayRemove(o)};await r(T,`تم ${v==="add"?"إضافة":"إزالة"} فئة "${o}" بنجاح.`)},D=async(o,v)=>{const T={tags:v==="add"?J.arrayUnion(o):J.arrayRemove(o)};await r(T,`تم ${v==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${o}" بنجاح.`)},K=p.filter(o=>C==="kurdish"?o.isKurdish===!0:C==="non-kurdish"?!o.isKurdish:!0).filter(o=>ue(P,o.title)),te=Math.ceil(K.length/re),d=K.slice((n-1)*re,n*re),E=o=>`px-4 py-2 text-sm font-bold rounded-lg transition-colors duration-200 ${C===o?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-md":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,$=d.length>0&&w.length===d.length;return L?e.jsx(xe,{}):e.jsxs("div",{className:"relative",children:[z&&e.jsx(he,{...z,onClose:()=>q(null)}),e.jsx(Z,{isOpen:R,onClose:()=>I(!1),onConfirm:ee,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',O==null?void 0:O.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:k}),l==="delete"&&e.jsx(Z,{isOpen:!0,onClose:()=>c(null),onConfirm:h,title:`تأكيد حذف ${w.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:k}),l==="genre"&&e.jsx(pe,{genres:m,onClose:V,onSubmit:y,isLoading:k}),l==="tags"&&e.jsx(ge,{onClose:V,onSubmit:D,isLoading:k}),l==="year"&&e.jsx(Ne,{onClose:V,onSubmit:o=>r({year:o},"تم تحديث السنة بنجاح."),isLoading:k}),l==="markKurdish"&&e.jsx(Z,{isOpen:!0,onClose:V,onConfirm:()=>r({isKurdish:!0},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد تحديد كل هذه الأفلام على أنها كردية؟",isLoading:k}),l==="unmarkKurdish"&&e.jsx(Z,{isOpen:!0,onClose:V,onConfirm:()=>r({isKurdish:!1},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد إزالة العلامة الكردية من كل هذه الأفلام؟",isLoading:k}),g&&e.jsx(ae,{title:u?"تعديل الفيلم":"إضافة فيلم جديد",onClose:V,isOpen:g,children:e.jsx(ye,{onSubmit:u?o=>N(u.id,o):S,initialData:u,onCancel:V,isKurdishByDefault:C==="kurdish"&&!u,isLoading:k,allGenres:m})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:se,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:P,onChange:o=>G(o.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-slate-900/50 rounded-lg flex-shrink-0",children:[e.jsx("button",{onClick:()=>A("all"),className:E("all"),children:"الكل"}),e.jsx("button",{onClick:()=>A("kurdish"),className:E("kurdish"),children:"كردي فقط"}),e.jsx("button",{onClick:()=>A("non-kurdish"),className:E("non-kurdish"),children:"غير كردي"})]})]}),w.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[w.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>f([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>c("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>c("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>c("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>c("markKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تحديد ككردي"}),e.jsx("button",{onClick:()=>c("unmarkKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"إلغاء تحديد ككردي"}),e.jsx("button",{onClick:()=>c("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:H,checked:$,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"مدبلج كردي"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:d.map(o=>{var v,T,X;return e.jsxs("tr",{className:`${w.includes(o.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:w.includes(o.id),onChange:()=>W(o.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:o.posterUrl,alt:o.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:o.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:o.imdbRating?o.imdbRating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:o.year}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(v=o.genres)==null?void 0:v.slice(0,3).map(Q=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:Q},Q)),((T=o.genres)==null?void 0:T.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:o.isKurdish?"نعم":"لا"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:(X=o.createdAt)!=null&&X.toDate?o.createdAt.toDate().toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>Y(o),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>_(o),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},o.id)})})]})}),K.length>re&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ie,{currentPage:n,totalPages:te,onPageChange:b})})]})]})},Ce=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ke=({onSubmit:p,initialData:s,onCancel:u,isLoading:i=!1,allGenres:g=[]})=>{const[a,n]=t.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],seasons:[{seasonNumber:1,title:"الموسم 1",description:"",posterUrl:"",year:new Date().getFullYear(),episodes:[{episodeNumber:1,title:"الحلقة 1",url:"",downloadUrl:""}],imdbRating:0}],trailerUrl:"",imdbRating:0}),[b,C]=t.useState(""),[A,P]=t.useState(!1),G=t.useRef(null);t.useEffect(()=>{s&&(n({...s,genres:s.genres||[],tags:s.tags||[],seasons:s.seasons&&s.seasons.length>0?s.seasons:[{seasonNumber:1,title:"الموسم 1",description:"",posterUrl:s.posterUrl,year:s.year,episodes:[],imdbRating:0}],trailerUrl:s.trailerUrl||"",imdbRating:s.imdbRating||0}),C((s.tags||[]).join(", ")))},[s]),t.useEffect(()=>{const l=c=>{G.current&&!G.current.contains(c.target)&&P(!1)};return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[]);const R=l=>{const{name:c,value:m}=l.target;n(j=>({...j,[c]:c==="year"||c==="imdbRating"?parseFloat(m):m}))},I=l=>{C(l.target.value)},O=l=>{n(c=>({...c,genres:c.genres.includes(l)?c.genres.filter(m=>m!==l):[...c.genres,l]}))},F=(l,c,m)=>{const j=[...a.seasons],x={...j[l]};x[c]=m,j[l]=x,n(S=>({...S,seasons:j}))},L=()=>{const l=a.seasons.length>0?Math.max(...a.seasons.map(m=>m.seasonNumber))+1:1,c=a.seasons.length>0?a.seasons[a.seasons.length-1].year:a.year;n(m=>({...m,seasons:[...m.seasons,{seasonNumber:l,title:`الموسم ${l}`,description:"",posterUrl:m.posterUrl,year:c+1,episodes:[{episodeNumber:1,title:"الحلقة 1",url:"",downloadUrl:""}],imdbRating:0}]}))},B=l=>{n(c=>({...c,seasons:c.seasons.filter((m,j)=>j!==l)}))},k=(l,c,m,j)=>{const x=[...a.seasons],S=[...x[l].episodes];S[c]={...S[c],[m]:j},x[l]={...x[l],episodes:S},n(N=>({...N,seasons:x}))},M=l=>{const c=a.seasons[l],m=c.episodes.length>0?Math.max(...c.episodes.map(S=>S.episodeNumber))+1:1,j={episodeNumber:m,title:`الحلقة ${m}`,url:"",downloadUrl:""},x=a.seasons.map((S,N)=>N===l?{...S,episodes:[...S.episodes,j]}:S);n(S=>({...S,seasons:x}))},z=(l,c)=>{const m=a.seasons.map((j,x)=>x===l?{...j,episodes:j.episodes.filter((S,N)=>N!==c)}:j);n(j=>({...j,seasons:m}))},q=l=>{l.preventDefault();const c=b.split(",").map(m=>m.trim()).filter(Boolean);p({...a,tags:c})},w="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",f="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white border-b border-slate-700 pb-2",children:"معلومات المسلسل الرئيسية"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:a.title,onChange:R,placeholder:"عنوان المسلسل",required:!0,className:w}),e.jsx("input",{type:"number",name:"year",value:a.year,onChange:R,placeholder:"سنة بداية العرض",required:!0,className:w})]}),e.jsx("textarea",{name:"description",value:a.description,onChange:R,placeholder:"وصف المسلسل العام",required:!0,className:`${w} h-24`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:a.posterUrl,onChange:R,placeholder:"رابط البوستر الرئيسي",required:!0,className:w}),e.jsx("input",{type:"url",name:"backdropUrl",value:a.backdropUrl,onChange:R,placeholder:"رابط صورة الخلفية",required:!0,className:w})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdbRating",value:a.imdbRating||"",onChange:R,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:w}),e.jsx("input",{type:"url",name:"trailerUrl",value:a.trailerUrl??"",onChange:R,placeholder:"رابط المقطع الدعائي (اختياري)",className:w})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات"}),e.jsxs("div",{className:"relative",ref:G,children:[e.jsx("button",{type:"button",onClick:()=>P(l=>!l),className:`${w} text-right`,children:a.genres.length>0?a.genres.join(", "):"اختر الفئات..."}),A&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:g.map(l=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.genres.includes(l),onChange:()=>O(l),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:l})]},l))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (مفصولة بفاصلة)"}),e.jsx("input",{type:"text",value:b,onChange:I,placeholder:"أكشن, إثارة...",className:w})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),a.seasons.map((l,c)=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-white font-semibold",children:"الموسم رقم:"}),e.jsx("input",{type:"number",value:l.seasonNumber,onChange:m=>F(c,"seasonNumber",parseInt(m.target.value)),className:`${f} w-20`})]}),e.jsx("button",{type:"button",onClick:()=>B(c),className:"bg-red-600 text-white px-3 py-1 rounded-md text-sm",children:"إزالة الموسم"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",value:l.title,onChange:m=>F(c,"title",m.target.value),placeholder:"عنوان الموسم",required:!0,className:f}),e.jsx("input",{type:"number",value:l.year,onChange:m=>F(c,"year",parseInt(m.target.value)),placeholder:"سنة الموسم",required:!0,className:f}),e.jsx("input",{type:"number",value:l.imdbRating||"",onChange:m=>F(c,"imdbRating",parseFloat(m.target.value)),placeholder:"تقييم IMDb",step:"0.1",min:"0",max:"10",className:f}),e.jsx("input",{type:"url",value:l.posterUrl,onChange:m=>F(c,"posterUrl",m.target.value),placeholder:"رابط بوستر الموسم",required:!0,className:`${f} col-span-1 sm:col-span-3`}),e.jsx("textarea",{value:l.description,onChange:m=>F(c,"description",m.target.value),placeholder:"وصف الموسم",required:!0,className:`${f} h-20 col-span-1 sm:col-span-3`})]}),e.jsxs("div",{className:"space-y-2 pt-3 mt-3 border-t border-slate-600",children:[e.jsxs("h4",{className:"font-semibold text-slate-300",children:["حلقات الموسم ",l.seasonNumber,":"]}),l.episodes.map((m,j)=>e.jsxs("div",{className:"bg-slate-800/60 p-2 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:m.episodeNumber,onChange:x=>k(c,j,"episodeNumber",parseInt(x.target.value)),placeholder:"رقم",className:`${f} w-16`}),e.jsx("input",{type:"text",value:m.title,onChange:x=>k(c,j,"title",x.target.value),placeholder:"عنوان الحلقة",className:`${f} flex-1`}),e.jsx("button",{type:"button",onClick:()=>z(c,j),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600 text-xs",children:"X"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:m.url,onChange:x=>k(c,j,"url",x.target.value),placeholder:"رابط المشاهدة",required:!0,className:`${f} flex-1`}),e.jsx("input",{type:"url",value:m.downloadUrl||"",onChange:x=>k(c,j,"downloadUrl",x.target.value),placeholder:"رابط التحميل (اختياري)",className:`${f} flex-1`})]})]},j)),e.jsx("button",{type:"button",onClick:()=>M(c),className:"text-sm bg-slate-600 text-white py-1 px-3 rounded-md hover:bg-slate-500",children:"إضافة حلقة"})]})]},c)),e.jsx("button",{type:"button",onClick:L,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700",children:"إضافة موسم"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:u,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg",disabled:i,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg",disabled:i,children:[i&&e.jsx(Ce,{}),s?"تحديث المسلسل":"إضافة المسلسل"]})]})]})},le=10,Se=()=>{const[p,s]=t.useState([]),[u,i]=t.useState(null),[g,a]=t.useState(!1),[n,b]=t.useState(1),[C,A]=t.useState(""),[P,G]=t.useState(!1),[R,I]=t.useState(null),[O,F]=t.useState(!0),[L,B]=t.useState(!1),[k,M]=t.useState(null),[z,q]=t.useState([]),[w,f]=t.useState(null),[l,c]=t.useState([]);t.useEffect(()=>{F(!0);const d=U.collection("series").orderBy("createdAt","desc").onSnapshot($=>{const o=$.docs.map(v=>({id:v.id,...v.data()}));s(o),F(!1)},$=>{console.error("Error fetching series: ",$),M({message:"فشل في تحميل المسلسلات.",type:"error"}),F(!1)}),E=U.collection("categories").orderBy("name").onSnapshot($=>{const o=$.docs.map(v=>v.data().name);c(o)},$=>{console.error("Error fetching categories from ManageSeries: ",$)});return()=>{d(),E()}},[]),t.useEffect(()=>{b(1),q([])},[C]);const m=(d,E)=>{M({message:d,type:E})},j=async d=>{B(!0);try{await U.collection("series").add({...d,createdAt:me.now()}),a(!1),b(1),m("تمت إضافة المسلسل بنجاح.","success")}catch(E){console.error("Error adding series: ",E),m("حدث خطأ أثناء إضافة المسلسل.","error")}finally{B(!1)}},x=async(d,E)=>{B(!0);try{await U.collection("series").doc(d).update(E),i(null),a(!1),m("تم تحديث المسلسل بنجاح.","success")}catch($){console.error("Error updating series: ",$),m("حدث خطأ أثناء تحديث المسلسل.","error")}finally{B(!1)}},S=d=>{I(d),G(!0)},N=async()=>{if(R){B(!0);try{await U.collection("series").doc(R.id).delete(),m("تم حذف المسلسل بنجاح.","success")}catch(d){console.error("Error deleting series: ",d),m("حدث خطأ أثناء حذف المسلسل.","error")}finally{G(!1),I(null),B(!1)}}},_=d=>{i(d),a(!0)},ee=()=>{i(null),a(!0)},Y=()=>{i(null),a(!1),f(null)},se=d=>{q(E=>E.includes(d)?E.filter($=>$!==d):[...E,d])},V=d=>{d.target.checked?q(K.map(E=>E.id)):q([])},W=async()=>{B(!0);try{const d=U.batch();z.forEach(E=>{const $=U.collection("series").doc(E);d.delete($)}),await d.commit(),m(`تم حذف ${z.length} مسلسل بنجاح.`,"success"),q([])}catch(d){console.error("Bulk delete failed:",d),m("فشل الحذف الجماعي.","error")}finally{B(!1),f(null)}},H=async(d,E)=>{const $={genres:E==="add"?J.arrayUnion(d):J.arrayRemove(d)};await h($,`تم ${E==="add"?"إضافة":"إزالة"} فئة "${d}" بنجاح.`)},r=async(d,E)=>{const $={tags:E==="add"?J.arrayUnion(d):J.arrayRemove(d)};await h($,`تم ${E==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${d}" بنجاح.`)},h=async(d,E)=>{B(!0);try{const $=U.batch();z.forEach(o=>{const v=U.collection("series").doc(o);$.update(v,d)}),await $.commit(),m(E,"success"),q([])}catch($){console.error("Bulk update failed:",$),m("فشل التحديث الجماعي.","error")}finally{B(!1),f(null)}},y=p.filter(d=>ue(C,d.title)),D=Math.ceil(y.length/le),K=y.slice((n-1)*le,n*le),te=K.length>0&&z.length===K.length;return O?e.jsx(xe,{}):e.jsxs("div",{className:"relative",children:[k&&e.jsx(he,{...k,onClose:()=>M(null)}),e.jsx(Z,{isOpen:P,onClose:()=>G(!1),onConfirm:N,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',R==null?void 0:R.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:L}),w==="delete"&&e.jsx(Z,{isOpen:!0,onClose:()=>f(null),onConfirm:W,title:`تأكيد حذف ${z.length} مسلسل`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:L}),w==="genre"&&e.jsx(pe,{genres:l,onClose:Y,onSubmit:H,isLoading:L}),w==="tags"&&e.jsx(ge,{onClose:Y,onSubmit:r,isLoading:L}),g&&e.jsx(ae,{title:u?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:Y,isOpen:g,children:e.jsx(ke,{onSubmit:u?d=>x(u.id,d):j,initialData:u,onCancel:Y,isLoading:L,allGenres:l})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:ee,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsx("div",{className:"relative w-full sm:flex-grow",children:e.jsx("input",{type:"text",value:C,onChange:d=>A(d.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-4 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a series to edit"})})]}),z.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("span",{className:"text-white font-bold",children:[z.length," مسلسل محدد"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>f("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>f("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>f("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:V,checked:te})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:K.map(d=>{var E,$;return e.jsxs("tr",{className:`${z.includes(d.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"}`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:z.includes(d.id),onChange:()=>se(d.id)})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("img",{src:d.posterUrl,alt:d.title,className:"h-20 w-auto rounded"})}),e.jsx("td",{className:"px-4 py-2 font-medium text-white",children:d.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:d.imdbRating?d.imdbRating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:d.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:((E=d.seasons)==null?void 0:E.length)||0}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:($=d.createdAt)!=null&&$.toDate?d.createdAt.toDate().toLocaleDateString("ar-EG"):"N/A"}),e.jsxs("td",{className:"px-4 py-2 font-medium",children:[e.jsx("button",{onClick:()=>_(d),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>S(d),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},d.id)})})]})}),y.length>le&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ie,{currentPage:n,totalPages:D,onPageChange:b})})]})]})},Ee=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsx("div",{className:"p-4 bg-gray-900",children:e.jsx("div",{className:"h-6 bg-gray-600 rounded w-1/3"})}),e.jsx("div",{className:"divide-y divide-gray-700",children:[...Array(5)].map((p,s)=>e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-600 rounded w-20"})]},s))})]}),Ae="yO8pzykKincc5zgbdJGdN6xISr03",ne=10,Me=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),$e=({message:p,type:s,onClose:u})=>(t.useEffect(()=>{const a=setTimeout(u,5e3);return()=>clearTimeout(a)},[u]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:p}),e.jsx("button",{onClick:u,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Ue=({children:p,onClose:s,title:u,isOpen:i})=>{const[g,a]=t.useState(i);return t.useEffect(()=>{if(i){a(!0),document.body.style.overflow="hidden";const n=b=>{b.key==="Escape"&&s()};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}}else{const n=setTimeout(()=>{a(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(n)}},[i,s]),g?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${i?"animate-fade-in":"animate-fade-out"}`,onClick:s,children:e.jsxs("div",{className:`bg-slate-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-slate-700 ${i?"animate-zoom-in":"animate-zoom-out"}`,onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:u}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white text-3xl transition-colors",children:"×"})]}),p]})}):null},Re=()=>{const{currentUser:p}=be(),[s,u]=t.useState([]),[i,g]=t.useState(""),[a,n]=t.useState(""),[b,C]=t.useState(""),[A,P]=t.useState(!0),[G,R]=t.useState(!1),[I,O]=t.useState(1),[F,L]=t.useState(!1),[B,k]=t.useState(!1),[M,z]=t.useState(null),[q,w]=t.useState(null),f=(p==null?void 0:p.uid)===Ae;t.useEffect(()=>{if(!f){P(!1);return}P(!0);const N=U.collection("admins").onSnapshot(_=>{const ee=_.docs.map(Y=>({id:Y.id,uid:Y.data().uid,email:Y.data().email}));u(ee),P(!1)},_=>{console.error(_),l("فشل في تحميل قائمة المشرفين.","error"),P(!1)});return()=>N()},[f]);const l=(N,_)=>{w({message:N,type:_})},c=async N=>{if(N.preventDefault(),C(""),!i.trim()||!a.trim()){C("الرجاء إدخال UID وبريد إلكتروني صالحين.");return}R(!0);try{await U.collection("admins").doc(i).set({uid:i,email:a}),l(`تمت إضافة المشرف ${a} بنجاح.`,"success"),L(!1),g(""),n("")}catch(_){console.error("Error adding admin:",_),l("فشل في إضافة المشرف.","error")}finally{R(!1)}},m=N=>{z(N),k(!0)},j=async()=>{if(M){R(!0);try{await U.collection("admins").doc(M.id).delete(),l(`تم حذف المشرف ${M.email} بنجاح.`,"success")}catch(N){console.error(N),l("حدث خطأ أثناء حذف المشرف.","error")}finally{k(!1),z(null),R(!1)}}};if(!f)return e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"إدارة المشرفين"}),e.jsx("p",{className:"text-yellow-300",children:"هذه الصفحة متاحة فقط للمشرف الأساسي."})]});const x=Math.ceil(s.length/ne),S=s.slice((I-1)*ne,I*ne);return e.jsxs(e.Fragment,{children:[q&&e.jsx($e,{...q,onClose:()=>w(null)}),e.jsx(Z,{isOpen:B,onClose:()=>k(!1),onConfirm:j,title:"تأكيد حذف المشرف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المشرف ",e.jsxs("strong",{className:"text-white",children:['"',M==null?void 0:M.email,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"سيؤدي هذا إلى إزالة صلاحيات المشرف الخاصة به."})]}),isLoading:G}),e.jsx(Ue,{isOpen:F,title:"إضافة مشرف جديد",onClose:()=>L(!1),children:e.jsxs("form",{onSubmit:c,className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"لإضافة مشرف جديد، يجب عليك الحصول على **معرّف المستخدم (UID)** الخاص به من لوحة تحكم Firebase Authentication."}),e.jsx("input",{type:"text",value:i,onChange:N=>g(N.target.value),placeholder:"معرّف المستخدم (UID)",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),e.jsx("input",{type:"email",value:a,onChange:N=>n(N.target.value),placeholder:"البريد الإلكتروني للمشرف",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),b&&e.jsx("p",{className:"text-red-500 text-center text-sm",children:b}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:()=>L(!1),className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:G,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:G,children:[G&&e.jsx(Me,{}),G?"جاري الإضافة...":"إضافة مشرف"]})]})]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"المشرفون الحاليون"}),e.jsx("button",{onClick:()=>L(!0),className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة مشرف جديد"})]}),A?e.jsx(Ee,{}):e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-900/50 flex items-center justify-between",children:[e.jsxs("span",{className:"text-white font-bold",children:[p.email," (المشرف الأساسي)"]}),e.jsx("span",{className:"text-sm text-slate-500",children:"لا يمكن حذفه"})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:S.map(N=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-slate-700/50",children:[e.jsx("span",{className:"text-white",children:N.email}),e.jsx("button",{onClick:()=>m(N),className:"bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700 transition-colors",children:"حذف"})]},N.id))}),s.length>ne&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ie,{currentPage:I,totalPages:x,onPageChange:O})})]})]})]})},Fe=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Te=({onSubmit:p,initialData:s,onCancel:u,isLoading:i=!1})=>{const[g,a]=t.useState("");t.useEffect(()=>{a(s?s.name:"")},[s]);const n=b=>{b.preventDefault(),g.trim()&&p({name:g})};return e.jsxs("form",{onSubmit:n,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:g,onChange:b=>a(b.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:u,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:i,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:i,children:[i&&e.jsx(Fe,{}),i?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث":"إضافة"]})]})]})},Be=10,Pe=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(Be)].map((p,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},s))})]})})}),oe=10,ze=({message:p,type:s,onClose:u})=>(t.useEffect(()=>{const a=setTimeout(u,5e3);return()=>clearTimeout(a)},[u]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:p}),e.jsx("button",{onClick:u,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Ge=({children:p,onClose:s,title:u,isOpen:i})=>{const[g,a]=t.useState(i);return t.useEffect(()=>{if(i){a(!0),document.body.style.overflow="hidden";const n=b=>{b.key==="Escape"&&s()};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}}else{const n=setTimeout(()=>{a(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(n)}},[i,s]),g?e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 ${i?"animate-fade-in":"animate-fade-out"}`,onClick:s,children:e.jsxs("div",{className:`bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700 ${i?"animate-zoom-in":"animate-zoom-out"}`,onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:u}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),p]})}):null},qe=()=>{const[p,s]=t.useState([]),[u,i]=t.useState(null),[g,a]=t.useState(!1),[n,b]=t.useState(1),[C,A]=t.useState(!1),[P,G]=t.useState(null),[R,I]=t.useState(!0),[O,F]=t.useState(!1),[L,B]=t.useState(null);t.useEffect(()=>{I(!0);const x=U.collection("categories").orderBy("name").onSnapshot(S=>{const N=S.docs.map(_=>({id:_.id,..._.data()}));s(N),I(!1)},S=>{console.error("Error fetching categories: ",S),k("فشل في تحميل الفئات.","error"),I(!1)});return()=>x()},[]);const k=(x,S)=>{B({message:x,type:S})},M=async x=>{F(!0);try{await U.collection("categories").add(x),k("تمت إضافة الفئة بنجاح!","success"),a(!1),b(1)}catch(S){console.error("Error adding category: ",S),k("حدث خطأ أثناء إضافة الفئة.","error")}finally{F(!1)}},z=async(x,S)=>{F(!0);try{await U.collection("categories").doc(x).update(S),k("تم تحديث الفئة بنجاح!","success"),i(null),a(!1)}catch(N){console.error("Error updating category: ",N),k("حدث خطأ أثناء تحديث الفئة.","error")}finally{F(!1)}},q=x=>{G(x),A(!0)},w=async()=>{if(P){F(!0);try{await U.collection("categories").doc(P.id).delete(),k("تم حذف الفئة بنجاح!","success")}catch(x){console.error("Error deleting category: ",x),k("حدث خطأ أثناء حذف الفئة.","error")}finally{A(!1),G(null),F(!1)}}},f=x=>{i(x),a(!0)},l=()=>{i(null),a(!0)},c=()=>{i(null),a(!1)},m=Math.ceil(p.length/oe),j=p.slice((n-1)*oe,n*oe);return R?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(Pe,{})]}):e.jsxs("div",{children:[L&&e.jsx(ze,{...L,onClose:()=>B(null)}),e.jsx(Z,{isOpen:C,onClose:()=>A(!1),onConfirm:w,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',P==null?void 0:P.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:O}),e.jsx(Ge,{isOpen:g,title:u?"تعديل الفئة":"إضافة فئة جديدة",onClose:c,children:e.jsx(Te,{onSubmit:u?x=>z(u.id,x):M,initialData:u,onCancel:c,isLoading:O})}),e.jsx("button",{onClick:l,className:"mb-6 bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:p.length>0?j.map(x=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:x.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>f(x),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>q(x),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},x.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})}),p.length>oe&&e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx(ie,{currentPage:n,totalPages:m,onPageChange:b})})]})]})},ce=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(ve,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx(Se,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(qe,{})},{key:"admins",label:"إدارة المشرفين",component:e.jsx(Re,{})}],De=({label:p,tabKey:s,activeTab:u,onClick:i})=>e.jsx("button",{onClick:()=>i(s),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px ${u===s?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":u===s,children:p}),_e=()=>{var i;const[p,s]=t.useState(ce[0].key),u=(i=ce.find(g=>g.key===p))==null?void 0:i.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8 animate-fade-in",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6",role:"tablist",children:ce.map(g=>e.jsx(De,{label:g.label,tabKey:g.key,activeTab:p,onClick:s},g.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-6 rounded-lg border border-slate-700",children:u})]})};export{_e as default};
