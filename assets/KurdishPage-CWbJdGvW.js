import{j as s,r as l,a as V,b as W,d as T,f as J}from"./index-COHSSNss.js";import{H as X,a as Z,S as $,G as ee,T as te,Y as se}from"./TagFilter-BqO5ZAg2.js";import{M as re}from"./MovieGrid-B5uZhT3G.js";import{M as ae}from"./MovieGridSkeleton-5cat1ZpX.js";import{I as oe}from"./InfiniteScrollTrigger-1Hd5b64E.js";import"./MovieCard-C6_WItKi.js";import"./MovieCardSkeleton-D7JhNSqL.js";const ne=({searchQuery:i,onSearchChange:j})=>s.jsxs("div",{className:"relative w-full md:w-auto md:flex-grow",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),s.jsx("input",{type:"text",value:i,onChange:y=>j(y.target.value),placeholder:"ابحث عن فيلم...",className:"w-full bg-gray-700 text-white p-2 pl-10 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none","aria-label":"Search for movies by title"})]}),G=28,ue=()=>{const[i,j]=l.useState([]),[y,E]=l.useState([]),[P,_]=l.useState(!0),{getAverageRating:h}=V(),[g,B]=W(),[w,A]=l.useState(1),[S,b]=l.useState(!1),u=g.get("year")||"all",o=g.getAll("genre"),n=g.getAll("tag"),x=g.get("sort")||"createdAt_desc",f=g.get("q")||"";l.useEffect(()=>{(async()=>{try{let r=(await T.collection("movies").where("isKurdish","==",!0).get()).docs.map(a=>({id:a.id,...a.data()}));r.sort((a,d)=>{var m,N;const p=(m=a.createdAt)!=null&&m.toMillis?a.createdAt.toMillis():0;return((N=d.createdAt)!=null&&N.toMillis?d.createdAt.toMillis():0)-p}),j(r)}catch(t){console.error("Error fetching movies: ",t)}finally{_(!1)}})()},[]),l.useEffect(()=>{const e=T.collection("categories").orderBy("name").onSnapshot(t=>{const r=t.docs.map(a=>a.data().name);E(r)},t=>{console.error("Error fetching categories for Kurdish page: ",t)});return()=>e()},[]);const c=e=>{const t=new URLSearchParams(g);Object.entries(e).forEach(([r,a])=>{t.delete(r),Array.isArray(a)?a.forEach(d=>t.append(r,d)):a&&a!=="all"&&t.set(r,a)}),A(1),B(t,{replace:!0})},F=e=>{const t=o.includes(e)?o.filter(r=>r!==e):[...o,e];c({genre:t})},L=()=>c({genre:[]}),Y=e=>{const t=n.includes(e)?n.filter(r=>r!==e):[...n,e];c({tag:t})},k=()=>c({tag:[]}),I=e=>c({year:e}),R=e=>c({sort:e}),z=e=>c({q:e}),H=[...new Set(i.map(e=>e.year))].sort((e,t)=>t-e),K=y,O=[...new Set(i.flatMap(e=>e.tags||[]))].sort(),M=l.useMemo(()=>i.filter(e=>u==="all"||e.year.toString()===u).filter(e=>o.length===0?!0:o.some(t=>{var r;return(r=e.genres)==null?void 0:r.includes(t)})).filter(e=>n.length===0?!0:n.some(t=>{var r;return(r=e.tags)==null?void 0:r.includes(t)})).filter(e=>J(f,e.title)).sort((e,t)=>{var r,a,d,p;switch(x){case"rating_desc":return h(t.id).average-h(e.id).average;case"rating_asc":return h(e.id).average-h(t.id).average;case"year_desc":return Number(t.year)-Number(e.year);case"year_asc":return Number(e.year)-Number(t.year);case"createdAt_asc":{const v=(r=e.createdAt)!=null&&r.toMillis?e.createdAt.toMillis():0,m=(a=t.createdAt)!=null&&a.toMillis?t.createdAt.toMillis():0;return v-m}case"createdAt_desc":default:{const v=(d=t.createdAt)!=null&&d.toMillis?t.createdAt.toMillis():0,m=(p=e.createdAt)!=null&&p.toMillis?e.createdAt.toMillis():0;return v-m}}}),[i,u,o,n,f,x,h]),D=Math.ceil(M.length/G),C=w<D,q=()=>{C&&!S&&(b(!0),setTimeout(()=>{A(e=>e+1),b(!1)},500))},Q=M.slice(0,w*G),U=f!==""||u!=="all"||o.length>0||n.length>0||x!=="createdAt_desc";return P?s.jsxs("div",{children:[s.jsx(X,{}),s.jsx("div",{className:"my-8 h-20 bg-gray-800/50 rounded-lg animate-pulse"}),s.jsxs("section",{className:"mb-12",children:[s.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"الأفلام المدبلجة للكردية"}),s.jsx(ae,{count:18})]})]}):s.jsxs("div",{children:[s.jsx(Z,{movies:i.slice(0,5)}),s.jsxs("div",{className:"relative z-30 my-8 flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl",children:[s.jsx(ne,{searchQuery:f,onSearchChange:z}),s.jsxs("div",{className:"w-full md:w-auto flex flex-col md:flex-row md:flex-wrap justify-center items-center gap-4",children:[s.jsx($,{sortOrder:x,onSortChange:R}),s.jsx(ee,{genres:K,selectedGenres:o,onToggleGenre:F,onClearGenres:L}),s.jsx(te,{tags:O,selectedTags:n,onToggleTag:Y,onClearTags:k}),s.jsx(se,{years:H,selectedYear:u,onYearChange:I})]})]}),s.jsxs("section",{className:"mb-12",children:[s.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:U?"نتائج البحث":"الأفلام المدبلجة للكردية"}),M.length>0?s.jsxs(s.Fragment,{children:[s.jsx(re,{movies:Q}),s.jsx(oe,{onIntersect:q,hasMore:C,isLoading:S})]}):s.jsx("div",{className:"text-center p-8 bg-gray-800 rounded-lg mt-8",children:s.jsx("p",{className:"text-xl text-gray-400",children:"لا توجد أفلام مدبلجة للكردية تطابق معايير البحث."})})]})]})};export{ue as default};
