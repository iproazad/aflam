import{r as o,j as e,s as E,a as mt,f as ht,R as yt}from"./index-Bd1E2-F5.js";import{P as it}from"./Pagination-DI_lNQG9.js";import{F as _e,S as Ce}from"./SpinnerIcon-CiLCQ8EM.js";const jt=[{key:"foreign",label:"افلام اجنبي"},{key:"kurdish",label:"افلام كردي"},{key:"asian",label:"افلام اسيوية"},{key:"turkish",label:"افلام تركية"},{key:"arabic",label:"افلام عربي"},{key:"classic",label:"افلام كلاسيكيه"},{key:"dubbed",label:"افلام مدبلجة"},{key:"indian",label:"افلام هندية"},{key:"anime",label:"افلام انمي"}],ut=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),wt=({onSubmit:i,initialData:a,onCancel:m,isLoading:u=!1,allGenres:j=[]})=>{var Q,ne,ee;const[s,c]=o.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"1080p"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:!1,movie_type:"foreign",imdb_rating:void 0,quality:"",duration:"",language:"",country:"",directors:[],writers:[],cast:[]}),[N,b]=o.useState(""),[T,K]=o.useState(""),[I,Z]=o.useState(!1),[g,w]=o.useState(""),[B,q]=o.useState(!1),[A,z]=o.useState(""),[_,$]=o.useState(""),[Y,G]=o.useState(!1),y=o.useRef(null);o.useEffect(()=>{if(a){let n=a.movie_type;!n&&a.is_kurdish&&(n="kurdish"),c({title:a.title||"",description:a.description||"",poster_url:a.poster_url||"",backdrop_url:a.backdrop_url||"",year:a.year||new Date().getFullYear(),genres:a.genres||[],tags:a.tags||[],servers:a.servers&&a.servers.length>0?a.servers:[{name:"Server 1",url:"",quality:"1080p"}],backup_servers:a.backup_servers||[],download_url:a.download_url||"",trailer_url:a.trailer_url||"",is_kurdish:n==="kurdish",movie_type:n||"foreign",imdb_rating:a.imdb_rating,quality:a.quality||"",duration:a.duration||"",language:a.language||"",country:a.country||"",directors:a.directors||[],writers:a.writers||[],cast:a.cast||[]}),b((a.tags||[]).join(", "))}else c({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"1080p"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:!1,movie_type:"foreign",imdb_rating:void 0,quality:"",duration:"",language:"",country:"",directors:[],writers:[],cast:[]}),b("")},[a]),o.useEffect(()=>{const n=t=>{y.current&&!y.current.contains(t.target)&&q(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[]),o.useEffect(()=>{const n=s.download_url;if(n&&n.includes("vidtube.pro/d/")){const t=n.replace("/d/","/embed-");s.servers.length>0&&s.servers[0].url!==t&&c(l=>{const p=[...l.servers];return p[0]={...p[0],url:t},{...l,servers:p}})}},[s.download_url,s.servers]),o.useEffect(()=>{if(!a){const n=s.title.match(/\b(19[89]\d|20\d{2})\b/);if(n&&n[0]){const t=parseInt(n[0],10),l=s.title.replace(n[0],"").replace(/\s\s+/g," ").trim();c(p=>p.year!==t||p.title!==l?{...p,year:t,title:l}:p)}}},[s.title,a]),o.useEffect(()=>{!a&&!s.backdrop_url.trim()&&c(n=>({...n,backdrop_url:n.poster_url}))},[s.poster_url,a,s.backdrop_url]);const D=async n=>{var t;try{if(!((t=navigator.clipboard)!=null&&t.readText))throw new Error("Clipboard API not available.");const l=await navigator.clipboard.readText();l&&n(l)}catch(l){console.error("Failed to read clipboard contents: ",l),alert("فشل لصق النص. يرجى التأكد من منح الإذن لاستخدام الحافظة.")}},d=n=>{const{name:t,value:l,type:p}=n.target;if(p==="checkbox"){const{checked:k}=n.target;c(O=>({...O,[t]:k}))}else if(t==="year"){const k=parseInt(l,10);c(O=>({...O,[t]:isNaN(k)?0:k}))}else if(t==="imdb_rating"){const k=parseFloat(l);c(O=>({...O,imdb_rating:isNaN(k)?void 0:k}))}else c(k=>({...k,[t]:l}))},x=n=>{b(n.target.value)},h=n=>{c(t=>{const l=t.genres||[],p=l.includes(n)?l.filter(k=>k!==n):[...l,n];return{...t,genres:p}})},S=async()=>{const n=_.trim();if(n){if(j.some(t=>t.toLowerCase()===n.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}G(!0);try{const{error:t}=await E.from("categories").insert({name:n});if(t)throw t;c(l=>({...l,genres:[...l.genres||[],n]})),$("")}catch(t){console.error("Error adding new genre:",t),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{G(!1)}}},M=(n,t,l)=>{const p=[...s.servers];p[n]={...p[n],[t]:l},c(k=>({...k,servers:p}))},U=()=>{c(n=>{const t={name:`Server ${n.servers.length+1}`,url:"",quality:"1080p"};return{...n,servers:[...n.servers,t]}})},se=n=>{c(t=>({...t,servers:t.servers.filter((l,p)=>p!==n)}))},R=(n,t,l)=>{const p=[...s.backup_servers||[]];p[n]={...p[n],[t]:l},c(k=>({...k,backup_servers:p}))},Ne=()=>{c(n=>{var t;return{...n,backup_servers:[...n.backup_servers||[],{name:`Server ${(((t=n.backup_servers)==null?void 0:t.length)||0)+1}`,url:"",quality:"1080p",no_sub_url:""}]}})},ue=n=>{c(t=>({...t,backup_servers:(t.backup_servers||[]).filter((l,p)=>p!==n)}))},v=async()=>{var n,t,l,p,k,O,te,ae,me,r,f,C,re,Ee,ye,je,we,pe,$e;if(!T){w("Please enter a URL.");return}Z(!0),w("");try{w("Fetching movie page...");const Pe=`https://corsproxy.io/?${encodeURIComponent(T)}`,Je=await fetch(Pe);if(!Je.ok)throw new Error(`Failed to fetch URL: ${Je.statusText}`);const ft=await Je.text(),dt=new DOMParser,le=dt.parseFromString(ft,"text/html");if(T.includes("a.asd.homes")){w("جلب البيانات من عرب سيد...");const oe=J=>{var X,qe;const V=Array.from(le.querySelectorAll(".info__area__ul > li")).find(he=>{var xe,st;return(st=(xe=he.querySelector(".title__kit span"))==null?void 0:xe.textContent)==null?void 0:st.trim().startsWith(J)});if(!V)return[];const ce=Array.from(V.querySelectorAll("ul.tags__list a"));if(ce.length>0)return ce.map(he=>{var xe;return((xe=he.textContent)==null?void 0:xe.trim())||""}).filter(Boolean);const de=Array.from(V.childNodes).find(he=>{var xe;return he.nodeType===Node.TEXT_NODE&&((xe=he.textContent)==null?void 0:xe.trim())});if(de)return[((X=de.textContent)==null?void 0:X.trim())||""];const F=V.querySelector("a");return F?[((qe=F.textContent)==null?void 0:qe.trim())||""]:[]},Me=((t=(n=le.querySelector("h1.post__name"))==null?void 0:n.textContent)==null?void 0:t.trim())||"",ge=Me.match(/\(\s*(\d{4})\s*\)/),Ye=ge?parseInt(ge[1],10):new Date().getFullYear(),fe=ge?Me.replace(ge[0],"").trim():Me,He=((p=(l=le.querySelector(".post__story p"))==null?void 0:l.textContent)==null?void 0:p.trim())||"",Ae=((k=le.querySelector(".poster__single img"))==null?void 0:k.getAttribute("data-src"))||((O=le.querySelector(".poster__single img"))==null?void 0:O.getAttribute("src"))||"",Ve=((ae=(te=le.querySelector(".rating__box .rate__txt"))==null?void 0:te.textContent)==null?void 0:ae.trim().split("/")[0].trim())||"0",Ke=parseFloat(Ve)||void 0,Qe=oe("نوع العرض"),Xe=oe("جودة العرض").join(", "),Ze=oe("مدة العرض").join(", "),et=oe("لغة العرض").join(", "),tt=oe("بلد العرض").join(", "),Re=[],Be=[],Ue=[];le.querySelectorAll(".persons__list li a").forEach(J=>{var ce,de,F,X;const ie=(de=(ce=J.querySelector(".name"))==null?void 0:ce.textContent)==null?void 0:de.trim(),V=(X=(F=J.querySelector(".role"))==null?void 0:F.textContent)==null?void 0:X.trim();ie&&V&&(V.includes("مخرج")?Re.push(ie):V.includes("كاتب")?Be.push(ie):Ue.push(ie))});const Le=((me=le.querySelector(".show__trailer"))==null?void 0:me.getAttribute("data-iframe"))||"",Fe=async J=>{var ie;if(!J)return"";try{w("Fetching watch page...");const V=await fetch(`https://corsproxy.io/?${encodeURIComponent(J)}`);if(!V.ok)throw new Error(`Failed to fetch watch page: ${V.statusText}`);const ce=await V.text(),F=(ie=new DOMParser().parseFromString(ce,"text/html").querySelector(".player__iframe iframe"))==null?void 0:ie.getAttribute("src");return F?F.startsWith("/")?`https://a.asd.homes${F}`:new URL(F,J).href:""}catch(V){return console.error("Error scraping watch page:",V),w("Warning: Could not automatically find watch server."),""}},Ge=(J,ie,V)=>new Promise(async(ce,de)=>{if(!J)return ce("");let F=null,X=null;const qe=setTimeout(()=>{X==null||X.disconnect(),F==null||F.remove(),de(new Error(`Scraping timed out for ${J}`))},15e3);try{const he=await fetch(`https://corsproxy.io/?${encodeURIComponent(J)}`);if(!he.ok)return de(new Error(`Failed to fetch intermediate page: ${J}`));const xe=await he.text(),rt=new DOMParser().parseFromString(xe,"text/html").querySelector(ie);if(rt&&rt.getAttribute(V))return clearTimeout(qe),ce(rt.getAttribute(V)||"");F=document.createElement("div"),F.style.display="none",document.body.appendChild(F),X=new MutationObserver(()=>{const at=F==null?void 0:F.querySelector(ie);if(at&&at.getAttribute(V)){const bt=at.getAttribute(V)||"";X==null||X.disconnect(),clearTimeout(qe),F==null||F.remove(),ce(bt)}}),X.observe(F,{childList:!0,subtree:!0}),F.innerHTML=xe}catch(he){clearTimeout(qe),X==null||X.disconnect(),F==null||F.remove(),de(he)}});w("Fetching watch & download pages (this may take a moment)...");const be=(r=le.querySelector("a.watch__btn"))==null?void 0:r.getAttribute("href"),Te=(f=le.querySelector("a.download__btn"))==null?void 0:f.getAttribute("href"),[ve,Oe]=await Promise.all([Fe(be),Ge(Te,'a.downloadsLink, a[href*="vidtube.pro/d/"], .downloads__links__list a',"href").catch(J=>(console.warn("Could not scrape download URL:",J),w("Warning: Could not automatically find download link."),""))]);let ke=[];ve&&(w("Parsing watch servers..."),ke.push({name:"Server 1",url:ve,quality:"HD"})),c(J=>({...J,title:fe,year:Ye||J.year,description:He,poster_url:Ae,backdrop_url:Ae,imdb_rating:Ke,genres:[...new Set([...J.genres,...Qe])],quality:Xe,duration:Ze,language:et,country:tt,directors:Re,writers:Be,cast:Ue,trailer_url:Le,servers:ke.length>0?ke:J.servers,download_url:Oe||J.download_url})),w("تم جلب البيانات بنجاح!")}else if(T.includes("topcinema.cam")){const oe=be=>{var ie,V,ce;const ve=Array.from(le.querySelectorAll(".RightTaxContent > li")).find(de=>{var F,X;return(X=(F=de.querySelector("span"))==null?void 0:F.textContent)==null?void 0:X.trim().startsWith(be)});if(!ve)return[];const Oe=Array.from(ve.querySelectorAll("a, strong"));if(Oe.length>0)return Oe.map(de=>{var F;return((F=de.textContent)==null?void 0:F.trim())||""}).filter(Boolean);const ke=ve.cloneNode(!0);(ie=ke.querySelector("i"))==null||ie.remove(),(V=ke.querySelector("span"))==null||V.remove();const J=(ce=ke.textContent)==null?void 0:ce.trim().replace(/^:/,"").trim();return J?J.split(/\s*,\s*/):[]},Me=((re=(C=le.querySelector("h1.post-title"))==null?void 0:C.textContent)==null?void 0:re.trim())||"",ge=Me.match(/\b(19\d{2}|20\d{2})\b/),Ye=ge?parseInt(ge[0],10):new Date().getFullYear();let fe=Me;fe=fe.replace(/فيلم|مترجم|اون لاين|اونلاين|WEB-DL|BluRay|HD/gi,"").replace(/[\u0600-\u06FF]+/g,""),ge&&(fe=fe.replace(ge[0],"")),fe=fe.trim().replace(/^[^a-zA-Z0-9\s]+|[^a-zA-Z0-9\s]+$/g,"").trim();const He=((ye=(Ee=le.querySelector(".story p"))==null?void 0:Ee.textContent)==null?void 0:ye.trim())||"",Ae=((je=le.querySelector(".MainSingle .left .image img"))==null?void 0:je.getAttribute("src"))||"",Ve=((pe=(we=le.querySelector(".imdbR span"))==null?void 0:we.textContent)==null?void 0:pe.trim())||"0",Ke=parseFloat(Ve)||void 0,Qe=oe("نوع الفيلم"),Xe=oe("جودة الفيلم").join(", "),Ze=oe("توقيت الفيلم").join(", "),et=oe("لغة الفيلم").join(", "),tt=oe("دولة الفيلم").join(", "),Re=oe("المخرجين"),Be=oe("المؤلفين"),Ue=oe("بطولة");let Le="";const Fe=le.querySelector("a.download"),Ge=Fe==null?void 0:Fe.getAttribute("href");if(Ge){w("Fetching download link...");const be=`https://corsproxy.io/?${encodeURIComponent(Ge)}`,Te=await fetch(be);if(Te.ok){const ve=await Te.text();Le=(($e=dt.parseFromString(ve,"text/html").querySelector('a.downloadsLink, a[href*="vidtube.pro/d/"]'))==null?void 0:$e.getAttribute("href"))||""}}c(be=>({...be,title:fe,year:Ye||be.year,description:He,poster_url:Ae,backdrop_url:Ae,imdb_rating:Ke,genres:[...new Set([...be.genres,...Qe])],quality:Xe,duration:Ze,language:et,country:tt,directors:Re,writers:Be,cast:Ue,download_url:Le})),w("تم جلب البيانات بنجاح!")}else{w("هذا الموقع غير مدعوم حاليًا للجلب."),Z(!1);return}}catch(Pe){console.error("Scraping failed:",Pe),w(`فشل جلب البيانات: ${Pe.message}.`)}finally{Z(!1)}},L=n=>{if(n.preventDefault(),s.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const t=N.split(",").map(p=>p.trim()).filter(Boolean),l={...s,tags:t,is_kurdish:s.movie_type==="kurdish"};i(l)},H=j.filter(n=>n.toLowerCase().includes(A.toLowerCase())),W="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",P="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:L,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3 p-4 bg-slate-900/50 rounded-lg border border-slate-700",children:[e.jsx("label",{htmlFor:"scrape_url",className:"block text-lg font-semibold text-white",children:"جلب البيانات من رابط"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{id:"scrape_url",type:"url",value:T,onChange:n=>K(n.target.value),placeholder:"https://web6.topcinema.cam/... or https://a.asd.homes/...",className:`${W} flex-grow`}),e.jsxs("button",{type:"button",onClick:v,disabled:I,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700 flex-shrink-0 flex items-center disabled:bg-slate-500",children:[I&&e.jsx(ut,{}),I?"جاري الجلب...":"جلب البيانات"]})]}),g&&e.jsx("p",{className:`text-sm mt-1 ${g.startsWith("فشل")||g.startsWith("هذا")?"text-red-400":"text-green-400"}`,children:g})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx("input",{type:"text",name:"title",value:s.title,onChange:d,placeholder:"عنوان الفيلم (بالانجليزية)",required:!0,className:W})}),e.jsx("input",{type:"number",name:"year",value:s.year||"",onChange:d,placeholder:"سنة الإنتاج",required:!0,className:W})]}),e.jsx("textarea",{name:"description",value:s.description,onChange:d,placeholder:"وصف الفيلم",required:!0,className:`${W} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",name:"poster_url",value:s.poster_url,onChange:d,placeholder:"رابط صورة البوستر",required:!0,className:`${W} flex-grow`}),e.jsx("button",{type:"button",onClick:()=>D(n=>c(t=>({...t,poster_url:n,backdrop_url:n}))),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-2 px-4 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsx("input",{type:"url",name:"backdrop_url",value:s.backdrop_url,onChange:d,placeholder:"رابط صورة الخلفية",required:!0,className:W})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:s.imdb_rating??"",onChange:d,placeholder:"تقيم الفيلم",step:"0.1",min:"0",max:"10",className:W}),e.jsx("input",{type:"url",name:"trailer_url",value:s.trailer_url??"",onChange:d,placeholder:"رابط المقطع الدعائي (اختياري)",className:W})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"movie_type",className:"block text-sm font-medium text-slate-300 mb-2",children:"نوع الفيلم"}),e.jsx("select",{id:"movie_type",name:"movie_type",value:s.movie_type||"foreign",onChange:d,className:W,children:jt.map(n=>e.jsx("option",{value:n.key,children:n.label},n.key))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-sm font-medium text-slate-300 mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:N,onChange:x,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:W})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:y,children:[e.jsxs("button",{type:"button",onClick:()=>q(n=>!n),className:`${W} text-right flex justify-between items-center`,children:[e.jsx("span",{children:s.genres.length>0?s.genres.join(", "):"اختر الفئات..."}),e.jsx("svg",{className:`h-5 w-5 transition-transform duration-200 ${B?"rotate-180":""}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),B&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[e.jsx("div",{className:"p-2 border-b border-slate-700",children:e.jsx("input",{type:"text",placeholder:"ابحث أو أضف فئة...",value:A,onChange:n=>z(n.target.value),className:"w-full bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"})}),e.jsx("ul",{className:"p-1",children:H.map(n=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.genres.includes(n),onChange:()=>h(n),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:n})]},n))}),e.jsx("div",{className:"p-2 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"إضافة فئة جديدة...",value:_,onChange:n=>$(n.target.value),className:"flex-grow bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:S,disabled:Y||!_.trim(),className:"bg-cyan-600 text-white px-3 py-1 rounded-md text-sm hover:bg-cyan-700 disabled:bg-slate-500",children:Y?"...":"إضافة"})]})})]})]})]}),e.jsxs("details",{className:"bg-slate-900/30 p-4 rounded-lg border border-slate-700",open:!0,children:[e.jsx("summary",{className:"text-lg font-semibold text-white cursor-pointer",children:"تفاصيل إضافية للفيلم"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",name:"quality",value:s.quality,onChange:d,placeholder:"الجودة (e.g. 1080p WEB-DL)",className:P}),e.jsx("input",{type:"text",name:"duration",value:s.duration,onChange:d,placeholder:"مدة العرض",className:P}),e.jsx("input",{type:"text",name:"language",value:s.language,onChange:d,placeholder:"اللغة",className:P}),e.jsx("input",{type:"text",name:"country",value:s.country,onChange:d,placeholder:"الدولة",className:P})]}),e.jsx("textarea",{value:(Q=s.directors)==null?void 0:Q.join(", "),onChange:n=>c(t=>({...t,directors:n.target.value.split(",").map(l=>l.trim())})),placeholder:"المخرجين (مفصولة بفاصلة)",className:`${P} w-full`,rows:2}),e.jsx("textarea",{value:(ne=s.writers)==null?void 0:ne.join(", "),onChange:n=>c(t=>({...t,writers:n.target.value.split(",").map(l=>l.trim())})),placeholder:"المؤلفين (مفصولة بفاصلة)",className:`${P} w-full`,rows:2}),e.jsx("textarea",{value:(ee=s.cast)==null?void 0:ee.join(", "),onChange:n=>c(t=>({...t,cast:n.target.value.split(",").map(l=>l.trim())})),placeholder:"البطولة (مفصولة بفاصلة)",className:`${P} w-full`,rows:3})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات المشاهدة"}),s.servers.map((n,t)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:n.name,onChange:l=>M(t,"name",l.target.value),placeholder:"اسم السيرفر",className:`${P} flex-1`}),e.jsxs("select",{value:n.quality,onChange:l=>M(t,"quality",l.target.value),className:`${P} w-28`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),s.servers.length>1&&e.jsx("button",{type:"button",onClick:()=>se(t),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),t===0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{type:"url",value:n.url,onChange:l=>M(t,"url",l.target.value),placeholder:"رابط السيرفر 1",required:!0,className:`${P} w-full`}),e.jsx("input",{type:"url",name:"download_url",value:s.download_url||"",onChange:d,placeholder:"رابط تحميل الفيلم (اختياري)",className:`${P} w-full`})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:n.url,onChange:l=>M(t,"url",l.target.value),placeholder:`رابط السيرفر ${t+1}`,required:!0,className:`${P} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>D(l=>M(t,"url",l)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]})]},t)),e.jsx("button",{type:"button",onClick:U,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات احتياطية (مشغل خارجي)"}),(s.backup_servers||[]).map((n,t)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:n.name,onChange:l=>R(t,"name",l.target.value),placeholder:"اسم السيرفر",className:`${P} flex-1`}),e.jsxs("select",{value:n.quality,onChange:l=>R(t,"quality",l.target.value),className:`${P} w-28`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>ue(t),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{type:"url",value:n.url,onChange:l=>R(t,"url",l.target.value),placeholder:"رابط السيرفر (مع ترجمة)",className:`${P} w-full`}),e.jsx("input",{type:"url",value:n.no_sub_url||"",onChange:l=>R(t,"no_sub_url",l.target.value),placeholder:"رابط السيرفر (بدون ترجمة)",className:`${P} w-full`})]})]},t)),e.jsx("button",{type:"button",onClick:Ne,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:m,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",disabled:u,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:u,children:[u&&e.jsx(ut,{}),u?a?"جاري التحديث...":"جاري الإضافة...":a?"تحديث الفيلم":"إضافة الفيلم"]})]})]})},vt=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Se=({isOpen:i,onClose:a,onConfirm:m,title:u,message:j,isLoading:s=!1})=>{const[c,N]=o.useState(i);return o.useEffect(()=>{if(i)N(!0);else{const b=setTimeout(()=>N(!1),300);return()=>clearTimeout(b)}},[i]),c?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${i?"animate-fade-in":"animate-fade-out"}`,onClick:a,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:`relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md border border-slate-700 ${i?"animate-zoom-in":"animate-zoom-out"}`,onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:u}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:j})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:m,disabled:s,children:[s&&e.jsx(vt,{}),s?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:a,disabled:s,children:"إلغاء"})]})]})}):null},Nt=10,xt=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((i,a)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},a))})}),e.jsx("tbody",{children:[...Array(Nt)].map((i,a)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((m,u)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},u))]},a))})]})})]}),ct=({message:i,type:a,onClose:m})=>(o.useEffect(()=>{const s=setTimeout(m,5e3);return()=>clearTimeout(s)},[m]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${a==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:i}),e.jsx("button",{onClick:m,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),pt=({genres:i,onSubmit:a,onClose:m,isLoading:u})=>{const[j,s]=o.useState(i[0]||""),[c,N]=o.useState("add"),b=T=>{T.preventDefault(),j&&a(j,c)};return e.jsx(_e,{title:"تغيير الفئة بشكل جماعي",onClose:m,isOpen:!0,children:e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:j,onChange:T=>s(T.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:i.map(T=>e.jsx("option",{value:T,children:T},T))}),e.jsxs("select",{value:c,onChange:T=>N(T.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:m,disabled:u,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:u||!j,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[u&&e.jsx(Ce,{}),u?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},kt=({onSubmit:i,onClose:a,isLoading:m})=>{const[u,j]=o.useState(new Date().getFullYear()),s=c=>{c.preventDefault(),i(u)};return e.jsx(_e,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:a,isOpen:!0,children:e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:u,onChange:c=>j(parseInt(c.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:a,disabled:m,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:m,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[m&&e.jsx(Ce,{}),m?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},gt=({onSubmit:i,onClose:a,isLoading:m})=>{const[u,j]=o.useState(""),[s,c]=o.useState("add"),N=b=>{b.preventDefault(),u.trim()&&i(u.trim(),s)};return e.jsx(_e,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:a,isOpen:!0,children:e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:u,onChange:b=>j(b.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:s,onChange:b=>c(b.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:a,disabled:m,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:m||!u.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[m&&e.jsx(Ce,{}),m?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Ct=({movieTypes:i,onSubmit:a,onClose:m,isLoading:u})=>{var N;const[j,s]=o.useState(((N=i[0])==null?void 0:N.key)||"foreign"),c=b=>{b.preventDefault(),a(j)};return e.jsx(_e,{title:"تغيير نوع الفيلم بشكل جماعي",onClose:m,isOpen:!0,children:e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر النوع الجديد ليتم تطبيقه على جميع الأفلام المحددة."}),e.jsx("select",{value:j,onChange:b=>s(b.target.value),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:i.map(b=>e.jsx("option",{value:b.key,children:b.label},b.key))}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:m,disabled:u,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:u,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[u&&e.jsx(Ce,{}),u?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Ie=10,nt=[{key:"foreign",label:"افلام اجنبي"},{key:"kurdish",label:"افلام كردي"},{key:"asian",label:"افلام اسيوية"},{key:"turkish",label:"افلام تركية"},{key:"arabic",label:"افلام عربي"},{key:"classic",label:"افلام كلاسيكيه"},{key:"dubbed",label:"افلام مدبلجة"},{key:"indian",label:"افلام هندية"},{key:"anime",label:"افلام انمي"}],St=async()=>{let i=[],a=0;const m=1e3;for(;;){const{data:u,error:j,count:s}=await E.from("movies").select("*",{count:"exact"}).order("created_at",{ascending:!1}).range(a,a+m-1);if(j)throw console.error("Error fetching a batch of movies for admin: ",j.message),j;if(u){if(i=i.concat(u),i.length>=(s??0)||u.length<m)break;a+=m}else break}return i},_t=()=>{const[i,a]=o.useState([]),[m,u]=o.useState(null),[j,s]=o.useState(!1),[c,N]=o.useState(1),[b,T]=o.useState("all"),[K,I]=o.useState(""),[Z,g]=o.useState(!1),[w,B]=o.useState(null),[q,A]=o.useState(!0),[z,_]=o.useState(!1),[$,Y]=o.useState(null),[G,y]=o.useState([]),[D,d]=o.useState(null),[x,h]=o.useState([]),[S,M]=mt(),U=o.useRef(!1),se=async()=>{try{const C=await St();a(C)}catch(C){console.error("Error fetching movies: ",C),R("فشل في تحميل الأفلام.","error")}const{data:r,error:f}=await E.from("categories").select("name").order("name");f?console.error("Error fetching categories from ManageMovies: ",f):h(r.map(C=>C.name)),A(!1)};o.useEffect(()=>{A(!0),se();const r=E.channel("public:movies").on("postgres_changes",{event:"*",schema:"public",table:"movies"},()=>se()).subscribe();return()=>{E.removeChannel(r)}},[]),o.useEffect(()=>{if(q||U.current)return;const r=S.get("edit");if(r&&i.length>0){const f=i.find(C=>C.id===r);f&&(H(f),S.delete("edit"),M(S,{replace:!0}),U.current=!0)}},[S,M,i,q]),o.useEffect(()=>{N(1),y([])},[b,K]);const R=(r,f)=>{Y({message:r,type:f})},Ne=async r=>{_(!0);try{const{error:f}=await E.from("movies").insert([{...r,created_at:new Date().toISOString()}]);if(f)throw f;await se(),s(!1),N(1),R("تمت إضافة الفيلم بنجاح.","success")}catch(f){console.error("Error adding movie: ",f);const C=f.message||JSON.stringify(f);R(`حدث خطأ أثناء إضافة الفيلم: ${C}`,"error")}finally{_(!1)}},ue=async(r,f)=>{_(!0);try{const{error:C}=await E.from("movies").update(f).eq("id",r);if(C)throw C;await se(),u(null),s(!1),R("تم تحديث الفيلم بنجاح.","success")}catch(C){console.error("Error updating movie: ",C);const re=C.message||JSON.stringify(C);R(`حدث خطأ أثناء تحديث الفيلم: ${re}`,"error")}finally{_(!1)}},v=r=>{B(r),g(!0)},L=async()=>{if(w){_(!0);try{const{error:r}=await E.from("movies").delete().eq("id",w.id);if(r)throw r;R("تم حذف الفيلم بنجاح.","success")}catch(r){console.error("Error deleting movie: ",r);const f=r.message||JSON.stringify(r);R(`حدث خطأ أثناء حذف الفيلم: ${f}`,"error")}finally{g(!1),B(null),_(!1)}}},H=r=>{u(r),s(!0)},W=()=>{u(null),s(!0)},P=()=>{u(null),s(!1),d(null)},Q=r=>{y(f=>f.includes(r)?f.filter(C=>C!==r):[...f,r])},ne=r=>{r.target.checked?y(te.map(f=>f.id)):y(G.filter(f=>!te.some(C=>C.id===f)))},ee=async(r,f)=>{_(!0);try{const{error:C}=await E.from("movies").update(r).in("id",G);if(C)throw C;R(f,"success"),y([])}catch(C){console.error("Bulk update failed:",C),R("فشل التحديث الجماعي.","error")}finally{_(!1),d(null)}},n=async r=>{await ee({movie_type:r,is_kurdish:r==="kurdish"},"تم تغيير النوع بنجاح.")},t=async()=>{_(!0);try{const{error:r}=await E.from("movies").delete().in("id",G);if(r)throw r;R(`تم حذف ${G.length} فيلم بنجاح.`,"success"),y([])}catch(r){console.error("Bulk delete failed:",r),R("فشل الحذف الجماعي.","error")}finally{_(!1),d(null)}},l=async(r,f)=>{_(!0);try{const{data:C,error:re}=await E.from("movies").select("id, genres").in("id",G);if(re)throw re;const Ee=C.map(je=>{const we=je.genres||[];let pe;return f==="add"?pe=[...new Set([...we,r])]:pe=we.filter($e=>$e!==r),{id:je.id,genres:pe}}),{error:ye}=await E.from("movies").upsert(Ee);if(ye)throw ye;R(`تم ${f==="add"?"إضافة":"إزالة"} فئة "${r}" بنجاح.`,"success"),y([])}catch(C){console.error("Bulk genre change failed:",C),R("فشل تغيير الفئة الجماعي.","error")}finally{_(!1),d(null)}},p=async(r,f)=>{_(!0);try{const{data:C,error:re}=await E.from("movies").select("id, tags").in("id",G);if(re)throw re;const Ee=C.map(je=>{const we=je.tags||[];let pe;return f==="add"?pe=[...new Set([...we,r])]:pe=we.filter($e=>$e!==r),{id:je.id,tags:pe}}),{error:ye}=await E.from("movies").upsert(Ee);if(ye)throw ye;R(`تم ${f==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${r}" بنجاح.`,"success"),y([])}catch(C){console.error("Bulk tags change failed:",C),R("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{_(!1),d(null)}},k=i.filter(r=>b==="all"?!0:b==="foreign"?r.movie_type==="foreign"||!r.movie_type:b==="kurdish"?r.movie_type==="kurdish"||r.is_kurdish===!0:r.movie_type===b).filter(r=>ht(K,r.title)),O=Math.ceil(k.length/Ie),te=k.slice((c-1)*Ie,c*Ie),ae=te.length>0&&te.every(r=>G.includes(r.id)),me=r=>{var C;let f=r.movie_type;return!f&&r.is_kurdish?f="kurdish":f||(f="foreign"),((C=nt.find(re=>re.key===f))==null?void 0:C.label)||f};return q?e.jsx(xt,{}):e.jsxs("div",{className:"relative",children:[$&&e.jsx(ct,{...$,onClose:()=>Y(null)}),e.jsx(Se,{isOpen:Z,onClose:()=>g(!1),onConfirm:L,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',w==null?void 0:w.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:z}),D==="delete"&&e.jsx(Se,{isOpen:!0,onClose:()=>d(null),onConfirm:t,title:`تأكيد حذف ${G.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:z}),D==="genre"&&e.jsx(pt,{genres:x,onClose:P,onSubmit:l,isLoading:z}),D==="tags"&&e.jsx(gt,{onClose:P,onSubmit:p,isLoading:z}),D==="year"&&e.jsx(kt,{onClose:P,onSubmit:r=>ee({year:r},"تم تحديث السنة بنجاح."),isLoading:z}),D==="changeType"&&e.jsx(Ct,{movieTypes:nt,onClose:P,onSubmit:n,isLoading:z}),j&&e.jsx(_e,{title:m?"تعديل الفيلم":"إضافة فيلم جديد",onClose:P,isOpen:j,children:e.jsx(wt,{onSubmit:m?r=>ue(m.id,r):Ne,initialData:m,onCancel:P,isLoading:z,allGenres:x})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:W,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:K,onChange:r=>I(r.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("select",{value:b,onChange:r=>T(r.target.value),className:"w-full sm:w-auto bg-slate-700 text-white p-2.5 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors flex-shrink-0","aria-label":"Filter by movie type",children:[e.jsx("option",{value:"all",children:"كل الأنواع"}),nt.map(r=>e.jsx("option",{value:r.key,children:r.label},r.key))]})]}),G.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[G.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>y([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>d("changeType"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير النوع"}),e.jsx("button",{onClick:()=>d("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>d("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>d("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>d("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto hidden lg:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:ne,checked:ae,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"نوع الفيلم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:te.map(r=>{var f,C;return e.jsxs("tr",{className:`${G.includes(r.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:G.includes(r.id),onChange:()=>Q(r.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:r.poster_url,alt:r.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:r.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:r.imdb_rating?r.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:r.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(f=r.genres)==null?void 0:f.slice(0,3).map(re=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:re},re)),((C=r.genres)==null?void 0:C.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:me(r)}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:r.created_at?new Date(r.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>H(r),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>v(r),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},r.id)})})]})}),e.jsxs("div",{className:"block lg:hidden space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx("input",{type:"checkbox",onChange:ne,checked:ae,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("label",{className:"text-sm text-slate-300",children:"تحديد الكل في هذه الصفحة"})]}),te.map(r=>{var f,C;return e.jsxs("div",{className:`p-3 rounded-lg transition-all duration-200 ${G.includes(r.id)?"bg-cyan-500/20 ring-2 ring-cyan-500":"bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24",children:e.jsx("img",{src:r.poster_url,alt:r.title,className:"w-full rounded object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-bold text-white truncate flex-grow pr-2",children:r.title}),e.jsx("input",{type:"checkbox",checked:G.includes(r.id),onChange:()=>Q(r.id),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 flex-shrink-0"})]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1 flex items-center gap-x-2 flex-wrap",children:[e.jsx("span",{children:r.year}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{className:"text-yellow-400 font-bold",children:r.imdb_rating?r.imdb_rating.toFixed(1):"N/A"}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{children:me(r)})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[(f=r.genres)==null?void 0:f.slice(0,2).map(re=>e.jsx("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:re},re)),((C=r.genres)==null?void 0:C.length)>2&&e.jsxs("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:["+",r.genres.length-2]})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 flex justify-end items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-xs text-slate-500 mr-auto",children:["أضيف في: ",r.created_at?new Date(r.created_at).toLocaleDateString("ar-EG"):"N/A"]}),e.jsx("button",{onClick:()=>H(r),className:"font-medium text-cyan-400 hover:text-cyan-300",children:"تعديل"}),e.jsx("button",{onClick:()=>v(r),className:"font-medium text-red-500 hover:text-red-400",children:"حذف"})]})]},r.id)})]})]}),k.length>Ie&&e.jsx("div",{className:"p-4 mt-4 border-t border-slate-700",children:e.jsx(it,{currentPage:c,totalPages:O,onPageChange:N})})]})},Et=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),$t=({onSubmit:i,initialData:a,onCancel:m,isLoading:u=!1,allGenres:j=[]})=>{const[s,c]=o.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:"",year:new Date().getFullYear(),episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"}],imdb_rating:0}],trailer_url:"",imdb_rating:0}),[N,b]=o.useState(""),[T,K]=o.useState(!1),I=o.useRef(null);o.useEffect(()=>{a&&(c({...a,genres:a.genres||[],tags:a.tags||[],seasons:a.seasons&&a.seasons.length>0?a.seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:a.poster_url,year:a.year,episodes:[],imdb_rating:0}],trailer_url:a.trailer_url||"",imdb_rating:a.imdb_rating||0}),b((a.tags||[]).join(", ")))},[a]),o.useEffect(()=>{const d=x=>{I.current&&!I.current.contains(x.target)&&K(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]);const Z=async d=>{var x;try{if(!((x=navigator.clipboard)!=null&&x.readText))throw new Error("Clipboard API not available.");const h=await navigator.clipboard.readText();h&&d(h)}catch(h){console.error("Failed to read clipboard contents: ",h),alert("فشل لصق النص. يرجى التأكد من منح الإذن لاستخدام الحافظة.")}},g=d=>{const{name:x,value:h}=d.target;if(x==="year"||x==="imdb_rating"){const S=parseFloat(h);c(M=>({...M,[x]:isNaN(S)?0:S}))}else c(S=>({...S,[x]:h}))},w=d=>{b(d.target.value)},B=d=>{c(x=>({...x,genres:x.genres.includes(d)?x.genres.filter(h=>h!==d):[...x.genres,d]}))},q=(d,x,h)=>{const S=[...s.seasons],M={...S[d]};if(x==="season_number"||x==="year"||x==="imdb_rating"){const U=typeof h=="string"?parseFloat(h):h;M[x]=isNaN(U)?0:U}else M[x]=h;S[d]=M,c(U=>({...U,seasons:S}))},A=()=>{const d=s.seasons.length>0?Math.max(...s.seasons.map(h=>h.season_number))+1:1,x=s.seasons.length>0?s.seasons[s.seasons.length-1].year:s.year;c(h=>({...h,seasons:[...h.seasons,{season_number:d,title:`الموسم ${d}`,description:"",poster_url:h.poster_url,year:x+1,episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"}],imdb_rating:0}]}))},z=d=>{c(x=>({...x,seasons:x.seasons.filter((h,S)=>S!==d)}))},_=(d,x,h,S)=>{const M=[...s.seasons],U=[...M[d].episodes],se={...U[x]};if(h==="episode_number"){const R=typeof S=="string"?parseFloat(S):S;se[h]=isNaN(R)?0:R}else se[h]=S;U[x]=se,M[d]={...M[d],episodes:U},c(R=>({...R,seasons:M}))},$=d=>{const x=s.seasons[d],h=x.episodes.length>0?Math.max(...x.episodes.map(U=>U.episode_number))+1:1,S={episode_number:h,title:`الحلقة ${h}`,url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"},M=s.seasons.map((U,se)=>se===d?{...U,episodes:[...U.episodes,S]}:U);c(U=>({...U,seasons:M}))},Y=(d,x)=>{const h=s.seasons.map((S,M)=>M===d?{...S,episodes:S.episodes.filter((U,se)=>se!==x)}:S);c(S=>({...S,seasons:h}))},G=d=>{d.preventDefault();const x=N.split(",").map(h=>h.trim()).filter(Boolean);i({...s,tags:x})},y="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",D="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:G,className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white border-b border-slate-700 pb-2",children:"معلومات المسلسل الرئيسية"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:s.title,onChange:g,placeholder:"عنوان المسلسل",required:!0,className:y}),e.jsx("input",{type:"number",name:"year",value:s.year||"",onChange:g,placeholder:"سنة بداية العرض",required:!0,className:y})]}),e.jsx("textarea",{name:"description",value:s.description,onChange:g,placeholder:"وصف المسلسل العام",required:!0,className:`${y} h-24`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"poster_url",value:s.poster_url,onChange:g,placeholder:"رابط البوستر الرئيسي",required:!0,className:y}),e.jsx("input",{type:"url",name:"backdrop_url",value:s.backdrop_url,onChange:g,placeholder:"رابط صورة الخلفية",required:!0,className:y})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:s.imdb_rating??"",onChange:g,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:y}),e.jsx("input",{type:"url",name:"trailer_url",value:s.trailer_url??"",onChange:g,placeholder:"رابط المقطع الدعائي (اختياري)",className:y})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات"}),e.jsxs("div",{className:"relative",ref:I,children:[e.jsx("button",{type:"button",onClick:()=>K(d=>!d),className:`${y} text-right`,children:s.genres.length>0?s.genres.join(", "):"اختر الفئات..."}),T&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:j.map(d=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.genres.includes(d),onChange:()=>B(d),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:d})]},d))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (مفصولة بفاصلة)"}),e.jsx("input",{type:"text",value:N,onChange:w,placeholder:"أكشن, إثارة...",className:y})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),s.seasons.map((d,x)=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-white font-semibold",children:"الموسم رقم:"}),e.jsx("input",{type:"number",value:d.season_number||"",onChange:h=>q(x,"season_number",h.target.value),className:`${D} w-20`})]}),e.jsx("button",{type:"button",onClick:()=>z(x),className:"bg-red-600 text-white px-3 py-1 rounded-md text-sm",children:"إزالة الموسم"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",value:d.title,onChange:h=>q(x,"title",h.target.value),placeholder:"عنوان الموسم",required:!0,className:D}),e.jsx("input",{type:"number",value:d.year||"",onChange:h=>q(x,"year",h.target.value),placeholder:"سنة الموسم",required:!0,className:D}),e.jsx("input",{type:"number",value:d.imdb_rating??"",onChange:h=>q(x,"imdb_rating",h.target.value),placeholder:"تقييم IMDb",step:"0.1",min:"0",max:"10",className:D}),e.jsx("input",{type:"url",value:d.poster_url,onChange:h=>q(x,"poster_url",h.target.value),placeholder:"رابط بوستر الموسم",required:!0,className:`${D} col-span-1 sm:col-span-3`}),e.jsx("textarea",{value:d.description,onChange:h=>q(x,"description",h.target.value),placeholder:"وصف الموسم",required:!0,className:`${D} h-20 col-span-1 sm:col-span-3`})]}),e.jsxs("div",{className:"space-y-2 pt-3 mt-3 border-t border-slate-600",children:[e.jsxs("h4",{className:"font-semibold text-slate-300",children:["حلقات الموسم ",d.season_number,":"]}),d.episodes.map((h,S)=>e.jsxs("div",{className:"bg-slate-800/60 p-2 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:h.episode_number||"",onChange:M=>_(x,S,"episode_number",M.target.value),placeholder:"رقم",className:`${D} w-16`}),e.jsx("input",{type:"text",value:h.title,onChange:M=>_(x,S,"title",M.target.value),placeholder:"عنوان الحلقة",className:`${D} flex-1`}),e.jsx("button",{type:"button",onClick:()=>Y(x,S),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600 text-xs",children:"X"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("input",{type:"url",value:h.url,onChange:M=>_(x,S,"url",M.target.value),placeholder:"رابط المشاهدة",required:!0,className:`${D} flex-1`}),e.jsx("button",{type:"button",onClick:()=>Z(M=>_(x,S,"url",M)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsxs("select",{value:h.quality||"1080p",onChange:M=>_(x,S,"quality",M.target.value),className:`${D} w-28 flex-shrink-0`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]})]}),e.jsx("input",{type:"url",value:h.download_url||"",onChange:M=>_(x,S,"download_url",M.target.value),placeholder:"رابط التحميل (اختياري)",className:`${D} w-full`})]})]},S)),e.jsx("button",{type:"button",onClick:()=>$(x),className:"text-sm bg-slate-600 text-white py-1 px-3 rounded-md hover:bg-slate-500",children:"إضافة حلقة"})]})]},x)),e.jsx("button",{type:"button",onClick:A,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700",children:"إضافة موسم"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:m,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg",disabled:u,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg",disabled:u,children:[u&&e.jsx(Et,{}),a?"تحديث المسلسل":"إضافة المسلسل"]})]})]})},De=10,Mt=()=>{const[i,a]=o.useState([]),[m,u]=o.useState(null),[j,s]=o.useState(!1),[c,N]=o.useState(1),[b,T]=o.useState(""),[K,I]=o.useState(!1),[Z,g]=o.useState(null),[w,B]=o.useState(!0),[q,A]=o.useState(!1),[z,_]=o.useState(null),[$,Y]=o.useState([]),[G,y]=o.useState(null),[D,d]=o.useState([]),x=async()=>{const{data:t,error:l}=await E.from("series").select("*").order("created_at",{ascending:!1});l?(console.error("Error fetching series: ",l),h("فشل في تحميل المسلسلات.","error")):a(t);const{data:p,error:k}=await E.from("categories").select("name").order("name");k?console.error("Error fetching categories: ",k):d(p.map(O=>O.name)),B(!1)};o.useEffect(()=>{B(!0),x();const t=E.channel("public:series").on("postgres_changes",{event:"*",schema:"public",table:"series"},x).subscribe();return()=>{E.removeChannel(t)}},[]),o.useEffect(()=>{N(1),Y([])},[b]);const h=(t,l)=>{_({message:t,type:l})},S=async t=>{A(!0);try{const{error:l}=await E.from("series").insert([{...t,created_at:new Date().toISOString()}]);if(l)throw l;await x(),s(!1),N(1),h("تمت إضافة المسلسل بنجاح.","success")}catch(l){console.error("Error adding series: ",l);const p=l.message||JSON.stringify(l);h(`حدث خطأ أثناء إضافة المسلسل: ${p}`,"error")}finally{A(!1)}},M=async(t,l)=>{A(!0);try{const{error:p}=await E.from("series").update(l).eq("id",t);if(p)throw p;await x(),u(null),s(!1),h("تم تحديث المسلسل بنجاح.","success")}catch(p){console.error("Error updating series:",p);const k=p.message||JSON.stringify(p);h(`حدث خطأ أثناء تحديث المسلسل: ${k}`,"error")}finally{A(!1)}},U=t=>{g(t),I(!0)},se=async()=>{if(Z){A(!0);try{const{error:t}=await E.from("series").delete().eq("id",Z.id);if(t)throw t;h("تم حذف المسلسل بنجاح.","success")}catch(t){console.error("Error deleting series:",t);const l=t.message||JSON.stringify(t);h(`حدث خطأ أثناء حذف المسلسل: ${l}`,"error")}finally{I(!1),g(null),A(!1)}}},R=t=>{u(t),s(!0)},Ne=()=>{u(null),s(!0)},ue=()=>{u(null),s(!1),y(null)},v=t=>{Y(l=>l.includes(t)?l.filter(p=>p!==t):[...l,t])},L=t=>{t.target.checked?Y(ee.map(l=>l.id)):Y($.filter(l=>!ee.some(p=>p.id===l)))},H=async()=>{A(!0);try{const{error:t}=await E.from("series").delete().in("id",$);if(t)throw t;h(`تم حذف ${$.length} مسلسل بنجاح.`,"success"),Y([])}catch(t){console.error("Bulk delete failed:",t),h("فشل الحذف الجماعي.","error")}finally{A(!1),y(null)}},W=async(t,l)=>{A(!0);try{const{data:p,error:k}=await E.from("series").select("id, genres").in("id",$);if(k)throw k;const O=p.map(ae=>{const me=ae.genres||[],r=l==="add"?[...new Set([...me,t])]:me.filter(f=>f!==t);return{id:ae.id,genres:r}}),{error:te}=await E.from("series").upsert(O);if(te)throw te;h(`تم ${l==="add"?"إضافة":"إزالة"} فئة "${t}" بنجاح.`,"success"),Y([])}catch(p){console.error("Bulk genre change failed:",p),h("فشل تغيير الفئة الجماعي.","error")}finally{A(!1),y(null)}},P=async(t,l)=>{A(!0);try{const{data:p,error:k}=await E.from("series").select("id, tags").in("id",$);if(k)throw k;const O=p.map(ae=>{const me=ae.tags||[],r=l==="add"?[...new Set([...me,t])]:me.filter(f=>f!==t);return{id:ae.id,tags:r}}),{error:te}=await E.from("series").upsert(O);if(te)throw te;h(`تم ${l==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${t}" بنجاح.`,"success"),Y([])}catch(p){console.error("Bulk tags change failed:",p),h("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{A(!1),y(null)}},Q=i.filter(t=>ht(b,t.title)),ne=Math.ceil(Q.length/De),ee=Q.slice((c-1)*De,c*De),n=ee.length>0&&ee.every(t=>$.includes(t.id));return w?e.jsx(xt,{}):e.jsxs("div",{className:"relative",children:[z&&e.jsx(ct,{...z,onClose:()=>_(null)}),e.jsx(Se,{isOpen:K,onClose:()=>I(!1),onConfirm:se,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',Z==null?void 0:Z.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:q}),G==="delete"&&e.jsx(Se,{isOpen:!0,onClose:()=>y(null),onConfirm:H,title:`تأكيد حذف ${$.length} مسلسل`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:q}),G==="genre"&&e.jsx(pt,{genres:D,onClose:ue,onSubmit:W,isLoading:q}),G==="tags"&&e.jsx(gt,{onClose:ue,onSubmit:P,isLoading:q}),j&&e.jsx(_e,{title:m?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:ue,isOpen:j,children:e.jsx($t,{onSubmit:m?t=>M(m.id,t):S,initialData:m,onCancel:ue,isLoading:q,allGenres:D})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:Ne,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:b,onChange:t=>T(t.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a series to edit"})]})]}),$.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[$.length," مسلسل محدد"]}),e.jsx("button",{onClick:()=>Y([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>y("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>y("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>y("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto hidden lg:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:L,checked:n,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:ee.map(t=>{var l,p,k;return e.jsxs("tr",{className:`${$.includes(t.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:$.includes(t.id),onChange:()=>v(t.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:t.poster_url,alt:t.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:t.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:t.imdb_rating?t.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(l=t.genres)==null?void 0:l.slice(0,3).map(O=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:O},O)),((p=t.genres)==null?void 0:p.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:((k=t.seasons)==null?void 0:k.length)||0}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>R(t),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>U(t),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},t.id)})})]})}),e.jsxs("div",{className:"block lg:hidden space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx("input",{type:"checkbox",onChange:L,checked:n,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("label",{className:"text-sm text-slate-300",children:"تحديد الكل في هذه الصفحة"})]}),ee.map(t=>{var l,p,k;return e.jsxs("div",{className:`p-3 rounded-lg transition-all duration-200 ${$.includes(t.id)?"bg-cyan-500/20 ring-2 ring-cyan-500":"bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24",children:e.jsx("img",{src:t.poster_url,alt:t.title,className:"w-full rounded object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-bold text-white truncate flex-grow pr-2",children:t.title}),e.jsx("input",{type:"checkbox",checked:$.includes(t.id),onChange:()=>v(t.id),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 flex-shrink-0"})]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1 flex items-center gap-x-2 flex-wrap",children:[e.jsx("span",{children:t.year}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{className:"text-yellow-400 font-bold",children:t.imdb_rating?t.imdb_rating.toFixed(1):"N/A"}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsxs("span",{children:[((l=t.seasons)==null?void 0:l.length)||0," مواسم"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[(p=t.genres)==null?void 0:p.slice(0,2).map(O=>e.jsx("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:O},O)),((k=t.genres)==null?void 0:k.length)>2&&e.jsxs("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:["+",t.genres.length-2]})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 flex justify-end items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-xs text-slate-500 mr-auto",children:["أضيف في: ",t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"N/A"]}),e.jsx("button",{onClick:()=>R(t),className:"font-medium text-cyan-400 hover:text-cyan-300",children:"تعديل"}),e.jsx("button",{onClick:()=>U(t),className:"font-medium text-red-500 hover:text-red-400",children:"حذف"})]})]},t.id)})]})]}),Q.length>De&&e.jsx("div",{className:"p-4 mt-4 border-t border-slate-700",children:e.jsx(it,{currentPage:c,totalPages:ne,onPageChange:N})})]})},qt=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),At=({onSubmit:i,initialData:a,onCancel:m,isLoading:u=!1})=>{const[j,s]=o.useState("");o.useEffect(()=>{s(a?a.name:"")},[a]);const c=N=>{N.preventDefault(),j.trim()&&i({name:j})};return e.jsxs("form",{onSubmit:c,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:j,onChange:N=>s(N.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:m,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:u,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:u,children:[u&&e.jsx(qt,{}),u?a?"جاري التحديث...":"جاري الإضافة...":a?"تحديث":"إضافة"]})]})]})},Ft=10,Tt=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(Ft)].map((i,a)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},a))})]})})}),Ot=({isOpen:i,onClose:a,onSubmit:m,isLoading:u,categories:j})=>{const[s,c]=o.useState(""),[N,b]=o.useState(""),[T,K]=o.useState(""),I=yt.useMemo(()=>j.filter(g=>g.name!==s),[j,s]);o.useEffect(()=>{if(i&&j.length>0){const g=j[0].name;c(g);const w=j.filter(B=>B.name!==g);b(w.length>0?w[0].name:"")}},[i,j]),o.useEffect(()=>{K(s&&N&&s===N?"لا يمكن دمج فئة مع نفسها. الرجاء اختيار فئتين مختلفتين.":"")},[s,N]),o.useEffect(()=>{I.some(g=>g.name===N)||b(I.length>0?I[0].name:"")},[s,I,N]);const Z=g=>{g.preventDefault(),!(T||!s||!N)&&m(s,N)};return e.jsx(_e,{title:"توحيد (دمج) الفئات",onClose:a,isOpen:i,children:e.jsxs("form",{onSubmit:Z,className:"space-y-6",children:[e.jsx("p",{className:"text-slate-300",children:"سيتم نقل كل المحتوى من الفئة المصدر إلى الفئة الهدف، ثم سيتم حذف الفئة المصدر نهائياً."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source_category",className:"block text-sm font-medium text-slate-300 mb-2",children:"دمج من هذه الفئة (سيتم حذفها):"}),e.jsx("select",{id:"source_category",value:s,onChange:g=>c(g.target.value),required:!0,className:"w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",children:j.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"destination_category",className:"block text-sm font-medium text-slate-300 mb-2",children:"الدمج في هذه الفئة (ستبقى):"}),e.jsx("select",{id:"destination_category",value:N,onChange:g=>b(g.target.value),required:!0,className:"w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",disabled:I.length===0,children:I.map(g=>e.jsx("option",{value:g.name,children:g.name},g.id))})]}),T&&e.jsx("p",{className:"text-red-400 text-center text-sm bg-red-500/10 p-2 rounded-md",children:T}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:a,disabled:u,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:u||!!T||!s||!N,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",children:[u&&e.jsx(Ce,{}),u?"جاري الدمج...":"تنفيذ الدمج"]})]})]})})},ze=10,Pt=({message:i,type:a,onClose:m})=>(o.useEffect(()=>{const s=setTimeout(m,5e3);return()=>clearTimeout(s)},[m]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${a==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:i}),e.jsx("button",{onClick:m,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Rt=({children:i,onClose:a,title:m,isOpen:u})=>{const[j,s]=o.useState(u);return o.useEffect(()=>{if(u){s(!0),document.body.style.overflow="hidden";const c=N=>{N.key==="Escape"&&a()};return window.addEventListener("keydown",c),()=>{window.removeEventListener("keydown",c)}}else{const c=setTimeout(()=>{s(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(c)}},[u,a]),j?e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 ${u?"animate-fade-in":"animate-fade-out"}`,onClick:a,children:e.jsxs("div",{className:`bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700 ${u?"animate-zoom-in":"animate-zoom-out"}`,onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:m}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),i]})}):null},Bt=()=>{const[i,a]=o.useState([]),[m,u]=o.useState(null),[j,s]=o.useState(!1),[c,N]=o.useState(1),[b,T]=o.useState(!1),[K,I]=o.useState(null),[Z,g]=o.useState(!0),[w,B]=o.useState(!1),[q,A]=o.useState(null),[z,_]=o.useState(!1),[$,Y]=o.useState(null),G=async()=>{const{data:v,error:L}=await E.from("categories").select("*").order("name");L?(console.error("Error fetching categories: ",L),y("فشل في تحميل الفئات.","error")):a(v),g(!1)};o.useEffect(()=>{g(!0),G();const v=E.channel("public:categories").on("postgres_changes",{event:"*",schema:"public",table:"categories"},G).subscribe();return()=>{E.removeChannel(v)}},[]);const y=(v,L)=>{A({message:v,type:L})},D=async v=>{B(!0);try{const{error:L}=await E.from("categories").insert([v]);if(L)throw L;y("تمت إضافة الفئة بنجاح!","success"),s(!1),N(1)}catch(L){console.error("Error adding category: ",L);const H=L.message||JSON.stringify(L);y(`حدث خطأ أثناء إضافة الفئة: ${H}`,"error")}finally{B(!1)}},d=async(v,L)=>{B(!0);const H=m==null?void 0:m.name,W=L.name,P=H&&W&&H!==W;try{const{error:Q}=await E.from("categories").update(L).eq("id",v);if(Q)throw Q;if(P){y("تم تحديث الفئة. جاري تحديث المحتوى المرتبط...","success");const{data:ne,error:ee}=await E.from("movies").select("id, genres").contains("genres",[H]);if(ee)console.error("Error fetching movies to update:",ee),y("تم تحديث الفئة، لكن حدث خطأ أثناء جلب الأفلام للتحديث.","error");else if(ne&&ne.length>0){const l=ne.map(O=>{const te=O.genres.map(ae=>ae===H?W:ae);return E.from("movies").update({genres:te}).eq("id",O.id)}),k=(await Promise.all(l)).find(O=>O.error);k&&(console.error("Error updating movies with new category:",k.error),y("تم تحديث الفئة، لكن حدث خطأ أثناء تحديث بعض الأفلام.","error"))}const{data:n,error:t}=await E.from("series").select("id, genres").contains("genres",[H]);if(t)console.error("Error fetching series to update:",t),y("تم تحديث الفئة، لكن حدث خطأ أثناء جلب المسلسلات للتحديث.","error");else if(n&&n.length>0){const l=n.map(O=>{const te=O.genres.map(ae=>ae===H?W:ae);return E.from("series").update({genres:te}).eq("id",O.id)}),k=(await Promise.all(l)).find(O=>O.error);k&&(console.error("Error updating series with new category:",k.error),y("تم تحديث الفئة، لكن حدث خطأ أثناء تحديث بعض المسلسلات.","error"))}y("تم تحديث الفئة والمحتوى المرتبط بنجاح!","success")}else y("تم تحديث الفئة بنجاح!","success");u(null),s(!1)}catch(Q){if(console.error("Error updating category transaction: ",Q),Q.code==="23505")y(`فشل التحديث: اسم الفئة "${W}" موجود بالفعل.`,"error");else{const ne=Q.message||JSON.stringify(Q);y(`حدث خطأ أثناء تحديث الفئة: ${ne}`,"error")}}finally{B(!1)}},x=v=>{I(v),T(!0)},h=async()=>{if(K){B(!0);try{const{error:v}=await E.from("categories").delete().eq("id",K.id);if(v)throw v;y("تم حذف الفئة بنجاح!","success")}catch(v){console.error("Error deleting category: ",v);const L=v.message||JSON.stringify(v);y(`حدث خطأ أثناء حذف الفئة: ${L}`,"error")}finally{T(!1),I(null),B(!1)}}},S=v=>{u(v),s(!0)},M=()=>{u(null),s(!0)},U=()=>{u(null),s(!1)},se=(v,L)=>{_(!1),Y({source:v,dest:L})},R=async()=>{if(!$)return;const{source:v,dest:L}=$;B(!0);try{y("جاري تحديث الأفلام...","success");const{data:H,error:W}=await E.from("movies").select("id, genres").contains("genres",[v]);if(W)throw new Error(`Failed to fetch movies: ${W.message}`);if(H&&H.length>0){const ee=H.map(n=>{const t=[...new Set(n.genres.filter(l=>l!==v).concat([L]))];return E.from("movies").update({genres:t}).eq("id",n.id)});await Promise.all(ee)}y("جاري تحديث المسلسلات...","success");const{data:P,error:Q}=await E.from("series").select("id, genres").contains("genres",[v]);if(Q)throw new Error(`Failed to fetch series: ${Q.message}`);if(P&&P.length>0){const ee=P.map(n=>{const t=[...new Set(n.genres.filter(l=>l!==v).concat([L]))];return E.from("series").update({genres:t}).eq("id",n.id)});await Promise.all(ee)}y("جاري حذف الفئة المدمجة...","success");const{error:ne}=await E.from("categories").delete().eq("name",v);if(ne)throw new Error(`Failed to delete category: ${ne.message}`);y("تم دمج الفئات بنجاح!","success")}catch(H){console.error("Error merging categories: ",H),y(`فشل دمج الفئات: ${H.message}`,"error")}finally{Y(null),B(!1)}},Ne=Math.ceil(i.length/ze),ue=i.slice((c-1)*ze,c*ze);return Z?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(Tt,{})]}):e.jsxs("div",{children:[q&&e.jsx(Pt,{...q,onClose:()=>A(null)}),e.jsx(Se,{isOpen:b,onClose:()=>T(!1),onConfirm:h,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',K==null?void 0:K.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:w}),e.jsx(Se,{isOpen:!!$,onClose:()=>Y(null),onConfirm:R,title:"تأكيد عملية الدمج",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد دمج الفئة ",e.jsxs("strong",{className:"text-white",children:['"',$==null?void 0:$.source,'"']})," في الفئة ",e.jsxs("strong",{className:"text-white",children:['"',$==null?void 0:$.dest,'"']}),"؟",e.jsx("br",{}),e.jsxs("span",{className:"text-yellow-400",children:['سيتم حذف الفئة "',$==null?void 0:$.source,'" نهائياً. لا يمكن التراجع عن هذا الإجراء.']})]}),isLoading:w}),e.jsx(Ot,{isOpen:z,onClose:()=>_(!1),onSubmit:se,isLoading:w,categories:i}),e.jsx(Rt,{isOpen:j,title:m?"تعديل الفئة":"إضافة فئة جديدة",onClose:U,children:e.jsx(At,{onSubmit:m?v=>d(m.id,v):D,initialData:m,onCancel:U,isLoading:w})}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsx("button",{onClick:M,className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsx("button",{onClick:()=>_(!0),className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500 transition-colors",children:"توحيد الفئات"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden hidden sm:block",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:i.length>0?ue.map(v=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:v.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>S(v),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>x(v),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},v.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})})}),e.jsx("div",{className:"block sm:hidden space-y-3",children:i.length>0?ue.map(v=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-white",children:v.name}),e.jsxs("div",{className:"flex gap-4 flex-shrink-0",children:[e.jsx("button",{onClick:()=>S(v),className:"text-cyan-400 hover:text-cyan-300 text-sm font-medium",children:"تعديل"}),e.jsx("button",{onClick:()=>x(v),className:"text-red-500 hover:text-red-400 text-sm font-medium",children:"حذف"})]})]},v.id)):e.jsx("div",{className:"text-center py-8 text-gray-400 bg-slate-900/50 rounded-lg",children:"لا توجد فئات حالياً."})})]}),i.length>ze&&e.jsx("div",{className:"mt-4",children:e.jsx(it,{currentPage:c,totalPages:Ne,onPageChange:N})})]})},lt=["movies","series","categories"],Ut=i=>i.replace(/[A-Z]/g,a=>`_${a.toLowerCase()}`),ot=i=>Array.isArray(i)?i.map(a=>ot(a)):i!==null&&typeof i=="object"&&i.constructor===Object?i.hasOwnProperty("seconds")&&i.hasOwnProperty("nanoseconds")&&Object.keys(i).length===2&&typeof i.seconds=="number"&&typeof i.nanoseconds=="number"?new Date(i.seconds*1e3).toISOString():i.hasOwnProperty("_seconds")&&i.hasOwnProperty("_nanoseconds")&&Object.keys(i).length===2&&typeof i._seconds=="number"&&typeof i._nanoseconds=="number"?new Date(i._seconds*1e3).toISOString():Object.keys(i).reduce((a,m)=>{const u=Ut(m);return a[u]=ot(i[m]),a},{}):i,Lt=()=>{const[i,a]=o.useState(!1),[m,u]=o.useState(null),[j,s]=o.useState(!1),[c,N]=o.useState(null),b=(g,w)=>{u({message:g,type:w})},T=async()=>{a(!0),b("بدء عملية النسخ الاحتياطي... قد تستغرق هذه العملية بعض الوقت.","success");try{const g={};for(const _ of lt){const{data:$,error:Y}=await E.from(_).select("*");if(Y)throw Y;g[_]=$||[]}const w=JSON.stringify(g,null,2),B=new Blob([w],{type:"application/json"}),q=URL.createObjectURL(B),A=document.createElement("a");A.href=q;const z=new Date().toISOString().slice(0,10);A.download=`supabase-backup-${z}.json`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(q),b("تم إكمال النسخ الاحتياطي بنجاح!","success")}catch(g){console.error("Backup failed:",g);let w="فشل النسخ الاحتياطي. تحقق من وحدة التحكم لمزيد من التفاصيل.";g.code==="42501"&&(w="فشل النسخ الاحتياطي: أذونات غير كافية. تأكد من أن قواعد RLS تسمح للمشرفين بقراءة المجموعات."),b(w,"error")}finally{a(!1)}},K=g=>{var B;const w=(B=g.target.files)==null?void 0:B[0];if(w){const q=new FileReader;q.onload=A=>{var z;try{const _=(z=A.target)==null?void 0:z.result,$=JSON.parse(_);N($)}catch(_){b("ملف JSON غير صالح.","error"),console.error("JSON parsing error:",_),N(null)}},q.readAsText(w)}},I=()=>{c?s(!0):b("الرجاء تحديد ملف نسخ احتياطي أولاً.","error")},Z=async()=>{if(s(!1),!!c){a(!0),b("بدء عملية الاستعادة... هذه العملية ستستغرق وقتاً.","success");try{let g=0,w=[];for(const q of Object.keys(c)){if(!lt.includes(q)){w.push(q),console.warn(`Skipping restore for unsupported collection: "${q}"`);continue}const A=c[q];if(Array.isArray(A)&&A.length>0){const z=A.map($=>ot($)),{error:_}=await E.from(q).upsert(z);if(_)throw console.error(`Error during upsert to "${q}":`,JSON.stringify(_,null,2)),console.error("First failed object (transformed):",JSON.stringify(z[0],null,2)),_;g++}}let B="تمت استعادة البيانات بنجاح!";w.length>0&&(B+=` تم تخطي المجموعات التالية: ${w.join(", ")}.`),g===0&&w.length>0?b(`لم يتم العثور على مجموعات بيانات صالحة للاستعادة في الملف. تم تخطي: ${w.join(", ")}.`,"error"):g>0?b(B,"success"):b("لم يتم العثور على بيانات صالحة للاستعادة في الملف.","error")}catch(g){console.error("Restore failed:",JSON.stringify(g,null,2));const w=`فشلت عملية الاستعادة: ${g.message||"خطأ غير معروف"}. يرجى مراجعة وحدة التحكم للحصول على التفاصيل الفنية.`;b(w,"error")}finally{a(!1),N(null)}}};return e.jsxs("div",{className:"space-y-12",children:[m&&e.jsx(ct,{...m,onClose:()=>u(null)}),e.jsx(Se,{isOpen:j,onClose:()=>s(!1),onConfirm:Z,title:"تأكيد استعادة البيانات",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد استعادة البيانات من هذا الملف؟",e.jsx("br",{}),e.jsx("strong",{className:"text-yellow-400",children:"تحذير:"})," سيتم الكتابة فوق أي بيانات موجودة في المجموعات التي لها نفس الأسماء. لا يمكن التراجع عن هذا الإجراء."]}),isLoading:i}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"النسخ الاحتياطي للبيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:["انقر على الزر أدناه لتصدير بيانات المحتوى العام (",lt.join(", "),"). لا يتم تضمين بيانات المستخدمين والمشرفين الخاصة في هذا النسخ الاحتياطي من جانب العميل لأسباب تتعلق بالأمان والأذونات."]}),e.jsxs("button",{onClick:T,disabled:i,className:"w-full flex items-center justify-center bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-800 disabled:cursor-wait",children:[i&&e.jsx(Ce,{}),i?"جاري التصدير...":"تصدير بيانات المحتوى الآن"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"استعادة البيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("div",{className:"p-4 border-l-4 border-yellow-500 bg-yellow-500/10 text-yellow-300 rounded-md",children:[e.jsx("strong",{className:"font-bold",children:"تحذير خطير:"})," استعادة البيانات من ملف ستقوم بالكتابة فوق البيانات الحالية في قاعدة البيانات. استخدم هذه الميزة بحذر شديد وتأكد من أنك تستخدم ملف النسخ الاحتياطي الصحيح."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"1. حدد ملف النسخ الاحتياطي (.json)"}),e.jsx("input",{type:"file",accept:".json",onChange:K,className:"w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-500/20 file:text-cyan-300 hover:file:bg-cyan-500/30"})]}),e.jsxs("button",{onClick:I,disabled:i||!c,className:"w-full flex items-center justify-center bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors disabled:bg-red-800 disabled:cursor-not-allowed disabled:cursor-wait",children:[i&&e.jsx(Ce,{}),i?"جاري الاستعادة...":"2. استعادة البيانات"]})]})]})]})},We=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(_t,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx(Mt,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(Bt,{})},{key:"backup",label:"النسخ الاحتياطي والاستعادة",component:e.jsx(Lt,{})}],Gt=({label:i,tabKey:a,activeTab:m,onClick:u})=>e.jsx("button",{onClick:()=>u(a),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex-shrink-0 ${m===a?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":m===a,children:i}),Jt=()=>{var j;const[i,a]=o.useState(We[0].key),[m]=mt();o.useEffect(()=>{const s=m.get("tab");s&&We.some(c=>c.key===s)&&a(s)},[m]);const u=(j=We.find(s=>s.key===i))==null?void 0:j.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6 overflow-x-auto whitespace-nowrap scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",role:"tablist",children:We.map(s=>e.jsx(Gt,{label:s.label,tabKey:s.key,activeTab:i,onClick:a},s.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-3 sm:p-6 rounded-lg border border-slate-700",children:u})]})};export{Jt as default};
