import{r,a as U,j as e,s as C,L as z}from"./index-7uJ0qKqD.js";import{u as D}from"./useWatchLater-B27ka-37.js";import{u as H,a as J,R as Q}from"./ResumeFromModal-XZE8XZ6D.js";import{M as V}from"./MovieGridSkeleton-DW-WaVP_.js";import{M as X}from"./MovieGrid-DoFVm-rM.js";import{S as Y}from"./SeriesGrid-BuAcxdhR.js";import{P as Z}from"./Pagination-BK7uePpH.js";import"./MovieCardSkeleton--xuy0sGE.js";import"./SpinnerIcon-DP9Pwg2V.js";const v=30,le=()=>{const[l,S]=r.useState([]),[j,k]=r.useState(0),[T,h]=r.useState(!0),{favorites:d}=D(),{favoriteSeries:x}=H(),{addWatchLaterSeries:N,removeWatchLaterSeries:E,isWatchLaterSeries:F,getWatchLaterInfo:M,loading:I}=J(),[a,R]=r.useState("movies"),[u,b]=r.useState(null),[f,L]=U(),m=parseInt(f.get("page")||"1",10),P=r.useCallback(s=>{const t=new URLSearchParams(f);s<=1?t.delete("page"):t.set("page",s.toString()),L(t,{replace:!0}),window.scrollTo(0,0)},[f,L]);r.useEffect(()=>{m!==1&&P(1)},[a]),r.useEffect(()=>{(async()=>{h(!0);const t=(m-1)*v,n=t+v-1;let o,i=[],c="";switch(a){case"movies":case"kurdish":c="movies",i=d,o=C.from(c).select("*",{count:"exact"}).in("id",i).eq("is_kurdish",a==="kurdish");break;case"series":c="series",i=x,o=C.from(c).select("*",{count:"exact"}).in("id",i);break}if(!o||i.length===0){S([]),k(0),h(!1);return}const{data:K,error:y,count:O}=await o.order("created_at",{ascending:!1}).range(t,n);y?console.error(`Error fetching favorite ${c}:`,y):(S(K||[]),k(O||0)),h(!1)})()},[d,x,a,m]);const W=s=>{F(s.id)?E(s.id):b(s)},G=(s,t)=>{u&&N(u.id,s,t),b(null)},_=d.length,$=d.length,q=x.length,w=Math.ceil(j/v),A=r.useMemo(()=>new Map(l.map(s=>{const t=M(s.id);return[s.id,t?{season:t.season,episode:t.episode}:null]})),[l,M]),g=({tab:s,label:t,count:n})=>e.jsxs("button",{onClick:()=>R(s),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex items-center gap-2 ${a===s?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":a===s,children:[t,e.jsx("span",{className:`text-xs font-mono px-2 py-0.5 rounded-full ${a===s?"bg-cyan-500/20 text-cyan-300":"bg-slate-700 text-slate-300"}`,children:n})]}),p=({message:s,subMessage:t,buttonText:n,link:o})=>e.jsxs("div",{className:"text-center p-12 bg-slate-800/50 rounded-lg mt-8",children:[e.jsx("p",{className:"text-2xl text-slate-300 mb-4",children:s}),e.jsx("p",{className:"text-slate-400 mb-6",children:t}),e.jsx(z,{to:o,className:"inline-block bg-cyan-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-cyan-600 transition-colors",children:n})]}),B=()=>{if(j>0)return e.jsxs(e.Fragment,{children:[a==="series"?e.jsx(Y,{series:l,onToggleWatchLater:W,watchLaterInfoMap:A}):e.jsx(X,{movies:l}),w>1&&e.jsx(Z,{currentPage:m,totalPages:w,onPageChange:P})]});switch(a){case"movies":return e.jsx(p,{message:"قائمة أفلامك المفضلة فارغة.",subMessage:"أضف أفلامًا إلى قائمتك بالنقر على أيقونة القلب.",buttonText:"تصفح الأفلام",link:"/"});case"kurdish":return e.jsx(p,{message:"قائمة الأفلام الكردية المفضلة فارغة.",subMessage:"أضف أفلامًا كردية إلى مفضلتك.",buttonText:"تصفح الأفلام الكردية",link:"/kurdish"});case"series":return e.jsx(p,{message:"قائمة مسلسلاتك المفضلة فارغة.",subMessage:"أضف مسلسلات إلى قائمتك بالنقر على أيقونة القلب.",buttonText:"تصفح المسلسلات",link:"/series"});default:return null}};return e.jsxs("div",{className:"animate-fade-in",children:[e.jsx(Q,{isOpen:!!u,onClose:()=>b(null),series:u,onSave:G,isSaving:I}),e.jsx("h1",{className:"text-4xl font-black text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"قائمتي المفضلة"}),e.jsxs("div",{className:"flex border-b border-slate-700 mb-8",role:"tablist",children:[e.jsx(g,{tab:"movies",label:"أفلام",count:_}),e.jsx(g,{tab:"kurdish",label:"كردي",count:$}),e.jsx(g,{tab:"series",label:"مسلسلات",count:q})]}),T?e.jsx(V,{count:12}):e.jsx("div",{role:"tabpanel",className:"animate-fade-in",children:B()})]})};export{le as default};
