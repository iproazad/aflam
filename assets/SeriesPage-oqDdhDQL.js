import{r,d as T,j as s}from"./index-Cqcvdv2m.js";import{S as U,G as V,T as X,Y as Z}from"./TagFilter-CpcOk6iy.js";import{M as ee}from"./MovieGridSkeleton-Drligw3L.js";import{P as te}from"./Pagination-CrNHQOBN.js";import{S as se}from"./SeriesGrid-B9eQkN2x.js";import{a as ae,R as re}from"./ResumeFromModal-CYfiu0Ei.js";import"./MovieCardSkeleton-BN57qR6e.js";import"./SpinnerIcon-Bws6oY6u.js";const y=28,xe=()=>{const[c,G]=r.useState([]),[E,F]=r.useState([]),[L,k]=r.useState(!0),[l,g]=r.useState("all"),[n,x]=r.useState([]),[i,h]=r.useState([]),[d,P]=r.useState("createdAt_desc"),[u,v]=r.useState(1),{addWatchLaterSeries:_,removeWatchLaterSeries:W,isWatchLaterSeries:Y,getWatchLaterInfo:N,loading:B}=ae(),[m,f]=r.useState(null);r.useEffect(()=>{(async()=>{try{const a=(await T.collection("series").orderBy("createdAt","desc").get()).docs.map(o=>({id:o.id,...o.data()}));G(a)}catch(t){console.error("Error fetching series: ",t)}finally{k(!1)}})()},[]),r.useEffect(()=>{const e=T.collection("categories").orderBy("name").onSnapshot(t=>{const a=t.docs.map(o=>o.data().name);F(a)},t=>{console.error("Error fetching categories: ",t)});return()=>e()},[]);const w=e=>x(t=>t.includes(e)?t.filter(a=>a!==e):[...t,e]),I=()=>x([]),A=e=>h(t=>t.includes(e)?t.filter(a=>a!==e):[...t,e]),O=()=>h([]),$=()=>{g("all"),x([]),h([])},z=e=>{Y(e.id)?W(e.id):f(e)},D=(e,t)=>{m&&_(m.id,e,t),f(null)},q=[...new Set(c.map(e=>e.year))].sort((e,t)=>t-e),H=E,J=[...new Set(c.flatMap(e=>e.tags||[]))].sort(),p=r.useMemo(()=>c.filter(e=>l==="all"||e.year.toString()===l).filter(e=>n.length===0||n.some(t=>{var a;return(a=e.genres)==null?void 0:a.includes(t)})).filter(e=>i.length===0||i.some(t=>{var a;return(a=e.tags)==null?void 0:a.includes(t)})).sort((e,t)=>{var a,o,M,R;switch(d){case"rating_desc":return(t.imdbRating||0)-(e.imdbRating||0);case"rating_asc":return(e.imdbRating||0)-(t.imdbRating||0);case"year_desc":return t.year-e.year;case"year_asc":return e.year-t.year;case"createdAt_asc":{const b=(a=e.createdAt)!=null&&a.toMillis?e.createdAt.toMillis():0,j=(o=t.createdAt)!=null&&o.toMillis?t.createdAt.toMillis():0;return b-j}case"createdAt_desc":default:{const b=(M=t.createdAt)!=null&&M.toMillis?t.createdAt.toMillis():0,j=(R=e.createdAt)!=null&&R.toMillis?e.createdAt.toMillis():0;return b-j}}}),[c,l,n,i,d]);r.useEffect(()=>{v(1)},[l,n,i,d]);const C=Math.ceil(p.length/y),S=p.slice((u-1)*y,u*y),K=l!=="all"||n.length>0||i.length>0,Q=r.useMemo(()=>new Map(S.map(e=>{const t=N(e.id);return[e.id,t?{season:t.season,episode:t.episode}:null]})),[S,N]);return L?s.jsxs("div",{className:"animate-fade-in",children:[s.jsx("h1",{className:"text-4xl font-black text-white mb-8 border-r-4 border-cyan-400 pr-4",children:"تصفح المسلسلات"}),s.jsx("div",{className:"my-8 h-20 bg-slate-800/50 rounded-lg animate-pulse"}),s.jsx(ee,{count:18})]}):s.jsxs("div",{className:"animate-fade-in",children:[s.jsx(re,{isOpen:!!m,onClose:()=>f(null),series:m,onSave:D,isSaving:B}),s.jsx("h1",{className:"text-4xl font-black text-white mb-8 border-r-4 border-cyan-400 pr-4",children:"تصفح المسلسلات"}),s.jsx("div",{className:"relative z-30 my-8 flex justify-center items-center p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl",children:s.jsxs("div",{className:"w-full grid grid-cols-1 sm:grid-cols-2 md:flex md:flex-row md:flex-wrap justify-center items-center gap-4",children:[s.jsx(U,{sortOrder:d,onSortChange:P}),s.jsx(V,{genres:H,selectedGenres:n,onToggleGenre:w,onClearGenres:I}),s.jsx(X,{tags:J,selectedTags:i,onToggleTag:A,onClearTags:O}),s.jsx(Z,{years:q,selectedYear:l,onYearChange:g})]})}),K&&s.jsxs("div",{className:"mb-8 flex flex-wrap items-center gap-3 rounded-lg bg-slate-800/50 p-3 animate-fade-in-down",children:[s.jsx("span",{className:"font-bold text-slate-300 mr-2 flex-shrink-0",children:"الفلاتر النشطة:"}),s.jsxs("div",{className:"flex flex-wrap items-center gap-2 flex-grow",children:[l!=="all"&&s.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["سنة: ",l,s.jsx("button",{onClick:()=>g("all"),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove year filter ${l}`,children:"×"})]}),n.map(e=>s.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:[e,s.jsx("button",{onClick:()=>w(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove genre filter ${e}`,children:"×"})]},e)),i.map(e=>s.jsxs("span",{className:"flex items-center gap-2 rounded-full bg-cyan-900/50 px-3 py-1 text-sm text-cyan-300",children:["#",e,s.jsx("button",{onClick:()=>A(e),className:"text-cyan-400 hover:text-white text-lg leading-none font-bold","aria-label":`Remove tag filter ${e}`,children:"×"})]},e))]}),s.jsx("button",{onClick:$,className:"ml-auto text-sm font-bold text-red-500 hover:text-red-400 hover:underline flex-shrink-0 px-2",children:"مسح الكل"})]}),s.jsx("section",{className:"mb-12",children:p.length>0?s.jsxs(s.Fragment,{children:[s.jsx(se,{series:S,onToggleWatchLater:z,watchLaterInfoMap:Q}),C>1&&s.jsx(te,{currentPage:u,totalPages:C,onPageChange:v})]}):s.jsx("div",{className:"text-center p-8 bg-slate-800 rounded-lg mt-8",children:s.jsx("p",{className:"text-xl text-slate-400",children:"لا توجد مسلسلات تطابق معايير البحث."})})})]})};export{xe as default};
