import{r as o,j as e,p as Ue,s as E,a as mt,f as ht,R as yt}from"./index-cSJbAW7c.js";import{P as it}from"./Pagination-C9g_vTGO.js";import{F as _e,S as Ce}from"./SpinnerIcon-aMsK_7Jl.js";const wt=[{key:"foreign",label:"افلام اجنبي"},{key:"kurdish",label:"افلام كردي"},{key:"asian",label:"افلام اسيوية"},{key:"turkish",label:"افلام تركية"},{key:"arabic",label:"افلام عربي"},{key:"classic",label:"افلام كلاسيكيه"},{key:"dubbed",label:"افلام مدبلجة"},{key:"indian",label:"افلام هندية"},{key:"anime",label:"افلام انمي"}],ut=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),jt=({onSubmit:i,initialData:a,onCancel:h,isLoading:d=!1,allGenres:w=[]})=>{var Q,ne,ee;const[s,c]=o.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"FullHD"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:!1,movie_type:"foreign",imdb_rating:void 0,quality:"",duration:"",language:"",country:"",directors:[],writers:[],cast:[]}),[k,b]=o.useState(""),[O,K]=o.useState(""),[z,Z]=o.useState(!1),[p,v]=o.useState(""),[B,q]=o.useState(!1),[A,H]=o.useState(""),[_,$]=o.useState(""),[J,U]=o.useState(!1),y=o.useRef(null);o.useEffect(()=>{if(a){let n=a.movie_type;!n&&a.is_kurdish&&(n="kurdish"),c({title:a.title||"",description:a.description||"",poster_url:a.poster_url||"",backdrop_url:a.backdrop_url||"",year:a.year||new Date().getFullYear(),genres:a.genres||[],tags:a.tags||[],servers:a.servers&&a.servers.length>0?a.servers:[{name:"Server 1",url:"",quality:"FullHD"}],backup_servers:a.backup_servers||[],download_url:a.download_url||"",trailer_url:a.trailer_url||"",is_kurdish:n==="kurdish",movie_type:n||"foreign",imdb_rating:a.imdb_rating,quality:a.quality||"",duration:a.duration||"",language:a.language||"",country:a.country||"",directors:a.directors||[],writers:a.writers||[],cast:a.cast||[]}),b((a.tags||[]).join(", "))}else c({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"FullHD"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:!1,movie_type:"foreign",imdb_rating:void 0,quality:"",duration:"",language:"",country:"",directors:[],writers:[],cast:[]}),b("")},[a]),o.useEffect(()=>{const n=t=>{y.current&&!y.current.contains(t.target)&&q(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[]),o.useEffect(()=>{if(!a){const n=s.title.match(/\b(19[89]\d|20\d{2})\b/);if(n&&n[0]){const t=parseInt(n[0],10),l=s.title.replace(n[0],"").replace(/\s\s+/g," ").trim();c(g=>g.year!==t||g.title!==l?{...g,year:t,title:l}:g)}}},[s.title,a]),o.useEffect(()=>{!a&&!s.backdrop_url.trim()&&c(n=>({...n,backdrop_url:n.poster_url}))},[s.poster_url,a,s.backdrop_url]),o.useEffect(()=>{const n=s.download_url;if(n&&n.includes("vidtube.pro/d/")){const t=n.match(/vidtube\.pro\/d\/([a-zA-Z0-9]+)\.html/);if(t&&t[1]){const g=`https://vidtube.pro/embed-${t[1]}.html`;if(s.servers.length>0&&s.servers[0].url!==g){const j=[...s.servers];j[0]={...j[0],url:g},c(F=>({...F,servers:j}))}else if(s.servers.length===0){const j={name:"Server 1",url:g,quality:"FullHD"};c(F=>({...F,servers:[j]}))}}}},[s.download_url]);const L=async n=>{var t;try{if(!((t=navigator.clipboard)!=null&&t.readText))throw new Error("Clipboard API not available.");const l=await navigator.clipboard.readText();l&&n(l)}catch(l){console.error("Failed to read clipboard contents: ",l),alert("فشل لصق النص. يرجى التأكد من منح الإذن لاستخدام الحافظة.")}},u=n=>{const{name:t,value:l,type:g}=n.target;if(g==="checkbox"){const{checked:j}=n.target;c(F=>({...F,[t]:j}))}else if(t==="year"){const j=parseInt(l,10);c(F=>({...F,[t]:isNaN(j)?0:j}))}else if(t==="imdb_rating"){const j=parseFloat(l);c(F=>({...F,imdb_rating:isNaN(j)?void 0:j}))}else c(j=>({...j,[t]:l}))},x=n=>{b(n.target.value)},m=n=>{c(t=>{const l=t.genres||[],g=l.includes(n)?l.filter(j=>j!==n):[...l,n];return{...t,genres:g}})},C=async()=>{const n=_.trim();if(n){if(w.some(t=>t.toLowerCase()===n.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}U(!0);try{const{error:t}=await E.from("categories").insert({name:n});if(t)throw t;c(l=>({...l,genres:[...l.genres||[],n]})),$("")}catch(t){console.error("Error adding new genre:",t),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{U(!1)}}},M=(n,t,l)=>{const g=[...s.servers];g[n]={...g[n],[t]:l},c(j=>({...j,servers:g}))},R=()=>{c(n=>{const t={name:`Server ${n.servers.length+1}`,url:"",quality:"FullHD"};return{...n,servers:[...n.servers,t]}})},se=n=>{c(t=>({...t,servers:t.servers.filter((l,g)=>g!==n)}))},P=(n,t,l)=>{const g=[...s.backup_servers||[]];g[n]={...g[n],[t]:l},c(j=>({...j,backup_servers:g}))},ve=()=>{c(n=>{var t;return{...n,backup_servers:[...n.backup_servers||[],{name:`Server ${(((t=n.backup_servers)==null?void 0:t.length)||0)+1}`,url:"",quality:"FullHD",no_sub_url:""}]}})},ue=n=>{c(t=>({...t,backup_servers:(t.backup_servers||[]).filter((l,g)=>g!==n)}))},N=async()=>{var n,t,l,g,j,F,te,ae,me,r,f,S,re,Ee,ye,we,je,ge,Me;if(!O){v("Please enter a URL.");return}Z(!0),v("");try{v("Fetching movie page...");const $e=await Ue(O);if(!$e.ok)throw new Error(`Failed to fetch URL: ${$e.statusText}`);const ft=await $e.text(),dt=new DOMParser,le=dt.parseFromString(ft,"text/html");if(O.includes("a.asd.homes")){v("جلب البيانات من عرب سيد...");const oe=W=>{var X,qe;const V=Array.from(le.querySelectorAll(".info__area__ul > li")).find(he=>{var xe,st;return(st=(xe=he.querySelector(".title__kit span"))==null?void 0:xe.textContent)==null?void 0:st.trim().startsWith(W)});if(!V)return[];const ce=Array.from(V.querySelectorAll("ul.tags__list a"));if(ce.length>0)return ce.map(he=>{var xe;return((xe=he.textContent)==null?void 0:xe.trim())||""}).filter(Boolean);const de=Array.from(V.childNodes).find(he=>{var xe;return he.nodeType===Node.TEXT_NODE&&((xe=he.textContent)==null?void 0:xe.trim())});if(de)return[((X=de.textContent)==null?void 0:X.trim())||""];const T=V.querySelector("a");return T?[((qe=T.textContent)==null?void 0:qe.trim())||""]:[]},Fe=((t=(n=le.querySelector("h1.post__name"))==null?void 0:n.textContent)==null?void 0:t.trim())||"",fe=Fe.match(/\(\s*(\d{4})\s*\)/),Je=fe?parseInt(fe[1],10):new Date().getFullYear(),be=fe?Fe.replace(fe[0],"").trim():Fe,Ye=((g=(l=le.querySelector(".post__story p"))==null?void 0:l.textContent)==null?void 0:g.trim())||"",Ae=((j=le.querySelector(".poster__single img"))==null?void 0:j.getAttribute("data-src"))||((F=le.querySelector(".poster__single img"))==null?void 0:F.getAttribute("src"))||"",Ve=((ae=(te=le.querySelector(".rating__box .rate__txt"))==null?void 0:te.textContent)==null?void 0:ae.trim().split("/")[0].trim())||"0",Ke=parseFloat(Ve)||void 0,Ze=oe("نوع العرض"),Qe=oe("جودة العرض").join(", "),Xe=oe("مدة العرض").join(", "),et=oe("لغة العرض").join(", "),tt=oe("بلد العرض").join(", "),Oe=[],Pe=[],De=[];le.querySelectorAll(".persons__list li a").forEach(W=>{var ce,de,T,X;const ie=(de=(ce=W.querySelector(".name"))==null?void 0:ce.textContent)==null?void 0:de.trim(),V=(X=(T=W.querySelector(".role"))==null?void 0:T.textContent)==null?void 0:X.trim();ie&&V&&(V.includes("مخرج")?Oe.push(ie):V.includes("كاتب")?Pe.push(ie):De.push(ie))});const Be=((me=le.querySelector(".show__trailer"))==null?void 0:me.getAttribute("data-iframe"))||"",Te=async W=>{var ie;if(!W)return"";try{v("Fetching watch page...");const V=await Ue(W);if(!V.ok)throw new Error(`Failed to fetch watch page: ${V.statusText}`);const ce=await V.text(),T=(ie=new DOMParser().parseFromString(ce,"text/html").querySelector(".player__iframe iframe"))==null?void 0:ie.getAttribute("src");return T?T.startsWith("/")?`https://a.asd.homes${T}`:new URL(T,W).href:""}catch(V){return console.error("Error scraping watch page:",V),v("Warning: Could not automatically find watch server."),""}},Le=(W,ie,V)=>new Promise(async(ce,de)=>{if(!W)return ce("");let T=null,X=null;const qe=setTimeout(()=>{X==null||X.disconnect(),T==null||T.remove(),de(new Error(`Scraping timed out for ${W}`))},15e3);try{const he=await Ue(W);if(!he.ok)return de(new Error(`Failed to fetch intermediate page: ${W}`));const xe=await he.text(),rt=new DOMParser().parseFromString(xe,"text/html").querySelector(ie);if(rt&&rt.getAttribute(V))return clearTimeout(qe),ce(rt.getAttribute(V)||"");T=document.createElement("div"),T.style.display="none",document.body.appendChild(T),X=new MutationObserver(()=>{const at=T==null?void 0:T.querySelector(ie);if(at&&at.getAttribute(V)){const bt=at.getAttribute(V)||"";X==null||X.disconnect(),clearTimeout(qe),T==null||T.remove(),ce(bt)}}),X.observe(T,{childList:!0,subtree:!0}),T.innerHTML=xe}catch(he){clearTimeout(qe),X==null||X.disconnect(),T==null||T.remove(),de(he)}});v("Fetching watch & download pages (this may take a moment)...");const pe=(r=le.querySelector("a.watch__btn"))==null?void 0:r.getAttribute("href"),Re=(f=le.querySelector("a.download__btn"))==null?void 0:f.getAttribute("href"),[Ne,Ge]=await Promise.all([Te(pe),Le(Re,'a.downloadsLink, a[href*="vidtube.pro/d/"], .downloads__links__list a',"href").catch(W=>(console.warn("Could not scrape download URL:",W),v("Warning: Could not automatically find download link."),""))]);let ke=[];Ne&&(v("Parsing watch servers..."),ke.push({name:"Server 1",url:Ne,quality:"HD"})),c(W=>({...W,title:be,year:Je||W.year,description:Ye,poster_url:Ae,backdrop_url:Ae,imdb_rating:Ke,genres:[...new Set([...W.genres,...Ze])],quality:Qe,duration:Xe,language:et,country:tt,directors:Oe,writers:Pe,cast:De,trailer_url:Be,servers:ke.length>0?ke:W.servers,download_url:Ge||W.download_url})),v("تم جلب البيانات بنجاح!")}else if(O.includes("topcinema.cam")){const oe=pe=>{var ie,V,ce;const Ne=Array.from(le.querySelectorAll(".RightTaxContent > li")).find(de=>{var T,X;return(X=(T=de.querySelector("span"))==null?void 0:T.textContent)==null?void 0:X.trim().startsWith(pe)});if(!Ne)return[];const Ge=Array.from(Ne.querySelectorAll("a, strong"));if(Ge.length>0)return Ge.map(de=>{var T;return((T=de.textContent)==null?void 0:T.trim())||""}).filter(Boolean);const ke=Ne.cloneNode(!0);(ie=ke.querySelector("i"))==null||ie.remove(),(V=ke.querySelector("span"))==null||V.remove();const W=(ce=ke.textContent)==null?void 0:ce.trim().replace(/^:/,"").trim();return W?W.split(/\s*,\s*/):[]},Fe=((re=(S=le.querySelector("h1.post-title"))==null?void 0:S.textContent)==null?void 0:re.trim())||"",fe=Fe.match(/\b(19\d{2}|20\d{2})\b/),Je=fe?parseInt(fe[0],10):new Date().getFullYear();let be=Fe;be=be.replace(/فيلم|مترجم|اون لاين|اونلاين|WEB-DL|BluRay|HD/gi,"").replace(/[\u0600-\u06FF]+/g,""),fe&&(be=be.replace(fe[0],"")),be=be.trim().replace(/^[^a-zA-Z0-9\s]+|[^a-zA-Z0-9\s]+$/g,"").trim();const Ye=((ye=(Ee=le.querySelector(".story p"))==null?void 0:Ee.textContent)==null?void 0:ye.trim())||"",Ae=((we=le.querySelector(".MainSingle .left .image img"))==null?void 0:we.getAttribute("src"))||"",Ve=((ge=(je=le.querySelector(".imdbR span"))==null?void 0:je.textContent)==null?void 0:ge.trim())||"0",Ke=parseFloat(Ve)||void 0,Ze=oe("نوع الفيلم"),Qe=oe("جودة الفيلم").join(", "),Xe=oe("توقيت الفيلم").join(", "),et=oe("لغة الفيلم").join(", "),tt=oe("دولة الفيلم").join(", "),Oe=oe("المخرجين"),Pe=oe("المؤلفين"),De=oe("بطولة");let Be="";const Te=le.querySelector("a.download"),Le=Te==null?void 0:Te.getAttribute("href");if(Le){v("Fetching download link...");const pe=await Ue(Le);if(pe.ok){const Re=await pe.text();Be=((Me=dt.parseFromString(Re,"text/html").querySelector('a.downloadsLink, a[href*="vidtube.pro/d/"]'))==null?void 0:Me.getAttribute("href"))||""}}c(pe=>({...pe,title:be,year:Je||pe.year,description:Ye,poster_url:Ae,backdrop_url:Ae,imdb_rating:Ke,genres:[...new Set([...pe.genres,...Ze])],quality:Qe,duration:Xe,language:et,country:tt,directors:Oe,writers:Pe,cast:De,download_url:Be})),v("تم جلب البيانات بنجاح!")}else{v("هذا الموقع غير مدعوم حاليًا للجلب."),Z(!1);return}}catch($e){console.error("Scraping failed:",$e),v(`فشل جلب البيانات: ${$e.message}.`)}finally{Z(!1)}},G=n=>{if(n.preventDefault(),s.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const t=k.split(",").map(g=>g.trim()).filter(Boolean),l={...s,tags:t,is_kurdish:s.movie_type==="kurdish"};i(l)},Y=w.filter(n=>n.toLowerCase().includes(A.toLowerCase())),I="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",D="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:G,children:[e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsxs("div",{className:"space-y-3 p-4 bg-slate-900/50 rounded-lg border border-slate-700",children:[e.jsx("label",{htmlFor:"scrape_url",className:"block text-lg font-semibold text-white",children:"جلب البيانات من رابط"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{id:"scrape_url",type:"url",value:O,onChange:n=>K(n.target.value),placeholder:"https://web6.topcinema.cam/... or https://a.asd.homes/...",className:`${I} flex-grow`}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx("button",{type:"button",onClick:()=>c(n=>({...n,download_url:O})),title:"لصق رابط الجلب في حقل رابط التحميل",className:"bg-slate-600 text-white font-bold py-2 px-3 rounded-lg hover:bg-slate-500 transition-colors flex-grow sm:flex-grow-0 flex items-center justify-center text-sm",children:"تحميل"}),e.jsxs("button",{type:"button",onClick:N,disabled:z,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700 flex-shrink-0 flex-grow sm:flex-grow-0 flex items-center justify-center disabled:bg-slate-500",children:[z&&e.jsx(ut,{}),z?"جاري الجلب...":"جلب البيانات"]})]})]}),p&&e.jsx("p",{className:`text-sm mt-1 ${p.startsWith("فشل")||p.startsWith("هذا")?"text-red-400":"text-green-400"}`,children:p})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx("input",{type:"text",name:"title",value:s.title,onChange:u,placeholder:"عنوان الفيلم (بالانجليزية)",required:!0,className:I})}),e.jsx("input",{type:"number",name:"year",value:s.year||"",onChange:u,placeholder:"سنة الإنتاج",required:!0,className:I})]}),e.jsx("textarea",{name:"description",value:s.description,onChange:u,placeholder:"وصف الفيلم",required:!0,className:`${I} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",name:"poster_url",value:s.poster_url,onChange:u,placeholder:"رابط صورة البوستر",required:!0,className:`${I} flex-grow`}),e.jsx("button",{type:"button",onClick:()=>L(n=>c(t=>({...t,poster_url:n,backdrop_url:n}))),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-2 px-4 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsx("input",{type:"url",name:"backdrop_url",value:s.backdrop_url,onChange:u,placeholder:"رابط صورة الخلفية",required:!0,className:I})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:s.imdb_rating??"",onChange:u,placeholder:"تقيم الفيلم",step:"0.1",min:"0",max:"10",className:I}),e.jsx("input",{type:"url",name:"trailer_url",value:s.trailer_url??"",onChange:u,placeholder:"رابط المقطع الدعائي (اختياري)",className:I})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"movie_type",className:"block text-sm font-medium text-slate-300 mb-2",children:"نوع الفيلم"}),e.jsx("select",{id:"movie_type",name:"movie_type",value:s.movie_type||"foreign",onChange:u,className:I,children:wt.map(n=>e.jsx("option",{value:n.key,children:n.label},n.key))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-sm font-medium text-slate-300 mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:k,onChange:x,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:I})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:y,children:[e.jsxs("button",{type:"button",onClick:()=>q(n=>!n),className:`${I} text-right flex justify-between items-center`,children:[e.jsx("span",{children:s.genres.length>0?s.genres.join(", "):"اختر الفئات..."}),e.jsx("svg",{className:`h-5 w-5 transition-transform duration-200 ${B?"rotate-180":""}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),B&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[e.jsx("div",{className:"p-2 border-b border-slate-700",children:e.jsx("input",{type:"text",placeholder:"ابحث أو أضف فئة...",value:A,onChange:n=>H(n.target.value),className:"w-full bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"})}),e.jsx("ul",{className:"p-1",children:Y.map(n=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.genres.includes(n),onChange:()=>m(n),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:n})]},n))}),e.jsx("div",{className:"p-2 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"إضافة فئة جديدة...",value:_,onChange:n=>$(n.target.value),className:"flex-grow bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:C,disabled:J||!_.trim(),className:"bg-cyan-600 text-white px-3 py-1 rounded-md text-sm hover:bg-cyan-700 disabled:bg-slate-500",children:J?"...":"إضافة"})]})})]})]})]}),e.jsxs("details",{className:"bg-slate-900/30 p-4 rounded-lg border border-slate-700",open:!0,children:[e.jsx("summary",{className:"text-lg font-semibold text-white cursor-pointer",children:"تفاصيل إضافية للفيلم"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 gap-4",children:[e.jsx("input",{type:"text",name:"quality",value:s.quality,onChange:u,placeholder:"الجودة (e.g. 1080p WEB-DL)",className:D}),e.jsx("input",{type:"text",name:"duration",value:s.duration,onChange:u,placeholder:"مدة العرض",className:D}),e.jsx("input",{type:"text",name:"language",value:s.language,onChange:u,placeholder:"اللغة",className:D}),e.jsx("input",{type:"text",name:"country",value:s.country,onChange:u,placeholder:"الدولة",className:D})]}),e.jsx("textarea",{value:(Q=s.directors)==null?void 0:Q.join(", "),onChange:n=>c(t=>({...t,directors:n.target.value.split(",").map(l=>l.trim())})),placeholder:"المخرجين (مفصولة بفاصلة)",className:`${D} w-full`,rows:2}),e.jsx("textarea",{value:(ne=s.writers)==null?void 0:ne.join(", "),onChange:n=>c(t=>({...t,writers:n.target.value.split(",").map(l=>l.trim())})),placeholder:"المؤلفين (مفصولة بفاصلة)",className:`${D} w-full`,rows:2}),e.jsx("textarea",{value:(ee=s.cast)==null?void 0:ee.join(", "),onChange:n=>c(t=>({...t,cast:n.target.value.split(",").map(l=>l.trim())})),placeholder:"البطولة (مفصولة بفاصلة)",className:`${D} w-full`,rows:3})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات المشاهدة"}),s.servers.map((n,t)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:n.name,onChange:l=>M(t,"name",l.target.value),placeholder:"اسم السيرفر",className:`${D} flex-1`}),e.jsxs("select",{value:n.quality,onChange:l=>M(t,"quality",l.target.value),className:`${D} w-28`,children:[e.jsx("option",{value:"FullHD",children:"FullHD"}),e.jsx("option",{value:"HD",children:"HD"}),e.jsx("option",{value:"SD",children:"SD"})]}),s.servers.length>1&&e.jsx("button",{type:"button",onClick:()=>se(t),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),t===0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:n.url,onChange:l=>M(t,"url",l.target.value),placeholder:"رابط السيرفر 1",required:!0,className:`${D} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>L(l=>M(t,"url",l)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",name:"download_url",value:s.download_url||"",onChange:u,placeholder:"رابط صفحة الفيلم (لجلب التحميلات)",className:`${D} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>L(l=>c(g=>({...g,download_url:l}))),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:n.url,onChange:l=>M(t,"url",l.target.value),placeholder:`رابط السيرفر ${t+1}`,required:!0,className:`${D} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>L(l=>M(t,"url",l)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]})]},t)),e.jsx("button",{type:"button",onClick:R,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات احتياطية (مشغل خارجي)"}),(s.backup_servers||[]).map((n,t)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:n.name,onChange:l=>P(t,"name",l.target.value),placeholder:"اسم السيرفر",className:`${D} flex-1`}),e.jsxs("select",{value:n.quality,onChange:l=>P(t,"quality",l.target.value),className:`${D} w-28`,children:[e.jsx("option",{value:"FullHD",children:"FullHD"}),e.jsx("option",{value:"HD",children:"HD"}),e.jsx("option",{value:"SD",children:"SD"})]}),e.jsx("button",{type:"button",onClick:()=>ue(t),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:n.url,onChange:l=>P(t,"url",l.target.value),placeholder:"رابط السيرفر (مع ترجمة)",className:`${D} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>L(l=>P(t,"url",l)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:n.no_sub_url||"",onChange:l=>P(t,"no_sub_url",l.target.value),placeholder:"رابط السيرفر (بدون ترجمة)",className:`${D} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>L(l=>P(t,"no_sub_url",l)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]})]})]},t)),e.jsx("button",{type:"button",onClick:ve,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]})]}),e.jsxs("div",{className:"sticky bottom-0 z-10 bg-slate-800/95 backdrop-blur-sm p-4 border-t border-slate-700 flex justify-end gap-4 -mx-6 -mb-6 md:-mx-8 md:-mb-8 rounded-b-lg",children:[e.jsx("button",{type:"button",onClick:h,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",disabled:d,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:d,children:[d&&e.jsx(ut,{}),d?a?"جاري التحديث...":"جاري الإضافة...":a?"تحديث الفيلم":"إضافة الفيلم"]})]})]})},vt=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Se=({isOpen:i,onClose:a,onConfirm:h,title:d,message:w,isLoading:s=!1})=>{const[c,k]=o.useState(i);return o.useEffect(()=>{if(i)k(!0);else{const b=setTimeout(()=>k(!1),300);return()=>clearTimeout(b)}},[i]),c?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${i?"animate-fade-in":"animate-fade-out"}`,onClick:a,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:`relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md border border-slate-700 ${i?"animate-zoom-in":"animate-zoom-out"}`,onClick:b=>b.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:d}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:w})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:h,disabled:s,children:[s&&e.jsx(vt,{}),s?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:a,disabled:s,children:"إلغاء"})]})]})}):null},Nt=10,xt=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((i,a)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},a))})}),e.jsx("tbody",{children:[...Array(Nt)].map((i,a)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((h,d)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},d))]},a))})]})})]}),ct=({message:i,type:a,onClose:h})=>(o.useEffect(()=>{const s=setTimeout(h,5e3);return()=>clearTimeout(s)},[h]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${a==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:i}),e.jsx("button",{onClick:h,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),gt=({genres:i,onSubmit:a,onClose:h,isLoading:d})=>{const[w,s]=o.useState(i[0]||""),[c,k]=o.useState("add"),b=O=>{O.preventDefault(),w&&a(w,c)};return e.jsx(_e,{title:"تغيير الفئة بشكل جماعي",onClose:h,isOpen:!0,children:e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:w,onChange:O=>s(O.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:i.map(O=>e.jsx("option",{value:O,children:O},O))}),e.jsxs("select",{value:c,onChange:O=>k(O.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:h,disabled:d,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:d||!w,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[d&&e.jsx(Ce,{}),d?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},kt=({onSubmit:i,onClose:a,isLoading:h})=>{const[d,w]=o.useState(new Date().getFullYear()),s=c=>{c.preventDefault(),i(d)};return e.jsx(_e,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:a,isOpen:!0,children:e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:d,onChange:c=>w(parseInt(c.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:a,disabled:h,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:h,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[h&&e.jsx(Ce,{}),h?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},pt=({onSubmit:i,onClose:a,isLoading:h})=>{const[d,w]=o.useState(""),[s,c]=o.useState("add"),k=b=>{b.preventDefault(),d.trim()&&i(d.trim(),s)};return e.jsx(_e,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:a,isOpen:!0,children:e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:d,onChange:b=>w(b.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:s,onChange:b=>c(b.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:a,disabled:h,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:h||!d.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[h&&e.jsx(Ce,{}),h?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Ct=({movieTypes:i,onSubmit:a,onClose:h,isLoading:d})=>{var k;const[w,s]=o.useState(((k=i[0])==null?void 0:k.key)||"foreign"),c=b=>{b.preventDefault(),a(w)};return e.jsx(_e,{title:"تغيير نوع الفيلم بشكل جماعي",onClose:h,isOpen:!0,children:e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر النوع الجديد ليتم تطبيقه على جميع الأفلام المحددة."}),e.jsx("select",{value:w,onChange:b=>s(b.target.value),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:i.map(b=>e.jsx("option",{value:b.key,children:b.label},b.key))}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:h,disabled:d,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:d,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[d&&e.jsx(Ce,{}),d?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},ze=10,nt=[{key:"foreign",label:"افلام اجنبي"},{key:"kurdish",label:"افلام كردي"},{key:"asian",label:"افلام اسيوية"},{key:"turkish",label:"افلام تركية"},{key:"arabic",label:"افلام عربي"},{key:"classic",label:"افلام كلاسيكيه"},{key:"dubbed",label:"افلام مدبلجة"},{key:"indian",label:"افلام هندية"},{key:"anime",label:"افلام انمي"}],St=async()=>{let i=[],a=0;const h=1e3;for(;;){const{data:d,error:w}=await E.from("movies").select("*").order("created_at",{ascending:!1}).range(a,a+h-1);if(w)throw console.error("Error fetching a batch of movies for admin: ",w.message),w;if(d&&d.length>0){if(i=i.concat(d),d.length<h)break;a+=d.length}else break}return i},_t=()=>{const[i,a]=o.useState([]),[h,d]=o.useState(null),[w,s]=o.useState(!1),[c,k]=o.useState(1),[b,O]=o.useState("all"),[K,z]=o.useState(""),[Z,p]=o.useState(!1),[v,B]=o.useState(null),[q,A]=o.useState(!0),[H,_]=o.useState(!1),[$,J]=o.useState(null),[U,y]=o.useState([]),[L,u]=o.useState(null),[x,m]=o.useState([]),[C,M]=mt(),R=o.useRef(!1),se=async()=>{try{const S=await St();a(S)}catch(S){console.error("Error fetching movies: ",S),P("فشل في تحميل الأفلام.","error")}const{data:r,error:f}=await E.from("categories").select("name").order("name");f?console.error("Error fetching categories from ManageMovies: ",f):m(r.map(S=>S.name)),A(!1)};o.useEffect(()=>{A(!0),se();const r=E.channel("public:movies").on("postgres_changes",{event:"*",schema:"public",table:"movies"},()=>se()).subscribe();return()=>{E.removeChannel(r)}},[]),o.useEffect(()=>{if(q||R.current)return;const r=C.get("edit");if(r&&i.length>0){const f=i.find(S=>S.id===r);f&&(Y(f),C.delete("edit"),M(C,{replace:!0}),R.current=!0)}},[C,M,i,q]),o.useEffect(()=>{k(1),y([])},[b,K]);const P=(r,f)=>{J({message:r,type:f})},ve=async r=>{_(!0);try{const{error:f}=await E.from("movies").insert([{...r,created_at:new Date().toISOString()}]);if(f)throw f;await se(),s(!1),k(1),P("تمت إضافة الفيلم بنجاح.","success")}catch(f){console.error("Error adding movie: ",f);const S=f.message||JSON.stringify(f);P(`حدث خطأ أثناء إضافة الفيلم: ${S}`,"error")}finally{_(!1)}},ue=async(r,f)=>{_(!0);try{const{error:S}=await E.from("movies").update(f).eq("id",r);if(S)throw S;await se(),d(null),s(!1),P("تم تحديث الفيلم بنجاح.","success")}catch(S){console.error("Error updating movie: ",S);const re=S.message||JSON.stringify(S);P(`حدث خطأ أثناء تحديث الفيلم: ${re}`,"error")}finally{_(!1)}},N=r=>{B(r),p(!0)},G=async()=>{if(v){_(!0);try{const{error:r}=await E.from("movies").delete().eq("id",v.id);if(r)throw r;P("تم حذف الفيلم بنجاح.","success")}catch(r){console.error("Error deleting movie: ",r);const f=r.message||JSON.stringify(r);P(`حدث خطأ أثناء حذف الفيلم: ${f}`,"error")}finally{p(!1),B(null),_(!1)}}},Y=r=>{d(r),s(!0)},I=()=>{d(null),s(!0)},D=()=>{d(null),s(!1),u(null)},Q=r=>{y(f=>f.includes(r)?f.filter(S=>S!==r):[...f,r])},ne=r=>{r.target.checked?y(te.map(f=>f.id)):y(U.filter(f=>!te.some(S=>S.id===f)))},ee=async(r,f)=>{_(!0);try{const{error:S}=await E.from("movies").update(r).in("id",U);if(S)throw S;P(f,"success"),y([])}catch(S){console.error("Bulk update failed:",S),P("فشل التحديث الجماعي.","error")}finally{_(!1),u(null)}},n=async r=>{await ee({movie_type:r,is_kurdish:r==="kurdish"},"تم تغيير النوع بنجاح.")},t=async()=>{_(!0);try{const{error:r}=await E.from("movies").delete().in("id",U);if(r)throw r;P(`تم حذف ${U.length} فيلم بنجاح.`,"success"),y([])}catch(r){console.error("Bulk delete failed:",r),P("فشل الحذف الجماعي.","error")}finally{_(!1),u(null)}},l=async(r,f)=>{_(!0);try{const{data:S,error:re}=await E.from("movies").select("id, genres").in("id",U);if(re)throw re;const Ee=S.map(we=>{const je=we.genres||[];let ge;return f==="add"?ge=[...new Set([...je,r])]:ge=je.filter(Me=>Me!==r),{id:we.id,genres:ge}}),{error:ye}=await E.from("movies").upsert(Ee);if(ye)throw ye;P(`تم ${f==="add"?"إضافة":"إزالة"} فئة "${r}" بنجاح.`,"success"),y([])}catch(S){console.error("Bulk genre change failed:",S),P("فشل تغيير الفئة الجماعي.","error")}finally{_(!1),u(null)}},g=async(r,f)=>{_(!0);try{const{data:S,error:re}=await E.from("movies").select("id, tags").in("id",U);if(re)throw re;const Ee=S.map(we=>{const je=we.tags||[];let ge;return f==="add"?ge=[...new Set([...je,r])]:ge=je.filter(Me=>Me!==r),{id:we.id,tags:ge}}),{error:ye}=await E.from("movies").upsert(Ee);if(ye)throw ye;P(`تم ${f==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${r}" بنجاح.`,"success"),y([])}catch(S){console.error("Bulk tags change failed:",S),P("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{_(!1),u(null)}},j=i.filter(r=>b==="all"?!0:b==="foreign"?r.movie_type==="foreign"||!r.movie_type:b==="kurdish"?r.movie_type==="kurdish"||r.is_kurdish===!0:r.movie_type===b).filter(r=>ht(K,r.title)),F=Math.ceil(j.length/ze),te=j.slice((c-1)*ze,c*ze),ae=te.length>0&&te.every(r=>U.includes(r.id)),me=r=>{var S;let f=r.movie_type;return!f&&r.is_kurdish?f="kurdish":f||(f="foreign"),((S=nt.find(re=>re.key===f))==null?void 0:S.label)||f};return q?e.jsx(xt,{}):e.jsxs("div",{className:"relative",children:[$&&e.jsx(ct,{...$,onClose:()=>J(null)}),e.jsx(Se,{isOpen:Z,onClose:()=>p(!1),onConfirm:G,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',v==null?void 0:v.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:H}),L==="delete"&&e.jsx(Se,{isOpen:!0,onClose:()=>u(null),onConfirm:t,title:`تأكيد حذف ${U.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:H}),L==="genre"&&e.jsx(gt,{genres:x,onClose:D,onSubmit:l,isLoading:H}),L==="tags"&&e.jsx(pt,{onClose:D,onSubmit:g,isLoading:H}),L==="year"&&e.jsx(kt,{onClose:D,onSubmit:r=>ee({year:r},"تم تحديث السنة بنجاح."),isLoading:H}),L==="changeType"&&e.jsx(Ct,{movieTypes:nt,onClose:D,onSubmit:n,isLoading:H}),w&&e.jsx(_e,{title:h?"تعديل الفيلم":"إضافة فيلم جديد",onClose:D,isOpen:w,children:e.jsx(jt,{onSubmit:h?r=>ue(h.id,r):ve,initialData:h,onCancel:D,isLoading:H,allGenres:x})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:I,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:K,onChange:r=>z(r.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("select",{value:b,onChange:r=>O(r.target.value),className:"w-full sm:w-auto bg-slate-700 text-white p-2.5 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors flex-shrink-0","aria-label":"Filter by movie type",children:[e.jsx("option",{value:"all",children:"كل الأنواع"}),nt.map(r=>e.jsx("option",{value:r.key,children:r.label},r.key))]})]}),U.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[U.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>y([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>u("changeType"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير النوع"}),e.jsx("button",{onClick:()=>u("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>u("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>u("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>u("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto hidden lg:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:ne,checked:ae,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"نوع الفيلم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:te.map(r=>{var f,S;return e.jsxs("tr",{className:`${U.includes(r.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:U.includes(r.id),onChange:()=>Q(r.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:r.poster_url,alt:r.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:r.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:r.imdb_rating?r.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:r.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(f=r.genres)==null?void 0:f.slice(0,3).map(re=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:re},re)),((S=r.genres)==null?void 0:S.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:me(r)}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:r.created_at?new Date(r.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>Y(r),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>N(r),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},r.id)})})]})}),e.jsxs("div",{className:"block lg:hidden space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx("input",{type:"checkbox",onChange:ne,checked:ae,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("label",{className:"text-sm text-slate-300",children:"تحديد الكل في هذه الصفحة"})]}),te.map(r=>{var f,S;return e.jsxs("div",{className:`p-3 rounded-lg transition-all duration-200 ${U.includes(r.id)?"bg-cyan-500/20 ring-2 ring-cyan-500":"bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24",children:e.jsx("img",{src:r.poster_url,alt:r.title,className:"w-full rounded object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-bold text-white truncate flex-grow pr-2",children:r.title}),e.jsx("input",{type:"checkbox",checked:U.includes(r.id),onChange:()=>Q(r.id),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 flex-shrink-0"})]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1 flex items-center gap-x-2 flex-wrap",children:[e.jsx("span",{children:r.year}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{className:"text-yellow-400 font-bold",children:r.imdb_rating?r.imdb_rating.toFixed(1):"N/A"}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{children:me(r)})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[(f=r.genres)==null?void 0:f.slice(0,2).map(re=>e.jsx("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:re},re)),((S=r.genres)==null?void 0:S.length)>2&&e.jsxs("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:["+",r.genres.length-2]})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 flex justify-end items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-xs text-slate-500 mr-auto",children:["أضيف في: ",r.created_at?new Date(r.created_at).toLocaleDateString("ar-EG"):"N/A"]}),e.jsx("button",{onClick:()=>Y(r),className:"font-medium text-cyan-400 hover:text-cyan-300",children:"تعديل"}),e.jsx("button",{onClick:()=>N(r),className:"font-medium text-red-500 hover:text-red-400",children:"حذف"})]})]},r.id)})]})]}),j.length>ze&&e.jsx("div",{className:"p-4 mt-4 border-t border-slate-700",children:e.jsx(it,{currentPage:c,totalPages:F,onPageChange:k})})]})},Et=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Mt=({onSubmit:i,initialData:a,onCancel:h,isLoading:d=!1,allGenres:w=[]})=>{const[s,c]=o.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:"",year:new Date().getFullYear(),episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"FullHD"}],imdb_rating:0}],trailer_url:"",imdb_rating:0}),[k,b]=o.useState(""),[O,K]=o.useState(!1),z=o.useRef(null);o.useEffect(()=>{a&&(c({...a,genres:a.genres||[],tags:a.tags||[],seasons:a.seasons&&a.seasons.length>0?a.seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:a.poster_url,year:a.year,episodes:[],imdb_rating:0}],trailer_url:a.trailer_url||"",imdb_rating:a.imdb_rating||0}),b((a.tags||[]).join(", ")))},[a]),o.useEffect(()=>{const u=x=>{z.current&&!z.current.contains(x.target)&&K(!1)};return document.addEventListener("mousedown",u),()=>document.removeEventListener("mousedown",u)},[]);const Z=async u=>{var x;try{if(!((x=navigator.clipboard)!=null&&x.readText))throw new Error("Clipboard API not available.");const m=await navigator.clipboard.readText();m&&u(m)}catch(m){console.error("Failed to read clipboard contents: ",m),alert("فشل لصق النص. يرجى التأكد من منح الإذن لاستخدام الحافظة.")}},p=u=>{const{name:x,value:m}=u.target;if(x==="year"||x==="imdb_rating"){const C=parseFloat(m);c(M=>({...M,[x]:isNaN(C)?0:C}))}else c(C=>({...C,[x]:m}))},v=u=>{b(u.target.value)},B=u=>{c(x=>({...x,genres:x.genres.includes(u)?x.genres.filter(m=>m!==u):[...x.genres,u]}))},q=(u,x,m)=>{const C=[...s.seasons],M={...C[u]};if(x==="season_number"||x==="year"||x==="imdb_rating"){const R=typeof m=="string"?parseFloat(m):m;M[x]=isNaN(R)?0:R}else M[x]=m;C[u]=M,c(R=>({...R,seasons:C}))},A=()=>{const u=s.seasons.length>0?Math.max(...s.seasons.map(m=>m.season_number))+1:1,x=s.seasons.length>0?s.seasons[s.seasons.length-1].year:s.year;c(m=>({...m,seasons:[...m.seasons,{season_number:u,title:`الموسم ${u}`,description:"",poster_url:m.poster_url,year:x+1,episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"FullHD"}],imdb_rating:0}]}))},H=u=>{c(x=>({...x,seasons:x.seasons.filter((m,C)=>C!==u)}))},_=(u,x,m,C)=>{const M=[...s.seasons],R=[...M[u].episodes],se={...R[x]};if(m==="episode_number"){const P=typeof C=="string"?parseFloat(C):C;se[m]=isNaN(P)?0:P}else se[m]=C;R[x]=se,M[u]={...M[u],episodes:R},c(P=>({...P,seasons:M}))},$=u=>{const x=s.seasons[u],m=x.episodes.length>0?Math.max(...x.episodes.map(R=>R.episode_number))+1:1,C={episode_number:m,title:`الحلقة ${m}`,url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"FullHD"},M=s.seasons.map((R,se)=>se===u?{...R,episodes:[...R.episodes,C]}:R);c(R=>({...R,seasons:M}))},J=(u,x)=>{const m=s.seasons.map((C,M)=>M===u?{...C,episodes:C.episodes.filter((R,se)=>se!==x)}:C);c(C=>({...C,seasons:m}))},U=u=>{u.preventDefault();const x=k.split(",").map(m=>m.trim()).filter(Boolean);i({...s,tags:x})},y="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",L="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:U,children:[e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsx("h3",{className:"text-xl font-bold text-white border-b border-slate-700 pb-2",children:"معلومات المسلسل الرئيسية"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:s.title,onChange:p,placeholder:"عنوان المسلسل",required:!0,className:y}),e.jsx("input",{type:"number",name:"year",value:s.year||"",onChange:p,placeholder:"سنة بداية العرض",required:!0,className:y})]}),e.jsx("textarea",{name:"description",value:s.description,onChange:p,placeholder:"وصف المسلسل العام",required:!0,className:`${y} h-24`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"poster_url",value:s.poster_url,onChange:p,placeholder:"رابط البوستر الرئيسي",required:!0,className:y}),e.jsx("input",{type:"url",name:"backdrop_url",value:s.backdrop_url,onChange:p,placeholder:"رابط صورة الخلفية",required:!0,className:y})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:s.imdb_rating??"",onChange:p,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:y}),e.jsx("input",{type:"url",name:"trailer_url",value:s.trailer_url??"",onChange:p,placeholder:"رابط المقطع الدعائي (اختياري)",className:y})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات"}),e.jsxs("div",{className:"relative",ref:z,children:[e.jsx("button",{type:"button",onClick:()=>K(u=>!u),className:`${y} text-right`,children:s.genres.length>0?s.genres.join(", "):"اختر الفئات..."}),O&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:w.map(u=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:s.genres.includes(u),onChange:()=>B(u),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:u})]},u))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (مفصولة بفاصلة)"}),e.jsx("input",{type:"text",value:k,onChange:v,placeholder:"أكشن, إثارة...",className:y})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),s.seasons.map((u,x)=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-white font-semibold",children:"الموسم رقم:"}),e.jsx("input",{type:"number",value:u.season_number||"",onChange:m=>q(x,"season_number",m.target.value),className:`${L} w-20`})]}),e.jsx("button",{type:"button",onClick:()=>H(x),className:"bg-red-600 text-white px-3 py-1 rounded-md text-sm",children:"إزالة الموسم"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",value:u.title,onChange:m=>q(x,"title",m.target.value),placeholder:"عنوان الموسم",required:!0,className:L}),e.jsx("input",{type:"number",value:u.year||"",onChange:m=>q(x,"year",m.target.value),placeholder:"سنة الموسم",required:!0,className:L}),e.jsx("input",{type:"number",value:u.imdb_rating??"",onChange:m=>q(x,"imdb_rating",m.target.value),placeholder:"تقييم IMDb",step:"0.1",min:"0",max:"10",className:L}),e.jsx("input",{type:"url",value:u.poster_url,onChange:m=>q(x,"poster_url",m.target.value),placeholder:"رابط بوستر الموسم",required:!0,className:`${L} col-span-1 sm:col-span-3`}),e.jsx("textarea",{value:u.description,onChange:m=>q(x,"description",m.target.value),placeholder:"وصف الموسم",required:!0,className:`${L} h-20 col-span-1 sm:col-span-3`})]}),e.jsxs("div",{className:"space-y-2 pt-3 mt-3 border-t border-slate-600",children:[e.jsxs("h4",{className:"font-semibold text-slate-300",children:["حلقات الموسم ",u.season_number,":"]}),u.episodes.map((m,C)=>e.jsxs("div",{className:"bg-slate-800/60 p-2 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:m.episode_number||"",onChange:M=>_(x,C,"episode_number",M.target.value),placeholder:"رقم",className:`${L} w-16`}),e.jsx("input",{type:"text",value:m.title,onChange:M=>_(x,C,"title",M.target.value),placeholder:"عنوان الحلقة",className:`${L} flex-1`}),e.jsx("button",{type:"button",onClick:()=>J(x,C),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600 text-xs",children:"X"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("input",{type:"url",value:m.url,onChange:M=>_(x,C,"url",M.target.value),placeholder:"رابط المشاهدة",required:!0,className:`${L} flex-1`}),e.jsx("button",{type:"button",onClick:()=>Z(M=>_(x,C,"url",M)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]}),e.jsxs("select",{value:m.quality||"FullHD",onChange:M=>_(x,C,"quality",M.target.value),className:`${L} w-28 flex-shrink-0`,children:[e.jsx("option",{value:"FullHD",children:"FullHD"}),e.jsx("option",{value:"HD",children:"HD"}),e.jsx("option",{value:"SD",children:"SD"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:m.download_url||"",onChange:M=>_(x,C,"download_url",M.target.value),placeholder:"رابط التحميل (اختياري)",className:`${L} w-full flex-grow`}),e.jsx("button",{type:"button",onClick:()=>Z(M=>_(x,C,"download_url",M)),className:"bg-cyan-600 hover:bg-cyan-700 text-white font-bold text-xs py-1.5 px-3 rounded-md transition-colors flex-shrink-0",children:"لصق"})]})]})]},C)),e.jsx("button",{type:"button",onClick:()=>$(x),className:"text-sm bg-slate-600 text-white py-1 px-3 rounded-md hover:bg-slate-500",children:"إضافة حلقة"})]})]},x)),e.jsx("button",{type:"button",onClick:A,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700",children:"إضافة موسم"})]})]}),e.jsxs("div",{className:"sticky bottom-0 z-10 bg-slate-800/95 backdrop-blur-sm p-4 border-t border-slate-700 flex justify-end gap-4 -mx-6 -mb-6 md:-mx-8 md:-mb-8 rounded-b-lg",children:[e.jsx("button",{type:"button",onClick:h,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg",disabled:d,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg",disabled:d,children:[d&&e.jsx(Et,{}),a?"تحديث المسلسل":"إضافة المسلسل"]})]})]})},He=10,$t=()=>{const[i,a]=o.useState([]),[h,d]=o.useState(null),[w,s]=o.useState(!1),[c,k]=o.useState(1),[b,O]=o.useState(""),[K,z]=o.useState(!1),[Z,p]=o.useState(null),[v,B]=o.useState(!0),[q,A]=o.useState(!1),[H,_]=o.useState(null),[$,J]=o.useState([]),[U,y]=o.useState(null),[L,u]=o.useState([]),x=async()=>{const{data:t,error:l}=await E.from("series").select("*").order("created_at",{ascending:!1});l?(console.error("Error fetching series: ",l),m("فشل في تحميل المسلسلات.","error")):a(t);const{data:g,error:j}=await E.from("categories").select("name").order("name");j?console.error("Error fetching categories: ",j):u(g.map(F=>F.name)),B(!1)};o.useEffect(()=>{B(!0),x();const t=E.channel("public:series").on("postgres_changes",{event:"*",schema:"public",table:"series"},x).subscribe();return()=>{E.removeChannel(t)}},[]),o.useEffect(()=>{k(1),J([])},[b]);const m=(t,l)=>{_({message:t,type:l})},C=async t=>{A(!0);try{const{error:l}=await E.from("series").insert([{...t,created_at:new Date().toISOString()}]);if(l)throw l;await x(),s(!1),k(1),m("تمت إضافة المسلسل بنجاح.","success")}catch(l){console.error("Error adding series: ",l);const g=l.message||JSON.stringify(l);m(`حدث خطأ أثناء إضافة المسلسل: ${g}`,"error")}finally{A(!1)}},M=async(t,l)=>{A(!0);try{const{error:g}=await E.from("series").update(l).eq("id",t);if(g)throw g;await x(),d(null),s(!1),m("تم تحديث المسلسل بنجاح.","success")}catch(g){console.error("Error updating series:",g);const j=g.message||JSON.stringify(g);m(`حدث خطأ أثناء تحديث المسلسل: ${j}`,"error")}finally{A(!1)}},R=t=>{p(t),z(!0)},se=async()=>{if(Z){A(!0);try{const{error:t}=await E.from("series").delete().eq("id",Z.id);if(t)throw t;m("تم حذف المسلسل بنجاح.","success")}catch(t){console.error("Error deleting series:",t);const l=t.message||JSON.stringify(t);m(`حدث خطأ أثناء حذف المسلسل: ${l}`,"error")}finally{z(!1),p(null),A(!1)}}},P=t=>{d(t),s(!0)},ve=()=>{d(null),s(!0)},ue=()=>{d(null),s(!1),y(null)},N=t=>{J(l=>l.includes(t)?l.filter(g=>g!==t):[...l,t])},G=t=>{t.target.checked?J(ee.map(l=>l.id)):J($.filter(l=>!ee.some(g=>g.id===l)))},Y=async()=>{A(!0);try{const{error:t}=await E.from("series").delete().in("id",$);if(t)throw t;m(`تم حذف ${$.length} مسلسل بنجاح.`,"success"),J([])}catch(t){console.error("Bulk delete failed:",t),m("فشل الحذف الجماعي.","error")}finally{A(!1),y(null)}},I=async(t,l)=>{A(!0);try{const{data:g,error:j}=await E.from("series").select("id, genres").in("id",$);if(j)throw j;const F=g.map(ae=>{const me=ae.genres||[],r=l==="add"?[...new Set([...me,t])]:me.filter(f=>f!==t);return{id:ae.id,genres:r}}),{error:te}=await E.from("series").upsert(F);if(te)throw te;m(`تم ${l==="add"?"إضافة":"إزالة"} فئة "${t}" بنجاح.`,"success"),J([])}catch(g){console.error("Bulk genre change failed:",g),m("فشل تغيير الفئة الجماعي.","error")}finally{A(!1),y(null)}},D=async(t,l)=>{A(!0);try{const{data:g,error:j}=await E.from("series").select("id, tags").in("id",$);if(j)throw j;const F=g.map(ae=>{const me=ae.tags||[],r=l==="add"?[...new Set([...me,t])]:me.filter(f=>f!==t);return{id:ae.id,tags:r}}),{error:te}=await E.from("series").upsert(F);if(te)throw te;m(`تم ${l==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${t}" بنجاح.`,"success"),J([])}catch(g){console.error("Bulk tags change failed:",g),m("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{A(!1),y(null)}},Q=i.filter(t=>ht(b,t.title)),ne=Math.ceil(Q.length/He),ee=Q.slice((c-1)*He,c*He),n=ee.length>0&&ee.every(t=>$.includes(t.id));return v?e.jsx(xt,{}):e.jsxs("div",{className:"relative",children:[H&&e.jsx(ct,{...H,onClose:()=>_(null)}),e.jsx(Se,{isOpen:K,onClose:()=>z(!1),onConfirm:se,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',Z==null?void 0:Z.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:q}),U==="delete"&&e.jsx(Se,{isOpen:!0,onClose:()=>y(null),onConfirm:Y,title:`تأكيد حذف ${$.length} مسلسل`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:q}),U==="genre"&&e.jsx(gt,{genres:L,onClose:ue,onSubmit:I,isLoading:q}),U==="tags"&&e.jsx(pt,{onClose:ue,onSubmit:D,isLoading:q}),w&&e.jsx(_e,{title:h?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:ue,isOpen:w,children:e.jsx(Mt,{onSubmit:h?t=>M(h.id,t):C,initialData:h,onCancel:ue,isLoading:q,allGenres:L})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:ve,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:b,onChange:t=>O(t.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a series to edit"})]})]}),$.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[$.length," مسلسل محدد"]}),e.jsx("button",{onClick:()=>J([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>y("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>y("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>y("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"overflow-x-auto hidden lg:block",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:G,checked:n,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:ee.map(t=>{var l,g,j;return e.jsxs("tr",{className:`${$.includes(t.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:$.includes(t.id),onChange:()=>N(t.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:t.poster_url,alt:t.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:t.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:t.imdb_rating?t.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(l=t.genres)==null?void 0:l.slice(0,3).map(F=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:F},F)),((g=t.genres)==null?void 0:g.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:((j=t.seasons)==null?void 0:j.length)||0}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>P(t),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>R(t),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},t.id)})})]})}),e.jsxs("div",{className:"block lg:hidden space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2",children:[e.jsx("input",{type:"checkbox",onChange:G,checked:n,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("label",{className:"text-sm text-slate-300",children:"تحديد الكل في هذه الصفحة"})]}),ee.map(t=>{var l,g,j;return e.jsxs("div",{className:`p-3 rounded-lg transition-all duration-200 ${$.includes(t.id)?"bg-cyan-500/20 ring-2 ring-cyan-500":"bg-slate-900/50"}`,children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24",children:e.jsx("img",{src:t.poster_url,alt:t.title,className:"w-full rounded object-cover",loading:"lazy"})}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h3",{className:"font-bold text-white truncate flex-grow pr-2",children:t.title}),e.jsx("input",{type:"checkbox",checked:$.includes(t.id),onChange:()=>N(t.id),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 flex-shrink-0"})]}),e.jsxs("div",{className:"text-sm text-slate-400 mt-1 flex items-center gap-x-2 flex-wrap",children:[e.jsx("span",{children:t.year}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsx("span",{className:"text-yellow-400 font-bold",children:t.imdb_rating?t.imdb_rating.toFixed(1):"N/A"}),e.jsx("span",{className:"text-slate-600",children:"•"}),e.jsxs("span",{children:[((l=t.seasons)==null?void 0:l.length)||0," مواسم"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[(g=t.genres)==null?void 0:g.slice(0,2).map(F=>e.jsx("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:F},F)),((j=t.genres)==null?void 0:j.length)>2&&e.jsxs("span",{className:"bg-slate-700 text-slate-200 px-2 py-0.5 text-xs rounded-full",children:["+",t.genres.length-2]})]})]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700 flex justify-end items-center gap-4 text-sm",children:[e.jsxs("div",{className:"text-xs text-slate-500 mr-auto",children:["أضيف في: ",t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"N/A"]}),e.jsx("button",{onClick:()=>P(t),className:"font-medium text-cyan-400 hover:text-cyan-300",children:"تعديل"}),e.jsx("button",{onClick:()=>R(t),className:"font-medium text-red-500 hover:text-red-400",children:"حذف"})]})]},t.id)})]})]}),Q.length>He&&e.jsx("div",{className:"p-4 mt-4 border-t border-slate-700",children:e.jsx(it,{currentPage:c,totalPages:ne,onPageChange:k})})]})},Ft=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),qt=({onSubmit:i,initialData:a,onCancel:h,isLoading:d=!1})=>{const[w,s]=o.useState("");o.useEffect(()=>{s(a?a.name:"")},[a]);const c=k=>{k.preventDefault(),w.trim()&&i({name:w})};return e.jsxs("form",{onSubmit:c,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:w,onChange:k=>s(k.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:h,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:d,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:d,children:[d&&e.jsx(Ft,{}),d?a?"جاري التحديث...":"جاري الإضافة...":a?"تحديث":"إضافة"]})]})]})},At=10,Tt=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(At)].map((i,a)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},a))})]})})}),Ot=({isOpen:i,onClose:a,onSubmit:h,isLoading:d,categories:w})=>{const[s,c]=o.useState(""),[k,b]=o.useState(""),[O,K]=o.useState(""),z=yt.useMemo(()=>w.filter(p=>p.name!==s),[w,s]);o.useEffect(()=>{if(i&&w.length>0){const p=w[0].name;c(p);const v=w.filter(B=>B.name!==p);b(v.length>0?v[0].name:"")}},[i,w]),o.useEffect(()=>{K(s&&k&&s===k?"لا يمكن دمج فئة مع نفسها. الرجاء اختيار فئتين مختلفتين.":"")},[s,k]),o.useEffect(()=>{z.some(p=>p.name===k)||b(z.length>0?z[0].name:"")},[s,z,k]);const Z=p=>{p.preventDefault(),!(O||!s||!k)&&h(s,k)};return e.jsx(_e,{title:"توحيد (دمج) الفئات",onClose:a,isOpen:i,children:e.jsxs("form",{onSubmit:Z,className:"space-y-6",children:[e.jsx("p",{className:"text-slate-300",children:"سيتم نقل كل المحتوى من الفئة المصدر إلى الفئة الهدف، ثم سيتم حذف الفئة المصدر نهائياً."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"source_category",className:"block text-sm font-medium text-slate-300 mb-2",children:"دمج من هذه الفئة (سيتم حذفها):"}),e.jsx("select",{id:"source_category",value:s,onChange:p=>c(p.target.value),required:!0,className:"w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",children:w.map(p=>e.jsx("option",{value:p.name,children:p.name},p.id))})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"destination_category",className:"block text-sm font-medium text-slate-300 mb-2",children:"الدمج في هذه الفئة (ستبقى):"}),e.jsx("select",{id:"destination_category",value:k,onChange:p=>b(p.target.value),required:!0,className:"w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",disabled:z.length===0,children:z.map(p=>e.jsx("option",{value:p.name,children:p.name},p.id))})]}),O&&e.jsx("p",{className:"text-red-400 text-center text-sm bg-red-500/10 p-2 rounded-md",children:O}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:a,disabled:d,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:d||!!O||!s||!k,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",children:[d&&e.jsx(Ce,{}),d?"جاري الدمج...":"تنفيذ الدمج"]})]})]})})},Ie=10,Pt=({message:i,type:a,onClose:h})=>(o.useEffect(()=>{const s=setTimeout(h,5e3);return()=>clearTimeout(s)},[h]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${a==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:i}),e.jsx("button",{onClick:h,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Dt=({children:i,onClose:a,title:h,isOpen:d})=>{const[w,s]=o.useState(d);return o.useEffect(()=>{if(d){s(!0),document.body.style.overflow="hidden";const c=k=>{k.key==="Escape"&&a()};return window.addEventListener("keydown",c),()=>{window.removeEventListener("keydown",c)}}else{const c=setTimeout(()=>{s(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(c)}},[d,a]),w?e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 ${d?"animate-fade-in":"animate-fade-out"}`,onClick:a,children:e.jsxs("div",{className:`bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700 ${d?"animate-zoom-in":"animate-zoom-out"}`,onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:h}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),i]})}):null},Bt=()=>{const[i,a]=o.useState([]),[h,d]=o.useState(null),[w,s]=o.useState(!1),[c,k]=o.useState(1),[b,O]=o.useState(!1),[K,z]=o.useState(null),[Z,p]=o.useState(!0),[v,B]=o.useState(!1),[q,A]=o.useState(null),[H,_]=o.useState(!1),[$,J]=o.useState(null),U=async()=>{const{data:N,error:G}=await E.from("categories").select("*").order("name");G?(console.error("Error fetching categories: ",G),y("فشل في تحميل الفئات.","error")):a(N),p(!1)};o.useEffect(()=>{p(!0),U();const N=E.channel("public:categories").on("postgres_changes",{event:"*",schema:"public",table:"categories"},U).subscribe();return()=>{E.removeChannel(N)}},[]);const y=(N,G)=>{A({message:N,type:G})},L=async N=>{B(!0);try{const{error:G}=await E.from("categories").insert([N]);if(G)throw G;y("تمت إضافة الفئة بنجاح!","success"),s(!1),k(1)}catch(G){console.error("Error adding category: ",G);const Y=G.message||JSON.stringify(G);y(`حدث خطأ أثناء إضافة الفئة: ${Y}`,"error")}finally{B(!1)}},u=async(N,G)=>{B(!0);const Y=h==null?void 0:h.name,I=G.name,D=Y&&I&&Y!==I;try{const{error:Q}=await E.from("categories").update(G).eq("id",N);if(Q)throw Q;if(D){y("تم تحديث الفئة. جاري تحديث المحتوى المرتبط...","success");const{data:ne,error:ee}=await E.from("movies").select("id, genres").contains("genres",[Y]);if(ee)console.error("Error fetching movies to update:",ee),y("تم تحديث الفئة، لكن حدث خطأ أثناء جلب الأفلام للتحديث.","error");else if(ne&&ne.length>0){const l=ne.map(F=>{const te=F.genres.map(ae=>ae===Y?I:ae);return E.from("movies").update({genres:te}).eq("id",F.id)}),j=(await Promise.all(l)).find(F=>F.error);j&&(console.error("Error updating movies with new category:",j.error),y("تم تحديث الفئة، لكن حدث خطأ أثناء تحديث بعض الأفلام.","error"))}const{data:n,error:t}=await E.from("series").select("id, genres").contains("genres",[Y]);if(t)console.error("Error fetching series to update:",t),y("تم تحديث الفئة، لكن حدث خطأ أثناء جلب المسلسلات للتحديث.","error");else if(n&&n.length>0){const l=n.map(F=>{const te=F.genres.map(ae=>ae===Y?I:ae);return E.from("series").update({genres:te}).eq("id",F.id)}),j=(await Promise.all(l)).find(F=>F.error);j&&(console.error("Error updating series with new category:",j.error),y("تم تحديث الفئة، لكن حدث خطأ أثناء تحديث بعض المسلسلات.","error"))}y("تم تحديث الفئة والمحتوى المرتبط بنجاح!","success")}else y("تم تحديث الفئة بنجاح!","success");d(null),s(!1)}catch(Q){if(console.error("Error updating category transaction: ",Q),Q.code==="23505")y(`فشل التحديث: اسم الفئة "${I}" موجود بالفعل.`,"error");else{const ne=Q.message||JSON.stringify(Q);y(`حدث خطأ أثناء تحديث الفئة: ${ne}`,"error")}}finally{B(!1)}},x=N=>{z(N),O(!0)},m=async()=>{if(K){B(!0);try{const{error:N}=await E.from("categories").delete().eq("id",K.id);if(N)throw N;y("تم حذف الفئة بنجاح!","success")}catch(N){console.error("Error deleting category: ",N);const G=N.message||JSON.stringify(N);y(`حدث خطأ أثناء حذف الفئة: ${G}`,"error")}finally{O(!1),z(null),B(!1)}}},C=N=>{d(N),s(!0)},M=()=>{d(null),s(!0)},R=()=>{d(null),s(!1)},se=(N,G)=>{_(!1),J({source:N,dest:G})},P=async()=>{if(!$)return;const{source:N,dest:G}=$;B(!0);try{y("جاري تحديث الأفلام...","success");const{data:Y,error:I}=await E.from("movies").select("id, genres").contains("genres",[N]);if(I)throw new Error(`Failed to fetch movies: ${I.message}`);if(Y&&Y.length>0){const ee=Y.map(n=>{const t=[...new Set(n.genres.filter(l=>l!==N).concat([G]))];return E.from("movies").update({genres:t}).eq("id",n.id)});await Promise.all(ee)}y("جاري تحديث المسلسلات...","success");const{data:D,error:Q}=await E.from("series").select("id, genres").contains("genres",[N]);if(Q)throw new Error(`Failed to fetch series: ${Q.message}`);if(D&&D.length>0){const ee=D.map(n=>{const t=[...new Set(n.genres.filter(l=>l!==N).concat([G]))];return E.from("series").update({genres:t}).eq("id",n.id)});await Promise.all(ee)}y("جاري حذف الفئة المدمجة...","success");const{error:ne}=await E.from("categories").delete().eq("name",N);if(ne)throw new Error(`Failed to delete category: ${ne.message}`);y("تم دمج الفئات بنجاح!","success")}catch(Y){console.error("Error merging categories: ",Y),y(`فشل دمج الفئات: ${Y.message}`,"error")}finally{J(null),B(!1)}},ve=Math.ceil(i.length/Ie),ue=i.slice((c-1)*Ie,c*Ie);return Z?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(Tt,{})]}):e.jsxs("div",{children:[q&&e.jsx(Pt,{...q,onClose:()=>A(null)}),e.jsx(Se,{isOpen:b,onClose:()=>O(!1),onConfirm:m,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',K==null?void 0:K.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:v}),e.jsx(Se,{isOpen:!!$,onClose:()=>J(null),onConfirm:P,title:"تأكيد عملية الدمج",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد دمج الفئة ",e.jsxs("strong",{className:"text-white",children:['"',$==null?void 0:$.source,'"']})," في الفئة ",e.jsxs("strong",{className:"text-white",children:['"',$==null?void 0:$.dest,'"']}),"؟",e.jsx("br",{}),e.jsxs("span",{className:"text-yellow-400",children:['سيتم حذف الفئة "',$==null?void 0:$.source,'" نهائياً. لا يمكن التراجع عن هذا الإجراء.']})]}),isLoading:v}),e.jsx(Ot,{isOpen:H,onClose:()=>_(!1),onSubmit:se,isLoading:v,categories:i}),e.jsx(Dt,{isOpen:w,title:h?"تعديل الفئة":"إضافة فئة جديدة",onClose:R,children:e.jsx(qt,{onSubmit:h?N=>u(h.id,N):L,initialData:h,onCancel:R,isLoading:v})}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsx("button",{onClick:M,className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsx("button",{onClick:()=>_(!0),className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500 transition-colors",children:"توحيد الفئات"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden hidden sm:block",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:i.length>0?ue.map(N=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:N.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>C(N),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>x(N),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},N.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})})}),e.jsx("div",{className:"block sm:hidden space-y-3",children:i.length>0?ue.map(N=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-white",children:N.name}),e.jsxs("div",{className:"flex gap-4 flex-shrink-0",children:[e.jsx("button",{onClick:()=>C(N),className:"text-cyan-400 hover:text-cyan-300 text-sm font-medium",children:"تعديل"}),e.jsx("button",{onClick:()=>x(N),className:"text-red-500 hover:text-red-400 text-sm font-medium",children:"حذف"})]})]},N.id)):e.jsx("div",{className:"text-center py-8 text-gray-400 bg-slate-900/50 rounded-lg",children:"لا توجد فئات حالياً."})})]}),i.length>Ie&&e.jsx("div",{className:"mt-4",children:e.jsx(it,{currentPage:c,totalPages:ve,onPageChange:k})})]})},lt=["movies","series","categories"],Lt=i=>i.replace(/[A-Z]/g,a=>`_${a.toLowerCase()}`),ot=i=>Array.isArray(i)?i.map(a=>ot(a)):i!==null&&typeof i=="object"&&i.constructor===Object?i.hasOwnProperty("seconds")&&i.hasOwnProperty("nanoseconds")&&Object.keys(i).length===2&&typeof i.seconds=="number"&&typeof i.nanoseconds=="number"?new Date(i.seconds*1e3).toISOString():i.hasOwnProperty("_seconds")&&i.hasOwnProperty("_nanoseconds")&&Object.keys(i).length===2&&typeof i._seconds=="number"&&typeof i._nanoseconds=="number"?new Date(i._seconds*1e3).toISOString():Object.keys(i).reduce((a,h)=>{const d=Lt(h);return a[d]=ot(i[h]),a},{}):i,Rt=()=>{const[i,a]=o.useState(!1),[h,d]=o.useState(null),[w,s]=o.useState(!1),[c,k]=o.useState(null),b=(p,v)=>{d({message:p,type:v})},O=async()=>{a(!0),b("بدء عملية النسخ الاحتياطي... قد تستغرق هذه العملية بعض الوقت.","success");try{const p={};for(const _ of lt){const{data:$,error:J}=await E.from(_).select("*");if(J)throw J;p[_]=$||[]}const v=JSON.stringify(p,null,2),B=new Blob([v],{type:"application/json"}),q=URL.createObjectURL(B),A=document.createElement("a");A.href=q;const H=new Date().toISOString().slice(0,10);A.download=`supabase-backup-${H}.json`,document.body.appendChild(A),A.click(),document.body.removeChild(A),URL.revokeObjectURL(q),b("تم إكمال النسخ الاحتياطي بنجاح!","success")}catch(p){console.error("Backup failed:",p);let v="فشل النسخ الاحتياطي. تحقق من وحدة التحكم لمزيد من التفاصيل.";p.code==="42501"&&(v="فشل النسخ الاحتياطي: أذونات غير كافية. تأكد من أن قواعد RLS تسمح للمشرفين بقراءة المجموعات."),b(v,"error")}finally{a(!1)}},K=p=>{var B;const v=(B=p.target.files)==null?void 0:B[0];if(v){const q=new FileReader;q.onload=A=>{var H;try{const _=(H=A.target)==null?void 0:H.result,$=JSON.parse(_);k($)}catch(_){b("ملف JSON غير صالح.","error"),console.error("JSON parsing error:",_),k(null)}},q.readAsText(v)}},z=()=>{c?s(!0):b("الرجاء تحديد ملف نسخ احتياطي أولاً.","error")},Z=async()=>{if(s(!1),!!c){a(!0),b("بدء عملية الاستعادة... هذه العملية ستستغرق وقتاً.","success");try{let p=0,v=[];for(const q of Object.keys(c)){if(!lt.includes(q)){v.push(q),console.warn(`Skipping restore for unsupported collection: "${q}"`);continue}const A=c[q];if(Array.isArray(A)&&A.length>0){const H=A.map($=>ot($)),{error:_}=await E.from(q).upsert(H);if(_)throw console.error(`Error during upsert to "${q}":`,JSON.stringify(_,null,2)),console.error("First failed object (transformed):",JSON.stringify(H[0],null,2)),_;p++}}let B="تمت استعادة البيانات بنجاح!";v.length>0&&(B+=` تم تخطي المجموعات التالية: ${v.join(", ")}.`),p===0&&v.length>0?b(`لم يتم العثور على مجموعات بيانات صالحة للاستعادة في الملف. تم تخطي: ${v.join(", ")}.`,"error"):p>0?b(B,"success"):b("لم يتم العثور على بيانات صالحة للاستعادة في الملف.","error")}catch(p){console.error("Restore failed:",JSON.stringify(p,null,2));const v=`فشلت عملية الاستعادة: ${p.message||"خطأ غير معروف"}. يرجى مراجعة وحدة التحكم للحصول على التفاصيل الفنية.`;b(v,"error")}finally{a(!1),k(null)}}};return e.jsxs("div",{className:"space-y-12",children:[h&&e.jsx(ct,{...h,onClose:()=>d(null)}),e.jsx(Se,{isOpen:w,onClose:()=>s(!1),onConfirm:Z,title:"تأكيد استعادة البيانات",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد استعادة البيانات من هذا الملف؟",e.jsx("br",{}),e.jsx("strong",{className:"text-yellow-400",children:"تحذير:"})," سيتم الكتابة فوق أي بيانات موجودة في المجموعات التي لها نفس الأسماء. لا يمكن التراجع عن هذا الإجراء."]}),isLoading:i}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"النسخ الاحتياطي للبيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:["انقر على الزر أدناه لتصدير بيانات المحتوى العام (",lt.join(", "),"). لا يتم تضمين بيانات المستخدمين والمشرفين الخاصة في هذا النسخ الاحتياطي من جانب العميل لأسباب تتعلق بالأمان والأذونات."]}),e.jsxs("button",{onClick:O,disabled:i,className:"w-full flex items-center justify-center bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-800 disabled:cursor-wait",children:[i&&e.jsx(Ce,{}),i?"جاري التصدير...":"تصدير بيانات المحتوى الآن"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"استعادة البيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("div",{className:"p-4 border-l-4 border-yellow-500 bg-yellow-500/10 text-yellow-300 rounded-md",children:[e.jsx("strong",{className:"font-bold",children:"تحذير خطير:"})," استعادة البيانات من ملف ستقوم بالكتابة فوق البيانات الحالية في قاعدة البيانات. استخدم هذه الميزة بحذر شديد وتأكد من أنك تستخدم ملف النسخ الاحتياطي الصحيح."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"1. حدد ملف النسخ الاحتياطي (.json)"}),e.jsx("input",{type:"file",accept:".json",onChange:K,className:"w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-500/20 file:text-cyan-300 hover:file:bg-cyan-500/30"})]}),e.jsxs("button",{onClick:z,disabled:i||!c,className:"w-full flex items-center justify-center bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors disabled:bg-red-800 disabled:cursor-not-allowed disabled:cursor-wait",children:[i&&e.jsx(Ce,{}),i?"جاري الاستعادة...":"2. استعادة البيانات"]})]})]})]})},We=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(_t,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx($t,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(Bt,{})},{key:"backup",label:"النسخ الاحتياطي والاستعادة",component:e.jsx(Rt,{})}],Gt=({label:i,tabKey:a,activeTab:h,onClick:d})=>e.jsx("button",{onClick:()=>d(a),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex-shrink-0 ${h===a?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":h===a,children:i}),Wt=()=>{var w;const[i,a]=o.useState(We[0].key),[h]=mt();o.useEffect(()=>{const s=h.get("tab");s&&We.some(c=>c.key===s)&&a(s)},[h]);const d=(w=We.find(s=>s.key===i))==null?void 0:w.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6 overflow-x-auto whitespace-nowrap scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",role:"tablist",children:We.map(s=>e.jsx(Gt,{label:s.label,tabKey:s.key,activeTab:i,onClick:a},s.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-3 sm:p-6 rounded-lg border border-slate-700",children:d})]})};export{Wt as default};
