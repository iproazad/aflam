import{r as t,d as $,j as e,f as ue,F as J,T as me,u as be}from"./index-Cqcvdv2m.js";import{P as ce}from"./Pagination-CrNHQOBN.js";import{F as ae,S as de}from"./SpinnerIcon-Bws6oY6u.js";const fe=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ye=({onSubmit:h,initialData:s,onCancel:d,isKurdishByDefault:o=!1,isLoading:b=!1,allGenres:r=[]})=>{const[n,g]=t.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:!1,imdbRating:0}),[v,E]=t.useState(""),[F,P]=t.useState(!1),[U,q]=t.useState(""),[_,L]=t.useState(""),[I,T]=t.useState(!1),C=t.useRef(null),[A,B]=t.useState(!1),[z,y]=t.useState(""),j=t.useRef(null);t.useEffect(()=>{s?(g({...s,genres:s.genres||[],tags:s.tags||[],servers:s.servers&&s.servers.length>0?s.servers:[{name:"Server 1",url:"",quality:"720p"}],backupServers:s.backupServers||[],trailerUrl:s.trailerUrl||"",isKurdish:s.isKurdish||!1,imdbRating:s.imdbRating||0}),E((s.tags||[]).join(", "))):(g({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"720p"}],backupServers:[],downloadUrl:"",trailerUrl:"",isKurdish:o,imdbRating:0}),E(""))},[s,o]),t.useEffect(()=>{const a=m=>{C.current&&!C.current.contains(m.target)&&P(!1)};return document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[]),t.useEffect(()=>{j.current&&clearTimeout(j.current);const a=n.title.trim();if(!a||s&&a===s.title.trim()){y(""),B(!1);return}return B(!0),y(""),j.current=window.setTimeout(async()=>{try{const m=await $.collection("movies").where("title","==",a).get();let f=!1;m.empty||(s?m.forEach(D=>{D.id!==s.id&&(f=!0)}):f=!0),y(f?"تحذير: فيلم بنفس هذا العنوان موجود بالفعل.":"")}catch(m){console.error("Error checking for duplicate title:",m)}finally{B(!1)}},500),()=>{j.current&&clearTimeout(j.current)}},[n.title,s]);const c=a=>{const{name:m,value:f,type:D}=a.target;if(D==="checkbox"){const{checked:K}=a.target;g(te=>({...te,[m]:K}))}else g(K=>({...K,[m]:m==="year"||m==="imdbRating"?parseFloat(f):f}))},u=a=>{E(a.target.value)},p=a=>{g(m=>{const f=m.genres||[],D=f.includes(a)?f.filter(K=>K!==a):[...f,a];return{...m,genres:D}})},w=async()=>{const a=_.trim();if(a){if(r.some(m=>m.toLowerCase()===a.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}T(!0);try{await $.collection("categories").add({name:a}),g(m=>({...m,genres:[...m.genres||[],a]})),L("")}catch(m){console.error("Error adding new genre:",m),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{T(!1)}}},x=(a,m,f)=>{const D=[...n.servers];D[a]={...D[a],[m]:f},g(K=>({...K,servers:D}))},G=()=>{g(a=>{const m={name:`Server ${a.servers.length+1}`,url:"",quality:"720p"};return{...a,servers:[...a.servers,m]}})},S=a=>{g(m=>({...m,servers:m.servers.filter((f,D)=>D!==a)}))},O=(a,m,f)=>{const D=[...n.backupServers||[]];D[a]={...D[a],[m]:f},g(K=>({...K,backupServers:D}))},ee=()=>{g(a=>{var m;return{...a,backupServers:[...a.backupServers||[],{name:`Backup Server ${(((m=a.backupServers)==null?void 0:m.length)||0)+1}`,url:"",quality:"720p"}]}})},V=a=>{g(m=>({...m,backupServers:(m.backupServers||[]).filter((f,D)=>D!==a)}))},se=a=>{if(a.preventDefault(),n.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const m=v.split(",").map(f=>f.trim()).filter(f=>f!=="");h({...n,tags:m})},H=r.filter(a=>a.toLowerCase().includes(U.toLowerCase())),W="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",Y="bg-slate-600 text-white p-2 rounded-md border-2 border-slate-500 focus:border-cyan-500 outline-none focus:ring-2 focus:ring-cyan-500 transition";return e.jsxs("form",{onSubmit:se,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("input",{type:"text",name:"title",value:n.title,onChange:c,placeholder:"عنوان الفيلم",required:!0,className:W}),A&&e.jsx("p",{className:"text-xs text-slate-400 mt-1 animate-pulse",children:"جاري التحقق من العنوان..."}),z&&e.jsxs("p",{className:"text-sm text-yellow-400 mt-2 font-semibold flex items-center gap-2 animate-fade-in",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.636-1.21 2.37-1.21 3.006 0l5.485 10.47c.616 1.176-.24 2.62-1.503 2.62H4.275c-1.263 0-2.118-1.444-1.503-2.62l5.485-10.47zM9 9a1 1 0 011-1h0a1 1 0 011 1v3a1 1 0 01-2 0V9zm1 6a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})}),z]})]}),e.jsx("input",{type:"number",name:"year",value:n.year,onChange:c,placeholder:"سنة الإنتاج",required:!0,className:W})]}),e.jsx("textarea",{name:"description",value:n.description,onChange:c,placeholder:"وصف الفيلم",required:!0,className:`${W} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:n.posterUrl,onChange:c,placeholder:"رابط صورة البوستر",required:!0,className:W}),e.jsx("input",{type:"url",name:"backdropUrl",value:n.backdropUrl,onChange:c,placeholder:"رابط صورة الخلفية",required:!0,className:W})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdbRating",value:n.imdbRating||"",onChange:c,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:W}),e.jsx("input",{type:"url",name:"trailerUrl",value:n.trailerUrl??"",onChange:c,placeholder:"رابط المقطع الدعائي (اختياري)",className:W})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:v,onChange:u,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:W})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"isKurdish",type:"checkbox",name:"isKurdish",checked:!!n.isKurdish,onChange:c,className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("label",{htmlFor:"isKurdish",className:"text-white cursor-pointer",children:"هذا الفيلم مدبلج للكردية"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:C,children:[e.jsxs("button",{type:"button",onClick:()=>P(a=>!a),className:`${W} text-right flex justify-between items-center min-h-[52px]`,"aria-haspopup":"true","aria-expanded":F,children:[e.jsx("div",{className:"flex flex-wrap gap-1",children:n.genres.length>0?n.genres.map(a=>e.jsxs("span",{className:"bg-cyan-500 text-white text-xs font-semibold px-2 py-1 rounded-full flex items-center gap-1",children:[a,e.jsx("button",{type:"button",onClick:m=>{m.stopPropagation(),p(a)},className:"text-cyan-100 hover:text-white leading-none text-lg","aria-label":`إزالة ${a}`,children:"×"})]},a)):e.jsx("span",{className:"text-slate-400 px-1",children:"اختر الفئات..."})}),e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:`h-5 w-5 text-slate-400 transition-transform ${F?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),F&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg animate-fade-in-up-fast",children:[e.jsx("div",{className:"p-2",children:e.jsx("input",{type:"text",placeholder:"ابحث عن فئة...",value:U,onChange:a=>q(a.target.value),className:"w-full bg-slate-800 text-white p-2 rounded-md focus:ring-2 focus:ring-cyan-500 border border-slate-600 outline-none",autoFocus:!0})}),e.jsx("ul",{className:"max-h-60 overflow-y-auto p-1 scrollbar-thin scrollbar-thumb-slate-600 scrollbar-track-slate-800",children:H.length>0?H.map(a=>e.jsx("li",{children:e.jsxs("label",{className:"flex items-center gap-3 p-2 rounded-md hover:bg-slate-700 cursor-pointer transition-colors",children:[e.jsx("input",{type:"checkbox",checked:n.genres.includes(a),onChange:()=>p(a),className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("span",{className:"text-white select-none",children:a})]})},a)):e.jsx("li",{className:"text-slate-400 text-center p-4",children:"لا توجد نتائج"})}),e.jsx("div",{className:"border-t border-slate-700 p-2 mt-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"أو أضف فئة جديدة...",value:_,onChange:a=>L(a.target.value),onKeyDown:a=>{a.key==="Enter"&&(a.preventDefault(),w())},className:"flex-grow bg-slate-800 text-white p-2 text-sm rounded-md focus:ring-2 focus:ring-cyan-500 border border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:w,disabled:I||!_.trim(),className:"flex-shrink-0 bg-cyan-600 text-white px-3 py-1.5 text-sm font-bold rounded-md hover:bg-cyan-700 transition-colors disabled:bg-slate-500 disabled:cursor-not-allowed",children:I?"...":"إضافة"})]})})]})]})]}),e.jsx("input",{type:"url",name:"downloadUrl",value:n.downloadUrl??"",onChange:c,placeholder:"رابط التحميل (اختياري)",className:W}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات المشاهدة"}),n.servers.map((a,m)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-slate-700/50 rounded-md",children:[e.jsx("input",{type:"text",value:a.name,onChange:f=>x(m,"name",f.target.value),placeholder:"اسم السيرفر",className:`${Y} flex-1`}),e.jsx("input",{type:"url",value:a.url,onChange:f=>x(m,"url",f.target.value),placeholder:"رابط السيرفر",required:!0,className:`${Y} flex-grow-[2]`}),e.jsxs("select",{value:a.quality,onChange:f=>x(m,"quality",f.target.value),className:`${Y} flex-1 cursor-pointer`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>S(m),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},m)),e.jsx("button",{type:"button",onClick:G,className:"mt-2 bg-slate-600 text-white py-2 px-4 rounded-md hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-2",children:"سيرفرات احتياطية (اختياري)"}),(n.backupServers||[]).map((a,m)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2 p-2 bg-slate-700/50 rounded-md",children:[e.jsx("input",{type:"text",value:a.name,onChange:f=>O(m,"name",f.target.value),placeholder:"اسم السيرفر الاحتياطي",className:`${Y} flex-1`}),e.jsx("input",{type:"url",value:a.url,onChange:f=>O(m,"url",f.target.value),placeholder:"رابط السيرفر الاحتياطي",className:`${Y} flex-grow-[2]`}),e.jsxs("select",{value:a.quality,onChange:f=>O(m,"quality",f.target.value),className:`${Y} flex-1 cursor-pointer`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>V(m),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600",children:"X"})]},m)),e.jsx("button",{type:"button",onClick:ee,className:"mt-2 bg-slate-600 text-white py-2 px-4 rounded-md hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:d,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:b,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:b||!!z,children:[b&&e.jsx(fe,{}),b?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث":"إضافة"]})]})]})},je=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Z=({isOpen:h,onClose:s,onConfirm:d,title:o,message:b,isLoading:r=!1})=>{const[n,g]=t.useState(h);return t.useEffect(()=>{if(h)g(!0);else{const v=setTimeout(()=>g(!1),300);return()=>clearTimeout(v)}},[h]),n?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${h?"animate-fade-in":"animate-fade-out"}`,onClick:s,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:`relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md border border-slate-700 ${h?"animate-zoom-in":"animate-zoom-out"}`,onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:o}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:b})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:d,disabled:r,children:[r&&e.jsx(je,{}),r?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:s,disabled:r,children:"إلغاء"})]})]})}):null},we=10,xe=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((h,s)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},s))})}),e.jsx("tbody",{children:[...Array(we)].map((h,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((d,o)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},o))]},s))})]})})]}),he=({message:h,type:s,onClose:d})=>(t.useEffect(()=>{const r=setTimeout(d,5e3);return()=>clearTimeout(r)},[d]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:h}),e.jsx("button",{onClick:d,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),pe=({genres:h,onSubmit:s,onClose:d,isLoading:o})=>{const[b,r]=t.useState(h[0]||""),[n,g]=t.useState("add"),v=E=>{E.preventDefault(),b&&s(b,n)};return e.jsx(ae,{title:"تغيير الفئة بشكل جماعي",onClose:d,children:e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:b,onChange:E=>r(E.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:h.map(E=>e.jsx("option",{value:E,children:E},E))}),e.jsxs("select",{value:n,onChange:E=>g(E.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:d,disabled:o,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:o||!b,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[o&&e.jsx(de,{}),o?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Ne=({onSubmit:h,onClose:s,isLoading:d})=>{const[o,b]=t.useState(new Date().getFullYear()),r=n=>{n.preventDefault(),h(o)};return e.jsx(ae,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:s,children:e.jsxs("form",{onSubmit:r,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:o,onChange:n=>b(parseInt(n.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:d,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:d,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[d&&e.jsx(de,{}),d?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},ge=({onSubmit:h,onClose:s,isLoading:d})=>{const[o,b]=t.useState(""),[r,n]=t.useState("add"),g=v=>{v.preventDefault(),o.trim()&&h(o.trim(),r)};return e.jsx(ae,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:s,children:e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:o,onChange:v=>b(v.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:r,onChange:v=>n(v.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:d,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:d||!o.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[d&&e.jsx(de,{}),d?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},re=10,ve=()=>{const[h,s]=t.useState([]),[d,o]=t.useState(null),[b,r]=t.useState(!1),[n,g]=t.useState(1),[v,E]=t.useState("all"),[F,P]=t.useState(""),[U,q]=t.useState(!1),[_,L]=t.useState(null),[I,T]=t.useState(!0),[C,A]=t.useState(!1),[B,z]=t.useState(null),[y,j]=t.useState([]),[c,u]=t.useState(null),[p,w]=t.useState([]);t.useEffect(()=>{T(!0);const l=$.collection("movies").orderBy("createdAt","desc").onSnapshot(R=>{const X=R.docs.map(Q=>({id:Q.id,...Q.data()}));s(X),T(!1)},R=>{console.error("Error fetching movies: ",R),z({message:"فشل في تحميل الأفلام.",type:"error"}),T(!1)}),N=$.collection("categories").orderBy("name").onSnapshot(R=>{const X=R.docs.map(Q=>Q.data().name);w(X)},R=>{console.error("Error fetching categories from ManageMovies: ",R)});return()=>{l(),N()}},[]),t.useEffect(()=>{g(1),j([])},[v,F]);const x=(l,N)=>{z({message:l,type:N})},G=async l=>{A(!0);try{await $.collection("movies").add({...l,createdAt:me.now()}),r(!1),g(1),x("تمت إضافة الفيلم بنجاح.","success")}catch(N){console.error("Error adding movie: ",N),x("حدث خطأ أثناء إضافة الفيلم.","error")}finally{A(!1)}},S=async(l,N)=>{A(!0);try{await $.collection("movies").doc(l).update(N),o(null),r(!1),x("تم تحديث الفيلم بنجاح.","success")}catch(R){console.error("Error updating movie: ",R),x("حدث خطأ أثناء تحديث الفيلم.","error")}finally{A(!1)}},O=l=>{L(l),q(!0)},ee=async()=>{if(_){A(!0);try{await $.collection("movies").doc(_.id).delete(),x("تم حذف الفيلم بنجاح.","success")}catch(l){console.error("Error deleting movie: ",l),x("حدث خطأ أثناء حذف الفيلم.","error")}finally{q(!1),L(null),A(!1)}}},V=l=>{o(l),r(!0)},se=()=>{o(null),r(!0)},H=()=>{o(null),r(!1),u(null)},W=l=>{j(N=>N.includes(l)?N.filter(R=>R!==l):[...N,l])},Y=l=>{l.target.checked?j(i.map(N=>N.id)):j([])},a=async(l,N)=>{A(!0);try{const R=$.batch();y.forEach(X=>{const Q=$.collection("movies").doc(X);R.update(Q,l)}),await R.commit(),x(N,"success"),j([])}catch(R){console.error("Bulk update failed:",R),x("فشل التحديث الجماعي.","error")}finally{A(!1),u(null)}},m=async()=>{A(!0);try{const l=$.batch();y.forEach(N=>{const R=$.collection("movies").doc(N);l.delete(R)}),await l.commit(),x(`تم حذف ${y.length} فيلم بنجاح.`,"success"),j([])}catch(l){console.error("Bulk delete failed:",l),x("فشل الحذف الجماعي.","error")}finally{A(!1),u(null)}},f=async(l,N)=>{const R={genres:N==="add"?J.arrayUnion(l):J.arrayRemove(l)};await a(R,`تم ${N==="add"?"إضافة":"إزالة"} فئة "${l}" بنجاح.`)},D=async(l,N)=>{const R={tags:N==="add"?J.arrayUnion(l):J.arrayRemove(l)};await a(R,`تم ${N==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${l}" بنجاح.`)},K=h.filter(l=>v==="kurdish"?l.isKurdish===!0:v==="non-kurdish"?!l.isKurdish:!0).filter(l=>ue(F,l.title)),te=Math.ceil(K.length/re),i=K.slice((n-1)*re,n*re),k=l=>`px-4 py-2 text-sm font-bold rounded-lg transition-colors duration-200 ${v===l?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-md":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,M=i.length>0&&y.length===i.length;return I?e.jsx(xe,{}):e.jsxs("div",{className:"relative",children:[B&&e.jsx(he,{...B,onClose:()=>z(null)}),e.jsx(Z,{isOpen:U,onClose:()=>q(!1),onConfirm:ee,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',_==null?void 0:_.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:C}),c==="delete"&&e.jsx(Z,{isOpen:!0,onClose:()=>u(null),onConfirm:m,title:`تأكيد حذف ${y.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:C}),c==="genre"&&e.jsx(pe,{genres:p,onClose:H,onSubmit:f,isLoading:C}),c==="tags"&&e.jsx(ge,{onClose:H,onSubmit:D,isLoading:C}),c==="year"&&e.jsx(Ne,{onClose:H,onSubmit:l=>a({year:l},"تم تحديث السنة بنجاح."),isLoading:C}),c==="markKurdish"&&e.jsx(Z,{isOpen:!0,onClose:H,onConfirm:()=>a({isKurdish:!0},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد تحديد كل هذه الأفلام على أنها كردية؟",isLoading:C}),c==="unmarkKurdish"&&e.jsx(Z,{isOpen:!0,onClose:H,onConfirm:()=>a({isKurdish:!1},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد إزالة العلامة الكردية من كل هذه الأفلام؟",isLoading:C}),b&&e.jsx(ae,{title:d?"تعديل الفيلم":"إضافة فيلم جديد",onClose:H,children:e.jsx(ye,{onSubmit:d?l=>S(d.id,l):G,initialData:d,onCancel:H,isKurdishByDefault:v==="kurdish"&&!d,isLoading:C,allGenres:p})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:se,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:F,onChange:l=>P(l.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-slate-900/50 rounded-lg flex-shrink-0",children:[e.jsx("button",{onClick:()=>E("all"),className:k("all"),children:"الكل"}),e.jsx("button",{onClick:()=>E("kurdish"),className:k("kurdish"),children:"كردي فقط"}),e.jsx("button",{onClick:()=>E("non-kurdish"),className:k("non-kurdish"),children:"غير كردي"})]})]}),y.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[y.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>j([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>u("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>u("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>u("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>u("markKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تحديد ككردي"}),e.jsx("button",{onClick:()=>u("unmarkKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"إلغاء تحديد ككردي"}),e.jsx("button",{onClick:()=>u("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:Y,checked:M,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"مدبلج كردي"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:i.map(l=>{var N,R,X;return e.jsxs("tr",{className:`${y.includes(l.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:y.includes(l.id),onChange:()=>W(l.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:l.posterUrl,alt:l.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:l.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:l.imdbRating?l.imdbRating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:l.year}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(N=l.genres)==null?void 0:N.slice(0,3).map(Q=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:Q},Q)),((R=l.genres)==null?void 0:R.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:l.isKurdish?"نعم":"لا"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:(X=l.createdAt)!=null&&X.toDate?l.createdAt.toDate().toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>V(l),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>O(l),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},l.id)})})]})}),K.length>re&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ce,{currentPage:n,totalPages:te,onPageChange:g})})]})]})},Ce=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),ke=({onSubmit:h,initialData:s,onCancel:d,isLoading:o=!1,allGenres:b=[]})=>{const[r,n]=t.useState({title:"",description:"",posterUrl:"",backdropUrl:"",year:new Date().getFullYear(),genres:[],tags:[],seasons:[{seasonNumber:1,episodes:[{episodeNumber:1,title:"الحلقة 1",url:"",downloadUrl:""}]}],trailerUrl:"",imdbRating:0}),[g,v]=t.useState(""),[E,F]=t.useState(!1),P=t.useRef(null);t.useEffect(()=>{s&&(n({...s,genres:s.genres||[],tags:s.tags||[],seasons:s.seasons&&s.seasons.length>0?s.seasons:[{seasonNumber:1,episodes:[]}],trailerUrl:s.trailerUrl||"",imdbRating:s.imdbRating||0}),v((s.tags||[]).join(", ")))},[s]),t.useEffect(()=>{const c=u=>{P.current&&!P.current.contains(u.target)&&F(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[]);const U=c=>{const{name:u,value:p}=c.target;n(w=>({...w,[u]:u==="year"||u==="imdbRating"?parseFloat(p):p}))},q=c=>{v(c.target.value)},_=c=>{n(u=>({...u,genres:u.genres.includes(c)?u.genres.filter(p=>p!==c):[...u.genres,c]}))},L=(c,u,p)=>{const w=[...r.seasons];w[c][u]=p,n(x=>({...x,seasons:w}))},I=()=>{const c=r.seasons.length>0?Math.max(...r.seasons.map(u=>u.seasonNumber))+1:1;n(u=>({...u,seasons:[...u.seasons,{seasonNumber:c,episodes:[{episodeNumber:1,title:"الحلقة 1",url:"",downloadUrl:""}]}]}))},T=c=>{n(u=>({...u,seasons:u.seasons.filter((p,w)=>w!==c)}))},C=(c,u,p,w)=>{const x=[...r.seasons],G=[...x[c].episodes];G[u]={...G[u],[p]:w},x[c]={...x[c],episodes:G},n(S=>({...S,seasons:x}))},A=c=>{const u=r.seasons[c].episodes.length>0?Math.max(...r.seasons[c].episodes.map(w=>w.episodeNumber))+1:1,p=[...r.seasons];p[c].episodes.push({episodeNumber:u,title:`الحلقة ${u}`,url:"",downloadUrl:""}),n(w=>({...w,seasons:p}))},B=(c,u)=>{const p=[...r.seasons];p[c].episodes=p[c].episodes.filter((w,x)=>x!==u),n(w=>({...w,seasons:p}))},z=c=>{c.preventDefault();const u=g.split(",").map(p=>p.trim()).filter(Boolean);h({...r,tags:u})},y="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",j="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:r.title,onChange:U,placeholder:"عنوان المسلسل",required:!0,className:y}),e.jsx("input",{type:"number",name:"year",value:r.year,onChange:U,placeholder:"سنة الإنتاج",required:!0,className:y})]}),e.jsx("textarea",{name:"description",value:r.description,onChange:U,placeholder:"وصف المسلسل",required:!0,className:`${y} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"posterUrl",value:r.posterUrl,onChange:U,placeholder:"رابط صورة البوستر",required:!0,className:y}),e.jsx("input",{type:"url",name:"backdropUrl",value:r.backdropUrl,onChange:U,placeholder:"رابط صورة الخلفية",required:!0,className:y})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdbRating",value:r.imdbRating||"",onChange:U,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:y}),e.jsx("input",{type:"url",name:"trailerUrl",value:r.trailerUrl??"",onChange:U,placeholder:"رابط المقطع الدعائي (اختياري)",className:y})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات"}),e.jsxs("div",{className:"relative",ref:P,children:[e.jsx("button",{type:"button",onClick:()=>F(c=>!c),className:`${y} text-right`,children:r.genres.length>0?r.genres.join(", "):"اختر الفئات..."}),E&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:b.map(c=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.genres.includes(c),onChange:()=>_(c)}),e.jsx("span",{children:c})]},c))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (مفصولة بفاصلة)"}),e.jsx("input",{type:"text",value:g,onChange:q,placeholder:"أكشن, إثارة...",className:y})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),r.seasons.map((c,u)=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{children:"الموسم رقم:"}),e.jsx("input",{type:"number",value:c.seasonNumber,onChange:p=>L(u,"seasonNumber",parseInt(p.target.value)),className:`${j} w-20`})]}),e.jsx("button",{type:"button",onClick:()=>T(u),className:"bg-red-600 text-white px-3 py-1 rounded-md text-sm",children:"إزالة الموسم"})]}),e.jsxs("div",{className:"space-y-2 pl-4 border-r-2 border-slate-600",children:[e.jsx("h4",{className:"font-semibold text-slate-300",children:"الحلقات:"}),c.episodes.map((p,w)=>e.jsxs("div",{className:"bg-slate-800/60 p-2 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:p.episodeNumber,onChange:x=>C(u,w,"episodeNumber",parseInt(x.target.value)),placeholder:"رقم",className:`${j} w-16`}),e.jsx("input",{type:"text",value:p.title,onChange:x=>C(u,w,"title",x.target.value),placeholder:"عنوان الحلقة",className:`${j} flex-1`}),e.jsx("button",{type:"button",onClick:()=>B(u,w),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600 text-xs",children:"X"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:p.url,onChange:x=>C(u,w,"url",x.target.value),placeholder:"رابط المشاهدة",required:!0,className:`${j} flex-1`}),e.jsx("input",{type:"url",value:p.downloadUrl||"",onChange:x=>C(u,w,"downloadUrl",x.target.value),placeholder:"رابط التحميل (اختياري)",className:`${j} flex-1`})]})]},w)),e.jsx("button",{type:"button",onClick:()=>A(u),className:"text-sm bg-slate-600 text-white py-1 px-3 rounded-md hover:bg-slate-500",children:"إضافة حلقة"})]})]},u)),e.jsx("button",{type:"button",onClick:I,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700",children:"إضافة موسم"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:d,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg",disabled:o,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg",disabled:o,children:[o&&e.jsx(Ce,{}),s?"تحديث المسلسل":"إضافة المسلسل"]})]})]})},ne=10,Se=()=>{const[h,s]=t.useState([]),[d,o]=t.useState(null),[b,r]=t.useState(!1),[n,g]=t.useState(1),[v,E]=t.useState(""),[F,P]=t.useState(!1),[U,q]=t.useState(null),[_,L]=t.useState(!0),[I,T]=t.useState(!1),[C,A]=t.useState(null),[B,z]=t.useState([]),[y,j]=t.useState(null),[c,u]=t.useState([]);t.useEffect(()=>{L(!0);const i=$.collection("series").orderBy("createdAt","desc").onSnapshot(M=>{const l=M.docs.map(N=>({id:N.id,...N.data()}));s(l),L(!1)},M=>{console.error("Error fetching series: ",M),A({message:"فشل في تحميل المسلسلات.",type:"error"}),L(!1)}),k=$.collection("categories").orderBy("name").onSnapshot(M=>{const l=M.docs.map(N=>N.data().name);u(l)},M=>{console.error("Error fetching categories from ManageSeries: ",M)});return()=>{i(),k()}},[]),t.useEffect(()=>{g(1),z([])},[v]);const p=(i,k)=>{A({message:i,type:k})},w=async i=>{T(!0);try{await $.collection("series").add({...i,createdAt:me.now()}),r(!1),g(1),p("تمت إضافة المسلسل بنجاح.","success")}catch(k){console.error("Error adding series: ",k),p("حدث خطأ أثناء إضافة المسلسل.","error")}finally{T(!1)}},x=async(i,k)=>{T(!0);try{await $.collection("series").doc(i).update(k),o(null),r(!1),p("تم تحديث المسلسل بنجاح.","success")}catch(M){console.error("Error updating series: ",M),p("حدث خطأ أثناء تحديث المسلسل.","error")}finally{T(!1)}},G=i=>{q(i),P(!0)},S=async()=>{if(U){T(!0);try{await $.collection("series").doc(U.id).delete(),p("تم حذف المسلسل بنجاح.","success")}catch(i){console.error("Error deleting series: ",i),p("حدث خطأ أثناء حذف المسلسل.","error")}finally{P(!1),q(null),T(!1)}}},O=i=>{o(i),r(!0)},ee=()=>{o(null),r(!0)},V=()=>{o(null),r(!1),j(null)},se=i=>{z(k=>k.includes(i)?k.filter(M=>M!==i):[...k,i])},H=i=>{i.target.checked?z(K.map(k=>k.id)):z([])},W=async()=>{T(!0);try{const i=$.batch();B.forEach(k=>{const M=$.collection("series").doc(k);i.delete(M)}),await i.commit(),p(`تم حذف ${B.length} مسلسل بنجاح.`,"success"),z([])}catch(i){console.error("Bulk delete failed:",i),p("فشل الحذف الجماعي.","error")}finally{T(!1),j(null)}},Y=async(i,k)=>{const M={genres:k==="add"?J.arrayUnion(i):J.arrayRemove(i)};await m(M,`تم ${k==="add"?"إضافة":"إزالة"} فئة "${i}" بنجاح.`)},a=async(i,k)=>{const M={tags:k==="add"?J.arrayUnion(i):J.arrayRemove(i)};await m(M,`تم ${k==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${i}" بنجاح.`)},m=async(i,k)=>{T(!0);try{const M=$.batch();B.forEach(l=>{const N=$.collection("series").doc(l);M.update(N,i)}),await M.commit(),p(k,"success"),z([])}catch(M){console.error("Bulk update failed:",M),p("فشل التحديث الجماعي.","error")}finally{T(!1),j(null)}},f=h.filter(i=>ue(v,i.title)),D=Math.ceil(f.length/ne),K=f.slice((n-1)*ne,n*ne),te=K.length>0&&B.length===K.length;return _?e.jsx(xe,{}):e.jsxs("div",{className:"relative",children:[C&&e.jsx(he,{...C,onClose:()=>A(null)}),e.jsx(Z,{isOpen:F,onClose:()=>P(!1),onConfirm:S,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',U==null?void 0:U.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:I}),y==="delete"&&e.jsx(Z,{isOpen:!0,onClose:()=>j(null),onConfirm:W,title:`تأكيد حذف ${B.length} مسلسل`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:I}),y==="genre"&&e.jsx(pe,{genres:c,onClose:V,onSubmit:Y,isLoading:I}),y==="tags"&&e.jsx(ge,{onClose:V,onSubmit:a,isLoading:I}),b&&e.jsx(ae,{title:d?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:V,children:e.jsx(ke,{onSubmit:d?i=>x(d.id,i):w,initialData:d,onCancel:V,isLoading:I,allGenres:c})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:ee,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsx("div",{className:"relative w-full sm:flex-grow",children:e.jsx("input",{type:"text",value:v,onChange:i=>E(i.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-4 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a series to edit"})})]}),B.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("span",{className:"text-white font-bold",children:[B.length," مسلسل محدد"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>j("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>j("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>j("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:H,checked:te})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:K.map(i=>{var k,M;return e.jsxs("tr",{className:`${B.includes(i.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"}`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:B.includes(i.id),onChange:()=>se(i.id)})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("img",{src:i.posterUrl,alt:i.title,className:"h-20 w-auto rounded"})}),e.jsx("td",{className:"px-4 py-2 font-medium text-white",children:i.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:i.imdbRating?i.imdbRating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:i.year}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:((k=i.seasons)==null?void 0:k.length)||0}),e.jsx("td",{className:"px-4 py-2 text-slate-300",children:(M=i.createdAt)!=null&&M.toDate?i.createdAt.toDate().toLocaleDateString("ar-EG"):"N/A"}),e.jsxs("td",{className:"px-4 py-2 font-medium",children:[e.jsx("button",{onClick:()=>O(i),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>G(i),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},i.id)})})]})}),f.length>ne&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ce,{currentPage:n,totalPages:D,onPageChange:g})})]})]})},Ee=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsx("div",{className:"p-4 bg-gray-900",children:e.jsx("div",{className:"h-6 bg-gray-600 rounded w-1/3"})}),e.jsx("div",{className:"divide-y divide-gray-700",children:[...Array(5)].map((h,s)=>e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"}),e.jsx("div",{className:"h-8 bg-gray-600 rounded w-20"})]},s))})]}),Ae="yO8pzykKincc5zgbdJGdN6xISr03",le=10,Me=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),$e=({message:h,type:s,onClose:d})=>(t.useEffect(()=>{const r=setTimeout(d,5e3);return()=>clearTimeout(r)},[d]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:h}),e.jsx("button",{onClick:d,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Ue=({children:h,onClose:s,title:d,isOpen:o})=>{const[b,r]=t.useState(o);return t.useEffect(()=>{if(o){r(!0),document.body.style.overflow="hidden";const n=g=>{g.key==="Escape"&&s()};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}}else{const n=setTimeout(()=>{r(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(n)}},[o,s]),b?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${o?"animate-fade-in":"animate-fade-out"}`,onClick:s,children:e.jsxs("div",{className:`bg-slate-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-slate-700 ${o?"animate-zoom-in":"animate-zoom-out"}`,onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:d}),e.jsx("button",{onClick:s,className:"text-slate-400 hover:text-white text-3xl transition-colors",children:"×"})]}),h]})}):null},Re=()=>{const{currentUser:h}=be(),[s,d]=t.useState([]),[o,b]=t.useState(""),[r,n]=t.useState(""),[g,v]=t.useState(""),[E,F]=t.useState(!0),[P,U]=t.useState(!1),[q,_]=t.useState(1),[L,I]=t.useState(!1),[T,C]=t.useState(!1),[A,B]=t.useState(null),[z,y]=t.useState(null),j=(h==null?void 0:h.uid)===Ae;t.useEffect(()=>{if(!j){F(!1);return}F(!0);const S=$.collection("admins").onSnapshot(O=>{const ee=O.docs.map(V=>({id:V.id,uid:V.data().uid,email:V.data().email}));d(ee),F(!1)},O=>{console.error(O),c("فشل في تحميل قائمة المشرفين.","error"),F(!1)});return()=>S()},[j]);const c=(S,O)=>{y({message:S,type:O})},u=async S=>{if(S.preventDefault(),v(""),!o.trim()||!r.trim()){v("الرجاء إدخال UID وبريد إلكتروني صالحين.");return}U(!0);try{await $.collection("admins").doc(o).set({uid:o,email:r}),c(`تمت إضافة المشرف ${r} بنجاح.`,"success"),I(!1),b(""),n("")}catch(O){console.error("Error adding admin:",O),c("فشل في إضافة المشرف.","error")}finally{U(!1)}},p=S=>{B(S),C(!0)},w=async()=>{if(A){U(!0);try{await $.collection("admins").doc(A.id).delete(),c(`تم حذف المشرف ${A.email} بنجاح.`,"success")}catch(S){console.error(S),c("حدث خطأ أثناء حذف المشرف.","error")}finally{C(!1),B(null),U(!1)}}};if(!j)return e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"إدارة المشرفين"}),e.jsx("p",{className:"text-yellow-300",children:"هذه الصفحة متاحة فقط للمشرف الأساسي."})]});const x=Math.ceil(s.length/le),G=s.slice((q-1)*le,q*le);return e.jsxs(e.Fragment,{children:[z&&e.jsx($e,{...z,onClose:()=>y(null)}),e.jsx(Z,{isOpen:T,onClose:()=>C(!1),onConfirm:w,title:"تأكيد حذف المشرف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المشرف ",e.jsxs("strong",{className:"text-white",children:['"',A==null?void 0:A.email,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"سيؤدي هذا إلى إزالة صلاحيات المشرف الخاصة به."})]}),isLoading:P}),e.jsx(Ue,{isOpen:L,title:"إضافة مشرف جديد",onClose:()=>I(!1),children:e.jsxs("form",{onSubmit:u,className:"flex flex-col gap-4",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"لإضافة مشرف جديد، يجب عليك الحصول على **معرّف المستخدم (UID)** الخاص به من لوحة تحكم Firebase Authentication."}),e.jsx("input",{type:"text",value:o,onChange:S=>b(S.target.value),placeholder:"معرّف المستخدم (UID)",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),e.jsx("input",{type:"email",value:r,onChange:S=>n(S.target.value),placeholder:"البريد الإلكتروني للمشرف",required:!0,className:"flex-grow bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none"}),g&&e.jsx("p",{className:"text-red-500 text-center text-sm",children:g}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:()=>I(!1),className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:P,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:P,children:[P&&e.jsx(Me,{}),P?"جاري الإضافة...":"إضافة مشرف"]})]})]})}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"المشرفون الحاليون"}),e.jsx("button",{onClick:()=>I(!0),className:"bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة مشرف جديد"})]}),E?e.jsx(Ee,{}):e.jsxs("div",{className:"overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-slate-900/50 flex items-center justify-between",children:[e.jsxs("span",{className:"text-white font-bold",children:[h.email," (المشرف الأساسي)"]}),e.jsx("span",{className:"text-sm text-slate-500",children:"لا يمكن حذفه"})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:G.map(S=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-slate-700/50",children:[e.jsx("span",{className:"text-white",children:S.email}),e.jsx("button",{onClick:()=>p(S),className:"bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700 transition-colors",children:"حذف"})]},S.id))}),s.length>le&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ce,{currentPage:q,totalPages:x,onPageChange:_})})]})]})]})},Te=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Fe=({onSubmit:h,initialData:s,onCancel:d,isLoading:o=!1})=>{const[b,r]=t.useState("");t.useEffect(()=>{r(s?s.name:"")},[s]);const n=g=>{g.preventDefault(),b.trim()&&h({name:b})};return e.jsxs("form",{onSubmit:n,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:b,onChange:g=>r(g.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:d,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:o,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:o,children:[o&&e.jsx(Te,{}),o?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث":"إضافة"]})]})]})},Be=10,Pe=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(Be)].map((h,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},s))})]})})}),oe=10,ze=({message:h,type:s,onClose:d})=>(t.useEffect(()=>{const r=setTimeout(d,5e3);return()=>clearTimeout(r)},[d]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:h}),e.jsx("button",{onClick:d,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Ge=({children:h,onClose:s,title:d,isOpen:o})=>{const[b,r]=t.useState(o);return t.useEffect(()=>{if(o){r(!0),document.body.style.overflow="hidden";const n=g=>{g.key==="Escape"&&s()};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}}else{const n=setTimeout(()=>{r(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(n)}},[o,s]),b?e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 ${o?"animate-fade-in":"animate-fade-out"}`,onClick:s,children:e.jsxs("div",{className:`bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700 ${o?"animate-zoom-in":"animate-zoom-out"}`,onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:d}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),h]})}):null},De=()=>{const[h,s]=t.useState([]),[d,o]=t.useState(null),[b,r]=t.useState(!1),[n,g]=t.useState(1),[v,E]=t.useState(!1),[F,P]=t.useState(null),[U,q]=t.useState(!0),[_,L]=t.useState(!1),[I,T]=t.useState(null);t.useEffect(()=>{q(!0);const x=$.collection("categories").orderBy("name").onSnapshot(G=>{const S=G.docs.map(O=>({id:O.id,...O.data()}));s(S),q(!1)},G=>{console.error("Error fetching categories: ",G),C("فشل في تحميل الفئات.","error"),q(!1)});return()=>x()},[]);const C=(x,G)=>{T({message:x,type:G})},A=async x=>{L(!0);try{await $.collection("categories").add(x),C("تمت إضافة الفئة بنجاح!","success"),r(!1),g(1)}catch(G){console.error("Error adding category: ",G),C("حدث خطأ أثناء إضافة الفئة.","error")}finally{L(!1)}},B=async(x,G)=>{L(!0);try{await $.collection("categories").doc(x).update(G),C("تم تحديث الفئة بنجاح!","success"),o(null),r(!1)}catch(S){console.error("Error updating category: ",S),C("حدث خطأ أثناء تحديث الفئة.","error")}finally{L(!1)}},z=x=>{P(x),E(!0)},y=async()=>{if(F){L(!0);try{await $.collection("categories").doc(F.id).delete(),C("تم حذف الفئة بنجاح!","success")}catch(x){console.error("Error deleting category: ",x),C("حدث خطأ أثناء حذف الفئة.","error")}finally{E(!1),P(null),L(!1)}}},j=x=>{o(x),r(!0)},c=()=>{o(null),r(!0)},u=()=>{o(null),r(!1)},p=Math.ceil(h.length/oe),w=h.slice((n-1)*oe,n*oe);return U?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(Pe,{})]}):e.jsxs("div",{children:[I&&e.jsx(ze,{...I,onClose:()=>T(null)}),e.jsx(Z,{isOpen:v,onClose:()=>E(!1),onConfirm:y,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',F==null?void 0:F.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:_}),e.jsx(Ge,{isOpen:b,title:d?"تعديل الفئة":"إضافة فئة جديدة",onClose:u,children:e.jsx(Fe,{onSubmit:d?x=>B(d.id,x):A,initialData:d,onCancel:u,isLoading:_})}),e.jsx("button",{onClick:c,className:"mb-6 bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:h.length>0?w.map(x=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:x.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>j(x),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>z(x),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},x.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})}),h.length>oe&&e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx(ce,{currentPage:n,totalPages:p,onPageChange:g})})]})]})},ie=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(ve,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx(Se,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(De,{})},{key:"admins",label:"إدارة المشرفين",component:e.jsx(Re,{})}],Le=({label:h,tabKey:s,activeTab:d,onClick:o})=>e.jsx("button",{onClick:()=>o(s),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px ${d===s?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":d===s,children:h}),Oe=()=>{var o;const[h,s]=t.useState(ie[0].key),d=(o=ie.find(b=>b.key===h))==null?void 0:o.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8 animate-fade-in",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6",role:"tablist",children:ie.map(b=>e.jsx(Le,{label:b.label,tabKey:b.key,activeTab:h,onClick:s},b.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-6 rounded-lg border border-slate-700",children:d})]})};export{Oe as default};
