import{r as i,b as y,j as e,L as S,d as w}from"./index-BFnxVxci.js";import{a as L}from"./MovieCardSkeleton-Dkd7B8hp.js";import{M as N,a as E}from"./MovieGridSkeleton-BvJcA7Af.js";import{P as k}from"./Pagination-D1Er8nK_.js";const l=28,U=()=>{const[s,h]=i.useState([]),[P,d]=i.useState(!0),{watchLater:c}=L(),[m,v]=y(),r=Number(m.get("page")||"1");i.useEffect(()=>{(async()=>{if(c.length===0){h([]),d(!1);return}d(!0);try{const f=[];for(let t=0;t<c.length;t+=30)f.push(c.slice(t,t+30));const j=f.map(t=>w.collection("movies").where(window.firebase.firestore.FieldPath.documentId(),"in",t).get()),u=(await Promise.all(j)).flatMap(t=>t.docs.map(n=>({id:n.id,...n.data()})));u.sort((t,n)=>{var p,b;return(p=t.createdAt)!=null&&p.toMillis&&((b=n.createdAt)!=null&&b.toMillis)?n.createdAt.toMillis()-t.createdAt.toMillis():0}),h(u)}catch(o){console.error("Error fetching watch later movies: ",o),h([])}finally{d(!1)}})()},[c]);const g=a=>{const o=new URLSearchParams(m);o.set("page",String(a)),v(o,{replace:!0})};i.useEffect(()=>{const a=Math.ceil(s.length/l);r>a&&a>0&&g(a)},[r,s.length]);const x=Math.ceil(s.length/l),M=s.slice((r-1)*l,r*l);return P?e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8 border-r-4 border-cyan-400 pr-4",children:"قائمة المشاهدة لاحقاً"}),e.jsx(N,{count:18})]}):e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8 border-r-4 border-cyan-400 pr-4",children:"قائمة المشاهدة لاحقاً"}),s.length>0?e.jsxs(e.Fragment,{children:[e.jsx(E,{movies:M}),x>1&&e.jsx(k,{currentPage:r,totalPages:x,onPageChange:g})]}):e.jsxs("div",{className:"text-center p-12 bg-gray-800/50 rounded-lg mt-8",children:[e.jsx("p",{className:"text-2xl text-gray-300 mb-4",children:"قائمة المشاهدة لاحقاً فارغة."}),e.jsx("p",{className:"text-gray-400 mb-6",children:"أضف أفلامًا لمشاهدتها لاحقًا بالنقر على أيقونة الإشارة المرجعية."}),e.jsx(S,{to:"/",className:"inline-block bg-cyan-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-cyan-600 transition-colors",children:"تصفح الأفلام"})]})]})};export{U as default};
