import{j as s,r as a,a as I,s as i,f as O}from"./index-CL-q6RGU.js";import{H as B,a as Q}from"./HeroSliderSkeleton-sRfN2xHi.js";import{S as U,G as V,T as W,Y as J}from"./TagFilter-D2XMgSLW.js";import{M as X}from"./MovieGrid-C_fVj6PY.js";import{M as Z}from"./MovieGridSkeleton-7AD7b2ma.js";import{P as $}from"./Pagination-DYl-LlXA.js";import"./MovieCardSkeleton-kFkFKOJk.js";import"./useWatchLater-_Cqq97Lr.js";const ee=({searchQuery:o,onSearchChange:h})=>s.jsxs("div",{className:"relative w-full md:w-auto md:flex-grow",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),s.jsx("input",{type:"text",value:o,onChange:x=>h(x.target.value),placeholder:"ابحث عن فيلم...",className:"w-full bg-gray-700 text-white p-2 pl-10 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none","aria-label":"Search for movies by title"})]}),v=30,ce=()=>{const[o,h]=a.useState([]),[x,S]=a.useState([]),[k,j]=a.useState(!0),[w,y]=a.useState(null),[l,E]=a.useState("all"),[c,_]=a.useState([]),[d,C]=a.useState([]),[u,G]=a.useState("createdAt_desc"),[g,A]=a.useState(""),[p,N]=I(),T=a.useRef(!0),f=parseInt(p.get("page")||"1",10),M=a.useCallback(e=>{const t=new URLSearchParams(p);e<=1?t.delete("page"):t.set("page",e.toString()),N(t,{replace:!0}),window.scrollTo(0,0)},[p,N]);a.useEffect(()=>{(async()=>{j(!0);const{data:r,error:n}=await i.from("movies").select("*").eq("is_kurdish",!0).order("created_at",{ascending:!1});n?(console.error("Error fetching Kurdish movies: ",n.message),y("فشل تحميل الأفلام الكردية. تأكد من أن جدول 'movies' موجود وأن سياسات RLS تسمح بالوصول للقراءة.")):h(r),j(!1)})();const t=i.channel("public:movies:kurdish").on("postgres_changes",{event:"*",schema:"public",table:"movies",filter:"is_kurdish=eq.true"},()=>{i.from("movies").select("*").eq("is_kurdish",!0).order("created_at",{ascending:!1}).then(({data:r,error:n})=>{n?console.error("Error refetching Kurdish movies on subscription:",n.message):r&&h(r)})}).subscribe();return()=>{i.removeChannel(t)}},[]),a.useEffect(()=>{(async()=>{const{data:r,error:n}=await i.from("categories").select("name").order("name");n?(console.error("Error fetching categories: ",n.message),y(m=>(m?m+`
`:"")+"فشل تحميل الفئات.")):S(r.map(m=>m.name))})();const t=i.channel("public:categories:kurdish").on("postgres_changes",{event:"*",schema:"public",table:"categories"},()=>{i.from("categories").select("name").order("name").then(({data:r,error:n})=>{n?console.error("Error refetching categories on subscription:",n.message):r&&S(r.map(m=>m.name))})}).subscribe();return()=>{i.removeChannel(t)}},[]);const F=e=>{_(t=>t.includes(e)?t.filter(r=>r!==e):[...t,e])},L=()=>{_([])},R=e=>{C(t=>t.includes(e)?t.filter(r=>r!==e):[...t,e])},Y=()=>{C([])},D=[...new Set(o.map(e=>e.year))].sort((e,t)=>t-e),K=x,z=[...new Set(o.flatMap(e=>e.tags||[]))].sort(),b=a.useMemo(()=>o.filter(e=>l==="all"||e.year.toString()===l).filter(e=>c.length===0?!0:c.some(t=>{var r;return(r=e.genres)==null?void 0:r.includes(t)})).filter(e=>d.length===0?!0:d.some(t=>{var r;return(r=e.tags)==null?void 0:r.includes(t)})).filter(e=>O(g,e.title)).sort((e,t)=>{switch(u){case"rating_desc":return(t.imdb_rating||0)-(e.imdb_rating||0);case"rating_asc":return(e.imdb_rating||0)-(t.imdb_rating||0);case"year_desc":return t.year-e.year;case"year_asc":return e.year-t.year;case"createdAt_asc":return new Date(e.created_at).getTime()-new Date(t.created_at).getTime();case"createdAt_desc":default:return new Date(t.created_at).getTime()-new Date(e.created_at).getTime()}}),[o,l,c,d,g,u]);a.useEffect(()=>{if(T.current){T.current=!1;return}f!==1&&M(1)},[l,c,d,g,u]);const P=Math.ceil(b.length/v),q=b.slice((f-1)*v,f*v),H=g!==""||l!=="all"||c.length>0||d.length>0||u!=="createdAt_desc";return k?s.jsxs("div",{children:[s.jsx(B,{}),s.jsx("div",{className:"my-8 h-20 bg-gray-800/50 rounded-lg animate-pulse"}),s.jsxs("section",{className:"mb-12",children:[s.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"الأفلام المدبلجة للكردية"}),s.jsx(Z,{count:18})]})]}):w&&o.length===0?s.jsxs("div",{className:"text-center p-8 bg-red-900/20 border border-red-500/50 rounded-lg mt-8 animate-fade-in",children:[s.jsx("h2",{className:"text-2xl text-red-400 mb-4",children:"حدث خطأ في الاتصال بقاعدة البيانات"}),s.jsx("p",{className:"text-slate-300 whitespace-pre-line",children:w}),s.jsx("p",{className:"text-slate-400 mt-4",children:"Please check your Supabase dashboard to ensure the 'movies' and 'categories' tables are readable by anonymous users via RLS policies."})]}):s.jsxs("div",{className:"animate-fade-in",children:[s.jsx(Q,{movies:o.slice(0,5)}),s.jsxs("div",{className:"relative z-30 my-8 flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl",children:[s.jsx(ee,{searchQuery:g,onSearchChange:A}),s.jsxs("div",{className:"w-full md:w-auto flex flex-col md:flex-row md:flex-wrap justify-center items-center gap-4",children:[s.jsx(U,{sortOrder:u,onSortChange:G}),s.jsx(V,{genres:K,selectedGenres:c,onToggleGenre:F,onClearGenres:L}),s.jsx(W,{tags:z,selectedTags:d,onToggleTag:R,onClearTags:Y}),s.jsx(J,{years:D,selectedYear:l,onYearChange:E})]})]}),s.jsxs("section",{className:"mb-12",children:[s.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:H?"نتائج البحث":"الأفلام المدبلجة للكردية"}),b.length>0?s.jsxs(s.Fragment,{children:[s.jsx(X,{movies:q}),P>1&&s.jsx($,{currentPage:f,totalPages:P,onPageChange:M})]}):s.jsx("div",{className:"text-center p-8 bg-gray-800 rounded-lg mt-8",children:s.jsx("p",{className:"text-xl text-gray-400",children:"لا توجد أفلام مدبلجة للكردية تطابق معايير البحث."})})]})]})};export{ce as default};
