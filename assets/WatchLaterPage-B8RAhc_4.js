import{r,a as B,j as e,s as T,L as U}from"./index-7uJ0qKqD.js";import{a as z}from"./useWatchLater-B27ka-37.js";import{a as D,R as H}from"./ResumeFromModal-XZE8XZ6D.js";import{M as J}from"./MovieGridSkeleton-DW-WaVP_.js";import{M as K}from"./MovieGrid-DoFVm-rM.js";import{S as Q}from"./SeriesGrid-BuAcxdhR.js";import{P as V}from"./Pagination-BK7uePpH.js";import"./MovieCardSkeleton--xuy0sGE.js";import"./SpinnerIcon-DP9Pwg2V.js";const j=30,oe=()=>{const[S,v]=r.useState([]),[L,k]=r.useState(0),[N,h]=r.useState(!0),{watchLater:l}=z(),{watchLaterSeries:d,addWatchLaterSeries:W,removeWatchLaterSeries:C,isWatchLaterSeries:E,loading:I}=D(),x=r.useMemo(()=>d.map(s=>s.seriesId),[d]),[a,R]=r.useState("movies"),[m,b]=r.useState(null),[g,w]=B(),u=parseInt(g.get("page")||"1",10),M=r.useCallback(s=>{const t=new URLSearchParams(g);s<=1?t.delete("page"):t.set("page",s.toString()),w(t,{replace:!0}),window.scrollTo(0,0)},[g,w]);r.useEffect(()=>{u!==1&&M(1)},[a]),r.useEffect(()=>{(async()=>{h(!0);const t=(u-1)*j,o=t+j-1;let n,i=[],c="";switch(a){case"movies":case"kurdish":c="movies",i=l,n=T.from(c).select("*",{count:"exact"}).in("id",i).eq("is_kurdish",a==="kurdish");break;case"series":c="series",i=x,n=T.from(c).select("*",{count:"exact"}).in("id",i);break}if(!n||i.length===0){v([]),k(0),h(!1);return}const q=a==="series"?{foreignTable:"user_lists",ascending:!1}:{ascending:!1},{data:A,error:y,count:O}=await n.order("created_at",q).range(t,o);y?console.error(`Error fetching watch later ${c}:`,y):(v(A||[]),k(O||0)),h(!1)})()},[l,x,a,u]);const _=s=>{E(s.id)?C(s.id):b(s)},F=(s,t)=>{m&&W(m.id,s,t),b(null)},G=r.useMemo(()=>new Map(d.map(s=>[s.seriesId,{season:s.season,episode:s.episode}])),[d]),P=Math.ceil(L/j),f=({tab:s,label:t,count:o})=>e.jsxs("button",{onClick:()=>R(s),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px flex items-center gap-2 ${a===s?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":a===s,children:[t,e.jsx("span",{className:`text-xs font-mono px-2 py-0.5 rounded-full ${a===s?"bg-cyan-500/20 text-cyan-300":"bg-slate-700 text-slate-300"}`,children:o})]}),p=({message:s,subMessage:t,buttonText:o,link:n})=>e.jsxs("div",{className:"text-center p-12 bg-slate-800/50 rounded-lg mt-8",children:[e.jsx("p",{className:"text-2xl text-slate-300 mb-4",children:s}),e.jsx("p",{className:"text-slate-400 mb-6",children:t}),e.jsx(U,{to:n,className:"inline-block bg-cyan-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-cyan-600 transition-colors",children:o})]}),$=()=>{if(L>0)return e.jsxs(e.Fragment,{children:[a==="series"?e.jsx(Q,{series:S,onToggleWatchLater:_,watchLaterInfoMap:G}):e.jsx(K,{movies:S}),P>1&&e.jsx(V,{currentPage:u,totalPages:P,onPageChange:M})]});switch(a){case"movies":return e.jsx(p,{message:"قائمة أفلامك فارغة.",subMessage:"أضف أفلامًا لمشاهدتها لاحقًا بالنقر على أيقونة الإشارة المرجعية.",buttonText:"تصفح الأفلام",link:"/"});case"kurdish":return e.jsx(p,{message:"قائمة الأفلام الكردية فارغة.",subMessage:"أضف أفلامًا كردية لمشاهدتها لاحقًا.",buttonText:"تصفح الأفلام الكردية",link:"/kurdish"});case"series":return e.jsx(p,{message:"قائمة مسلسلاتك فارغة.",subMessage:"أضف مسلسلات لمشاهدتها لاحقًا بالنقر على أيقونة الإشارة المرجعية.",buttonText:"تصفح المسلسلات",link:"/series"});default:return null}};return e.jsxs("div",{className:"animate-fade-in",children:[e.jsx(H,{isOpen:!!m,onClose:()=>b(null),series:m,onSave:F,isSaving:I}),e.jsx("h1",{className:"text-4xl font-black text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"قائمة المشاهدة لاحقاً"}),e.jsxs("div",{className:"flex border-b border-slate-700 mb-8",role:"tablist",children:[e.jsx(f,{tab:"movies",label:"أفلام",count:l.length}),e.jsx(f,{tab:"kurdish",label:"كردي",count:l.length}),e.jsx(f,{tab:"series",label:"مسلسلات",count:x.length})]}),N?e.jsx(J,{count:12}):e.jsx("div",{role:"tabpanel",className:"animate-fade-in",children:$()})]})};export{oe as default};
