import{r as a,j as e,s as _,f as be}from"./index-C9chdg0D.js";import{P as ge}from"./Pagination-BXWtZ7o9.js";import{F as oe,S as le}from"./SpinnerIcon-BNFkSkfI.js";const ve=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Ne=({onSubmit:l,initialData:s,onCancel:p,isKurdishByDefault:u=!1,isLoading:j=!1,allGenres:o=[]})=>{const[r,f]=a.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"1080p"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:!1,imdb_rating:void 0}),[w,B]=a.useState(""),[U,V]=a.useState(!1),[z,M]=a.useState(""),[C,A]=a.useState(""),[T,N]=a.useState(!1),E=a.useRef(null);a.useEffect(()=>{s?(f({title:s.title||"",description:s.description||"",poster_url:s.poster_url||"",backdrop_url:s.backdrop_url||"",year:s.year||new Date().getFullYear(),genres:s.genres||[],tags:s.tags||[],servers:s.servers&&s.servers.length>0?s.servers:[{name:"Server 1",url:"",quality:"1080p"}],backup_servers:s.backup_servers||[],download_url:s.download_url||"",trailer_url:s.trailer_url||"",is_kurdish:s.is_kurdish||!1,imdb_rating:s.imdb_rating}),B((s.tags||[]).join(", "))):(f({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],servers:[{name:"Server 1",url:"https://vidtube.pro/embed-1y2lihgthstv.html",quality:"1080p"}],backup_servers:[],download_url:"",trailer_url:"",is_kurdish:u,imdb_rating:void 0}),B(""))},[s,u]),a.useEffect(()=>{const n=h=>{E.current&&!E.current.contains(h.target)&&V(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[]),a.useEffect(()=>{const n=r.download_url;if(n&&n.includes("vidtube.pro/d/")){const h=n.replace("/d/","/embed-");r.servers.length>0&&r.servers[0].url!==h&&f(y=>{const F=[...y.servers];return F[0]={...F[0],url:h},{...y,servers:F}})}},[r.download_url,r.servers]),a.useEffect(()=>{if(!s){const n=r.title.match(/\b(19[89]\d|20\d{2})\b/);if(n&&n[0]){const h=parseInt(n[0],10);f(y=>({...y,year:h}))}}},[r.title,s]),a.useEffect(()=>{!s&&!r.backdrop_url.trim()&&f(n=>({...n,backdrop_url:n.poster_url}))},[r.poster_url,s,r.backdrop_url]);const b=n=>{const{name:h,value:y,type:F}=n.target;if(F==="checkbox"){const{checked:D}=n.target;f(K=>({...K,[h]:D}))}else if(h==="year"){const D=parseInt(y,10);f(K=>({...K,[h]:isNaN(D)?0:D}))}else if(h==="imdb_rating"){const D=parseFloat(y);f(K=>({...K,imdb_rating:isNaN(D)?void 0:D}))}else f(D=>({...D,[h]:y}))},G=n=>{B(n.target.value)},I=n=>{f(h=>{const y=h.genres||[],F=y.includes(n)?y.filter(D=>D!==n):[...y,n];return{...h,genres:F}})},q=async()=>{const n=C.trim();if(n){if(o.some(h=>h.toLowerCase()===n.toLowerCase())){alert("هذه الفئة موجودة بالفعل.");return}N(!0);try{const{error:h}=await _.from("categories").insert({name:n});if(h)throw h;f(y=>({...y,genres:[...y.genres||[],n]})),A("")}catch(h){console.error("Error adding new genre:",h),alert("حدث خطأ أثناء إضافة الفئة الجديدة.")}finally{N(!1)}}},v=(n,h,y)=>{const F=[...r.servers];F[n]={...F[n],[h]:y},f(D=>({...D,servers:F}))},x=()=>{f(n=>{const h={name:`Server ${n.servers.length+1}`,url:"",quality:"1080p"};return{...n,servers:[...n.servers,h]}})},i=n=>{f(h=>({...h,servers:h.servers.filter((y,F)=>F!==n)}))},m=(n,h,y)=>{const F=[...r.backup_servers||[]];F[n]={...F[n],[h]:y},f(D=>({...D,backup_servers:F}))},g=()=>{f(n=>{var h;return{...n,backup_servers:[...n.backup_servers||[],{name:`Backup Server ${(((h=n.backup_servers)==null?void 0:h.length)||0)+1}`,url:"",quality:"1080p",no_sub_url:""}]}})},k=n=>{f(h=>({...h,backup_servers:(h.backup_servers||[]).filter((y,F)=>F!==n)}))},c=n=>{if(n.preventDefault(),r.genres.length===0){alert("الرجاء اختيار فئة واحدة على الأقل.");return}const h=w.split(",").map(y=>y.trim()).filter(y=>y!=="");l({...r,tags:h})},L=o.filter(n=>n.toLowerCase().includes(z.toLowerCase())),P="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 focus:border-cyan-500 outline-none transition",J="bg-slate-600 text-white p-2 rounded-md border-2 border-slate-500 focus:border-cyan-500 outline-none focus:ring-2 focus:ring-cyan-500 transition";return e.jsxs("form",{onSubmit:c,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("div",{children:e.jsx("input",{type:"text",name:"title",value:r.title,onChange:b,placeholder:"عنوان الفيلم",required:!0,className:P})}),e.jsx("input",{type:"number",name:"year",value:r.year||"",onChange:b,placeholder:"سنة الإنتاج",required:!0,className:P})]}),e.jsx("textarea",{name:"description",value:r.description,onChange:b,placeholder:"وصف الفيلم",required:!0,className:`${P} h-32`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"poster_url",value:r.poster_url,onChange:b,placeholder:"رابط صورة البوستر",required:!0,className:P}),e.jsx("input",{type:"url",name:"backdrop_url",value:r.backdrop_url,onChange:b,placeholder:"رابط صورة الخلفية",required:!0,className:P})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:r.imdb_rating??"",onChange:b,placeholder:"تقيم الفيلم",step:"0.1",min:"0",max:"10",className:P}),e.jsx("input",{type:"url",name:"trailer_url",value:r.trailer_url??"",onChange:b,placeholder:"رابط المقطع الدعائي (اختياري)",className:P})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (Tags)"}),e.jsx("input",{id:"tags",type:"text",name:"tags",value:w,onChange:G,placeholder:"أكشن, بطل خارق, إثارة (مفصولة بفاصلة)",className:P})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"is_kurdish",type:"checkbox",name:"is_kurdish",checked:!!r.is_kurdish,onChange:b,className:"h-5 w-5 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600 focus:ring-offset-slate-800 cursor-pointer"}),e.jsx("label",{htmlFor:"is_kurdish",className:"text-white cursor-pointer",children:"هذا الفيلم مدبلج للكردية"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات (اختر واحدة على الأقل)"}),e.jsxs("div",{className:"relative",ref:E,children:[e.jsxs("button",{type:"button",onClick:()=>V(n=>!n),className:`${P} text-right flex justify-between items-center`,children:[e.jsx("span",{children:r.genres.length>0?r.genres.join(", "):"اختر الفئات..."}),e.jsx("svg",{className:`h-5 w-5 transition-transform duration-200 ${U?"rotate-180":""}`,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),U&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[e.jsx("div",{className:"p-2 border-b border-slate-700",children:e.jsx("input",{type:"text",placeholder:"ابحث أو أضف فئة...",value:z,onChange:n=>M(n.target.value),className:"w-full bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"})}),e.jsx("ul",{className:"p-1",children:L.map(n=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.genres.includes(n),onChange:()=>I(n),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:n})]},n))}),e.jsx("div",{className:"p-2 border-t border-slate-700",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"إضافة فئة جديدة...",value:C,onChange:n=>A(n.target.value),className:"flex-grow bg-slate-700 text-white p-2 rounded-md border-slate-600 outline-none"}),e.jsx("button",{type:"button",onClick:q,disabled:T||!C.trim(),className:"bg-cyan-600 text-white px-3 py-1 rounded-md text-sm hover:bg-cyan-700 disabled:bg-slate-500",children:T?"...":"إضافة"})]})})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات المشاهدة"}),r.servers.map((n,h)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:n.name,onChange:y=>v(h,"name",y.target.value),placeholder:"اسم السيرفر",className:`${J} flex-1`}),e.jsxs("select",{value:n.quality,onChange:y=>v(h,"quality",y.target.value),className:`${J} w-28`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),r.servers.length>1&&e.jsx("button",{type:"button",onClick:()=>i(h),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),h===0?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{type:"url",value:n.url,onChange:y=>v(h,"url",y.target.value),placeholder:"رابط السيرفر 1",required:!0,className:`${J} w-full`}),e.jsx("input",{type:"url",name:"download_url",value:r.download_url||"",onChange:b,placeholder:"رابط تحميل الفيلم (اختياري)",className:`${J} w-full`})]}):e.jsx("input",{type:"url",value:n.url,onChange:y=>v(h,"url",y.target.value),placeholder:"رابط السيرفر",required:!0,className:`${J} w-full`})]},h)),e.jsx("button",{type:"button",onClick:x,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر"})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"سيرفرات احتياطية (مشغل خارجي)"}),(r.backup_servers||[]).map((n,h)=>e.jsxs("div",{className:"bg-slate-900/50 p-3 rounded-lg border border-slate-700 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:n.name,onChange:y=>m(h,"name",y.target.value),placeholder:"اسم السيرفر",className:`${J} flex-1`}),e.jsxs("select",{value:n.quality,onChange:y=>m(h,"quality",y.target.value),className:`${J} w-28`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]}),e.jsx("button",{type:"button",onClick:()=>k(h),className:"bg-red-600 text-white p-2 rounded-md hover:bg-red-700 text-xs",children:"X"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsx("input",{type:"url",value:n.url,onChange:y=>m(h,"url",y.target.value),placeholder:"رابط السيرفر (مع ترجمة)",className:`${J} w-full`}),e.jsx("input",{type:"url",value:n.no_sub_url||"",onChange:y=>m(h,"no_sub_url",y.target.value),placeholder:"رابط السيرفر (بدون ترجمة)",className:`${J} w-full`})]})]},h)),e.jsx("button",{type:"button",onClick:g,className:"bg-slate-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-slate-500",children:"إضافة سيرفر احتياطي"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:p,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-slate-500 transition-colors disabled:opacity-50",disabled:j,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:j,children:[j&&e.jsx(ve,{}),j?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث الفيلم":"إضافة الفيلم"]})]})]})},ke=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),X=({isOpen:l,onClose:s,onConfirm:p,title:u,message:j,isLoading:o=!1})=>{const[r,f]=a.useState(l);return a.useEffect(()=>{if(l)f(!0);else{const w=setTimeout(()=>f(!1),300);return()=>clearTimeout(w)}},[l]),r?e.jsx("div",{className:`fixed inset-0 bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-50 p-4 ${l?"animate-fade-in":"animate-fade-out"}`,onClick:s,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:`relative bg-slate-800 p-6 rounded-lg shadow-xl w-full max-w-md border border-slate-700 ${l?"animate-zoom-in":"animate-zoom-out"}`,onClick:w=>w.stopPropagation(),children:[e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-500/20 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:mr-4 sm:text-right flex-grow",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-white",id:"modal-title",children:u}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-slate-300",children:j})})]})]}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse sm:justify-start gap-3",children:[e.jsxs("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 focus:ring-offset-slate-800 sm:w-auto sm:text-sm disabled:bg-red-800 disabled:cursor-not-allowed",onClick:p,disabled:o,children:[o&&e.jsx(ke,{}),o?"جاري الحذف...":"حذف"]}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-slate-600 shadow-sm px-4 py-2 bg-slate-700 text-base font-medium text-white hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 focus:ring-offset-slate-800 sm:mt-0 sm:w-auto sm:text-sm disabled:opacity-50",onClick:s,disabled:o,children:"إلغاء"})]})]})}):null},Ce=10,ye=()=>e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center",children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-40"}),e.jsx("div",{className:"h-8 bg-gray-700 rounded w-64"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsx("tr",{children:[...Array(9)].map((l,s)=>e.jsx("th",{className:"px-4 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},s))})}),e.jsx("tbody",{children:[...Array(Ce)].map((l,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-6 w-6 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-20 w-14 bg-gray-600 rounded"})}),[...Array(7)].map((p,u)=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})},u))]},s))})]})})]}),fe=({message:l,type:s,onClose:p})=>(a.useEffect(()=>{const o=setTimeout(p,5e3);return()=>clearTimeout(o)},[p]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:l}),e.jsx("button",{onClick:p,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),je=({genres:l,onSubmit:s,onClose:p,isLoading:u})=>{const[j,o]=a.useState(l[0]||""),[r,f]=a.useState("add"),w=B=>{B.preventDefault(),j&&s(j,r)};return e.jsx(oe,{title:"تغيير الفئة بشكل جماعي",onClose:p,isOpen:!0,children:e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"اختر فئة لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("select",{value:j,onChange:B=>o(B.target.value),className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:l.map(B=>e.jsx("option",{value:B,children:B},B))}),e.jsxs("select",{value:r,onChange:B=>f(B.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:p,disabled:u,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:u||!j,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[u&&e.jsx(le,{}),u?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},Se=({onSubmit:l,onClose:s,isLoading:p})=>{const[u,j]=a.useState(new Date().getFullYear()),o=r=>{r.preventDefault(),l(u)};return e.jsx(oe,{title:"تغيير سنة الإنتاج بشكل جماعي",onClose:s,isOpen:!0,children:e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل سنة الإنتاج الجديدة ليتم تطبيقها على جميع الأفلام المحددة."}),e.jsx("input",{type:"number",value:u,onChange:r=>j(parseInt(r.target.value)),required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:p,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:p,className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[p&&e.jsx(le,{}),p?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},we=({onSubmit:l,onClose:s,isLoading:p})=>{const[u,j]=a.useState(""),[o,r]=a.useState("add"),f=w=>{w.preventDefault(),u.trim()&&l(u.trim(),o)};return e.jsx(oe,{title:"تغيير الكلمات الدلالية بشكل جماعي",onClose:s,isOpen:!0,children:e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx("p",{className:"text-gray-300",children:"أدخل كلمة دلالية (Tag) لإضافتها أو إزالتها من الأفلام المحددة."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:u,onChange:w=>j(w.target.value),placeholder:"الكلمة الدلالية, مثلاً: بطل خارق",required:!0,className:"flex-grow bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("select",{value:o,onChange:w=>r(w.target.value),className:"bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none",children:[e.jsx("option",{value:"add",children:"إضافة"}),e.jsx("option",{value:"remove",children:"إزالة"})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:s,disabled:p,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:p||!u.trim(),className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800",children:[p&&e.jsx(le,{}),p?"جاري التنفيذ...":"تطبيق التغيير"]})]})]})})},ie=10,_e=()=>{const[l,s]=a.useState([]),[p,u]=a.useState(null),[j,o]=a.useState(!1),[r,f]=a.useState(1),[w,B]=a.useState("all"),[U,V]=a.useState(""),[z,M]=a.useState(!1),[C,A]=a.useState(null),[T,N]=a.useState(!0),[E,b]=a.useState(!1),[G,I]=a.useState(null),[q,v]=a.useState([]),[x,i]=a.useState(null),[m,g]=a.useState([]),k=async()=>{const{data:t,error:S}=await _.from("movies").select("*").order("created_at",{ascending:!1});S?(console.error("Error fetching movies: ",S),c("فشل في تحميل الأفلام.","error")):s(t);const{data:O,error:Y}=await _.from("categories").select("name").order("name");Y?console.error("Error fetching categories from ManageMovies: ",Y):g(O.map(H=>H.name)),N(!1)};a.useEffect(()=>{N(!0),k();const t=_.channel("public:movies").on("postgres_changes",{event:"*",schema:"public",table:"movies"},()=>k()).subscribe();return()=>{_.removeChannel(t)}},[]),a.useEffect(()=>{f(1),v([])},[w,U]);const c=(t,S)=>{I({message:t,type:S})},L=async t=>{b(!0);try{const{error:S}=await _.from("movies").insert([{...t,created_at:new Date().toISOString()}]);if(S)throw S;await k(),o(!1),f(1),c("تمت إضافة الفيلم بنجاح.","success")}catch(S){console.error("Error adding movie: ",S),c("حدث خطأ أثناء إضافة الفيلم.","error")}finally{b(!1)}},P=async(t,S)=>{b(!0);try{const{error:O}=await _.from("movies").update(S).eq("id",t);if(O)throw O;await k(),u(null),o(!1),c("تم تحديث الفيلم بنجاح.","success")}catch(O){console.error("Error updating movie: ",O),c("حدث خطأ أثناء تحديث الفيلم.","error")}finally{b(!1)}},J=t=>{A(t),M(!0)},n=async()=>{if(C){b(!0);try{const{error:t}=await _.from("movies").delete().eq("id",C.id);if(t)throw t;c("تم حذف الفيلم بنجاح.","success")}catch(t){console.error("Error deleting movie: ",t),c("حدث خطأ أثناء حذف الفيلم.","error")}finally{M(!1),A(null),b(!1)}}},h=t=>{u(t),o(!0)},y=()=>{u(null),o(!0)},F=()=>{u(null),o(!1),i(null)},D=t=>{v(S=>S.includes(t)?S.filter(O=>O!==t):[...S,t])},K=t=>{t.target.checked?v($.map(S=>S.id)):v([])},se=async(t,S)=>{b(!0);try{const{error:O}=await _.from("movies").update(t).in("id",q);if(O)throw O;c(S,"success"),v([])}catch(O){console.error("Bulk update failed:",O),c("فشل التحديث الجماعي.","error")}finally{b(!1),i(null)}},te=async()=>{b(!0);try{const{error:t}=await _.from("movies").delete().in("id",q);if(t)throw t;c(`تم حذف ${q.length} فيلم بنجاح.`,"success"),v([])}catch(t){console.error("Bulk delete failed:",t),c("فشل الحذف الجماعي.","error")}finally{b(!1),i(null)}},ue=async(t,S)=>{b(!0);try{const{data:O,error:Y}=await _.from("movies").select("id, genres").in("id",q);if(Y)throw Y;const H=O.map(ae=>{const ne=ae.genres||[];let Z;return S==="add"?Z=[...new Set([...ne,t])]:Z=ne.filter(me=>me!==t),{id:ae.id,genres:Z}}),{error:Q}=await _.from("movies").upsert(H);if(Q)throw Q;c(`تم ${S==="add"?"إضافة":"إزالة"} فئة "${t}" بنجاح.`,"success"),v([])}catch(O){console.error("Bulk genre change failed:",O),c("فشل تغيير الفئة الجماعي.","error")}finally{b(!1),i(null)}},ee=async(t,S)=>{b(!0);try{const{data:O,error:Y}=await _.from("movies").select("id, tags").in("id",q);if(Y)throw Y;const H=O.map(ae=>{const ne=ae.tags||[];let Z;return S==="add"?Z=[...new Set([...ne,t])]:Z=ne.filter(me=>me!==t),{id:ae.id,tags:Z}}),{error:Q}=await _.from("movies").upsert(H);if(Q)throw Q;c(`تم ${S==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${t}" بنجاح.`,"success"),v([])}catch(O){console.error("Bulk tags change failed:",O),c("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{b(!1),i(null)}},re=l.filter(t=>w==="kurdish"?t.is_kurdish===!0:w==="non-kurdish"?!t.is_kurdish:!0).filter(t=>be(U,t.title)),d=Math.ceil(re.length/ie),$=re.slice((r-1)*ie,r*ie),R=t=>`px-4 py-2 text-sm font-bold rounded-lg transition-colors duration-200 ${w===t?"bg-gradient-to-r from-cyan-500 to-blue-500 text-white shadow-md":"bg-slate-700 text-slate-200 hover:bg-slate-600"}`,W=$.length>0&&q.length===$.length;return T?e.jsx(ye,{}):e.jsxs("div",{className:"relative",children:[G&&e.jsx(fe,{...G,onClose:()=>I(null)}),e.jsx(X,{isOpen:z,onClose:()=>M(!1),onConfirm:n,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفيلم ",e.jsxs("strong",{className:"text-white",children:['"',C==null?void 0:C.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:E}),x==="delete"&&e.jsx(X,{isOpen:!0,onClose:()=>i(null),onConfirm:te,title:`تأكيد حذف ${q.length} فيلم`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الأفلام المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:E}),x==="genre"&&e.jsx(je,{genres:m,onClose:F,onSubmit:ue,isLoading:E}),x==="tags"&&e.jsx(we,{onClose:F,onSubmit:ee,isLoading:E}),x==="year"&&e.jsx(Se,{onClose:F,onSubmit:t=>se({year:t},"تم تحديث السنة بنجاح."),isLoading:E}),x==="markKurdish"&&e.jsx(X,{isOpen:!0,onClose:F,onConfirm:()=>se({is_kurdish:!0},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد تحديد كل هذه الأفلام على أنها كردية؟",isLoading:E}),x==="unmarkKurdish"&&e.jsx(X,{isOpen:!0,onClose:F,onConfirm:()=>se({is_kurdish:!1},"تم التحديث بنجاح."),title:"تأكيد",message:"هل تريد إزالة العلامة الكردية من كل هذه الأفلام؟",isLoading:E}),j&&e.jsx(oe,{title:p?"تعديل الفيلم":"إضافة فيلم جديد",onClose:F,isOpen:j,children:e.jsx(Ne,{onSubmit:p?t=>P(p.id,t):L,initialData:p,onCancel:F,isKurdishByDefault:w==="kurdish"&&!p,isLoading:E,allGenres:m})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:y,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة فيلم جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:U,onChange:t=>V(t.target.value),placeholder:"ابحث عن فيلم للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a movie to edit"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-1 bg-slate-900/50 rounded-lg flex-shrink-0",children:[e.jsx("button",{onClick:()=>B("all"),className:R("all"),children:"الكل"}),e.jsx("button",{onClick:()=>B("kurdish"),className:R("kurdish"),children:"كردي فقط"}),e.jsx("button",{onClick:()=>B("non-kurdish"),className:R("non-kurdish"),children:"غير كردي"})]})]}),q.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[q.length," فيلم محدد"]}),e.jsx("button",{onClick:()=>v([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>i("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>i("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>i("year"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير السنة"}),e.jsx("button",{onClick:()=>i("markKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تحديد ككردي"}),e.jsx("button",{onClick:()=>i("unmarkKurdish"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"إلغاء تحديد ككردي"}),e.jsx("button",{onClick:()=>i("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:K,checked:W,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"مدبلج كردي"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:$.map(t=>{var S,O;return e.jsxs("tr",{className:`${q.includes(t.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:q.includes(t.id),onChange:()=>D(t.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:t.poster_url,alt:t.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:t.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:t.imdb_rating?t.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.year}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[(S=t.genres)==null?void 0:S.slice(0,3).map(Y=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:Y},Y)),((O=t.genres)==null?void 0:O.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.is_kurdish?"نعم":"لا"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:t.created_at?new Date(t.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>h(t),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>J(t),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},t.id)})})]})}),re.length>ie&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ge,{currentPage:r,totalPages:d,onPageChange:f})})]})]})},Ee=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),$e=({onSubmit:l,initialData:s,onCancel:p,isLoading:u=!1,allGenres:j=[]})=>{const[o,r]=a.useState({title:"",description:"",poster_url:"",backdrop_url:"",year:new Date().getFullYear(),genres:[],tags:[],seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:"",year:new Date().getFullYear(),episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"}],imdb_rating:0}],trailer_url:"",imdb_rating:0}),[f,w]=a.useState(""),[B,U]=a.useState(!1),V=a.useRef(null);a.useEffect(()=>{s&&(r({...s,genres:s.genres||[],tags:s.tags||[],seasons:s.seasons&&s.seasons.length>0?s.seasons:[{season_number:1,title:"الموسم 1",description:"",poster_url:s.poster_url,year:s.year,episodes:[],imdb_rating:0}],trailer_url:s.trailer_url||"",imdb_rating:s.imdb_rating||0}),w((s.tags||[]).join(", ")))},[s]),a.useEffect(()=>{const x=i=>{V.current&&!V.current.contains(i.target)&&U(!1)};return document.addEventListener("mousedown",x),()=>document.removeEventListener("mousedown",x)},[]);const z=x=>{const{name:i,value:m}=x.target;if(i==="year"||i==="imdb_rating"){const g=parseFloat(m);r(k=>({...k,[i]:isNaN(g)?0:g}))}else r(g=>({...g,[i]:m}))},M=x=>{w(x.target.value)},C=x=>{r(i=>({...i,genres:i.genres.includes(x)?i.genres.filter(m=>m!==x):[...i.genres,x]}))},A=(x,i,m)=>{const g=[...o.seasons],k={...g[x]};if(i==="season_number"||i==="year"||i==="imdb_rating"){const c=typeof m=="string"?parseFloat(m):m;k[i]=isNaN(c)?0:c}else k[i]=m;g[x]=k,r(c=>({...c,seasons:g}))},T=()=>{const x=o.seasons.length>0?Math.max(...o.seasons.map(m=>m.season_number))+1:1,i=o.seasons.length>0?o.seasons[o.seasons.length-1].year:o.year;r(m=>({...m,seasons:[...m.seasons,{season_number:x,title:`الموسم ${x}`,description:"",poster_url:m.poster_url,year:i+1,episodes:[{episode_number:1,title:"الحلقة 1",url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"}],imdb_rating:0}]}))},N=x=>{r(i=>({...i,seasons:i.seasons.filter((m,g)=>g!==x)}))},E=(x,i,m,g)=>{const k=[...o.seasons],c=[...k[x].episodes],L={...c[i]};if(m==="episode_number"){const P=typeof g=="string"?parseFloat(g):g;L[m]=isNaN(P)?0:P}else L[m]=g;c[i]=L,k[x]={...k[x],episodes:c},r(P=>({...P,seasons:k}))},b=x=>{const i=o.seasons[x],m=i.episodes.length>0?Math.max(...i.episodes.map(c=>c.episode_number))+1:1,g={episode_number:m,title:`الحلقة ${m}`,url:"https://vidtube.pro/embed-yabwsjqcvg9i.html",download_url:"",quality:"1080p"},k=o.seasons.map((c,L)=>L===x?{...c,episodes:[...c.episodes,g]}:c);r(c=>({...c,seasons:k}))},G=(x,i)=>{const m=o.seasons.map((g,k)=>k===x?{...g,episodes:g.episodes.filter((c,L)=>L!==i)}:g);r(g=>({...g,seasons:m}))},I=x=>{x.preventDefault();const i=f.split(",").map(m=>m.trim()).filter(Boolean);l({...o,tags:i})},q="w-full bg-slate-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-2 border-slate-600 outline-none",v="bg-slate-600 text-white p-2 rounded-md border border-slate-500 focus:border-cyan-500 outline-none";return e.jsxs("form",{onSubmit:I,className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white border-b border-slate-700 pb-2",children:"معلومات المسلسل الرئيسية"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"text",name:"title",value:o.title,onChange:z,placeholder:"عنوان المسلسل",required:!0,className:q}),e.jsx("input",{type:"number",name:"year",value:o.year||"",onChange:z,placeholder:"سنة بداية العرض",required:!0,className:q})]}),e.jsx("textarea",{name:"description",value:o.description,onChange:z,placeholder:"وصف المسلسل العام",required:!0,className:`${q} h-24`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"url",name:"poster_url",value:o.poster_url,onChange:z,placeholder:"رابط البوستر الرئيسي",required:!0,className:q}),e.jsx("input",{type:"url",name:"backdrop_url",value:o.backdrop_url,onChange:z,placeholder:"رابط صورة الخلفية",required:!0,className:q})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx("input",{type:"number",name:"imdb_rating",value:o.imdb_rating??"",onChange:z,placeholder:"تقييم IMDb (e.g. 8.5)",step:"0.1",min:"0",max:"10",className:q}),e.jsx("input",{type:"url",name:"trailer_url",value:o.trailer_url??"",onChange:z,placeholder:"رابط المقطع الدعائي (اختياري)",className:q})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الفئات"}),e.jsxs("div",{className:"relative",ref:V,children:[e.jsx("button",{type:"button",onClick:()=>U(x=>!x),className:`${q} text-right`,children:o.genres.length>0?o.genres.join(", "):"اختر الفئات..."}),B&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-slate-900 border border-slate-700 rounded-md shadow-lg max-h-60 overflow-y-auto",children:j.map(x=>e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-slate-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o.genres.includes(x),onChange:()=>C(x),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"}),e.jsx("span",{className:"text-white",children:x})]},x))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-lg font-semibold text-white mb-2",children:"الكلمات الدلالية (مفصولة بفاصلة)"}),e.jsx("input",{type:"text",value:f,onChange:M,placeholder:"أكشن, إثارة...",className:q})]}),e.jsxs("div",{className:"space-y-4 border-t border-slate-700 pt-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"المواسم والحلقات"}),o.seasons.map((x,i)=>e.jsxs("div",{className:"bg-slate-900/50 p-4 rounded-lg border border-slate-700 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-white font-semibold",children:"الموسم رقم:"}),e.jsx("input",{type:"number",value:x.season_number||"",onChange:m=>A(i,"season_number",m.target.value),className:`${v} w-20`})]}),e.jsx("button",{type:"button",onClick:()=>N(i),className:"bg-red-600 text-white px-3 py-1 rounded-md text-sm",children:"إزالة الموسم"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[e.jsx("input",{type:"text",value:x.title,onChange:m=>A(i,"title",m.target.value),placeholder:"عنوان الموسم",required:!0,className:v}),e.jsx("input",{type:"number",value:x.year||"",onChange:m=>A(i,"year",m.target.value),placeholder:"سنة الموسم",required:!0,className:v}),e.jsx("input",{type:"number",value:x.imdb_rating??"",onChange:m=>A(i,"imdb_rating",m.target.value),placeholder:"تقييم IMDb",step:"0.1",min:"0",max:"10",className:v}),e.jsx("input",{type:"url",value:x.poster_url,onChange:m=>A(i,"poster_url",m.target.value),placeholder:"رابط بوستر الموسم",required:!0,className:`${v} col-span-1 sm:col-span-3`}),e.jsx("textarea",{value:x.description,onChange:m=>A(i,"description",m.target.value),placeholder:"وصف الموسم",required:!0,className:`${v} h-20 col-span-1 sm:col-span-3`})]}),e.jsxs("div",{className:"space-y-2 pt-3 mt-3 border-t border-slate-600",children:[e.jsxs("h4",{className:"font-semibold text-slate-300",children:["حلقات الموسم ",x.season_number,":"]}),x.episodes.map((m,g)=>e.jsxs("div",{className:"bg-slate-800/60 p-2 rounded-md space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:m.episode_number||"",onChange:k=>E(i,g,"episode_number",k.target.value),placeholder:"رقم",className:`${v} w-16`}),e.jsx("input",{type:"text",value:m.title,onChange:k=>E(i,g,"title",k.target.value),placeholder:"عنوان الحلقة",className:`${v} flex-1`}),e.jsx("button",{type:"button",onClick:()=>G(i,g),className:"bg-red-500 text-white p-2 rounded-md hover:bg-red-600 text-xs",children:"X"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"url",value:m.url,onChange:k=>E(i,g,"url",k.target.value),placeholder:"رابط المشاهدة",required:!0,className:`${v} flex-1`}),e.jsxs("select",{value:m.quality||"1080p",onChange:k=>E(i,g,"quality",k.target.value),className:`${v} w-28 flex-shrink-0`,children:[e.jsx("option",{value:"1080p",children:"1080p"}),e.jsx("option",{value:"720p",children:"720p"}),e.jsx("option",{value:"480p",children:"480p"})]})]}),e.jsx("input",{type:"url",value:m.download_url||"",onChange:k=>E(i,g,"download_url",k.target.value),placeholder:"رابط التحميل (اختياري)",className:`${v} w-full`})]})]},g)),e.jsx("button",{type:"button",onClick:()=>b(i),className:"text-sm bg-slate-600 text-white py-1 px-3 rounded-md hover:bg-slate-500",children:"إضافة حلقة"})]})]},i)),e.jsx("button",{type:"button",onClick:T,className:"bg-cyan-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-700",children:"إضافة موسم"})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-slate-700",children:[e.jsx("button",{type:"button",onClick:p,className:"bg-slate-600 text-white font-bold py-2 px-6 rounded-lg",disabled:u,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg",disabled:u,children:[u&&e.jsx(Ee,{}),s?"تحديث المسلسل":"إضافة المسلسل"]})]})]})},ce=10,Me=()=>{const[l,s]=a.useState([]),[p,u]=a.useState(null),[j,o]=a.useState(!1),[r,f]=a.useState(1),[w,B]=a.useState(""),[U,V]=a.useState(!1),[z,M]=a.useState(null),[C,A]=a.useState(!0),[T,N]=a.useState(!1),[E,b]=a.useState(null),[G,I]=a.useState([]),[q,v]=a.useState(null),[x,i]=a.useState([]),m=async()=>{const{data:d,error:$}=await _.from("series").select("*").order("created_at",{ascending:!1});$?(console.error("Error fetching series: ",$),g("فشل في تحميل المسلسلات.","error")):s(d);const{data:R,error:W}=await _.from("categories").select("name").order("name");W?console.error("Error fetching categories: ",W):i(R.map(t=>t.name)),A(!1)};a.useEffect(()=>{A(!0),m();const d=_.channel("public:series").on("postgres_changes",{event:"*",schema:"public",table:"series"},m).subscribe();return()=>{_.removeChannel(d)}},[]),a.useEffect(()=>{f(1),I([])},[w]);const g=(d,$)=>{b({message:d,type:$})},k=async d=>{N(!0);try{const{error:$}=await _.from("series").insert([{...d,created_at:new Date().toISOString()}]);if($)throw $;await m(),o(!1),f(1),g("تمت إضافة المسلسل بنجاح.","success")}catch($){console.error("Error adding series: ",$),g("حدث خطأ أثناء إضافة المسلسل.","error")}finally{N(!1)}},c=async(d,$)=>{N(!0);try{const{error:R}=await _.from("series").update($).eq("id",d);if(R)throw R;await m(),u(null),o(!1),g("تم تحديث المسلسل بنجاح.","success")}catch(R){console.error("Error updating series:",R),g("حدث خطأ أثناء تحديث المسلسل.","error")}finally{N(!1)}},L=d=>{M(d),V(!0)},P=async()=>{if(z){N(!0);try{const{error:d}=await _.from("series").delete().eq("id",z.id);if(d)throw d;g("تم حذف المسلسل بنجاح.","success")}catch(d){console.error("Error deleting series:",d),g("حدث خطأ أثناء حذف المسلسل.","error")}finally{V(!1),M(null),N(!1)}}},J=d=>{u(d),o(!0)},n=()=>{u(null),o(!0)},h=()=>{u(null),o(!1),v(null)},y=d=>{I($=>$.includes(d)?$.filter(R=>R!==d):[...$,d])},F=d=>{d.target.checked?I(ee.map($=>$.id)):I([])},D=async()=>{N(!0);try{const{error:d}=await _.from("series").delete().in("id",G);if(d)throw d;g(`تم حذف ${G.length} مسلسل بنجاح.`,"success"),I([])}catch(d){console.error("Bulk delete failed:",d),g("فشل الحذف الجماعي.","error")}finally{N(!1),v(null)}},K=async(d,$)=>{N(!0);try{const{data:R,error:W}=await _.from("series").select("id, genres").in("id",G);if(W)throw W;const t=R.map(O=>{const Y=O.genres||[],H=$==="add"?[...new Set([...Y,d])]:Y.filter(Q=>Q!==d);return{id:O.id,genres:H}}),{error:S}=await _.from("series").upsert(t);if(S)throw S;g(`تم ${$==="add"?"إضافة":"إزالة"} فئة "${d}" بنجاح.`,"success"),I([])}catch(R){console.error("Bulk genre change failed:",R),g("فشل تغيير الفئة الجماعي.","error")}finally{N(!1),v(null)}},se=async(d,$)=>{N(!0);try{const{data:R,error:W}=await _.from("series").select("id, tags").in("id",G);if(W)throw W;const t=R.map(O=>{const Y=O.tags||[],H=$==="add"?[...new Set([...Y,d])]:Y.filter(Q=>Q!==d);return{id:O.id,tags:H}}),{error:S}=await _.from("series").upsert(t);if(S)throw S;g(`تم ${$==="add"?"إضافة":"إزالة"} الكلمة الدلالية "${d}" بنجاح.`,"success"),I([])}catch(R){console.error("Bulk tags change failed:",R),g("فشل تغيير الكلمات الدلالية الجماعي.","error")}finally{N(!1),v(null)}},te=l.filter(d=>be(w,d.title)),ue=Math.ceil(te.length/ce),ee=te.slice((r-1)*ce,r*ce),re=ee.length>0&&G.length===ee.length;return C?e.jsx(ye,{}):e.jsxs("div",{className:"relative",children:[E&&e.jsx(fe,{...E,onClose:()=>b(null)}),e.jsx(X,{isOpen:U,onClose:()=>V(!1),onConfirm:P,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسل ",e.jsxs("strong",{className:"text-white",children:['"',z==null?void 0:z.title,'"']}),"؟ ",e.jsx("br",{})," ",e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:T}),q==="delete"&&e.jsx(X,{isOpen:!0,onClose:()=>v(null),onConfirm:D,title:`تأكيد حذف ${G.length} مسلسل`,message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف المسلسلات المحددة؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:T}),q==="genre"&&e.jsx(je,{genres:x,onClose:h,onSubmit:K,isLoading:T}),q==="tags"&&e.jsx(we,{onClose:h,onSubmit:se,isLoading:T}),j&&e.jsx(oe,{title:p?"تعديل المسلسل":"إضافة مسلسل جديد",onClose:h,isOpen:j,children:e.jsx($e,{onSubmit:p?d=>c(p.id,d):k,initialData:p,onCancel:h,isLoading:T,allGenres:x})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center mb-6 gap-4 w-full",children:[e.jsx("button",{onClick:n,className:"bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-bold py-2.5 px-5 rounded-lg hover:from-cyan-600 hover:to-blue-600 transition-all duration-300 shadow-lg w-full sm:w-auto flex-shrink-0",children:"إضافة مسلسل جديد"}),e.jsxs("div",{className:"relative w-full sm:flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",value:w,onChange:d=>B(d.target.value),placeholder:"ابحث عن مسلسل للتعديل...",className:"w-full bg-slate-700 text-white p-2.5 pl-10 rounded-lg focus:ring-2 focus:ring-cyan-500 border-none outline-none transition-colors","aria-label":"Search for a series to edit"})]})]}),G.length>0&&e.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-sm border border-cyan-500 rounded-lg p-3 mb-4 flex flex-wrap items-center justify-between gap-3 animate-fade-in-down",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-white font-bold",children:[G.length," مسلسل محدد"]}),e.jsx("button",{onClick:()=>I([]),className:"text-sm text-cyan-400 hover:underline",children:"إلغاء التحديد"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>v("genre"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الفئة"}),e.jsx("button",{onClick:()=>v("tags"),className:"bg-slate-700 text-sm py-1 px-3 rounded-md hover:bg-slate-600",children:"تغيير الكلمات"}),e.jsx("button",{onClick:()=>v("delete"),className:"bg-red-600 text-sm py-1 px-3 rounded-md hover:bg-red-500",children:"حذف المحدد"})]})]}),e.jsxs("div",{className:"overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-right",children:e.jsx("input",{type:"checkbox",onChange:F,checked:re,className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الصورة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"العنوان"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تقييم IMDb"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"السنة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"الفئات"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"المواسم"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"تاريخ الإضافة"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-slate-400 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-700",children:ee.map(d=>{var $,R,W;return e.jsxs("tr",{className:`${G.includes(d.id)?"bg-cyan-500/20":"hover:bg-slate-700/50"} transition-colors duration-200`,children:[e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"checkbox",checked:G.includes(d.id),onChange:()=>y(d.id),className:"h-4 w-4 text-cyan-500 bg-slate-700 border-slate-600 rounded focus:ring-cyan-600"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap",children:e.jsx("img",{src:d.poster_url,alt:d.title,className:"h-20 w-auto rounded object-cover",loading:"lazy"})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium text-white align-middle",children:d.title}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-yellow-400 font-bold align-middle",children:d.imdb_rating?d.imdb_rating.toFixed(1):"N/A"}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:d.year}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-xs",children:[($=d.genres)==null?void 0:$.slice(0,3).map(t=>e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:t},t)),((R=d.genres)==null?void 0:R.length)>3&&e.jsx("span",{className:"bg-slate-600 text-slate-200 px-2 py-1 text-xs rounded-full",children:"..."})]})}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:((W=d.seasons)==null?void 0:W.length)||0}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-slate-300 align-middle",children:d.created_at?new Date(d.created_at).toLocaleDateString("ar-EG"):"غير متاح"}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium align-middle",children:[e.jsx("button",{onClick:()=>J(d),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>L(d),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},d.id)})})]})}),te.length>ce&&e.jsx("div",{className:"p-4 border-t border-slate-700",children:e.jsx(ge,{currentPage:r,totalPages:ue,onPageChange:f})})]})]})},Ae=()=>e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Oe=({onSubmit:l,initialData:s,onCancel:p,isLoading:u=!1})=>{const[j,o]=a.useState("");a.useEffect(()=>{o(s?s.name:"")},[s]);const r=f=>{f.preventDefault(),j.trim()&&l({name:j})};return e.jsxs("form",{onSubmit:r,className:"space-y-6",children:[e.jsx("input",{type:"text",name:"name",value:j,onChange:f=>o(f.target.value),placeholder:"اسم الفئة",required:!0,className:"w-full bg-gray-700 text-white p-3 rounded-md focus:ring-2 focus:ring-cyan-500 border-none outline-none"}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-gray-700",children:[e.jsx("button",{type:"button",onClick:p,className:"bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-500 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:u,children:"إلغاء"}),e.jsxs("button",{type:"submit",className:"flex items-center justify-center bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-cyan-600 transition-colors disabled:bg-cyan-800 disabled:cursor-not-allowed",disabled:u,children:[u&&e.jsx(Ae,{}),u?s?"جاري التحديث...":"جاري الإضافة...":s?"تحديث":"إضافة"]})]})]})},qe=10,Fe=()=>e.jsx("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden mt-8 animate-pulse",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/3"})}),e.jsx("th",{className:"px-6 py-3",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/4"})})]})}),e.jsx("tbody",{children:[...Array(qe)].map((l,s)=>e.jsxs("tr",{className:"border-b border-gray-700",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"h-4 bg-gray-600 rounded w-1/2"})})]},s))})]})})}),de=10,Te=({message:l,type:s,onClose:p})=>(a.useEffect(()=>{const o=setTimeout(p,5e3);return()=>clearTimeout(o)},[p]),e.jsx("div",{className:`fixed top-24 right-5 z-[100] p-4 rounded-lg shadow-lg text-white border-l-4 animate-fade-in-down ${s==="success"?"bg-green-600 border-green-500":"bg-red-600 border-red-500"}`,role:"alert",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("p",{className:"font-bold",children:l}),e.jsx("button",{onClick:p,className:"absolute top-1 right-2 text-2xl font-bold leading-none",children:"×"})]})})),Be=({children:l,onClose:s,title:p,isOpen:u})=>{const[j,o]=a.useState(u);return a.useEffect(()=>{if(u){o(!0),document.body.style.overflow="hidden";const r=f=>{f.key==="Escape"&&s()};return window.addEventListener("keydown",r),()=>{window.removeEventListener("keydown",r)}}else{const r=setTimeout(()=>{o(!1),document.body.style.overflow="auto"},300);return()=>clearTimeout(r)}},[u,s]),j?e.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 ${u?"animate-fade-in":"animate-fade-out"}`,onClick:s,children:e.jsxs("div",{className:`bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg border border-gray-700 ${u?"animate-zoom-in":"animate-zoom-out"}`,onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:p}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white text-3xl transition-colors",children:"×"})]}),l]})}):null},Ge=()=>{const[l,s]=a.useState([]),[p,u]=a.useState(null),[j,o]=a.useState(!1),[r,f]=a.useState(1),[w,B]=a.useState(!1),[U,V]=a.useState(null),[z,M]=a.useState(!0),[C,A]=a.useState(!1),[T,N]=a.useState(null),E=async()=>{const{data:c,error:L}=await _.from("categories").select("*").order("name");L?(console.error("Error fetching categories: ",L),b("فشل في تحميل الفئات.","error")):s(c),M(!1)};a.useEffect(()=>{M(!0),E();const c=_.channel("public:categories").on("postgres_changes",{event:"*",schema:"public",table:"categories"},E).subscribe();return()=>{_.removeChannel(c)}},[]);const b=(c,L)=>{N({message:c,type:L})},G=async c=>{A(!0);try{const{error:L}=await _.from("categories").insert([c]);if(L)throw L;b("تمت إضافة الفئة بنجاح!","success"),o(!1),f(1)}catch(L){console.error("Error adding category: ",L),b("حدث خطأ أثناء إضافة الفئة.","error")}finally{A(!1)}},I=async(c,L)=>{A(!0);try{const{error:P}=await _.from("categories").update(L).eq("id",c);if(P)throw P;b("تم تحديث الفئة بنجاح!","success"),u(null),o(!1)}catch(P){console.error("Error updating category: ",P),b("حدث خطأ أثناء تحديث الفئة.","error")}finally{A(!1)}},q=c=>{V(c),B(!0)},v=async()=>{if(U){A(!0);try{const{error:c}=await _.from("categories").delete().eq("id",U.id);if(c)throw c;b("تم حذف الفئة بنجاح!","success")}catch(c){console.error("Error deleting category: ",c),b("حدث خطأ أثناء حذف الفئة.","error")}finally{B(!1),V(null),A(!1)}}},x=c=>{u(c),o(!0)},i=()=>{u(null),o(!0)},m=()=>{u(null),o(!1)},g=Math.ceil(l.length/de),k=l.slice((r-1)*de,r*de);return z?e.jsxs("div",{children:[e.jsx("div",{className:"h-10 bg-gray-700 rounded w-48 mb-6 animate-pulse"}),e.jsx(Fe,{})]}):e.jsxs("div",{children:[T&&e.jsx(Te,{...T,onClose:()=>N(null)}),e.jsx(X,{isOpen:w,onClose:()=>B(!1),onConfirm:v,title:"تأكيد الحذف",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد حذف الفئة ",e.jsxs("strong",{className:"text-white",children:['"',U==null?void 0:U.name,'"']}),"؟",e.jsx("br",{}),e.jsx("span",{className:"text-yellow-400",children:"لا يمكن التراجع عن هذا الإجراء."})]}),isLoading:C}),e.jsx(Be,{isOpen:j,title:p?"تعديل الفئة":"إضافة فئة جديدة",onClose:m,children:e.jsx(Oe,{onSubmit:p?c=>I(p.id,c):G,initialData:p,onCancel:m,isLoading:C})}),e.jsx("button",{onClick:i,className:"mb-6 bg-cyan-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-cyan-600 transition-colors",children:"إضافة فئة جديدة"}),e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"اسم الفئة"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"إجراءات"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-700",children:l.length>0?k.map(c=>e.jsxs("tr",{className:"hover:bg-gray-700/50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-white",children:c.name}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[e.jsx("button",{onClick:()=>x(c),className:"text-cyan-400 hover:text-cyan-300 ml-4",children:"تعديل"}),e.jsx("button",{onClick:()=>q(c),className:"text-red-500 hover:text-red-400",children:"حذف"})]})]},c.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"text-center py-8 text-gray-400",children:"لا توجد فئات حالياً."})})})]})}),l.length>de&&e.jsx("div",{className:"p-4 border-t border-gray-700",children:e.jsx(ge,{currentPage:r,totalPages:g,onPageChange:f})})]})]})},he=["movies","series","categories"],Le=l=>l.replace(/[A-Z]/g,s=>`_${s.toLowerCase()}`),pe=l=>Array.isArray(l)?l.map(s=>pe(s)):l!==null&&typeof l=="object"&&l.constructor===Object?l.hasOwnProperty("seconds")&&l.hasOwnProperty("nanoseconds")&&Object.keys(l).length===2&&typeof l.seconds=="number"&&typeof l.nanoseconds=="number"?new Date(l.seconds*1e3).toISOString():l.hasOwnProperty("_seconds")&&l.hasOwnProperty("_nanoseconds")&&Object.keys(l).length===2&&typeof l._seconds=="number"&&typeof l._nanoseconds=="number"?new Date(l._seconds*1e3).toISOString():Object.keys(l).reduce((s,p)=>{const u=Le(p);return s[u]=pe(l[p]),s},{}):l,Pe=()=>{const[l,s]=a.useState(!1),[p,u]=a.useState(null),[j,o]=a.useState(!1),[r,f]=a.useState(null),w=(M,C)=>{u({message:M,type:C})},B=async()=>{s(!0),w("بدء عملية النسخ الاحتياطي... قد تستغرق هذه العملية بعض الوقت.","success");try{const M={};for(const b of he){const{data:G,error:I}=await _.from(b).select("*");if(I)throw I;M[b]=G||[]}const C=JSON.stringify(M,null,2),A=new Blob([C],{type:"application/json"}),T=URL.createObjectURL(A),N=document.createElement("a");N.href=T;const E=new Date().toISOString().slice(0,10);N.download=`supabase-backup-${E}.json`,document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(T),w("تم إكمال النسخ الاحتياطي بنجاح!","success")}catch(M){console.error("Backup failed:",M);let C="فشل النسخ الاحتياطي. تحقق من وحدة التحكم لمزيد من التفاصيل.";M.code==="42501"&&(C="فشل النسخ الاحتياطي: أذونات غير كافية. تأكد من أن قواعد RLS تسمح للمشرفين بقراءة المجموعات."),w(C,"error")}finally{s(!1)}},U=M=>{var A;const C=(A=M.target.files)==null?void 0:A[0];if(C){const T=new FileReader;T.onload=N=>{var E;try{const b=(E=N.target)==null?void 0:E.result,G=JSON.parse(b);f(G)}catch(b){w("ملف JSON غير صالح.","error"),console.error("JSON parsing error:",b),f(null)}},T.readAsText(C)}},V=()=>{r?o(!0):w("الرجاء تحديد ملف نسخ احتياطي أولاً.","error")},z=async()=>{if(o(!1),!!r){s(!0),w("بدء عملية الاستعادة... هذه العملية ستستغرق وقتاً.","success");try{let M=0,C=[];for(const T of Object.keys(r)){if(!he.includes(T)){C.push(T),console.warn(`Skipping restore for unsupported collection: "${T}"`);continue}const N=r[T];if(Array.isArray(N)&&N.length>0){const E=N.map(G=>pe(G)),{error:b}=await _.from(T).upsert(E);if(b)throw console.error(`Error during upsert to "${T}":`,JSON.stringify(b,null,2)),console.error("First failed object (transformed):",JSON.stringify(E[0],null,2)),b;M++}}let A="تمت استعادة البيانات بنجاح!";C.length>0&&(A+=` تم تخطي المجموعات التالية: ${C.join(", ")}.`),M===0&&C.length>0?w(`لم يتم العثور على مجموعات بيانات صالحة للاستعادة في الملف. تم تخطي: ${C.join(", ")}.`,"error"):M>0?w(A,"success"):w("لم يتم العثور على بيانات صالحة للاستعادة في الملف.","error")}catch(M){console.error("Restore failed:",JSON.stringify(M,null,2));const C=`فشلت عملية الاستعادة: ${M.message||"خطأ غير معروف"}. يرجى مراجعة وحدة التحكم للحصول على التفاصيل الفنية.`;w(C,"error")}finally{s(!1),f(null)}}};return e.jsxs("div",{className:"space-y-12",children:[p&&e.jsx(fe,{...p,onClose:()=>u(null)}),e.jsx(X,{isOpen:j,onClose:()=>o(!1),onConfirm:z,title:"تأكيد استعادة البيانات",message:e.jsxs(e.Fragment,{children:["هل أنت متأكد أنك تريد استعادة البيانات من هذا الملف؟",e.jsx("br",{}),e.jsx("strong",{className:"text-yellow-400",children:"تحذير:"})," سيتم الكتابة فوق أي بيانات موجودة في المجموعات التي لها نفس الأسماء. لا يمكن التراجع عن هذا الإجراء."]}),isLoading:l}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"النسخ الاحتياطي للبيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:["انقر على الزر أدناه لتصدير بيانات المحتوى العام (",he.join(", "),"). لا يتم تضمين بيانات المستخدمين والمشرفين الخاصة في هذا النسخ الاحتياطي من جانب العميل لأسباب تتعلق بالأمان والأذونات."]}),e.jsxs("button",{onClick:B,disabled:l,className:"w-full flex items-center justify-center bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-800 disabled:cursor-wait",children:[l&&e.jsx(le,{}),l?"جاري التصدير...":"تصدير بيانات المحتوى الآن"]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"استعادة البيانات"}),e.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-slate-700 space-y-4",children:[e.jsxs("div",{className:"p-4 border-l-4 border-yellow-500 bg-yellow-500/10 text-yellow-300 rounded-md",children:[e.jsx("strong",{className:"font-bold",children:"تحذير خطير:"})," استعادة البيانات من ملف ستقوم بالكتابة فوق البيانات الحالية في قاعدة البيانات. استخدم هذه الميزة بحذر شديد وتأكد من أنك تستخدم ملف النسخ الاحتياطي الصحيح."]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"1. حدد ملف النسخ الاحتياطي (.json)"}),e.jsx("input",{type:"file",accept:".json",onChange:U,className:"w-full text-sm text-slate-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-500/20 file:text-cyan-300 hover:file:bg-cyan-500/30"})]}),e.jsxs("button",{onClick:V,disabled:l||!r,className:"w-full flex items-center justify-center bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors disabled:bg-red-800 disabled:cursor-not-allowed disabled:cursor-wait",children:[l&&e.jsx(le,{}),l?"جاري الاستعادة...":"2. استعادة البيانات"]})]})]})]})},xe=[{key:"movies",label:"إدارة الأفلام",component:e.jsx(_e,{})},{key:"series",label:"إدارة المسلسلات",component:e.jsx(Me,{})},{key:"categories",label:"إدارة الفئات",component:e.jsx(Ge,{})},{key:"backup",label:"النسخ الاحتياطي والاستعادة",component:e.jsx(Pe,{})}],Re=({label:l,tabKey:s,activeTab:p,onClick:u})=>e.jsx("button",{onClick:()=>u(s),className:`px-4 py-3 font-bold transition-colors duration-300 border-b-2 -mb-px ${p===s?"text-cyan-400 border-cyan-400":"text-slate-400 border-transparent hover:text-white hover:border-slate-500"}`,role:"tab","aria-selected":p===s,children:l}),De=()=>{var u;const[l,s]=a.useState(xe[0].key),p=(u=xe.find(j=>j.key===l))==null?void 0:u.component;return e.jsxs("div",{className:"container mx-auto px-4 py-8 animate-fade-in",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8",children:"لوحة تحكم المشرف"}),e.jsx("div",{className:"flex border-b border-slate-700 mb-6",role:"tablist",children:xe.map(j=>e.jsx(Re,{label:j.label,tabKey:j.key,activeTab:l,onClick:s},j.key))}),e.jsx("div",{role:"tabpanel",className:"bg-slate-800 p-6 rounded-lg border border-slate-700",children:p})]})};export{De as default};
