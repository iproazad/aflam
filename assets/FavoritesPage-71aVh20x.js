import{r,b as E,j as e,L as I,d as P}from"./index-SB9iHKDM.js";import{u as w}from"./MovieCardSkeleton-0pZWhUh-.js";import{M as F}from"./MovieGridSkeleton-4Q3-vxbl.js";import{M as k}from"./MovieGrid-CQLL3gWJ.js";import{I as L}from"./InfiniteScrollTrigger-BVp-5I8K.js";import"./MovieCard-C3DD8GqL.js";const p=28,Z=()=>{const[a,i]=r.useState([]),[M,n]=r.useState(!0),{favorites:o}=w();E();const[c,b]=r.useState(1),[l,d]=r.useState(!1);r.useEffect(()=>{(async()=>{if(o.length===0){i([]),n(!1);return}n(!0);try{const x=[];for(let t=0;t<o.length;t+=30)x.push(o.slice(t,t+30));const N=x.map(t=>P.collection("movies").where(window.firebase.firestore.FieldPath.documentId(),"in",t).get()),g=(await Promise.all(N)).flatMap(t=>t.docs.map(s=>({id:s.id,...s.data()})));g.sort((t,s)=>{var u,v;return(u=t.createdAt)!=null&&u.toMillis&&((v=s.createdAt)!=null&&v.toMillis)?s.createdAt.toMillis()-t.createdAt.toMillis():0}),i(g)}catch(h){console.error("Error fetching favorite movies: ",h),i([])}finally{n(!1)}})()},[o]);const j=Math.ceil(a.length/p),m=c<j,y=()=>{m&&!l&&(d(!0),setTimeout(()=>{b(f=>f+1),d(!1)},500))},S=a.slice(0,c*p);return M?e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8 border-r-4 border-cyan-400 pr-4",children:"أفلامي المفضلة"}),e.jsx(F,{count:18})]}):e.jsxs("div",{className:"animate-fade-in",children:[e.jsx("h1",{className:"text-4xl font-black text-white mb-8 border-r-4 border-cyan-400 pr-4",children:"أفلامي المفضلة"}),a.length>0?e.jsxs(e.Fragment,{children:[e.jsx(k,{movies:S}),e.jsx(L,{onIntersect:y,hasMore:m,isLoading:l})]}):e.jsxs("div",{className:"text-center p-12 bg-gray-800/50 rounded-lg mt-8",children:[e.jsx("p",{className:"text-2xl text-gray-300 mb-4",children:"قائمة المفضلة فارغة."}),e.jsx("p",{className:"text-gray-400 mb-6",children:"أضف أفلامًا إلى قائمتك بالنقر على أيقونة القلب."}),e.jsx(I,{to:"/",className:"inline-block bg-cyan-500 text-white font-bold px-6 py-3 rounded-lg hover:bg-cyan-600 transition-colors",children:"تصفح الأفلام"})]})]})};export{Z as default};
