import{r as a,a as I,d as w,j as s}from"./index-Dz8sUt64.js";import{f as L,H as V,a as q,S as J,b as U,G as W,T as X,Y as Z}from"./search-CnkKfoKB.js";import{M as $,a as ee}from"./MovieGridSkeleton-DhUE-vRA.js";import{P as te}from"./Pagination-DS74TubZ.js";import"./MovieCardSkeleton-Ce4PeUu6.js";const v=28,ne=()=>{const[i,C]=a.useState([]),[N,T]=a.useState([]),[G,_]=a.useState(!0),[o,E]=a.useState("all"),[n,y]=a.useState([]),[c,M]=a.useState([]),[d,P]=a.useState("createdAt_desc"),[g,F]=a.useState(""),{getAverageRating:u}=I(),[S,A]=a.useState(1);a.useEffect(()=>{(async()=>{try{let r=(await w.collection("movies").where("isKurdish","==",!0).get()).docs.map(l=>({id:l.id,...l.data()}));r.sort((l,m)=>{var h,f;const x=(h=l.createdAt)!=null&&h.toMillis?l.createdAt.toMillis():0;return((f=m.createdAt)!=null&&f.toMillis?m.createdAt.toMillis():0)-x}),C(r)}catch(t){console.error("Error fetching movies: ",t)}finally{_(!1)}})()},[]),a.useEffect(()=>{const e=w.collection("categories").orderBy("name").onSnapshot(t=>{const r=t.docs.map(l=>l.data().name);T(r)},t=>{console.error("Error fetching categories for Kurdish page: ",t)});return()=>e()},[]);const B=e=>{y(t=>t.includes(e)?t.filter(r=>r!==e):[...t,e])},Y=()=>{y([])},R=e=>{M(t=>t.includes(e)?t.filter(r=>r!==e):[...t,e])},k=()=>{M([])},z=[...new Set(i.map(e=>e.year))].sort((e,t)=>t-e),H=N,K=[...new Set(i.flatMap(e=>e.tags||[]))].sort(),j=a.useMemo(()=>i.filter(e=>o==="all"||e.year.toString()===o).filter(e=>n.length===0?!0:n.some(t=>{var r;return(r=e.genres)==null?void 0:r.includes(t)})).filter(e=>c.length===0?!0:c.some(t=>{var r;return(r=e.tags)==null?void 0:r.includes(t)})).filter(e=>L(g,e.title)).sort((e,t)=>{var r,l,m,x;switch(d){case"rating_desc":return u(t.id).average-u(e.id).average;case"rating_asc":return u(e.id).average-u(t.id).average;case"year_desc":return t.year-e.year;case"year_asc":return e.year-t.year;case"createdAt_asc":const b=(r=e.createdAt)!=null&&r.toMillis?e.createdAt.toMillis():0,h=(l=t.createdAt)!=null&&l.toMillis?t.createdAt.toMillis():0;return Number(b)-Number(h);case"createdAt_desc":default:const f=(m=t.createdAt)!=null&&m.toMillis?t.createdAt.toMillis():0,Q=(x=e.createdAt)!=null&&x.toMillis?e.createdAt.toMillis():0;return Number(f)-Number(Q)}}),[i,o,n,c,g,d,u]);a.useEffect(()=>{A(1)},[o,n,c,g,d]);const p=Math.ceil(j.length/v),O=j.slice((S-1)*v,S*v),D=g!==""||o!=="all"||n.length>0||c.length>0||d!=="createdAt_desc";return G?s.jsxs("div",{children:[s.jsx(V,{}),s.jsx("div",{className:"my-8 h-20 bg-gray-800/50 rounded-lg animate-pulse"}),s.jsxs("section",{className:"mb-12",children:[s.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:"الأفلام المدبلجة للكردية"}),s.jsx($,{count:18})]})]}):s.jsxs("div",{children:[s.jsx(q,{movies:i.slice(0,5)}),s.jsxs("div",{className:"relative z-30 my-8 flex flex-col md:flex-row justify-between items-center gap-4 p-4 bg-slate-900/70 backdrop-blur-sm rounded-xl",children:[s.jsx(J,{searchQuery:g,onSearchChange:F}),s.jsxs("div",{className:"w-full md:w-auto flex flex-col md:flex-row md:flex-wrap justify-center items-center gap-4",children:[s.jsx(U,{sortOrder:d,onSortChange:P}),s.jsx(W,{genres:H,selectedGenres:n,onToggleGenre:B,onClearGenres:Y}),s.jsx(X,{tags:K,selectedTags:c,onToggleTag:R,onClearTags:k}),s.jsx(Z,{years:z,selectedYear:o,onYearChange:E})]})]}),s.jsxs("section",{className:"mb-12",children:[s.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-6 border-r-4 border-cyan-400 pr-4",children:D?"نتائج البحث":"الأفلام المدبلجة للكردية"}),j.length>0?s.jsxs(s.Fragment,{children:[s.jsx(ee,{movies:O}),p>1&&s.jsx(te,{currentPage:S,totalPages:p,onPageChange:A})]}):s.jsx("div",{className:"text-center p-8 bg-gray-800 rounded-lg mt-8",children:s.jsx("p",{className:"text-xl text-gray-400",children:"لا توجد أفلام مدبلجة للكردية تطابق معايير البحث."})})]})]})};export{ne as default};
